<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>OpenSocial Application Specification 3.0</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Overview">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Notation and Conventions">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Versioning">
<link href="#rfc.section.1.3" rel="Chapter" title="1.3 Application Roles">
<link href="#rfc.section.2" rel="Chapter" title="2 The Application Specification Document">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Conventions and Notes">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Document Structure">
<link href="#rfc.section.2.2.1" rel="Chapter" title="2.2.1 The &lt;Module&gt; Element">
<link href="#rfc.section.2.2.2" rel="Chapter" title="2.2.2 The &lt;ModulePrefs&gt; Element">
<link href="#rfc.section.2.2.3" rel="Chapter" title="2.2.3 The &lt;Require&gt; and &lt;Optional&gt; Elements">
<link href="#rfc.section.2.2.3.1" rel="Chapter" title="2.2.3.1 The &lt;Param&gt; Element">
<link href="#rfc.section.2.2.4" rel="Chapter" title="2.2.4 The &lt;Preload&gt; Element">
<link href="#rfc.section.2.2.5" rel="Chapter" title="2.2.5 The &lt;Link&gt; Element">
<link href="#rfc.section.2.2.6" rel="Chapter" title="2.2.6 The &lt;Locale&gt; Element">
<link href="#rfc.section.2.2.7" rel="Chapter" title="2.2.7 The &lt;OAuth&gt; Element">
<link href="#rfc.section.2.2.8" rel="Chapter" title="2.2.8 The &lt;OAuth2&gt; Element">
<link href="#rfc.section.2.2.9" rel="Chapter" title="2.2.9 The &lt;UserPref&gt; Element">
<link href="#rfc.section.2.2.9.1" rel="Chapter" title="2.2.9.1 User Preference Data Types">
<link href="#rfc.section.2.2.10" rel="Chapter" title="2.2.10 The &lt;Data&gt; Element">
<link href="#rfc.section.2.2.11" rel="Chapter" title="2.2.11 The &lt;ExternalServices&gt; Element">
<link href="#rfc.section.2.2.12" rel="Chapter" title="2.2.12 The &lt;Content&gt; Element">
<link href="#rfc.section.2.2.12.1" rel="Chapter" title="2.2.12.1 Processing Model">
<link href="#rfc.section.2.2.12.1.1" rel="Chapter" title="2.2.12.1.1 HTML Content">
<link href="#rfc.section.2.2.12.1.2" rel="Chapter" title="2.2.12.1.2 Proxied Content">
<link href="#rfc.section.2.2.12.1.3" rel="Chapter" title="2.2.12.1.3 Redirected Content">
<link href="#rfc.section.2.2.12.1.4" rel="Chapter" title="2.2.12.1.4 Authentication for Proxied and Redirected Content">
<link href="#rfc.section.2.2.13" rel="Chapter" title="2.2.13 Extensibility">
<link href="#rfc.section.3" rel="Chapter" title="3 Container-Provided Capabilities">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Authentication">
<link href="#rfc.section.3.1.1" rel="Chapter" title="3.1.1 Signed Fetch">
<link href="#rfc.section.3.1.1.1" rel="Chapter" title="3.1.1.1 Using Signed Fetch">
<link href="#rfc.section.3.1.2" rel="Chapter" title="3.1.2 OAuth Support">
<link href="#rfc.section.3.1.2.1" rel="Chapter" title="3.1.2.1 Declaring and Using OAuth Services">
<link href="#rfc.section.3.1.2.1.1" rel="Chapter" title='3.1.2.1.1 The "OAUTH_USE_TOKEN" parameter'>
<link href="#rfc.section.3.1.2.2" rel="Chapter" title="3.1.2.2 Processing Model">
<link href="#rfc.section.3.1.2.2.1" rel="Chapter" title="3.1.2.2.1 Acquiring Access Tokens">
<link href="#rfc.section.3.1.2.2.2" rel="Chapter" title="3.1.2.2.2 Sending OAuth 2.0 Protected Requests">
<link href="#rfc.section.3.1.2.2.3" rel="Chapter" title="3.1.2.2.3 401 Unauthorized Responses">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Caching">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Variable Substitution">
<link href="#rfc.section.3.3.1" rel="Chapter" title="3.3.1 Using Literal Statements">
<link href="#rfc.section.3.3.2" rel="Chapter" title="3.3.2 Using Data Pipeline Variables">
<link href="#rfc.section.3.3.3" rel="Chapter" title="3.3.3 Using Reserved Variable Keys">
<link href="#rfc.section.3.3.4" rel="Chapter" title="3.3.4 Deprecated Expression Syntax">
<link href="#rfc.section.3.3.5" rel="Chapter" title="3.3.5 Processing Requirements">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Localization">
<link href="#rfc.section.3.4.1" rel="Chapter" title="3.4.1 Considerations for Bidirectional Text">
<link href="#rfc.section.3.4.2" rel="Chapter" title="3.4.2 Message Bundle Documents">
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 Application Lifecycle Events">
<link href="#rfc.section.3.5.1" rel="Chapter" title="3.5.1 Lifecycle Event Notifications">
<link href="#rfc.section.3.5.2" rel="Chapter" title="3.5.2 Legacy Support">
<link href="#rfc.section.3.6" rel="Chapter" title="3.6 Data Pipelining">
<link href="#rfc.section.3.6.1" rel="Chapter" title="3.6.1 The DataContext">
<link href="#rfc.section.3.6.2" rel="Chapter" title="3.6.2 Data Pipeline Elements and the Data Block">
<link href="#rfc.section.3.6.3" rel="Chapter" title="3.6.3 Data Pipeline Elements within HTML Content">
<link href="#rfc.section.3.6.4" rel="Chapter" title="3.6.4 Data Pipeline Elements and Proxied Content">
<link href="#rfc.section.3.6.5" rel="Chapter" title="3.6.5 The Data Pipeline Elements">
<link href="#rfc.section.3.6.5.1" rel="Chapter" title="3.6.5.1 The &lt;os:DataRequest&gt; Element">
<link href="#rfc.section.3.6.5.2" rel="Chapter" title="3.6.5.2 The &lt;os:HttpRequest&gt; Element">
<link href="#rfc.section.3.6.5.3" rel="Chapter" title="3.6.5.3 The &lt;os:Var&gt; Element">
<link href="#rfc.section.3.6.5.4" rel="Chapter" title="3.6.5.4 Expression Statements within Data Pipeline Attributes">
<link href="#rfc.section.4" rel="Chapter" title="4 Container-Provided Features">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Core Features">
<link href="#rfc.section.4.1.1" rel="Chapter" title="4.1.1 The Logging Feature">
<link href="#rfc.section.4.1.1.1" rel="Chapter" title="4.1.1.1 JavaScript API">
<link href="#rfc.section.4.1.1.1.1" rel="Chapter" title="4.1.1.1.1 gadgets.log">
<link href="#rfc.section.4.1.1.1.2" rel="Chapter" title="4.1.1.1.2 gadgets.warn">
<link href="#rfc.section.4.1.1.1.3" rel="Chapter" title="4.1.1.1.3 gadgets.error">
<link href="#rfc.section.4.1.1.1.4" rel="Chapter" title="4.1.1.1.4 gadgets.setLogLevel">
<link href="#rfc.section.4.1.2" rel="Chapter" title="4.1.2 The IO Feature">
<link href="#rfc.section.4.1.2.1" rel="Chapter" title="4.1.2.1 JavaScript API">
<link href="#rfc.section.4.1.2.1.1" rel="Chapter" title="4.1.2.1.1 gadgets.io.encodeValues">
<link href="#rfc.section.4.1.2.1.2" rel="Chapter" title="4.1.2.1.2 gadgets.io.getProxyUrl">
<link href="#rfc.section.4.1.2.1.3" rel="Chapter" title="4.1.2.1.3 gadgets.io.makeRequest">
<link href="#rfc.section.4.1.2.1.3.1" rel="Chapter" title="4.1.2.1.3.1 The callback parameter and the Response Object">
<link href="#rfc.section.4.1.3" rel="Chapter" title="4.1.3 The JSON Feature">
<link href="#rfc.section.4.1.3.1" rel="Chapter" title="4.1.3.1 JavaScript API">
<link href="#rfc.section.4.1.3.1.1" rel="Chapter" title="4.1.3.1.1 gadgets.json.parse">
<link href="#rfc.section.4.1.3.1.2" rel="Chapter" title="4.1.3.1.2 gadgets.json.stringify">
<link href="#rfc.section.4.1.4" rel="Chapter" title="4.1.4 The User Preferences Feature">
<link href="#rfc.section.4.1.4.1" rel="Chapter" title="4.1.4.1 JavaScript API">
<link href="#rfc.section.4.1.4.1.1" rel="Chapter" title="4.1.4.1.1 The gadgets.Prefs Object">
<link href="#rfc.section.4.1.4.1.1.1" rel="Chapter" title="4.1.4.1.1.1 gadgets.Prefs.getArray">
<link href="#rfc.section.4.1.4.1.1.2" rel="Chapter" title="4.1.4.1.1.2 gadgets.Prefs.getBool">
<link href="#rfc.section.4.1.4.1.1.3" rel="Chapter" title="4.1.4.1.1.3 gadgets.Prefs.getCountry">
<link href="#rfc.section.4.1.4.1.1.4" rel="Chapter" title="4.1.4.1.1.4 gadgets.Prefs.getFloat">
<link href="#rfc.section.4.1.4.1.1.5" rel="Chapter" title="4.1.4.1.1.5 gadgets.Prefs.getInt">
<link href="#rfc.section.4.1.4.1.1.6" rel="Chapter" title="4.1.4.1.1.6 gadgets.Prefs.getLang">
<link href="#rfc.section.4.1.4.1.1.7" rel="Chapter" title="4.1.4.1.1.7 gadgets.Prefs.getModuleId">
<link href="#rfc.section.4.1.4.1.1.8" rel="Chapter" title="4.1.4.1.1.8 gadgets.Prefs.getMsg">
<link href="#rfc.section.4.1.4.1.1.9" rel="Chapter" title="4.1.4.1.1.9 gadgets.Prefs.getString">
<link href="#rfc.section.4.1.4.2" rel="Chapter" title='4.1.4.2 The "setprefs" Feature'>
<link href="#rfc.section.4.1.4.2.1" rel="Chapter" title="4.1.4.2.1 JavaScript API">
<link href="#rfc.section.4.1.4.2.1.1" rel="Chapter" title="4.1.4.2.1.1 gadgets.Prefs.set">
<link href="#rfc.section.4.1.4.2.1.2" rel="Chapter" title="4.1.4.2.1.2 gadgets.Prefs.setArray">
<link href="#rfc.section.4.1.5" rel="Chapter" title="4.1.5 The Utility Feature">
<link href="#rfc.section.4.1.5.1" rel="Chapter" title="4.1.5.1 JavaScript API">
<link href="#rfc.section.4.1.5.1.1" rel="Chapter" title="4.1.5.1.1 gadgets.util.escapeString">
<link href="#rfc.section.4.1.5.1.2" rel="Chapter" title="4.1.5.1.2 gadgets.util.getFeatureParameters">
<link href="#rfc.section.4.1.5.1.3" rel="Chapter" title="4.1.5.1.3 gadgets.util.hasFeature">
<link href="#rfc.section.4.1.5.1.4" rel="Chapter" title="4.1.5.1.4 gadgets.util.registerOnLoadHandler">
<link href="#rfc.section.4.1.5.1.5" rel="Chapter" title="4.1.5.1.5 gadgets.util.sanitizeHtml">
<link href="#rfc.section.4.1.5.1.6" rel="Chapter" title="4.1.5.1.6 gadgets.util.unescapeString">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Recommended Features">
<link href="#rfc.section.4.2.1" rel="Chapter" title="4.2.1 The Action Contributions Feature">
<link href="#rfc.section.4.2.1.1" rel="Chapter" title="4.2.1.1 The &lt;action&gt; Element">
<link href="#rfc.section.4.2.1.2" rel="Chapter" title="4.2.1.2 Action Contribution Paths">
<link href="#rfc.section.4.2.1.3" rel="Chapter" title="4.2.1.3 JavaScript API">
<link href="#rfc.section.4.2.1.3.1" rel="Chapter" title="4.2.1.3.1 The Action Object">
<link href="#rfc.section.4.2.1.3.2" rel="Chapter" title="4.2.1.3.2 gadgets.actions.addAction">
<link href="#rfc.section.4.2.1.3.3" rel="Chapter" title="4.2.1.3.3 gadgets.actions.updateAction">
<link href="#rfc.section.4.2.1.3.4" rel="Chapter" title="4.2.1.3.4 gadgets.actions.removeAction">
<link href="#rfc.section.4.2.1.3.5" rel="Chapter" title="4.2.1.3.5 gadgets.actions.getActionsByPath">
<link href="#rfc.section.4.2.1.3.6" rel="Chapter" title="4.2.1.3.6 gadgets.actions.getActionsByDataType">
<link href="#rfc.section.4.2.1.3.7" rel="Chapter" title="4.2.1.3.7 gadgets.actions.runAction">
<link href="#rfc.section.4.2.1.3.8" rel="Chapter" title="4.2.1.3.8 gadgets.actions.registerShowActionsListener">
<link href="#rfc.section.4.2.1.3.9" rel="Chapter" title="4.2.1.3.9 gadgets.actions.registerHideActionsListener">
<link href="#rfc.section.4.2.2" rel="Chapter" title="4.2.2 The Content Rewriting Feature">
<link href="#rfc.section.4.2.3" rel="Chapter" title="4.2.3 The DataContext Feature">
<link href="#rfc.section.4.2.3.1" rel="Chapter" title="4.2.3.1 JavaScript API">
<link href="#rfc.section.4.2.3.1.1" rel="Chapter" title="4.2.3.1.1 opensocial.data.getContext">
<link href="#rfc.section.4.2.3.1.2" rel="Chapter" title="4.2.3.1.2 The DataContext Object">
<link href="#rfc.section.4.2.3.1.2.1" rel="Chapter" title="4.2.3.1.2.1 opensocial.data.DataContext.getDataSet">
<link href="#rfc.section.4.2.3.1.2.2" rel="Chapter" title="4.2.3.1.2.2 opensocial.data.DataContext.putDataSet">
<link href="#rfc.section.4.2.3.1.2.3" rel="Chapter" title="4.2.3.1.2.3 opensocial.data.DataContext.putDataSets">
<link href="#rfc.section.4.2.3.1.2.4" rel="Chapter" title="4.2.3.1.2.4 opensocial.data.DataContext.registerListener">
<link href="#rfc.section.4.2.4" rel="Chapter" title="4.2.4 The Embedded Experiences Feature">
<link href="#rfc.section.4.2.4.1" rel="Chapter" title="4.2.4.1 Additional Examples">
<link href="#rfc.section.4.2.4.2" rel="Chapter" title="4.2.4.2 Considerations for Embedded Gadgets">
<link href="#rfc.section.4.2.4.2.1" rel="Chapter" title='4.2.4.2.1 The "embedded" View'>
<link href="#rfc.section.4.2.4.2.2" rel="Chapter" title="4.2.4.2.2 Accessing The Context">
<link href="#rfc.section.4.2.4.2.2.1" rel="Chapter" title="4.2.4.2.2.1 Additional Container Specific Context">
<link href="#rfc.section.4.2.4.3" rel="Chapter" title="4.2.4.3 Preferred Experiences">
<link href="#rfc.section.4.2.4.3.1" rel="Chapter" title="4.2.4.3.1 Display Types">
<link href="#rfc.section.4.2.4.3.2" rel="Chapter" title="4.2.4.3.2 Target Types">
<link href="#rfc.section.4.2.4.4" rel="Chapter" title="4.2.4.4 Security">
<link href="#rfc.section.4.2.4.5" rel="Chapter" title="4.2.4.5 Embedded Experiences within Activity Streams">
<link href="#rfc.section.4.2.4.6" rel="Chapter" title="4.2.4.6 Embedded Experiences within Email">
<link href="#rfc.section.4.2.5" rel="Chapter" title="4.2.5 The Flash Feature">
<link href="#rfc.section.4.2.5.1" rel="Chapter" title="4.2.5.1 JavaScript API">
<link href="#rfc.section.4.2.5.1.1" rel="Chapter" title="4.2.5.1.1 gadgets.flash.embedCachedFlash">
<link href="#rfc.section.4.2.5.1.2" rel="Chapter" title="4.2.5.1.2 gadgets.flash.embedFlash">
<link href="#rfc.section.4.2.5.1.3" rel="Chapter" title="4.2.5.1.3 gadgets.flash.getMajorVersion">
<link href="#rfc.section.4.2.6" rel="Chapter" title="4.2.6 The JavaScript Internationalization (i18n) Feature">
<link href="#rfc.section.4.2.6.1" rel="Chapter" title="4.2.6.1 Specifying Format and Parsing Patterns">
<link href="#rfc.section.4.2.6.1.1" rel="Chapter" title="4.2.6.1.1 Date/Time Pattern Specification">
<link href="#rfc.section.4.2.6.1.2" rel="Chapter" title="4.2.6.1.2 Number Pattern Specification">
<link href="#rfc.section.4.2.6.2" rel="Chapter" title="4.2.6.2 JavaScript API">
<link href="#rfc.section.4.2.6.2.1" rel="Chapter" title="4.2.6.2.1 Predefined Format Constants">
<link href="#rfc.section.4.2.6.2.2" rel="Chapter" title="4.2.6.2.2 gadgets.i18n.formatDateTime">
<link href="#rfc.section.4.2.6.2.3" rel="Chapter" title="4.2.6.2.3 gadgets.i18n.formatNumber">
<link href="#rfc.section.4.2.6.2.4" rel="Chapter" title="4.2.6.2.4 gadgets.i18n.parseDateTime">
<link href="#rfc.section.4.2.6.2.5" rel="Chapter" title="4.2.6.2.5 gadgets.i18n.parseNumber">
<link href="#rfc.section.4.2.7" rel="Chapter" title="4.2.7 The MiniMessage Feature">
<link href="#rfc.section.4.2.7.1" rel="Chapter" title="4.2.7.1 JavaScript API">
<link href="#rfc.section.4.2.7.1.1" rel="Chapter" title="4.2.7.1.1 The gadgets.MiniMessage Object">
<link href="#rfc.section.4.2.7.1.1.1" rel="Chapter" title="4.2.7.1.1.1 gadgets.MiniMessage.createDismissibleMessage">
<link href="#rfc.section.4.2.7.1.1.2" rel="Chapter" title="4.2.7.1.1.2 gadgets.MiniMessage.createStaticMessage">
<link href="#rfc.section.4.2.7.1.1.3" rel="Chapter" title="4.2.7.1.1.3 gadgets.MiniMessage.createTimerMessage">
<link href="#rfc.section.4.2.7.1.1.4" rel="Chapter" title="4.2.7.1.1.4 gadgets.MiniMessage.dismissMessage">
<link href="#rfc.section.4.2.8" rel="Chapter" title="4.2.8 The OAuth Popup Feature">
<link href="#rfc.section.4.2.8.1" rel="Chapter" title="4.2.8.1 JavaScript API">
<link href="#rfc.section.4.2.8.1.1" rel="Chapter" title="4.2.8.1.1 The gadgets.oauth.Popup Object">
<link href="#rfc.section.4.2.8.1.1.1" rel="Chapter" title="4.2.8.1.1.1 gadgets.oauth.Popup.createOpenerOnClick">
<link href="#rfc.section.4.2.8.1.1.2" rel="Chapter" title="4.2.8.1.1.2 gadgets.oauth.Popup.createApprovedOnClick">
<link href="#rfc.section.4.2.9" rel="Chapter" title="4.2.9 The OpenSearch Feature">
<link href="#rfc.section.4.2.10" rel="Chapter" title="4.2.10 The OpenSocial API (osapi) Feature">
<link href="#rfc.section.4.2.10.1" rel="Chapter" title="4.2.10.1 JavaScript API">
<link href="#rfc.section.4.2.10.1.1" rel="Chapter" title="4.2.10.1.1 The osapi.Request Object">
<link href="#rfc.section.4.2.10.1.1.1" rel="Chapter" title="4.2.10.1.1.1 osapi.Request.execute">
<link href="#rfc.section.4.2.10.1.2" rel="Chapter" title="4.2.10.1.2 The osapi.BatchRequest Object">
<link href="#rfc.section.4.2.10.1.2.1" rel="Chapter" title="4.2.10.1.2.1 osapi.BatchRequest.add">
<link href="#rfc.section.4.2.10.1.2.2" rel="Chapter" title="4.2.10.1.2.2 osapi.BatchRequest.execute">
<link href="#rfc.section.4.2.10.1.3" rel="Chapter" title="4.2.10.1.3 Error Handling">
<link href="#rfc.section.4.2.10.1.4" rel="Chapter" title="4.2.10.1.4 The osapi.http Service Object">
<link href="#rfc.section.4.2.10.1.4.1" rel="Chapter" title="4.2.10.1.4.1 The HTTP Request Parameters Object">
<link href="#rfc.section.4.2.10.1.4.2" rel="Chapter" title="4.2.10.1.4.2 Processing osapi.http Requests">
<link href="#rfc.section.4.2.10.1.4.3" rel="Chapter" title="4.2.10.1.4.3 The HTTP Response Object">
<link href="#rfc.section.4.2.11" rel="Chapter" title="4.2.11 The PubSub Feature">
<link href="#rfc.section.4.2.11.1" rel="Chapter" title="4.2.11.1 Initializing the Hub within the Container">
<link href="#rfc.section.4.2.11.2" rel="Chapter" title="4.2.11.2 Examples">
<link href="#rfc.section.4.2.11.3" rel="Chapter" title="4.2.11.3 JavaScript API">
<link href="#rfc.section.4.2.11.3.1" rel="Chapter" title="4.2.11.3.1 The gadgets.Hub Object">
<link href="#rfc.section.4.2.11.3.1.1" rel="Chapter" title="4.2.11.3.1.1 gadgets.Hub.publish">
<link href="#rfc.section.4.2.11.3.1.2" rel="Chapter" title="4.2.11.3.1.2 gadgets.Hub.subscribe">
<link href="#rfc.section.4.2.11.3.1.3" rel="Chapter" title="4.2.11.3.1.3 gadgets.Hub.unsubscribe">
<link href="#rfc.section.4.2.11.3.1.4" rel="Chapter" title="4.2.11.3.1.4 Additional Methods">
<link href="#rfc.section.4.2.11.4" rel="Chapter" title="4.2.11.4 The &lt;Topic&gt; Element">
<link href="#rfc.section.4.2.11.4.1" rel="Chapter" title="4.2.11.4.1 Event Data Types">
<link href="#rfc.section.4.2.12" rel="Chapter" title="4.2.12 The Security Policy Feature">
<link href="#rfc.section.4.2.13" rel="Chapter" title="4.2.13 The Selection Feature">
<link href="#rfc.section.4.2.13.1" rel="Chapter" title="4.2.13.1 JavaScript API">
<link href="#rfc.section.4.2.13.1.1" rel="Chapter" title="4.2.13.1.1 The Selection Object">
<link href="#rfc.section.4.2.13.1.2" rel="Chapter" title="4.2.13.1.2 gadgets.selection.setSelection">
<link href="#rfc.section.4.2.13.1.3" rel="Chapter" title="4.2.13.1.3 gadgets.selection.getSelection">
<link href="#rfc.section.4.2.13.1.4" rel="Chapter" title="4.2.13.1.4 gadgets.selection.addListener">
<link href="#rfc.section.4.2.13.1.5" rel="Chapter" title="4.2.13.1.5 removeListener">
<link href="#rfc.section.4.2.14" rel="Chapter" title="4.2.14 The View Features">
<link href="#rfc.section.4.2.14.1" rel="Chapter" title='4.2.14.1 The "views" Feature'>
<link href="#rfc.section.4.2.14.1.1" rel="Chapter" title="4.2.14.1.1 JavaScript API">
<link href="#rfc.section.4.2.14.1.1.1" rel="Chapter" title="4.2.14.1.1.1 The gadgets.views.ViewType Constants">
<link href="#rfc.section.4.2.14.1.1.2" rel="Chapter" title="4.2.14.1.1.2 View Targets">
<link href="#rfc.section.4.2.14.1.1.3" rel="Chapter" title="4.2.14.1.1.3 The gadgets.views.View Object">
<link href="#rfc.section.4.2.14.1.1.3.1" rel="Chapter" title="4.2.14.1.1.3.1 gadgets.views.View.getName">
<link href="#rfc.section.4.2.14.1.1.3.2" rel="Chapter" title="4.2.14.1.1.3.2 gadgets.views.View.isOnlyVisibleGadget">
<link href="#rfc.section.4.2.14.1.1.4" rel="Chapter" title="4.2.14.1.1.4 gadgets.views.getCurrentView">
<link href="#rfc.section.4.2.14.1.1.5" rel="Chapter" title="4.2.14.1.1.5 gadgets.views.getParams">
<link href="#rfc.section.4.2.14.1.1.6" rel="Chapter" title="4.2.14.1.1.6 gadgets.views.getSupportedViews">
<link href="#rfc.section.4.2.14.1.1.7" rel="Chapter" title="4.2.14.1.1.7 gadgets.views.requestNavigateTo">
<link href="#rfc.section.4.2.14.2" rel="Chapter" title='4.2.14.2 The "open-views" Feature'>
<link href="#rfc.section.4.2.14.2.1" rel="Chapter" title="4.2.14.2.1 JavaScript API">
<link href="#rfc.section.4.2.14.2.1.1" rel="Chapter" title="4.2.14.2.1.1 gadgets.views.openGadget">
<link href="#rfc.section.4.2.14.2.1.2" rel="Chapter" title="4.2.14.2.1.2 gadgets.views.openEmbeddedExperience">
<link href="#rfc.section.4.2.14.2.1.3" rel="Chapter" title="4.2.14.2.1.3 gadgets.views.openUrl">
<link href="#rfc.section.4.2.14.2.1.4" rel="Chapter" title="4.2.14.2.1.4 gadgets.views.close">
<link href="#rfc.section.4.2.14.2.1.5" rel="Chapter" title="4.2.14.2.1.5 gadgets.views.setReturnValue">
<link href="#rfc.section.4.2.14.2.1.6" rel="Chapter" title="4.2.14.2.1.6 gadgets.window.getContainerDimensions">
<link href="#rfc.section.4.2.14.2.1.7" rel="Chapter" title="4.2.14.2.1.7 The Coordinates Object">
<link href="#rfc.section.4.2.15" rel="Chapter" title="4.2.15 The Window Features">
<link href="#rfc.section.4.2.15.1" rel="Chapter" title='4.2.15.1 The "settitle" Feature'>
<link href="#rfc.section.4.2.15.2" rel="Chapter" title='4.2.15.2 The "dynamic-height" Feature'>
<link href="#rfc.section.4.2.15.3" rel="Chapter" title='4.2.15.3 The "dynamic-width" Feature'>
<link href="#rfc.section.4.2.15.4" rel="Chapter" title='4.2.15.4 The "dynamic-size" Feature'>
<link href="#rfc.section.4.2.15.5" rel="Chapter" title="4.2.15.5 gadgets.window.getViewportDimensions">
<link href="#rfc.references" rel="Chapter" title="5 References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="" />
  <meta name="description" content="" />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right"></td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">May 2012</td>
</tr>
<tr>
<td class="left">Expires: October 31, 2012</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">OpenSocial Application Specification 3.0<br />
  <span class="filename"></span></p>
  
  <h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on October 31, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2012 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Overview</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Notation and Conventions</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Versioning</a>
</li>
<li>1.3.   <a href="#rfc.section.1.3">Application Roles</a>
</li>
<li>2.   <a href="#rfc.section.2">The Application Specification Document</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Conventions and Notes</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Document Structure</a>
</li>
<li>2.2.1.   <a href="#rfc.section.2.2.1">The &lt;Module&gt; Element</a>
</li>
<li>2.2.2.   <a href="#rfc.section.2.2.2">The &lt;ModulePrefs&gt; Element</a>
</li>
<li>2.2.3.   <a href="#rfc.section.2.2.3">The &lt;Require&gt; and &lt;Optional&gt; Elements</a>
</li>
<li>2.2.3.1.   <a href="#rfc.section.2.2.3.1">The &lt;Param&gt; Element</a>
</li>
<li>2.2.4.   <a href="#rfc.section.2.2.4">The &lt;Preload&gt; Element</a>
</li>
<li>2.2.5.   <a href="#rfc.section.2.2.5">The &lt;Link&gt; Element</a>
</li>
<li>2.2.6.   <a href="#rfc.section.2.2.6">The &lt;Locale&gt; Element</a>
</li>
<li>2.2.7.   <a href="#rfc.section.2.2.7">The &lt;OAuth&gt; Element</a>
</li>
<li>2.2.8.   <a href="#rfc.section.2.2.8">The &lt;OAuth2&gt; Element</a>
</li>
<li>2.2.9.   <a href="#rfc.section.2.2.9">The &lt;UserPref&gt; Element</a>
</li>
<li>2.2.9.1.   <a href="#rfc.section.2.2.9.1">User Preference Data Types</a>
</li>
<li>2.2.10.   <a href="#rfc.section.2.2.10">The &lt;Data&gt; Element</a>
</li>
<li>2.2.11.   <a href="#rfc.section.2.2.11">The &lt;ExternalServices&gt; Element</a>
</li>
<li>2.2.12.   <a href="#rfc.section.2.2.12">The &lt;Content&gt; Element</a>
</li>
<li>2.2.12.1.   <a href="#rfc.section.2.2.12.1">Processing Model</a>
</li>
<li>2.2.12.1.1.   <a href="#rfc.section.2.2.12.1.1">HTML Content</a>
</li>
<li>2.2.12.1.2.   <a href="#rfc.section.2.2.12.1.2">Proxied Content</a>
</li>
<li>2.2.12.1.3.   <a href="#rfc.section.2.2.12.1.3">Redirected Content</a>
</li>
<li>2.2.12.1.4.   <a href="#rfc.section.2.2.12.1.4">Authentication for Proxied and Redirected Content</a>
</li>
<li>2.2.13.   <a href="#rfc.section.2.2.13">Extensibility</a>
</li>
<li>3.   <a href="#rfc.section.3">Container-Provided Capabilities</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Authentication</a>
</li>
<li>3.1.1.   <a href="#rfc.section.3.1.1">Signed Fetch</a>
</li>
<li>3.1.1.1.   <a href="#rfc.section.3.1.1.1">Using Signed Fetch</a>
</li>
<li>3.1.2.   <a href="#rfc.section.3.1.2">OAuth Support</a>
</li>
<li>3.1.2.1.   <a href="#rfc.section.3.1.2.1">Declaring and Using OAuth Services</a>
</li>
<li>3.1.2.1.1.   <a href="#rfc.section.3.1.2.1.1">The "OAUTH_USE_TOKEN" parameter</a>
</li>
<li>3.1.2.2.   <a href="#rfc.section.3.1.2.2">Processing Model</a>
</li>
<li>3.1.2.2.1.   <a href="#rfc.section.3.1.2.2.1">Acquiring Access Tokens</a>
</li>
<li>3.1.2.2.2.   <a href="#rfc.section.3.1.2.2.2">Sending OAuth 2.0 Protected Requests</a>
</li>
<li>3.1.2.2.3.   <a href="#rfc.section.3.1.2.2.3">401 Unauthorized Responses</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Caching</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Variable Substitution</a>
</li>
<li>3.3.1.   <a href="#rfc.section.3.3.1">Using Literal Statements</a>
</li>
<li>3.3.2.   <a href="#rfc.section.3.3.2">Using Data Pipeline Variables</a>
</li>
<li>3.3.3.   <a href="#rfc.section.3.3.3">Using Reserved Variable Keys</a>
</li>
<li>3.3.4.   <a href="#rfc.section.3.3.4">Deprecated Expression Syntax</a>
</li>
<li>3.3.5.   <a href="#rfc.section.3.3.5">Processing Requirements</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">Localization</a>
</li>
<li>3.4.1.   <a href="#rfc.section.3.4.1">Considerations for Bidirectional Text</a>
</li>
<li>3.4.2.   <a href="#rfc.section.3.4.2">Message Bundle Documents</a>
</li>
<li>3.5.   <a href="#rfc.section.3.5">Application Lifecycle Events</a>
</li>
<li>3.5.1.   <a href="#rfc.section.3.5.1">Lifecycle Event Notifications</a>
</li>
<li>3.5.2.   <a href="#rfc.section.3.5.2">Legacy Support</a>
</li>
<li>3.6.   <a href="#rfc.section.3.6">Data Pipelining</a>
</li>
<li>3.6.1.   <a href="#rfc.section.3.6.1">The DataContext</a>
</li>
<li>3.6.2.   <a href="#rfc.section.3.6.2">Data Pipeline Elements and the Data Block</a>
</li>
<li>3.6.3.   <a href="#rfc.section.3.6.3">Data Pipeline Elements within HTML Content</a>
</li>
<li>3.6.4.   <a href="#rfc.section.3.6.4">Data Pipeline Elements and Proxied Content</a>
</li>
<li>3.6.5.   <a href="#rfc.section.3.6.5">The Data Pipeline Elements</a>
</li>
<li>3.6.5.1.   <a href="#rfc.section.3.6.5.1">The &lt;os:DataRequest&gt; Element</a>
</li>
<li>3.6.5.2.   <a href="#rfc.section.3.6.5.2">The &lt;os:HttpRequest&gt; Element</a>
</li>
<li>3.6.5.3.   <a href="#rfc.section.3.6.5.3">The &lt;os:Var&gt; Element</a>
</li>
<li>3.6.5.4.   <a href="#rfc.section.3.6.5.4">Expression Statements within Data Pipeline Attributes</a>
</li>
<li>4.   <a href="#rfc.section.4">Container-Provided Features</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Core Features</a>
</li>
<li>4.1.1.   <a href="#rfc.section.4.1.1">The Logging Feature</a>
</li>
<li>4.1.1.1.   <a href="#rfc.section.4.1.1.1">JavaScript API</a>
</li>
<li>4.1.1.1.1.   <a href="#rfc.section.4.1.1.1.1">gadgets.log</a>
</li>
<li>4.1.1.1.2.   <a href="#rfc.section.4.1.1.1.2">gadgets.warn</a>
</li>
<li>4.1.1.1.3.   <a href="#rfc.section.4.1.1.1.3">gadgets.error</a>
</li>
<li>4.1.1.1.4.   <a href="#rfc.section.4.1.1.1.4">gadgets.setLogLevel</a>
</li>
<li>4.1.2.   <a href="#rfc.section.4.1.2">The IO Feature</a>
</li>
<li>4.1.2.1.   <a href="#rfc.section.4.1.2.1">JavaScript API</a>
</li>
<li>4.1.2.1.1.   <a href="#rfc.section.4.1.2.1.1">gadgets.io.encodeValues</a>
</li>
<li>4.1.2.1.2.   <a href="#rfc.section.4.1.2.1.2">gadgets.io.getProxyUrl</a>
</li>
<li>4.1.2.1.3.   <a href="#rfc.section.4.1.2.1.3">gadgets.io.makeRequest</a>
</li>
<li>4.1.2.1.3.1.   <a href="#rfc.section.4.1.2.1.3.1">The callback parameter and the Response Object</a>
</li>
<li>4.1.3.   <a href="#rfc.section.4.1.3">The JSON Feature</a>
</li>
<li>4.1.3.1.   <a href="#rfc.section.4.1.3.1">JavaScript API</a>
</li>
<li>4.1.3.1.1.   <a href="#rfc.section.4.1.3.1.1">gadgets.json.parse</a>
</li>
<li>4.1.3.1.2.   <a href="#rfc.section.4.1.3.1.2">gadgets.json.stringify</a>
</li>
<li>4.1.4.   <a href="#rfc.section.4.1.4">The User Preferences Feature</a>
</li>
<li>4.1.4.1.   <a href="#rfc.section.4.1.4.1">JavaScript API</a>
</li>
<li>4.1.4.1.1.   <a href="#rfc.section.4.1.4.1.1">The gadgets.Prefs Object</a>
</li>
<li>4.1.4.1.1.1.   <a href="#rfc.section.4.1.4.1.1.1">gadgets.Prefs.getArray</a>
</li>
<li>4.1.4.1.1.2.   <a href="#rfc.section.4.1.4.1.1.2">gadgets.Prefs.getBool</a>
</li>
<li>4.1.4.1.1.3.   <a href="#rfc.section.4.1.4.1.1.3">gadgets.Prefs.getCountry</a>
</li>
<li>4.1.4.1.1.4.   <a href="#rfc.section.4.1.4.1.1.4">gadgets.Prefs.getFloat</a>
</li>
<li>4.1.4.1.1.5.   <a href="#rfc.section.4.1.4.1.1.5">gadgets.Prefs.getInt</a>
</li>
<li>4.1.4.1.1.6.   <a href="#rfc.section.4.1.4.1.1.6">gadgets.Prefs.getLang</a>
</li>
<li>4.1.4.1.1.7.   <a href="#rfc.section.4.1.4.1.1.7">gadgets.Prefs.getModuleId</a>
</li>
<li>4.1.4.1.1.8.   <a href="#rfc.section.4.1.4.1.1.8">gadgets.Prefs.getMsg</a>
</li>
<li>4.1.4.1.1.9.   <a href="#rfc.section.4.1.4.1.1.9">gadgets.Prefs.getString</a>
</li>
<li>4.1.4.2.   <a href="#rfc.section.4.1.4.2">The "setprefs" Feature</a>
</li>
<li>4.1.4.2.1.   <a href="#rfc.section.4.1.4.2.1">JavaScript API</a>
</li>
<li>4.1.4.2.1.1.   <a href="#rfc.section.4.1.4.2.1.1">gadgets.Prefs.set</a>
</li>
<li>4.1.4.2.1.2.   <a href="#rfc.section.4.1.4.2.1.2">gadgets.Prefs.setArray</a>
</li>
<li>4.1.5.   <a href="#rfc.section.4.1.5">The Utility Feature</a>
</li>
<li>4.1.5.1.   <a href="#rfc.section.4.1.5.1">JavaScript API</a>
</li>
<li>4.1.5.1.1.   <a href="#rfc.section.4.1.5.1.1">gadgets.util.escapeString</a>
</li>
<li>4.1.5.1.2.   <a href="#rfc.section.4.1.5.1.2">gadgets.util.getFeatureParameters</a>
</li>
<li>4.1.5.1.3.   <a href="#rfc.section.4.1.5.1.3">gadgets.util.hasFeature</a>
</li>
<li>4.1.5.1.4.   <a href="#rfc.section.4.1.5.1.4">gadgets.util.registerOnLoadHandler</a>
</li>
<li>4.1.5.1.5.   <a href="#rfc.section.4.1.5.1.5">gadgets.util.sanitizeHtml</a>
</li>
<li>4.1.5.1.6.   <a href="#rfc.section.4.1.5.1.6">gadgets.util.unescapeString</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Recommended Features</a>
</li>
<li>4.2.1.   <a href="#rfc.section.4.2.1">The Action Contributions Feature</a>
</li>
<li>4.2.1.1.   <a href="#rfc.section.4.2.1.1">The &lt;action&gt; Element</a>
</li>
<li>4.2.1.2.   <a href="#rfc.section.4.2.1.2">Action Contribution Paths</a>
</li>
<li>4.2.1.3.   <a href="#rfc.section.4.2.1.3">JavaScript API</a>
</li>
<li>4.2.1.3.1.   <a href="#rfc.section.4.2.1.3.1">The Action Object</a>
</li>
<li>4.2.1.3.2.   <a href="#rfc.section.4.2.1.3.2">gadgets.actions.addAction</a>
</li>
<li>4.2.1.3.3.   <a href="#rfc.section.4.2.1.3.3">gadgets.actions.updateAction</a>
</li>
<li>4.2.1.3.4.   <a href="#rfc.section.4.2.1.3.4">gadgets.actions.removeAction</a>
</li>
<li>4.2.1.3.5.   <a href="#rfc.section.4.2.1.3.5">gadgets.actions.getActionsByPath</a>
</li>
<li>4.2.1.3.6.   <a href="#rfc.section.4.2.1.3.6">gadgets.actions.getActionsByDataType</a>
</li>
<li>4.2.1.3.7.   <a href="#rfc.section.4.2.1.3.7">gadgets.actions.runAction</a>
</li>
<li>4.2.1.3.8.   <a href="#rfc.section.4.2.1.3.8">gadgets.actions.registerShowActionsListener</a>
</li>
<li>4.2.1.3.9.   <a href="#rfc.section.4.2.1.3.9">gadgets.actions.registerHideActionsListener</a>
</li>
<li>4.2.2.   <a href="#rfc.section.4.2.2">The Content Rewriting Feature</a>
</li>
<li>4.2.3.   <a href="#rfc.section.4.2.3">The DataContext Feature</a>
</li>
<li>4.2.3.1.   <a href="#rfc.section.4.2.3.1">JavaScript API</a>
</li>
<li>4.2.3.1.1.   <a href="#rfc.section.4.2.3.1.1">opensocial.data.getContext</a>
</li>
<li>4.2.3.1.2.   <a href="#rfc.section.4.2.3.1.2">The DataContext Object</a>
</li>
<li>4.2.3.1.2.1.   <a href="#rfc.section.4.2.3.1.2.1">opensocial.data.DataContext.getDataSet</a>
</li>
<li>4.2.3.1.2.2.   <a href="#rfc.section.4.2.3.1.2.2">opensocial.data.DataContext.putDataSet</a>
</li>
<li>4.2.3.1.2.3.   <a href="#rfc.section.4.2.3.1.2.3">opensocial.data.DataContext.putDataSets</a>
</li>
<li>4.2.3.1.2.4.   <a href="#rfc.section.4.2.3.1.2.4">opensocial.data.DataContext.registerListener</a>
</li>
<li>4.2.4.   <a href="#rfc.section.4.2.4">The Embedded Experiences Feature</a>
</li>
<li>4.2.4.1.   <a href="#rfc.section.4.2.4.1">Additional Examples</a>
</li>
<li>4.2.4.2.   <a href="#rfc.section.4.2.4.2">Considerations for Embedded Gadgets</a>
</li>
<li>4.2.4.2.1.   <a href="#rfc.section.4.2.4.2.1">The "embedded" View</a>
</li>
<li>4.2.4.2.2.   <a href="#rfc.section.4.2.4.2.2">Accessing The Context</a>
</li>
<li>4.2.4.2.2.1.   <a href="#rfc.section.4.2.4.2.2.1">Additional Container Specific Context</a>
</li>
<li>4.2.4.3.   <a href="#rfc.section.4.2.4.3">Preferred Experiences</a>
</li>
<li>4.2.4.3.1.   <a href="#rfc.section.4.2.4.3.1">Display Types</a>
</li>
<li>4.2.4.3.2.   <a href="#rfc.section.4.2.4.3.2">Target Types</a>
</li>
<li>4.2.4.4.   <a href="#rfc.section.4.2.4.4">Security</a>
</li>
<li>4.2.4.5.   <a href="#rfc.section.4.2.4.5">Embedded Experiences within Activity Streams</a>
</li>
<li>4.2.4.6.   <a href="#rfc.section.4.2.4.6">Embedded Experiences within Email</a>
</li>
<li>4.2.5.   <a href="#rfc.section.4.2.5">The Flash Feature</a>
</li>
<li>4.2.5.1.   <a href="#rfc.section.4.2.5.1">JavaScript API</a>
</li>
<li>4.2.5.1.1.   <a href="#rfc.section.4.2.5.1.1">gadgets.flash.embedCachedFlash</a>
</li>
<li>4.2.5.1.2.   <a href="#rfc.section.4.2.5.1.2">gadgets.flash.embedFlash</a>
</li>
<li>4.2.5.1.3.   <a href="#rfc.section.4.2.5.1.3">gadgets.flash.getMajorVersion</a>
</li>
<li>4.2.6.   <a href="#rfc.section.4.2.6">The JavaScript Internationalization (i18n) Feature</a>
</li>
<li>4.2.6.1.   <a href="#rfc.section.4.2.6.1">Specifying Format and Parsing Patterns</a>
</li>
<li>4.2.6.1.1.   <a href="#rfc.section.4.2.6.1.1">Date/Time Pattern Specification</a>
</li>
<li>4.2.6.1.2.   <a href="#rfc.section.4.2.6.1.2">Number Pattern Specification</a>
</li>
<li>4.2.6.2.   <a href="#rfc.section.4.2.6.2">JavaScript API</a>
</li>
<li>4.2.6.2.1.   <a href="#rfc.section.4.2.6.2.1">Predefined Format Constants</a>
</li>
<li>4.2.6.2.2.   <a href="#rfc.section.4.2.6.2.2">gadgets.i18n.formatDateTime</a>
</li>
<li>4.2.6.2.3.   <a href="#rfc.section.4.2.6.2.3">gadgets.i18n.formatNumber</a>
</li>
<li>4.2.6.2.4.   <a href="#rfc.section.4.2.6.2.4">gadgets.i18n.parseDateTime</a>
</li>
<li>4.2.6.2.5.   <a href="#rfc.section.4.2.6.2.5">gadgets.i18n.parseNumber</a>
</li>
<li>4.2.7.   <a href="#rfc.section.4.2.7">The MiniMessage Feature</a>
</li>
<li>4.2.7.1.   <a href="#rfc.section.4.2.7.1">JavaScript API</a>
</li>
<li>4.2.7.1.1.   <a href="#rfc.section.4.2.7.1.1">The gadgets.MiniMessage Object</a>
</li>
<li>4.2.7.1.1.1.   <a href="#rfc.section.4.2.7.1.1.1">gadgets.MiniMessage.createDismissibleMessage</a>
</li>
<li>4.2.7.1.1.2.   <a href="#rfc.section.4.2.7.1.1.2">gadgets.MiniMessage.createStaticMessage</a>
</li>
<li>4.2.7.1.1.3.   <a href="#rfc.section.4.2.7.1.1.3">gadgets.MiniMessage.createTimerMessage</a>
</li>
<li>4.2.7.1.1.4.   <a href="#rfc.section.4.2.7.1.1.4">gadgets.MiniMessage.dismissMessage</a>
</li>
<li>4.2.8.   <a href="#rfc.section.4.2.8">The OAuth Popup Feature</a>
</li>
<li>4.2.8.1.   <a href="#rfc.section.4.2.8.1">JavaScript API</a>
</li>
<li>4.2.8.1.1.   <a href="#rfc.section.4.2.8.1.1">The gadgets.oauth.Popup Object</a>
</li>
<li>4.2.8.1.1.1.   <a href="#rfc.section.4.2.8.1.1.1">gadgets.oauth.Popup.createOpenerOnClick</a>
</li>
<li>4.2.8.1.1.2.   <a href="#rfc.section.4.2.8.1.1.2">gadgets.oauth.Popup.createApprovedOnClick</a>
</li>
<li>4.2.9.   <a href="#rfc.section.4.2.9">The OpenSearch Feature</a>
</li>
<li>4.2.10.   <a href="#rfc.section.4.2.10">The OpenSocial API (osapi) Feature</a>
</li>
<li>4.2.10.1.   <a href="#rfc.section.4.2.10.1">JavaScript API</a>
</li>
<li>4.2.10.1.1.   <a href="#rfc.section.4.2.10.1.1">The osapi.Request Object</a>
</li>
<li>4.2.10.1.1.1.   <a href="#rfc.section.4.2.10.1.1.1">osapi.Request.execute</a>
</li>
<li>4.2.10.1.2.   <a href="#rfc.section.4.2.10.1.2">The osapi.BatchRequest Object</a>
</li>
<li>4.2.10.1.2.1.   <a href="#rfc.section.4.2.10.1.2.1">osapi.BatchRequest.add</a>
</li>
<li>4.2.10.1.2.2.   <a href="#rfc.section.4.2.10.1.2.2">osapi.BatchRequest.execute</a>
</li>
<li>4.2.10.1.3.   <a href="#rfc.section.4.2.10.1.3">Error Handling</a>
</li>
<li>4.2.10.1.4.   <a href="#rfc.section.4.2.10.1.4">The osapi.http Service Object</a>
</li>
<li>4.2.10.1.4.1.   <a href="#rfc.section.4.2.10.1.4.1">The HTTP Request Parameters Object</a>
</li>
<li>4.2.10.1.4.2.   <a href="#rfc.section.4.2.10.1.4.2">Processing osapi.http Requests</a>
</li>
<li>4.2.10.1.4.3.   <a href="#rfc.section.4.2.10.1.4.3">The HTTP Response Object</a>
</li>
<li>4.2.11.   <a href="#rfc.section.4.2.11">The PubSub Feature</a>
</li>
<li>4.2.11.1.   <a href="#rfc.section.4.2.11.1">Initializing the Hub within the Container</a>
</li>
<li>4.2.11.2.   <a href="#rfc.section.4.2.11.2">Examples</a>
</li>
<li>4.2.11.3.   <a href="#rfc.section.4.2.11.3">JavaScript API</a>
</li>
<li>4.2.11.3.1.   <a href="#rfc.section.4.2.11.3.1">The gadgets.Hub Object</a>
</li>
<li>4.2.11.3.1.1.   <a href="#rfc.section.4.2.11.3.1.1">gadgets.Hub.publish</a>
</li>
<li>4.2.11.3.1.2.   <a href="#rfc.section.4.2.11.3.1.2">gadgets.Hub.subscribe</a>
</li>
<li>4.2.11.3.1.3.   <a href="#rfc.section.4.2.11.3.1.3">gadgets.Hub.unsubscribe</a>
</li>
<li>4.2.11.3.1.4.   <a href="#rfc.section.4.2.11.3.1.4">Additional Methods</a>
</li>
<li>4.2.11.4.   <a href="#rfc.section.4.2.11.4">The &lt;Topic&gt; Element</a>
</li>
<li>4.2.11.4.1.   <a href="#rfc.section.4.2.11.4.1">Event Data Types</a>
</li>
<li>4.2.12.   <a href="#rfc.section.4.2.12">The Security Policy Feature</a>
</li>
<li>4.2.13.   <a href="#rfc.section.4.2.13">The Selection Feature</a>
</li>
<li>4.2.13.1.   <a href="#rfc.section.4.2.13.1">JavaScript API</a>
</li>
<li>4.2.13.1.1.   <a href="#rfc.section.4.2.13.1.1">The Selection Object</a>
</li>
<li>4.2.13.1.2.   <a href="#rfc.section.4.2.13.1.2">gadgets.selection.setSelection</a>
</li>
<li>4.2.13.1.3.   <a href="#rfc.section.4.2.13.1.3">gadgets.selection.getSelection</a>
</li>
<li>4.2.13.1.4.   <a href="#rfc.section.4.2.13.1.4">gadgets.selection.addListener</a>
</li>
<li>4.2.13.1.5.   <a href="#rfc.section.4.2.13.1.5">removeListener</a>
</li>
<li>4.2.14.   <a href="#rfc.section.4.2.14">The View Features</a>
</li>
<li>4.2.14.1.   <a href="#rfc.section.4.2.14.1">The "views" Feature</a>
</li>
<li>4.2.14.1.1.   <a href="#rfc.section.4.2.14.1.1">JavaScript API</a>
</li>
<li>4.2.14.1.1.1.   <a href="#rfc.section.4.2.14.1.1.1">The gadgets.views.ViewType Constants</a>
</li>
<li>4.2.14.1.1.2.   <a href="#rfc.section.4.2.14.1.1.2">View Targets</a>
</li>
<li>4.2.14.1.1.3.   <a href="#rfc.section.4.2.14.1.1.3">The gadgets.views.View Object</a>
</li>
<li>4.2.14.1.1.3.1.   <a href="#rfc.section.4.2.14.1.1.3.1">gadgets.views.View.getName</a>
</li>
<li>4.2.14.1.1.3.2.   <a href="#rfc.section.4.2.14.1.1.3.2">gadgets.views.View.isOnlyVisibleGadget</a>
</li>
<li>4.2.14.1.1.4.   <a href="#rfc.section.4.2.14.1.1.4">gadgets.views.getCurrentView</a>
</li>
<li>4.2.14.1.1.5.   <a href="#rfc.section.4.2.14.1.1.5">gadgets.views.getParams</a>
</li>
<li>4.2.14.1.1.6.   <a href="#rfc.section.4.2.14.1.1.6">gadgets.views.getSupportedViews</a>
</li>
<li>4.2.14.1.1.7.   <a href="#rfc.section.4.2.14.1.1.7">gadgets.views.requestNavigateTo</a>
</li>
<li>4.2.14.2.   <a href="#rfc.section.4.2.14.2">The "open-views" Feature</a>
</li>
<li>4.2.14.2.1.   <a href="#rfc.section.4.2.14.2.1">JavaScript API</a>
</li>
<li>4.2.14.2.1.1.   <a href="#rfc.section.4.2.14.2.1.1">gadgets.views.openGadget</a>
</li>
<li>4.2.14.2.1.2.   <a href="#rfc.section.4.2.14.2.1.2">gadgets.views.openEmbeddedExperience</a>
</li>
<li>4.2.14.2.1.3.   <a href="#rfc.section.4.2.14.2.1.3">gadgets.views.openUrl</a>
</li>
<li>4.2.14.2.1.4.   <a href="#rfc.section.4.2.14.2.1.4">gadgets.views.close</a>
</li>
<li>4.2.14.2.1.5.   <a href="#rfc.section.4.2.14.2.1.5">gadgets.views.setReturnValue</a>
</li>
<li>4.2.14.2.1.6.   <a href="#rfc.section.4.2.14.2.1.6">gadgets.window.getContainerDimensions</a>
</li>
<li>4.2.14.2.1.7.   <a href="#rfc.section.4.2.14.2.1.7">The Coordinates Object</a>
</li>
<li>4.2.15.   <a href="#rfc.section.4.2.15">The Window Features</a>
</li>
<li>4.2.15.1.   <a href="#rfc.section.4.2.15.1">The "settitle" Feature</a>
</li>
<li>4.2.15.2.   <a href="#rfc.section.4.2.15.2">The "dynamic-height" Feature</a>
</li>
<li>4.2.15.3.   <a href="#rfc.section.4.2.15.3">The "dynamic-width" Feature</a>
</li>
<li>4.2.15.4.   <a href="#rfc.section.4.2.15.4">The "dynamic-size" Feature</a>
</li>
<li>4.2.15.5.   <a href="#rfc.section.4.2.15.5">gadgets.window.getViewportDimensions</a>
</li>
<li>5.   <a href="#rfc.references">References</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Overview</h1>
<p id="rfc.section.1.p.1">OpenSocial Applications are Web-based software components that are based on HTML, CSS and JavaScript. Such applications can be used independently or composed together in a variety of ways. For instance, several individual applications can be embedded within a single Web page and can either operate independently of one another or can interact and communicate with each other.</p>
<p id="rfc.section.1.p.2">Each OpenSocial Application is defined by a declarative XML syntax known commonly as an "Application Specification". These documents contain the meta-data, content and code necessary for the application to function.  It is the responsibility of an OpenSocial Application Container to parse and process specification documents in order to render the application's content for a user. In the course of doing so, containers provide a range of capabilities and features the application can leverage.  Examples of such capabilities include providing access to data, facilitating communication with other applications, or allowing an application to extend the capabilities of the container itself.</p>
<p id="rfc.section.1.p.3">This specification describes the XML-document format used to define OpenSocial Applications as well as the capabilities and core features provided to application instances by the container.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> Notation and Conventions</h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<p id="rfc.section.1.1.p.2">Domain name examples use <a href="#RFC2606">RFC2606</a> <cite title="NONE">[RFC2606]</cite>.</p>
<p id="rfc.section.1.1.p.3">Some sections of this specification are illustrated with fragments of a <a href="#RFC5234">Augmented Backus-Naur Form</a> <cite title="NONE">[RFC5234]</cite> (ABNF) grammar.  The rules specified are normative.</p>
<p id="rfc.section.1.1.p.4">The following core rules are included by reference, as defined in <a href="#RFC5234">[RFC5234]</a>, Appendix B.1: ALPHA (letters), DIGIT (decimal 0-9), HTAB (horizontal tab), and SP (space).</p>
<div id="#rfc.figure.1"></div>
<p>The following additional ABNF rules are defined:</p>
<pre>
  OWS = *( SP / HTAB )
        </pre>
<p id="rfc.section.1.1.p.5">Some sections of this specification are illustrated with fragments of a non-normative <a href="#RNC">RELAX-NG Compact Schema</a> <cite title="NONE">[RNC]</cite>.  However, the text of the specification provides the definition of conformance. In several cases, portions of the non-normative RELAX-NG schema will reference ABNF rules.</p>
<div id="#rfc.figure.2"></div>
<p>For example, the following example ABNF rule:</p>
<pre>
  abc = "a" "b" "c"
        </pre>
<div id="#rfc.figure.3"></div>
<p>Can be referenced within the RELAX-NG schema fragment to define the acceptable value of an XML attribute:</p>
<pre>
  foo = element foo {
    attribute a { abc }?
  }
        </pre>
<div id="#rfc.figure.4"></div>
<p>Within the RELAX-NG grammar, the rules "undefinedAttribute" and "extensionElement" are defined as follows:</p>
<pre>
  namespace local = ""
  
  undefinedAttribute =
    attribute * - (xml:base | xml:lang) { text }

  anyElement =
    element * {
      (attribute * { text }
       | text
       | anyElement)*
      }
    
  simpleExtensionElement =
    element * {
      text
    }

  structuredExtensionElement =
    element * {
      (attribute * { text }+,
      (text|anyElement)*)
      | (attribute * { text }*,
      (text?, anyElement+, (text|anyElement)*))
    }

  extensionElement =
    simpleExtensionElement | 
    structuredExtensionElement
        </pre>
<p id="rfc.section.1.1.p.6">This specification allows the use of <a href="#RFC3987">IRIs</a> <cite title="NONE">[RFC3987]</cite>.  Every <a href="#RFC3986">URI</a> <cite title="NONE">[RFC3986]</cite> is also an IRI, so a URI may be used wherever an IRI is named. There are two special considerations: (1) when an IRI that is not also a URI is given for dereferencing, it MUST be mapped to a URI using the steps in Section 3.1 of RFC 3987.  and (2) when an IRI is serving as an identifier, it MUST NOT be so mapped.</p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> <a href="#Versioning" id="Versioning">Versioning</a>
</h1>
<p id="rfc.section.1.2.p.1">Both the overall OpenSocial specification and individual features are versioned. Application specification documents SHOULD specify the version of the OpenSocial specification to which they conform by including the "specificationVersion" attribute on the root &lt;Module&gt; element, as well as the versions of any optional or required features used by including the "version" attribute on &lt;Require&gt; and &lt;Optional&gt; elements.</p>
<p id="rfc.section.1.2.p.2">Version identifiers are composed of a series of up to three non-negative integers separated by the dot (.) character. For example, "1.0.0", "1.2.1", etc.</p>
<div id="#rfc.figure.5"></div>
<pre>
  major = 1*DIGIT
  minor = 1*DIGIT
  patch = 1*DIGIT
      
  version = major [ "." minor [ "." patch ] ]
        </pre>
<p id="rfc.section.1.2.p.3">The first number in the sequence represents a "major version". Changes in the major version signify possible backward-incompatible changes from previous versions. For instance, when the methods are removed from the JavaScript API provided by a feature, or when the definitions of XML elements or attributes used within an application specification document are changed, or when the processing requirements for any feature or capability are modified, the major version MUST be incremented.</p>
<p id="rfc.section.1.2.p.4">The second number in the sequence is a "minor version" that is interpreted relative to the preceding major version number. When the major version is incremented, the "minor version" MUST be reset to 0. Changes in the minor version signify backward-compatible but forward-incompatible changes from previous versions. For example, when new methods are added to the JavaScript API provided by a feature, or when new elements or attributes are added to the application specification document format, the minor version SHOULD be incremented and the major version SHOULD NOT be incremented.</p>
<p id="rfc.section.1.2.p.5">The third and final number in the sequence is the "patch version" that is interpreted relative to the preceding minor version. When the minor version is incremented, the "patch version" MUST be reset to 0. Changes in the patch version signify changes that are both backward- and forward- compatible with previous versions. For example, when making minor clarifications, fixing errors in the description of a method or element, or making other small changes that neither affect existing functionality or introduce new functionality that would be incompatible with existing versions, the patch version MUST be incremented but the minor and major versions SHOULD NOT change.</p>
<p id="rfc.section.1.2.p.6">Version identifiers are hierarchical and can either reference a specific individual version by specifying all three elements (e.g. "1.2.3") or can identify all versions at a particular major or minor level. For instance, the identifier "2.4" would apply to all combinations of versions specifying a major version of "2" and a minor version of "4" (e.g. "2.4", "2.4.0", "2.4.1", "2.4.2", and so on) but not any other minor version (e.g. "2.3", "2.5.2", etc).</p>
<p id="rfc.section.1.2.p.7">When processing application specification documents and determining the appropriate method of processing the application itself as well as determining the correct features to enable, containers are required to appropriately match the version identifiers specified within the application specification to those provided by the container. For instance, if the application requires version "2.3" of a particular feature, the container MUST provide an implementation of the feature whose version matches the given major and minor value (e.g. "2.3.1", "2.3.2", etc).</p>
<p id="rfc.section.1.2.p.8">It is RECOMMENDED that developers specify the most general version that will satisfy the requirements of the application. Usually, major and minor versions will suffice. The patch version MAY be omitted from application specification documents.</p>
<p id="rfc.section.1.2.p.9">When a version identifier is omitted from various locations within the application specification, the value is assumed to be "1.0". As described above, this value will match any version beginning with "1.0", including 1.0.0, 1.0.1, 1.0.22, etc., but not 1.1.0, 2.0.0, etc. This default value will not change in future versions of the specification, ensuring that Applications that omit these values will not have sudden, unexpected changes in behavior when containers adopt new versions of the OpenSocial specification or features.</p>
<h1 id="rfc.section.1.3">
<a href="#rfc.section.1.3">1.3.</a> <a href="#Application-Roles" id="Application-Roles">Application Roles</a>
</h1>
<p id="rfc.section.1.3.p.1">Before developing OpenSocial applications it is important to understand the roles and relationships between the various key elements.</p>
<p id="rfc.section.1.3.p.2">The basic elements of an OpenSocial application are: </p>

<dl>
<dt>Application</dt>
<dd style="margin-left: 8">A reusable software component, defined using the syntax established by this document, that can be generally deployed and utilized across multiple OpenSocial implementations.</dd>
<dt>Source</dt>
<dd style="margin-left: 8">The entity from which the application originated.  This may be the author of the application or a company that publishes the application, etc.</dd>
<dt>Instance</dt>
<dd style="margin-left: 8">A specific instance of an Application that has been provisioned for use by one or more users within a given context or for a specific purpose.</dd>
<dt>Context</dt>
<dd style="margin-left: 8">The context within which an application instance is being used. For instance, a website that represents a work project might utilize an instance of an application that lists the names of everyone involved with the project. The "Context" within which the application instance is being used is the work project.</dd>
<dt>Container</dt>
<dd style="margin-left: 8">Is the software component that is directly responsible for hosting and managing instances of one or more applications within their respective contexts.</dd>
<dt>Viewer</dt>
<dd style="margin-left: 8">Is the entity that is currently interacting with the instance of an application within a given context.</dd>
<dt>Instance Owner</dt>
<dd style="margin-left: 8">Is the entity that is responsible for the application instance.</dd>
<dt>Context Owner</dt>
<dd style="margin-left: 8">Is the entity that is responsible for the context within which an application instance is being used.</dd>
</dl>

<p> </p>
<p id="rfc.section.1.3.p.3">To understand the relationships between each of these elements, consider the following example scenario: </p>

<ul>
<li>A company deploys an internal project management system that is to be used by multiple teams to manage individual projects.</li>
<li>Each project within this system is "owned" by a single individual project manager, and is worked on by any number of other people.</li>
<li>When a project is created, the project manager creates a webpage representing the project and selects the members of the project.</li>
<li>On each project page, the application automatically creates an instance of two separate application components: one that lists the names of the current members of the project and another that lists the current schedule and master task list for the entire project.</li>
<li>When each project member views the page, they are asked to login and are given the opportunity to customize the page by selecting from a list of available application components that will display information relevant to their participation in the project. Examples include a component that lists only the current task items assigned to them; or a component that shows the most recent tasks completed by other users.</li>
</ul>

<p> </p>
<p id="rfc.section.1.3.p.4">Within this scenario: </p>

<ul>
<li>The project management system is the Container;</li>
<li>Each individual project is a Context;</li>
<li>The project manager is the Context Owner;</li>
<li>Each of the components added to each project's page is an individual Instance of an Application;</li>
<li>For the components that list the project members and master task list, the project manager is the Instance Owner;</li>
<li>For each of the components added to the page by individual project members, the Instance Owner is the user that added it to the page;</li>
<li>When a user logs in to view a project's page, they are the current Viewer.</li>
</ul>

<p> </p>
<p id="rfc.section.1.3.p.5">Each instance of an Application will be generally configurable only by the Instance or Context Owner. That is, while the instance can store and access information about the current Viewer, the Viewer typically is not permitted to modify configuration options that affect the operation of the application unless the Viewer happens to also be the owner of the Instance or the Context.</p>
<p id="rfc.section.1.3.p.6">Further, when an Application requires access to secure or private data hosted by the container or a third party, authentication and authorization might be required for not only the current viewer, but also for the Application Instance, Context and Application Source. That is, containers MUST NOT assume that simply because a particular Viewer has been authorized to access some secure piece of data within one Application Instance, that the same authorization applies to all instances of that same Application, or Instances of other Applications that happen to be used by the same Viewer.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#ElementsAndAttributes" id="ElementsAndAttributes">The Application Specification Document</a>
</h1>
<p id="rfc.section.2.p.1">An OpenSocial Application Specification is an XML document that contains the meta-data and content for an application.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Conventions and Notes</h1>
<p id="rfc.section.2.1.p.1">The document format is specified in terms from the <a href="#W3C.REC-xml-infoset-20040204">XML Infoset </a> <cite title="NONE">[W3C.REC-xml-infoset-20040204]</cite>.  However, this specification uses the term "element" when referring to "Element Information Items" as defined by the XML Infoset specification, and the term "attribute" when referring to "Attribute Information Items".</p>
<p id="rfc.section.2.1.p.2">Currently, no XML Namespace is defined for any of the elements defined by this specification. Neither is there a MIME Media Type specific for Gadget Specification Documents.</p>
<p id="rfc.section.2.1.p.3">All relative IRI and URI references contained within the Application Specification document, including those contained within the the textual content of &lt;Content&gt; elements, are relative to the Application Specification Document's URL as known by the container.</p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> Document Structure</h1>
<h1 id="rfc.section.2.2.1">
<a href="#rfc.section.2.2.1">2.2.1.</a> The &lt;Module&gt; Element</h1>
<p id="rfc.section.2.2.1.p.1">The root of the Application Specification Document is the &lt;Module&gt; element. At a minimum, it's children MUST consist of no more than one &lt;ModulePrefs&gt; element, no more than one &lt;UserPref&gt; element, and one or more &lt;Content&gt; elements.</p>
<div id="#rfc.figure.6"></div>
<pre>
  Module = element Module {
    attribute specificationVersion { version }?,
    undefinedAttribute*,
    ModulePrefs?,
    UserPref*,
    Content+,
    extensionElement*
  }
          </pre>
<p id="rfc.section.2.2.1.p.2">The <samp>specificationVersion</samp> attribute identifies the version of the OpenSocial specification the container MUST use to process and render the Application Specification. The value is a string conforming to the version identifier described in <a href="#Versioning">Section 1.2</a>. If absent, the default value is assumed to be "1.0".</p>
<p id="rfc.section.2.2.1.p.3">Text nodes included as children of the &lt;Module&gt; element will be ignored by the container.</p>
<p id="rfc.section.2.2.1.p.4">The &lt;Module&gt; element MAY contain an <samp>xml:base</samp> attribute as specified by <a href="#W3C.REC-xmlbase-20090128">[W3C.REC-xmlbase-20090128]</a> whose value establishes a base for all relative IRI's and URI's contained within the specification document. If specified, containers are required to use the base to resolve all relative IRI and URI references.</p>
<h1 id="rfc.section.2.2.2">
<a href="#rfc.section.2.2.2">2.2.2.</a> The &lt;ModulePrefs&gt; Element</h1>
<p id="rfc.section.2.2.2.p.1">The &lt;ModulePrefs&gt; element serves as a container for all metadata, features and processing rules dealing with the application.  The children of the element consist of a variety of optional attributes and elements.</p>
<div id="#rfc.figure.7"></div>
<pre>
  ModulePrefs = element ModulePrefs {
    attribute title { text }?,
    attribute title_url { IRI }?,
    attribute description { text }?,
    attribute author { text }?,
    attribute author_email { text }?,
    attribute screenshot { IRI }?,
    attribute thumbnail { IRI }?,
    attribute height { text }?,
    attribute width { text }?,
    attribute doctype { "quirksmode" | text },
    undefinedAttribute*,
    (Require* 
     &amp; Optional*
     &amp; Preload*
     &amp; Icon* 
     &amp; Locale*
     &amp; Link*
     &amp; OAuth? 
     &amp; OAuth2?,
     extensionElement*)
  }
         </pre>
<p id="rfc.section.2.2.2.p.2">The &lt;ModulePrefs&gt; element MAY contain zero or more &lt;Require&gt;, &lt;Optional&gt;, &lt;Preload&gt;, &lt;Icon&gt;, &lt;Locale&gt; and &lt;Link&gt; elements and MAY contain no more than one each of the &lt;OAuth&gt; and &lt;OAuth2&gt; elements.</p>
<p id="rfc.section.2.2.2.p.3">The <samp>title</samp> attribute specifies the application's title. If provided, a container SHOULD use this value in any situation where a title bar or other identifying name is required. The value MAY be localized as described in <a href="#Localization">Section 3.4</a>.</p>
<p id="rfc.section.2.2.2.p.4">If provided, containers SHOULD use the value of the <samp>title_url</samp> attribute to provide a link target whenever the value of the <samp>title</samp> attribute is displayed.</p>
<p id="rfc.section.2.2.2.p.5">The <samp>description</samp> attribute provides an optional, human-readable description of the application.  The value MAY be localized as described in <a href="#Localization">Section 3.4</a>.</p>
<p id="rfc.section.2.2.2.p.6">The <samp>author</samp> attribute optionally provides the name of the author of the application.</p>
<p id="rfc.section.2.2.2.p.7">The <samp>author_email</samp> attribute optionally provides an email address to serve as a point of contact for the author of the application.</p>
<p id="rfc.section.2.2.2.p.8">The <samp>screenshot</samp> attribute provides an optional IRI of a visual representation of the application. Typically such images depict an image of the application that reflects a typical user's experience. The referenced resource MUST be an image on a publicly-accessible web site that is not blocked by a robots.txt file.  The preferred format is PNG, though GIF and JPG are also acceptable.  Gadget screenshots SHOULD be 280 pixels wide. The height of the screenshot SHOULD be the "natural" height of the application, in pixels, when it is in use.</p>
<p id="rfc.section.2.2.2.p.9">The <samp>thumbnail</samp> attribute provides an optional IRI of a smaller visual representation of the application.  The referenced resource MUST be an image on a publicly-accessible web site that is not blocked by a robots.txt file. The preferred format is PNG, though GIF and JPG are also acceptable. Thumbnails SHOULD be 120x60 pixels and SHOULD be smaller than images referenced using the <samp>screenshot</samp> attribute but larger than any images linked to using &lt;Link&gt; elements that specify <samp>rel="icon"</samp>.</p>
<p id="rfc.section.2.2.2.p.10">The optional <samp>height</samp> and <samp>width</samp> attributes respectively define, in pixels, the preferred default display height and width of the application. Container's SHOULD use these values when establishing the appropriate display dimensions for the application.</p>
<p id="rfc.section.2.2.2.p.11">The optional <samp>doctype</samp> attribute is a string that identifies the preferred rendering model for the application.  When set to the literal value <samp>quirksmode</samp>, the application SHOULD be rendered using the so-called "browser quirks mode". Additional values MAY be used to support other rendering modes but only <samp>quirksmode</samp> is defined by this specification.</p>
<h1 id="rfc.section.2.2.3">
<a href="#rfc.section.2.2.3">2.2.3.</a> The &lt;Require&gt; and &lt;Optional&gt; Elements</h1>
<p id="rfc.section.2.2.3.p.1">The &lt;Require&gt; and &lt;Optional&gt; elements share a common structure and are each used to declare OpenSocial features that are either required or optional for the application to operate.  Each element consists of a feature identifier, a version, a list of specific application views the feature dependency applies to, and zero or more &lt;Param&gt; elements that provide specific feature-dependent detail.</p>
<div id="#rfc.figure.8"></div>
<pre>
  Param = element Param {
    attribute name { text },
    undefinedAttribute*,
    text?
  }   
        
  dependency = 
    attribute feature { text },
    attribute version { version },
    attribute views { viewnames },
    undefinedAttribute*,
    Param*,
    extensionElement,
        
  Optional = element Optional { dependency }
  Require = element Require { dependency }   
          </pre>
<p id="rfc.section.2.2.3.p.2">Features are collections of processing rules and JavaScript Library APIs that provide specific functionality to a application. A feature might also place various constraints and rules on the container and application when in use. Containers are required to honor the constraints and rules of any feature it claims to support.</p>
<p id="rfc.section.2.2.3.p.3">The <samp>feature</samp> attribute on the &lt;Optional&gt; and &lt;Require&gt; elements specifies the unique identifier of a Feature.</p>
<p id="rfc.section.2.2.3.p.4">The <samp>version</samp> attribute specifies the specific version of the identified Feature, using the syntax described in <a href="#Versioning">Section 1.2</a>.</p>
<p id="rfc.section.2.2.3.p.5">The <samp>views</samp> attribute specifies a comma separated list of <a href="#content-processing-model">views</a> <cite title="NONE">[content-processing-model]</cite> for which the Feature is either optional or required. Containers SHOULD only load features when an appropriate view is being rendered.</p>
<p id="rfc.section.2.2.3.p.6">For every feature identified using a &lt;Require&gt; element, the container to required to provide an implementation that matches the version specified by the <samp>version</samp> attribute.  The container is required to display an error if it is incapable of providing an appropriate implementation for a required Feature.</p>
<p id="rfc.section.2.2.3.p.7">For every feature identified using a &lt;Optional&gt; element, the container MAY provide an implementation of the feature. If an implementation is provided, it MUST match the version specified by the <samp>version</samp> attribute.</p>
<p id="rfc.section.2.2.3.p.8">Containers MUST NOT substitute versions of features that do not match that which is requested by the application.</p>
<p id="rfc.section.2.2.3.p.9">Containers SHOULD support as many versions of a feature as is practical to facilitate backwards compatibility with existing applications.</p>
<p id="rfc.section.2.2.3.p.10">Containers are permitted to refuse to support features or specific versions of features that are known or assumed to be incompatible with the specification version required by the Gadget, or that are known to be incompatible with other Features or versions of Features required by the Gadget. For example, a container MAY not support the combination of a &lt;ModulePrefs&gt; element using <samp>specificationVersion="1.0"</samp> and a &lt;Require feature="opensocial" version="2.0"&gt;; or the combination of &lt;Require feature="opensocial" version="1.0"&gt; and &lt;Require feature="opensocial-data" version="1.1"&gt;. In cases where such combinations are requested, the Features are said to be conflicting. Conflicting features are to be treated by Containers as if they were unsupported. Containers SHOULD provide an error message describing conflicts to developers when a conflict is detected.  If one or more of the conflicting Features is specified as Optional by a Gadget, and the set of Required features and specification version do not conflict, Containers SHOULD attempt to render the application by removing the conflicting optional Features. Containers SHOULD include the largest set of Optional Features that do not produce conflicts.</p>
<p id="rfc.section.2.2.3.p.11">It is possible for there to be feature version conflicts when two valid feature dependencies exist for the same feature.  This situation can occur when the same feature is declared at a global scope (no <samp>views</samp> attribute specified on the &lt;Require&gt; or &lt;Optional&gt; element) and at a view scope (<samp>views</samp> attribute specified) but with differing <samp>version</samp> values; for example, if we are rendering an Application's "home" view and the specification document contains both &lt;Require feature="myfeature" version="1"&gt; and &lt;Require feature="myfeature" version="2" views="home"&gt;.  In such cases, containers SHOULD use the Feature version from the element that explicitly matches the view being rendered over other feature references. Developers can easily correct such conflicts by always using the <samp>views</samp> attribute in applications that use mixed Feature versions.</p>
<h1 id="rfc.section.2.2.3.1">
<a href="#rfc.section.2.2.3.1">2.2.3.1.</a> The &lt;Param&gt; Element</h1>
<p id="rfc.section.2.2.3.1.p.1">The &lt;Param&gt; element provides configuration details for a feature dependency. The element consists of a single <samp>name</samp> attribute and text content. The element MUST NOT contain un-escaped markup. If the value of the parameter being specified contains markup such as XML or HTML tags, the value MUST either be properly escaped or wrapped within a CDATA section.</p>
<div id="#rfc.figure.9"></div>
<p>For instance:</p>
<pre>
  &lt;Require feature="my-feature" version="1.0"&gt;
    &lt;Param name="foo"&gt;&lt;![CDATA[&lt;a&gt;bar&lt;/a&gt;]]&gt;&lt;/Param&gt;
  &lt;/Require&gt;
            </pre>
<div id="#rfc.figure.10"></div>
<p>Or, alternatively:</p>
<pre>
  &lt;Require feature="my-feature" version="1.0"&gt;
    &lt;Param name="foo"&gt;&amp;lt;a&amp;gt;bar&amp;lt;/a&amp;gt;&lt;/Param&gt;
  &lt;/Require&gt;
            </pre>
<p id="rfc.section.2.2.3.1.p.2">Each &lt;Require&gt; and &lt;Optional&gt; element can contain any number of &lt;Param&gt; elements. The specific parameter names allowed are specific to each individual feature.</p>
<p id="rfc.section.2.2.3.1.p.3">When specified, each parameter will be made available by the container to the application code using the <samp>gadgets.util.getFeatureParameters</samp> API, with the value of the <samp>name</samp> attribute serving as the parameter key and the text value of the element serving as the parameter value.</p>
<p id="rfc.section.2.2.3.1.p.4">When a feature dependency for a specific view has been defined, the container SHOULD make only the parameters from the view-specific dependency available to the application using the getFeatureParameters API.</p>
<h1 id="rfc.section.2.2.4">
<a href="#rfc.section.2.2.4">2.2.4.</a> The &lt;Preload&gt; Element</h1>
<p id="rfc.section.2.2.4.p.1">The &lt;Preload&gt; element is used to identify resources that a container SHOULD load automatically when an application view is processed and rendered.</p>
<div id="#rfc.figure.11"></div>
<pre>
  Preload = element Preload {
    SignedFetch,
    attribute href { IRI },
    attribute views { viewnames }?
  }
          </pre>
<p id="rfc.section.2.2.4.p.2">The <samp>href</samp> attribute specifies the IRI of the resource to fetch.</p>
<p id="rfc.section.2.2.4.p.3">&lt;Preload&gt; elements MAY use the Signed Fetch mechanism defined by <a href="#SignedFetch">Section 3.1.1</a> and MAY contain the same optional attributes used to configure &lt;Content&gt; elements for signed fetch as described in <a href="#signed-fetch">Section 2.2.12.1.4</a>.</p>
<p id="rfc.section.2.2.4.p.4">The <samp>views</samp> attribute provides a comma-separated list of <a href="#content-processing-model">views</a> <cite title="NONE">[content-processing-model]</cite> for which this &lt;Preload&gt; element applies. Containers SHOULD NOT preload resources that are not specified for the view being rendered.  If no <samp>views</samp> attribute is specified, then the content SHOULD be preloaded for all views.</p>
<p id="rfc.section.2.2.4.p.5">The container will process all of the &lt;Preload&gt; elements defined for a particular view when it begins rendering the view by sending an HTTP GET request to the location specified in the <samp>href</samp> attribute. The responses to these requests will then be cached by the container as described in <a href="#caching">Section 3.2</a></p>
<p id="rfc.section.2.2.4.p.6">When an HTTP GET request for the same IRI is submitted using either the <samp>gadgets.io.makeRequest</samp> or <samp>osapi.http.get</samp> APIs, the container will use any cached responses previously generated as a result of processing the &lt;Preload&gt; elements.</p>
<h1 id="rfc.section.2.2.5">
<a href="#rfc.section.2.2.5">2.2.5.</a> The &lt;Link&gt; Element</h1>
<p id="rfc.section.2.2.5.p.1">The &lt;Link&gt; element is used to associate a variety of additional resources with the specification document. At a minimum, the element MUST contain the <samp>rel</samp> and <samp>href</samp> attributes.</p>
<div id="#rfc.figure.12"></div>
<pre>
  Link = element Link {
    SignedFetch,
    attribute rel { text },
    attribute href { IRI },
    attribute method { "GET" | "POST" }?,
    undefinedAttribute*,
    text
  }
          </pre>
<p id="rfc.section.2.2.5.p.2">The <samp>href</samp> attribute specifies the IRI of the resource being linked to. The value MUST be usable for dereferencing and therefore MUST be mapped to a URL following the rules specified in <a href="#RFC3987">[RFC3987]</a>.</p>
<p id="rfc.section.2.2.5.p.3">The specific relationship between the specification document and the referenced resource is specified by the value of the <samp>rel</samp> attribute. The value of the <samp>rel</samp> attribute MUST be a Link Relation Type as defined by <a href="#RFC5988">[RFC5988]</a>.</p>
<p id="rfc.section.2.2.5.p.4">This specification defines a number of <samp>rel</samp> attribute values that are significant. Implementations MUST NOT use any <samp>rel</samp> attribute value prefixed with the characters <samp>opensocial</samp>, <samp>gadgets</samp>, or <samp>events</samp> that are not defined by this specification.</p>
<p id="rfc.section.2.2.5.p.5">The <samp>rel</samp> attribute values currently supported by this specification are:</p>
<div id="#rfc.table.1"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">rel</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left"><samp>icon</samp></td>
<td class="left">Used to link an image resource to the specification document that serves as a representative icon for the application.</td>
</tr>
<tr>
<td class="left"><samp>license</samp></td>
<td class="left">Used to reference the license under which the code and content of an application specification document is being provided. For example, the JavaScript code contained within the specification document can be considered to be "open source" and distributed using a common "open source license" such as the <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache Software License, v2</a> or a <a href="http://creativecommons.org/">Creative Commons License</a>, etc.  Multiple &lt;Link&gt; elements using the "license" link relation MAY be used within a specification document with each representing an alternative distribution license.</td>
</tr>
<tr>
<td class="left"><samp>privacy-policy</samp></td>
<td class="left">Used to reference a document describing the privacy policy associated with the application. Such documents SHOULD disclose what personal information is collected by the application and how that information is stored, used, managed and disclosed to other parties. A specification document SHOULD contain no more than one &lt;Link&gt; element using the "privacy-policy" link relation.</td>
</tr>
<tr>
<td class="left"><samp>terms-of-service</samp></td>
<td class="left">Used to reference a document describing the the rules to which a user of the application agree to follow when using the application. Note that such "Terms of Service" carry no legal weight and can be ignored with impunity in the absence of an explicit, legally enforceable contract. A specification document SHOULD contain no more than one &lt;Link&gt; element using the "terms-of-service" link relation.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.2.2.5.p.6">Additional link relations specific to the Application Lifecycle Events capability are described in <a href="#gadget-lifecycle-events">Section 3.5</a>.</p>
<p id="rfc.section.2.2.5.p.7">The &lt;ModulePrefs&gt; element can contain any number of &lt;Link&gt; elements but MUST NOT contain more than one with the same combination of <samp>rel</samp> and <samp>href</samp> attribute values.</p>
<p id="rfc.section.2.2.5.p.8">The optional <samp>method</samp> attribute can be used with certain links to specify the HTTP method that is to be used when dereferencing the link's <samp>href</samp>.</p>
<h1 id="rfc.section.2.2.6">
<a href="#rfc.section.2.2.6">2.2.6.</a> The &lt;Locale&gt; Element</h1>
<p id="rfc.section.2.2.6.p.1">The &lt;Locale&gt; element is used to provide localization information for an application. Containers are required to honor localization rules as specified in <a href="#Localization">Localization</a> <cite title="NONE">[Localization]</cite>. Each Locale tag represents localization information for a single locale.</p>
<div id="#rfc.figure.13"></div>
<pre>
  Msg = element msg {
    attribute name { text },
    undefinedAttribute*,
    text
  }
 
  CommonLocale = {
    attribute lang { "all" | text }?,
    attribute country { "all" | text }?,
    attribute language_direction { "rtl" | "ltr" }?,
    attribute views { viewnames },
    undefinedAttribute*
  }
  
  RemoteLocale = element Locale {
    CommonLocale,
    attribute messages { IRI }
  }
  
  InLineLocale = element Locale {
    CommonLocale,
    Msg*
  }
        
  Locale = RemoteLocale | InLineLocale
          </pre>
<p id="rfc.section.2.2.6.p.2">The <samp>lang</samp> attribute specifies the language for the locale specified as an ISO-639-1 Language Code, or the special value <samp>all</samp>, which containers MUST interpret as applying to all languages unless a more specific match is found. If the lang attribute is not specified, the default is considered to be <samp>all</samp>.</p>
<p id="rfc.section.2.2.6.p.3">The <samp>country</samp> attribute specifies the country code for the locale specified as an ISO-3166-1 Country code, or the special value <samp>all</samp>, which containers MUST interpret as applying to all countries unless a more specific match is found. If the country attribute is not specified, the default is considered to be <samp>all</samp>.</p>
<p id="rfc.section.2.2.6.p.4">The optional <samp>language_direction</samp> attribute is used to specify the default text rendering direction.  Valid values are <samp>ltr</samp>, to indicate "Left-to-Right" ordering, or <samp>rtl</samp> to indicate "Right-to-Left" ordering. If not specified, the default text rendering direction is determined by the container. Directional rendering of text is discussed in detail in <a href="#Localization">Section 3.4</a>.</p>
<p id="rfc.section.2.2.6.p.5">The optional <samp>views</samp> attribute specifies a comma-separated list of <a href="#content-processing-model">views</a> <cite title="NONE">[content-processing-model]</cite> for which the Locale information applies. Containers SHOULD only use the information provided by the containing &lt;Locale&gt; element when an appropriate view is being rendered.</p>
<p id="rfc.section.2.2.6.p.6">The optional <samp>messages</samp> attribute specifies the IRI of an XML document conforming to the <a href="#MessageBundles">Message Bundle Document</a> <cite title="NONE">[MessageBundles]</cite> format. The IRI specified MUST be suitable for dereferencing. The container MUST fetch the referenced resource and treat all child elements of the root XML element in the document as though they are child nodes of the containing &lt;Locale&gt; element.</p>
<p id="rfc.section.2.2.6.p.7">Unless the <samp>messages</samp> attribute is specified, the &lt;Locale&gt; element MAY contain zero or more &lt;msg&gt; elements, each of which provide a singular localized value. The key used to identify the value is specified using the "name" attribute.  The text content of the &lt;msg&gt; element provides the localized value. If the <samp>messages</samp> attribute is specified, the &lt;Locale&gt; element MUST NOT contain any &lt;msg&gt; elements.</p>
<div id="#rfc.figure.14"></div>
<p>An example &lt;Locale&gt; that uses a referenced Message Bundle Document:</p>
<pre>
  &lt;Locale language="en" country="US"
    messages="http://example.org/i18n/en/messages.xml" /&gt;
          </pre>
<div id="#rfc.figure.15"></div>
<p>An example &lt;Locale&gt; that uses contained &lt;msg&gt; elements:</p>
<pre>
  &lt;Locale language="en" country="US"&gt;
    &lt;msg name="foo"&gt;This is the American English Version&lt;/msg&gt;
    &lt;msg name="bar"&gt;Hello From My Gadget&lt;/msg&gt;
  &lt;/Locale&gt;
          </pre>
<h1 id="rfc.section.2.2.7">
<a href="#rfc.section.2.2.7">2.2.7.</a> The &lt;OAuth&gt; Element</h1>
<p id="rfc.section.2.2.7.p.1">The &lt;OAuth&gt; element supplies the container with OAuth 1.0 specific configuration details for the application. For details see <a href="#oauth-support">Section 3.1.2</a>.</p>
<div id="#rfc.figure.16"></div>
<pre>        
  OAuth = element OAuth {
    undefinedAttribute*,
    Service*,
    extensionElement*
  }
          </pre>
<p id="rfc.section.2.2.7.p.2">The &lt;OAuth&gt; element contains zero or more &lt;Service&gt; elements, each of which detail a specific OAuth 1.0 service associated with the application.</p>
<div id="#rfc.figure.17"></div>
<pre>        
  Service = element Service {
    attribute name { text }?,
    attribute view { text }?,
    attribute realm { text }?,
    undefinedAttribute*,
    element Request { OAuthResourceType }?,
    element Access { OAuthResourceType }?,
    element Authorization {
      attribute url { IRI },
      undefinedAttribute*,
      extensionElement*
    }?,
    extensionElement*
  }
  
  OAuthResourceType = {
    attribute url { IRI },
    attribute method { "GET" | "POST" }?,
    attribute param_location { 
      "auth-header" | "uri-query" | "post-body" }?,
    extensionElement*
  }
          </pre>
<p id="rfc.section.2.2.7.p.3">The optional <samp>name</samp> attribute on the &lt;Service&gt; element specifies a name used to reference the service at runtime. If unspecified, the value is assumed to be an empty string. Gadget developers specify which OAuth Service they wish to use by passing the service name, for example, as a parameter to the <samp>gadgets.io.makeRequest</samp> and <samp>osapi.http</samp> APIs.</p>
<p id="rfc.section.2.2.7.p.4">The optional <samp>view</samp> attribute on the &lt;Service&gt; element specifies the name of a View the container SHOULD display to the Viewer when the container determines that an OAuth Access Token needs to be acquired. If the specified view does not exist within the Application specification document, the attribute MUST be ignored.</p>
<p id="rfc.section.2.2.7.p.5">The optional <samp>realm</samp> attribute specifies a realm-value as specified by <a href="#RFC2617">[RFC2617]</a>. The given realm-value is used to select an appropriate &lt;Service&gt; element to use when authenticating a request for a remote resource should the container receive a 401 Unauthenticated response. See <a href="#responses.unauthorized">Section 3.1.2.2.3</a> for additional detail.</p>
<p id="rfc.section.2.2.7.p.6">The child elements of the &lt;Service&gt; element consist of the &lt;Request&gt;, &lt;Access&gt; and &lt;Authorization&gt; elements, each of which are optional but MUST NOT appear more than once within a single &lt;Service&gt; element.</p>
<p id="rfc.section.2.2.7.p.7">The &lt;Request&gt; element identifies the endpoint for acquiring OAuth request tokens. The <samp>url</samp> attribute specifies the IRI of the endpoint. This IRI MUST be suitable for dereferencing. The <samp>method</samp> attribute specifies the HTTP verb to use when sending the request, valid values are either <samp>GET</samp> or <samp>POST</samp>.  If not specified, the value is assumed to be <samp>POST</samp>.  The <samp>param_location</samp> attributes specifies how OAuth parameters are to be passed in the request. Valid options are either <samp>uri-query</samp>, <samp>auth-header</samp>, and <samp>post-body</samp>, corresponding to the options described in <a href="#RFC5849">Section 3.5 of the OAuth specification</a> <cite title="NONE">[RFC5849]</cite>. If not specified, the value is assumed to be <samp>auth-header</samp>.</p>
<p id="rfc.section.2.2.7.p.8">The &lt;Access&gt; element identifies the endpoint for acquiring OAuth access tokens. The &lt;Access&gt; element shares the same attribute definitions as the &lt;Request&gt; element.</p>
<p id="rfc.section.2.2.7.p.9">The &lt;Authorization&gt; element identifies the endpoint used to acquire authorization. The <samp>url</samp> attribute specifies the IRI of the endpoint. This IRI MUST be suitable for dereferencing.</p>
<h1 id="rfc.section.2.2.8">
<a href="#rfc.section.2.2.8">2.2.8.</a> The &lt;OAuth2&gt; Element</h1>
<p id="rfc.section.2.2.8.p.1">The &lt;OAuth2&gt; element supplies the container with OAuth 2.0 specific configuration details for the application. For details see <a href="#oauth-support">Section 3.1.2</a>.</p>
<div id="#rfc.figure.18"></div>
<pre>        
  OAuth2 = element OAuth2 {
    undefinedAttribute*,
    Service*,
    extensionElement*
  }
          </pre>
<p id="rfc.section.2.2.8.p.2">The &lt;OAuth2&gt; element contains zero or more &lt;Service&gt; elements, each of which detail a specific OAuth 2.0 service associated with the application.</p>
<div id="#rfc.figure.19"></div>
<pre>        
  Service = element Service {
    attribute name { text }?,
    attribute view { text }?,
    attribute realm { text }?,
    attribute scope { text }?,
    undefinedAttribute*,
    element Authorization {
      attribute url { IRI },
      attribute method { "GET" | "POST" }?,
      undefinedAttribute*,
      extensionElement* 
    }?,
    element Token {
      attribute url {IRI},
      undefinedAttribute*,
      extensionElement*
    }?,
    extensionElement*
  }
          </pre>
<p id="rfc.section.2.2.8.p.3">The optional <samp>name</samp> attribute on the &lt;Service&gt; element specifies a name used to reference the service at runtime. If unspecified, the value is assumed to be an empty string. Gadget developers specify which OAuth Service they wish to use by passing the service name as a parameter, for example, to the <samp>gadgets.io.makeRequest</samp> or <samp>osapi.http</samp> APIs.</p>
<p id="rfc.section.2.2.8.p.4">The optional <samp>view</samp> attribute on the &lt;Service&gt; element specifies the name of a View the container SHOULD display to the Viewer when the container determines that an OAuth Access Token needs to be acquired. If the specified view does not exist within the Application specification document, the attribute MUST be ignored.</p>
<p id="rfc.section.2.2.8.p.5">The optional <samp>realm</samp> attribute specifies a realm-value as specified by <a href="#RFC2617">[RFC2617]</a>. The given realm-value is used to select an appropriate &lt;Service&gt; element to use when authenticating a request for a remote resource should the container receive a 401 Unauthenticated response. See <a href="#responses.unauthorized">Section 3.1.2.2.3</a> for additional detail.</p>
<p id="rfc.section.2.2.8.p.6">OAuth2 Service elements MAY also specify an optional <samp>scope</samp> attribute providing the scope used by default in all requests. Access Token Scope is defined in Section 3.3 of the <a href="#I-D.ietf-oauth-v2">OAuth 2.0 specification.</a> <cite title="NONE">[I-D.ietf-oauth-v2]</cite></p>
<p id="rfc.section.2.2.8.p.7">The child elements of the &lt;Service&gt; element consist of the &lt;Authorization&gt;, &lt;Token&gt; elements, each of which are optional but MUST NOT appear more than once within a single &lt;Service&gt; element.</p>
<p id="rfc.section.2.2.8.p.8">The &lt;Authorization&gt; element identifies the endpoint for acquiring OAuth authorization tokens. The <samp>url</samp> attribute specifies the IRI of the endpoint. This IRI MUST be suitable for dereferencing. The <samp>method</samp> attribute specifies the HTTP verb to use when sending the request, valid values are either <samp>GET</samp> or <samp>POST</samp>. If not specified, the value is assumed to be <samp>GET</samp>.</p>
<p id="rfc.section.2.2.8.p.9">The &lt;Token&gt; element is used to acquire OAuth 2.0 access tokens.  The <samp>url</samp> attribute specifies the IRI of the endpoint. This IRI MUST be suitable for dereferencing. For details, refer to <a href="#I-D.ietf-oauth-v2">Section 3.2 of the OAuth 2.0 specification.</a> <cite title="NONE">[I-D.ietf-oauth-v2]</cite></p>
<h1 id="rfc.section.2.2.9">
<a href="#rfc.section.2.2.9">2.2.9.</a> The &lt;UserPref&gt; Element</h1>
<p id="rfc.section.2.2.9.p.1">The &lt;UserPref&gt; element is used within a specification document to define a "user preference" for use within instances of the application.  Each instance of the &lt;UserPref&gt; element defines exactly one preference value. Multiple &lt;UserPref&gt; elements MAY be used within a specification document.</p>
<p id="rfc.section.2.2.9.p.2">Containers MUST process each &lt;UserPref&gt; by making each available to the application via the <samp>gadgets.Prefs</samp> API, using the value of &lt;UserPref&gt; element's required <samp>name</samp> attribute as the index key for storing and retrieving preferences using the API.</p>
<div id="#rfc.figure.20"></div>
<pre>
  BaseUserPref = {
    attribute name { text },
    attribute display_name { text }?,
    attribute default_value { text }?,
    attribute required { "true" | "false" }?,
    undefinedAttribute*,
    extensionElement*
  }
        
  SimpleUserPref = element UserPref {
    BaseUserPref,
    attribute datatype { 
      "string" | 
      "hidden" | 
      "bool" |
      "list" | 
      "number" }?
  }
        
  EnumUserPref = element UserPref {
    BaseUserPref,
    attribute datatype { "enum" },
    element EnumValue {
      attribute value { text },
      attribute display_value { text }?,
      undefinedAttribute*,
      extensionElement*
    }*
  }
  
  UserPref = element SimpleUserPref | EnumUserPref
          </pre>
<p id="rfc.section.2.2.9.p.3">The <samp>datatype</samp> attribute specifies the data type for the instances of the preference value at runtime.  Valid values are <samp>string</samp>, <samp>hidden</samp>, <samp>bool</samp>, <samp>list</samp> and <samp>number</samp>.  If not specified, the value is assumed to be <samp>string</samp>.  For more information on <samp>datatype</samp>, refer to <a href="#datatypes-values">Section 2.2.9.1</a> below.</p>
<p id="rfc.section.2.2.9.p.4">The <samp>display_name</samp> attribute specifies a preferred display name for the preference. The value SHOULD be localized as described in <a href="#Localization">Section 3.4</a>.</p>
<p id="rfc.section.2.2.9.p.5">The <samp>default_value</samp> attribute specifies the default value for instances of the preference. The value of the attribute depends on the value of the <samp>datatype</samp> attribute. Container's are required to provide the value of the <samp>default_value</samp> attribute as the value of the preference when using the <samp>gadgets.Prefs</samp> API and a stored value for the preference does not yet exist.</p>
<p id="rfc.section.2.2.9.p.6">The <samp>required</samp> attribute specifies whether instances of the preference require a valid value in order for the application to function correctly. Valid values are either <samp>true</samp> or <samp>false</samp>.  If not specified, the value is assumed to be <samp>false</samp>.  If the value is <samp>true</samp>, Containers are required to display an error message or a prompt if there is no value stored.</p>
<h1 id="rfc.section.2.2.9.1">
<a href="#rfc.section.2.2.9.1">2.2.9.1.</a> <a href="#datatypes-values" id="datatypes-values">User Preference Data Types</a>
</h1>
<p id="rfc.section.2.2.9.1.p.1">The default data type for all user preference values is <samp>string</samp>, represented either by omitting the <samp>datatype</samp> attribute on the &lt;UserPref&gt; element or by explicitly specifying <samp>datatype="string"</samp>.  When datatype is <samp>string</samp>, The value of the <samp>default_value</samp> attribute and the stored value of the user preference at runtime MUST be a String.</p>
<div id="#rfc.figure.21"></div>
<p>An example <samp>string</samp> preference:</p>
<pre>
  &lt;UserPref name="foo" datatype="string" default_value="foo"
            display_name="Foo" required="true" /&gt;
          </pre>
<p id="rfc.section.2.2.9.1.p.2">When datatype equals <samp>number</samp>, the value of the <samp>default_value</samp> attribute and the stored value of the user preference at runtime MUST be a numeric value. The value MAY be any integer, decimal or floating point value.</p>
<div id="#rfc.figure.22"></div>
<p>An example <samp>number</samp> preference:</p>
<pre>
  &lt;UserPref name="foo" datatype="number" default_value="123"
            display_name="Foo" required="true" /&gt;
            </pre>
<p id="rfc.section.2.2.9.1.p.3">When datatype equals <samp>bool</samp>, the value of the <samp>default_value</samp> attribute and the stored value of the user preference MUST evaluate to either True or False when accessed via the <samp>gadgets.Prefs.getBool</samp> API.</p>
<div id="#rfc.figure.23"></div>
<p>An example <samp>bool</samp> preference:</p>
<pre>
  &lt;UserPref name="foo" datatype="bool" default_value="true"
            display_name="Foo" required="true" /&gt;
            </pre>
<p id="rfc.section.2.2.9.1.p.4">When datatype equals <samp>list</samp>, the value of the <samp>default_value</samp> attribute and the stored value of the user preference MUST be a pipe-delimited (|) string of values, returned as a JavaScript array when accessed via the <samp>gadgets.Prefs.getArray</samp> API.</p>
<div id="#rfc.figure.24"></div>
<p>An example <samp>list</samp> preference:</p>
<pre>
  &lt;UserPref name="foo" datatype="list" default_value="foo|bar|baz"
            display_name="Foo" required="true" /&gt;
            </pre>
<p id="rfc.section.2.2.9.1.p.5">When datatype equals <samp>hidden</samp>, the value of the <samp>default_value</samp> attribute and the stored value of the user preference MUST be a String.  The difference between <samp>hidden</samp> and <samp>string</samp> is that <samp>hidden</samp> user preferences are not visible and are not editable by users by can be accessible via the <samp>gadgets.Prefs.getString</samp> API.</p>
<div id="#rfc.figure.25"></div>
<p>An example <samp>hidden</samp> preference:</p>
<pre>
  &lt;UserPref name="foo" datatype="hidden" default_value="foo"
            display_name="Foo" required="true" /&gt;
            </pre>
<p id="rfc.section.2.2.9.1.p.6">When datatype equals <samp>enum</samp>, the &lt;UserPref&gt; element SHOULD contain one or more &lt;EnumValue&gt; elements, each of which define a single possible value for the preference. Each &lt;EnumValue&gt; element contains a required <samp>value</samp> attribute that specifies a string value, and an optional <samp>display_value</samp> attribute that specifies a textual representation of the <samp>value</samp>. If unspecified, the <samp>display_value</samp> defaults to the <samp>value</samp>. Containers SHOULD display the <samp>display_value</samp> in place of <samp>value</samp> when rendering a user interface for editing purposes. The value of the <samp>default_value</samp> attribute and the stored value of the user preference MUST equal one of the supplied &lt;EnumValue&gt; <samp>value</samp> attributes.</p>
<div id="#rfc.figure.26"></div>
<p>An example <samp>enum</samp> preference:</p>
<pre>
  &lt;UserPref name="foo" datatype="string" default_value="foo"
            display_name="Foo" required="true"&gt;
    &lt;EnumValue value="foo" display_value="Foo" /&gt;
    &lt;EnumValue value="bar" display_value="Bar" /&gt;
    &lt;EnumValue value="baz" display_value="Baz" /&gt;
  &lt;/UserPref&gt;
            </pre>
<h1 id="rfc.section.2.2.10">
<a href="#rfc.section.2.2.10">2.2.10.</a> The &lt;Data&gt; Element</h1>
<p id="rfc.section.2.2.10.p.1">The &lt;Data&gt; element contains data pineline elements as defined by <a href="#DataPipelining">Section 3.6</a>. All data pipeline elements defined in this block are registered globlly for all views by default. Individual data pipeline elements MAY be specified for particular views by adding the <samp>view</samp> attribute to the tag.</p>
<div id="#rfc.figure.27"></div>
<pre>
  Data = element Data {
    undefinedAttribute*,
    extensionElement*
  }
          </pre>
<p id="rfc.section.2.2.10.p.2">See <a href="#DataPipelining">Section 3.6</a> for complete information on the data pipelining mechanism and element definitions.</p>
<h1 id="rfc.section.2.2.11">
<a href="#rfc.section.2.2.11">2.2.11.</a> The &lt;ExternalServices&gt; Element</h1>
<p id="rfc.section.2.2.11.p.1">The &lt;ExternalServices&gt; element contains zero or more &lt;ServiceTag&gt; elements used to establish an "alias" for container-managed external services utilized by the application.</p>
<div id="#rfc.figure.28"></div>
<pre>
  ExternalServices = element ExternalServices {
    undefinedAttribute*,
    element ServiceTag {
      attribute alias { text },
      text
    }*
  }
          </pre>
<p id="rfc.section.2.2.11.p.2">The &lt;ServiceTag&gt; element has a single <samp>alias</samp> attribute whose value is a string and textual content that provides an application-specific plain-text label for the alias. Additional markup within the &lt;ServiceTag&gt; is not allowed.</p>
<p id="rfc.section.2.2.11.p.3">Currently, when making a remote request from within an application using either the <samp>osapi.http</samp> or <samp>gadgets.io.makeRequest</samp> APIs, the full URL of the remote service that is being invoked must be known to the application and specified within the request, along with all other details of the request. Often, however, it is desirable to offload the responsibility of managing access to external services to the container, for instance, when multiple services are available that implement the same protocol and it would be difficult for a single application to keep track of all instances; or when a potentially untrusted application needs to be given access to secure backend systems. In such cases, a container can choose to manage all of the details involved with connecting to and communicating with the service and expose that service to the application via an "alias".</p>
<p id="rfc.section.2.2.11.p.4">Once an alias for a service is established, a specification document can use the &lt;ServiceTag&gt; element within &lt;ExternalServices&gt; to declare an application-specific reference label for the alias that can be used when invoking the <samp>osapi.http</samp> or <samp>gadgets.io.makeRequest</samp> APIs in place of the URL.</p>
<p id="rfc.section.2.2.11.p.5">For example, suppose that an application requires access to a backend enterprise application that implements a proprietary communications protocol. Software is added to the container that allows it to communicate with the backend system. All of the details including the URL, authentication details, authorization, and so forth are configured within the container by an administrator and an alias is assigned to the service: "opensocial:service://example.com/api?version=1".</p>
<p id="rfc.section.2.2.11.p.6">The developer then creates the specification document and adds a &lt;ServiceTag&gt; element referencing the alias and created a lobel for the alias that can be used within the application's Javascript:</p>
<div id="#rfc.figure.29"></div>
<pre>
  &lt;Module&gt;
    ...
    &lt;ExternalServices&gt;
      &lt;ServiceTag alias="opensocial:service://example.com/api?version=1"&gt;
        EnterpriseService
      &lt;/ServiceTag&gt;
    &lt;/ExternalServices&gt;
    &lt;Content&gt;
      ...
      &lt;script&gt;
        ...
        var params = {
          'alias' : 'EnterpriseService',
          'href'  : '/files',
          'format': 'json',
        };
        osapi.http.get(params).execute(
          function(result) {
            ...
          }
        );
        ...
      &lt;/script&gt;
      ...
    &lt;/Content&gt;
  &lt;/Module&gt;
          </pre>
<p id="rfc.section.2.2.11.p.7">When the application is installed, the container will attempt to match the alias specified in the &lt;ServiceTag&gt; to any known configured services -- in this case, our backend enterprise service -- and will automatically proxy all requests to the "EnterpriseService" label to the backend service.</p>
<p id="rfc.section.2.2.11.p.8">It is possible for multiple service instances managed by a single container to share the same alias; for instance, when there are multiple servers available that implement the same communication protocols.  In such cases, when the application is installed, the container can either automatically select an appropriate service instance to map the &lt;ServiceTag&gt; to or provide a choice to the user installing the application to select which service instance to use.</p>
<p id="rfc.section.2.2.11.p.9">If a &lt;ServiceTag&gt; specifies an alias that is not currently known to the container, installation of the application SHOULD fail and an error reported.</p>
<h1 id="rfc.section.2.2.12">
<a href="#rfc.section.2.2.12">2.2.12.</a> The &lt;Content&gt; Element</h1>
<p id="rfc.section.2.2.12.p.1">The &lt;Content&gt; element provides the user interface and runtime code for the application. A specification document MUST have at least one &lt;Content&gt; element.</p>
<div id="#rfc.figure.30"></div>
<pre>
  CommonContent = {
    attribute preferred_height { text }?,
    attribute preferred_width { text }?,
    attribute view { text }?,
    undefinedAttribute*
  }
        
  RedirectedContent = element Content {
    CommonContent,
    SignedFetch,
    attribute type { "url" },
    attribute href ( IRI )
  }
  
  ProxiedContent = element Content {
    CommonContent,
    SignedFetch,
    attribute type { "html" }?,
    attribute href { IRI },
    extensionElement*
  }
  
  HtmlContent = element Content {
    CommonContent,
    attribute type { "html" }?,
    text
  }
  
  Content = RedirectedContent | HtmlContent | ProxiedContent
          </pre>
<p id="rfc.section.2.2.12.p.2">The required <samp>type</samp> attribute specifies the type of content provided by the &lt;Content&gt; element. Valid values are either <samp>html</samp> or <samp>url</samp>. Containers MUST process the &lt;Content&gt; element according to the specific rules for each type.</p>
<p id="rfc.section.2.2.12.p.3">The &lt;Content&gt; element MUST conform to the following rules: </p>

<ol>
<li>If the value of <samp>type</samp> is <samp>html</samp> and the <samp>href</samp> attribute is specified, the content of &lt;Content&gt; MAY contain one or more Data Pipeline elements as defined in <a href="#DataPipelining">Section 3.6</a>.  The &lt;Content&gt; element MAY also contain any combination of the "Signed Fetch" attributes defined by <a href="#signed-fetch">Section 2.2.12.1.4</a>.</li>
<li>If the value of <samp>type</samp> is <samp>html</samp>, and the <samp>href</samp> attribute is not specified, the content of &lt;Content&gt; MUST NOT contain child elements and SHOULD be suitable for handling as HTML markup.  The HTML markup SHOULD be wrapped within a CDATA tag otherwise it MUST be escaped in order to prevent the HTML from being interpreted by the XML parser; for example, <samp>&lt;br&gt;</samp> as <samp>&amp;lt;br&gt;</samp>.</li>
<li>If the value of <samp>type</samp> is <samp>url</samp>, the &lt;Content&gt; element MUST contain the <samp>href</samp> attribute and MUST NOT contain child elements or text. Containers SHOULD ignore any elements or text contained within the &lt;Content&gt;.  The element MAY contain any combination of the "Signed Fetch" attributes defined by <a href="#signed-fetch">Section 2.2.12.1.4</a>.</li>
<li>Any &lt;Content&gt; element MAY contain <samp>preferred_height</samp> and <samp>preferred_width</samp> attributes that specify the preferred dimensions, in pixels, the container SHOULD use when rendering the content.</li>
<li>Any &lt;Content&lt; element MAY contain a <samp>view</samp> attribute that specifies a comma-separated list of views. A single application can support multiple views. Each view is associated with at least one &lt;Content&gt; element. When the container renders an application with multiple &lt;Content&gt; elements, it will use the view name to select the appropriate content.</li>
</ol>

<p> </p>
<p id="rfc.section.2.2.12.p.4">When a &lt;Content&gt; element uses the <samp>href</samp> attribute, the view names listed in it's <samp>view</samp> attribute MUST NOT be used in any other &lt;Content&gt; element. A single view name MAY appear within multiple &lt;Content&gt; elements that specify a <samp>type</samp> attribute value of <samp>html</samp> and do not include an <samp>href</samp> attribute.  How multiple &lt;Content&gt; elements sharing the same view name are processed to provide the rendered content for a view is defined in <a href="#content-processing-model">Section 2.2.12.1</a>.</p>
<h1 id="rfc.section.2.2.12.1">
<a href="#rfc.section.2.2.12.1">2.2.12.1.</a> <a href="#content-processing-model" id="content-processing-model">Processing Model</a>
</h1>
<p id="rfc.section.2.2.12.1.p.1">The full collection of &lt;Content&gt; elements contained within a single application specification document belong to one or more abstract Views. A View consists of all the stylesheets, script, and markup that comprise the application's visual interface to a user and can be constructed from one or more individual &lt;Content&gt; elements either from markup contained directly within the application specification document or from external documents and resources referenced by IRI.</p>
<p id="rfc.section.2.2.12.1.p.2">All applications have a single unnamed default view and zero or more named views.</p>
<p id="rfc.section.2.2.12.1.p.3">View names are Strings consisting of one or two groups of one or more ASCII alpha-numeric characters, with each group optionally separated by the ASCII period (".") character, e.g. "home", "canvas", "foo", "home.About", etc. View names are case-sensitive such that "Home", "home", and "HOME" are NOT considered to be equivalent.</p>
<div id="#rfc.figure.31"></div>
<pre>
  name = 1*(ALPHA / DIGIT)
  viewname = name *["." name]
  viewnames = viewname *[ OWS "," OWS name]
            </pre>
<p id="rfc.section.2.2.12.1.p.4">Containers MAY assign specific meaning to particular view names.  In particular, this specification assigns the following special meanings to each of the given view names:</p>
<div id="#rfc.table.2"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Name</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">about</td>
<td class="left">Identifies a View that provides descriptive information about the application.</td>
</tr>
<tr>
<td class="left">canvas</td>
<td class="left">Identifies a View that is typically rendered by the container in a large area that is generally not shared with other application views.</td>
</tr>
<tr>
<td class="left">embedded</td>
<td class="left">Identifies a View that is intended for use primarily with <a href="#Embedded-Experiences">Embedded Experiences</a> <cite title="NONE">[Embedded-Experiences]</cite>.  When a container displays an application View using the <samp>gadgets.views.openEmbeddedExperience</samp> API, it will, by default, render the "embedded" View.</td>
</tr>
<tr>
<td class="left">home</td>
<td class="left">Identifies a View that is typically rendered by the container on a page with other application views. These are typically assigned relatively small areas of the available display area for the page.</td>
</tr>
<tr>
<td class="left">preferences</td>
<td class="left">Identifies a View that is typically used to allow the user to view and modify user preferences for the application.</td>
</tr>
<tr>
<td class="left">preview</td>
<td class="left">Identifies a View that is typically used to provide a demonstration view of the application.</td>
</tr>
<tr>
<td class="left">profile</td>
<td class="left">Identifies a View that, like "home", is typically rendered by the container on a page with other application views. The difference with PROFILE, however, is that the page into which the View is included will typically represent a "Profile" view of an individual person or entity. For example, when displayed on the profile page for a person, an application View might provide an interface for scheduling a meeting with that person or initiating a Voice-over-IP call, and so forth.</td>
</tr>
<tr>
<td class="left">support</td>
<td class="left">Identifies a View that provides details about where users can acquire support information for the application, typically including contact information and links to product documentation, etc.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.2.2.12.1.p.5">Individual &lt;Content&gt; elements are associated with one or more distinct views through the use of the <samp>view</samp> attribute.</p>
<div id="#rfc.figure.32"></div>
<p>For example, the following &lt;Content&gt; element is associated with two separate Views: "home" and "foo". When the container receives a request to render either the "home" or "foo" Views, it will use the markup provided by this &lt;Content&gt; element:</p>
<pre>
  &lt;Content type="html" view="home,foo"&gt;
    ABC
  &lt;/Content&gt;
            </pre>
<p id="rfc.section.2.2.12.1.p.6">When a &lt;Content&gt; element is used without a <samp>view</samp> attribute, it automatically becomes associated with the unnamed default view.</p>
<p id="rfc.section.2.2.12.1.p.7">How any given View is constructed by the container for the application depends largely on which kinds of &lt;Content&gt; elements are used.  There are three distinct kinds of &lt;Content&gt; elements: </p>

<ul>
<li>"HTML Content" refers to &lt;Content&gt; elements that directly contain HTML markup, scripts and stylesheets;</li>
<li>"Proxied Content" refers to &lt;Content&gt; elements that use an IRI to reference HTML markup that is external to the application specification document but that is to be retrieved and processed by the container prior to display as if it were contained directly within the &lt;Content&gt; element; and</li>
<li>"Redirected Content" refers to &lt;Content&gt; elements that use an IRI to reference HTML markup that is displayed directly to the use without any processing performed by the container.</li>
</ul>

<p> </p>
<p id="rfc.section.2.2.12.1.p.8">The unnamed default View is rendered automatically by the Container when a request to display an application is received and either a specific view name is not specified in the render request or the view name that is specified does not exist within the application specification. If there are no &lt;Content&gt; elements within the application specification associated with the unnamed default (i.e. no &lt;Content&gt; elements that do not have a <samp>view</samp> attribute), then the container will attempt to render the "home" view as the default. If there are no &lt;Content&gt; elements associated with either the "home" view or the unnamed default view, the container SHOULD report an error to the user and abort the attempt to display the application.</p>
<div id="#rfc.figure.33"></div>
<p>For example, by default, a container rendering the following application will display the characters "AB":</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs title="foo" /&gt;
    &lt;Content type="html"&gt;AB&lt;/Content&gt;
    &lt;Content type="html" view="home"&gt;CD&lt;/Content&gt;
  &lt;/Module&gt;
            </pre>
<div id="#rfc.figure.34"></div>
<p>However, a container rendering the following application will, by default, display the characters "CD":</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs title="foo" /&gt;
    &lt;Content type="html" view="foo"&gt;AB&lt;/Content&gt;
    &lt;Content type="html" view="home"&gt;CD&lt;/Content&gt;
  &lt;/Module&gt;
            </pre>
<p id="rfc.section.2.2.12.1.p.9">The specific considerations for View construction relative to each type of &lt;Content&gt; is outlined in the sections that follow.</p>
<h1 id="rfc.section.2.2.12.1.1">
<a href="#rfc.section.2.2.12.1.1">2.2.12.1.1.</a> HTML Content</h1>
<div id="#rfc.figure.35"></div>
<p>The simplest form of content provided by an application is HTML associated with the unnamed default view:</p>
<pre>
  &lt;Content type="html"&gt;&lt;![CDATA[
    &lt;div&gt;Hello World!&lt;/div&gt;
  ]]&gt;&lt;/Content&gt;
              </pre>
<p id="rfc.section.2.2.12.1.1.p.1">When the container renders the default view for the application, it will select this &lt;Content&gt; element and display the HTML "&lt;div&gt;Hello World!&lt;/div&gt;" to the user.</p>
<div id="#rfc.figure.36"></div>
<p>An equivalent example can be provided by using the "home" view in the element's <samp>view</samp> attribute:</p>
<pre>
  &lt;Content type="html" view="home"&gt;&lt;![CDATA[
    &lt;div&gt;Hello World!&lt;/div&gt;
  ]]&gt;&lt;/Content&gt;
              </pre>
<p id="rfc.section.2.2.12.1.1.p.2">If an application provides multiple type "html" &lt;Content&gt; elements that specify the same view, the content is concatenated together when rendered in the order those &lt;Content&gt; elements appear within the specification document:</p>
<div id="#rfc.figure.37"></div>
<p>For instance, given two "html" Content elements for the "home" view:</p>
<pre>
  &lt;Content type="html" view="home"&gt;&lt;![CDATA[
    &lt;div&gt;Hello World!&lt;/div&gt;
  ]]&gt;&lt;/Content&gt;
  &lt;Content type="html" view="home,greeting"&gt;&lt;![CDATA[
    &lt;div&gt;How are you?&lt;/div&gt;
  ]]&gt;&lt;/Content&gt;
              </pre>
<div id="#rfc.figure.38"></div>
<p>When rendering the "home" view, the container would generate the following:</p>
<pre>
  &lt;div&gt;Hello World!&lt;/div&gt;
  &lt;div&gt;How are you?&lt;/div&gt;
              </pre>
<div id="#rfc.figure.39"></div>
<p>However, when rendering the "greeting" view, the container would only select the &lt;Content&gt; element that lists the "greeting" view, producing:</p>
<pre>
  &lt;div&gt;How are you?&lt;/div&gt;
              </pre>
<p id="rfc.section.2.2.12.1.1.p.3">Once the HTML content for a view has been assembled from the appropriate &lt;Content&gt; elements, the container MUST perform Variable Substitution on the resulting content as defined by <a href="#VariableSubstitution">Section 3.3</a>.</p>
<p id="rfc.section.2.2.12.1.1.p.4">Only type "html" &lt;Content&gt; elements can be concatenated together in this fashion.</p>
<h1 id="rfc.section.2.2.12.1.2">
<a href="#rfc.section.2.2.12.1.2">2.2.12.1.2.</a> Proxied Content</h1>
<p id="rfc.section.2.2.12.1.2.p.1">As an alternative to including HTML markup directly within the specification document, a &lt;Content&gt; element that uses type="html" MAY reference an external resource containing HTML markup using the "href" attribute. When the View is rendered, the container will fetch the external resource and process it's HTML content as if it were included directly within the &lt;Content&gt; element. This is commonly referred to as "Proxied Content".</p>
<div id="#rfc.figure.40"></div>
<p>An example of proxied content associated with the unnamed default view:</p>
<pre>
  &lt;Content type="html" href="http://example.org/hello.html"/&gt;
              </pre>
<p id="rfc.section.2.2.12.1.2.p.2">When rendering the default view for an application containing the above &lt;Content&gt; element, the container will issue an HTTP request to the address provided by the <samp>href</samp> attribute to retrieve the content.</p>
<p id="rfc.section.2.2.12.1.2.p.3">The container MUST add the following additional query string parameters to the address provided by the <samp>href</samp> attribute: </p>

<dl>
<dt>lang</dt>
<dd style="margin-left: 8">The preferred language of the user for which the content is being rendered, specified as an ISO-639-1 language code.</dd>
<dt>country</dt>
<dd style="margin-left: 8">The country of the user for which the content is being rendered, specified as an ISO-3166-1 country code.</dd>
<dt>opensocial_proxied_content</dt>
<dd style="margin-left: 8">MUST be specified using the value "1". Servers can use this to identify proxied content renders from other types of requests.</dd>
</dl>

<p> </p>
<p id="rfc.section.2.2.12.1.2.p.4">When the remote service returns the HTML content back to the container, the container will process it as if the HTML had been directly included within the application specification.</p>
<p id="rfc.section.2.2.12.1.2.p.5">Note that, whereas multiple HTML Content elements MAY share a common view name, the view names associated with Proxied Content MUST be unique to that &lt;Content&gt; element, thereby making concatentation unnecessary. The container MUST, however, still perform Variable Substitution on the returned HTML content.</p>
<p id="rfc.section.2.2.12.1.2.p.6">If the response to the proxied request returns an unsuccessful HTTP status code, the container SHOULD present a meaningful error message to the end user. Containers SHOULD obtain a suitable error message for display by displaying the content specified for a view named as "{view-name}.error", where {view-name} matches the name of the view that the proxied request was being processed for. If an exact match can not be found, the special view name "default.error" should be used. If content for the "default.error" is not present, the container SHOULD display a generic message indicating that a problem occurred.</p>
<div id="#rfc.figure.41"></div>
<p>For instance, A Proxied Content for the "greeting" view with a specific "greeting.error" view to display error responses:</p>
<pre>
  &lt;Content type="html" href="http://example.org/hello.html" views="greeting"/&gt;
  &lt;Content type="html" views="greeting.error"&gt;
    There was an error retrieving the greeting content.
  &lt;/Content&gt;
              </pre>
<div id="#rfc.figure.42"></div>
<p>An alternative Proxied Content for the "greeting" view that uses the "default.error" view to display error responses:</p>
<pre>
  &lt;Content type="html" href="http://example.org/hello.html" views="greeting"/&gt;
  &lt;Content type="html" views="default.error"&gt;
    There was an error retrieving the content.
  &lt;/Content&gt;
              </pre>
<p id="rfc.section.2.2.12.1.2.p.7">Typically, the container will issue an HTTP GET request to retrieve the content referenced by the <samp>href</samp> attribute. However, there are times when additional information beyond that provided by the request URI of an HTTP GET is required.  In such cases, proxy type &lt;Content&gt; elements MAY contain <a href="#data-pipeline-proxy">Data Pipeline</a> <cite title="NONE">[data-pipeline-proxy]</cite> elements that define the payload of an HTTP POST request to fetch the remote content.</p>
<p id="rfc.section.2.2.12.1.2.p.8">Containers are permitted to cache proxied content following the requirements specified in <a href="#caching">Section 3.2</a>.</p>
<h1 id="rfc.section.2.2.12.1.3">
<a href="#rfc.section.2.2.12.1.3">2.2.12.1.3.</a> Redirected Content</h1>
<p id="rfc.section.2.2.12.1.3.p.1">When using Proxied Content, the container is responsible for sending the HTTP request to the remote server and processing the content while the view is being rendered. Alternatively, by using <samp>type="url"</samp> within the &lt;Content&gt; element, the container can be instructed to provide a "direct view" of the content retrieved from the remote source without additional processing. When the view is being rendered for display within a Web Browser, this can be achieved by using an HTML IFrame whose src attribute is set to the value of the &lt;Content&gt; element's <samp>href</samp> attribute. This is commonly referred to as "Redirected Content".</p>
<div id="#rfc.figure.43"></div>
<p>An example of redirected content associated with the unnamed default view:</p>
<pre>
  &lt;Content type="url" href="http://example.org/hello.html"/&gt;
              </pre>
<p id="rfc.section.2.2.12.1.3.p.2">The container MUST add the following additional query string parameters to the address provided by the <samp>href</samp> attribute: </p>

<dl>
<dt>lang</dt>
<dd style="margin-left: 8">The preferred language of the user for which the content is being rendered, specified as an ISO-639-1 language code.</dd>
<dt>country</dt>
<dd style="margin-left: 8">The country of the user for which the content is being rendered, specified as an ISO-3166-1 country code.</dd>
<dt>libs</dt>
<dd style="margin-left: 8">An absolute URL reference that points to any JavaScript resources necessary to satisfy the optional or required features listed within the specification document's &lt;ModulePrefs&gt;. This URL MUST be suitable for setting as the value of an HTTP script tags src attribute and MUST return a JavaScript resource when dereferenced.</dd>
</dl>

<p> </p>
<div id="#rfc.figure.44"></div>
<p>When rendering the default view for an application containing the above Redirected Content element, a Web-browser based container would generate the following:</p>
<pre>
  ...
  &gt;iframe src="http://example.org/hello.html?language=en&amp;country=US&amp;libs=http://container.example.com/js/core:rpc:blah.js"
  ...
              </pre>
<p id="rfc.section.2.2.12.1.3.p.3">Like Proxied Content, view names associated with Redirected Content MUST not be shared with any other &lt;Content&gt; elements making concatenation unnecessary. Additionally, because Redirected Content is rendered exactly as it is provided by the remote service, Variable Substitution is not required. </p>
<h1 id="rfc.section.2.2.12.1.4">
<a href="#rfc.section.2.2.12.1.4">2.2.12.1.4.</a> <a href="#signed-fetch" id="signed-fetch">Authentication for Proxied and Redirected Content</a>
</h1>
<p id="rfc.section.2.2.12.1.4.p.1">For Proxied and Redirected Content, the Signed Fetch mechanism described in <a href="#SignedFetch">Section 3.1.1</a> MAY be used to specify the type of authentication used in the request sent to the remote service.</p>
<div id="#rfc.figure.45"></div>
<p>The Signed Fetch attributes defined below MAY be used on any Proxied and Redirected Content elements:</p>
<pre>
            
  NoAuth = {
    attribute authz { "none" }?
  }
  
  AuthCommon = {
    attribute refresh_interval { text }?,
    attribute sign_owner { "true" | "false" }?,
    attribute sign_viewer { "true" | "false" }?
  }
  
  OAuth1 = {
    AuthCommon,
    attribute authz { "oauth" },
    attribute oauth_received_callback { text }?,
    attribute oauth_request_token { text }?,
    attribute oauth_request_token_secret { text }?,
    attribute oauth_service_name { text }?,
    attribute oauth_token_name { text }?,
  }
            
  OAuth2 = {
    AuthCommon,
    attribute authz { "oauth2" },
    attribute oauth_received_callback { text }?,
    attribute oauth_request_token { text }?,
    attribute oauth_request_token_secret { text }?,
    attribute oauth_service_name { text }?,
    attribute oauth2_scope { text }?,
    attribute oauth_token_name { text }?,
  }
  
  SignedAuth = {
    AuthCommon,
    attribute authz { "signed" },
  }
  
  SignedFetch = NoAuth | OAuth1 | OAuth 2 | SignedAuth
              </pre>
<p id="rfc.section.2.2.12.1.4.p.2">The <samp>authz</samp> attribute identifies the authentication type used when submitting the request to fetch the resource. The valid values are <samp>none</samp>, <samp>oauth</samp>, <samp>oauth2</samp> or <samp>signed</samp>.  When not specified, the default is assumed to be <samp>none</samp> indicating that no authentication mechanism is to be used.</p>
<p id="rfc.section.2.2.12.1.4.p.3">When <samp>authz</samp> is equal to <samp>oauth</samp>, requests sent to the remote service MUST be authenticated using the OAuth 1.0 protocol as described in <a href="#oauth-support">Section 3.1.2</a>.</p>
<p id="rfc.section.2.2.12.1.4.p.4">When <samp>authz</samp> is equal to <samp>oauth2</samp>, requests sent to the remote service MUST be authenticated using the OAuth 2.0 protocol as described in <a href="#oauth-support">Section 3.1.2</a>.</p>
<p id="rfc.section.2.2.12.1.4.p.5">When <samp>authz</samp> is either <samp>oauth</samp> or <samp>oauth2</samp>, the following additional optional attributes MAY be included, each with identical semantics as the similarly named request parameters discussed in <a href="#declaring-oauth">Section 3.1.2.1</a>: </p>

<ul>
<li>oauth_received_callback,</li>
<li>oauth_request_token,</li>
<li>oauth_request_token_secret,</li>
<li>oauth_service_name,</li>
<li>oauth_token_name,</li>
<li>oauth_use_token</li>
</ul>

<p> </p>
<p id="rfc.section.2.2.12.1.4.p.6">Further, when <samp>authz</samp> is equal to <samp>oauth2</samp>, the optional <samp>oauth2_scope</samp> attribute MAY be included.</p>
<p id="rfc.section.2.2.12.1.4.p.7">When <samp>authz</samp> is equal to <samp>signed</samp>, the "Signed Fetch" mechanism described by <a href="#SignedFetch">Section 3.1.1</a> is to be used.</p>
<p id="rfc.section.2.2.12.1.4.p.8">The <samp>sign_owner</samp> attribute indicates whether the identity of the <a href="#Application-Roles">Instance Owner</a> <cite title="NONE">[Application-Roles]</cite> needs to be included in the request sent to fetch the resource.  If the value of this attribute is "true", the container MUST include the identity of the Instance Owner.</p>
<p id="rfc.section.2.2.12.1.4.p.9">The <samp>sign_viewer</samp> attribute indicates whether the identity of the current <a href="#Application-Roles">Viewer</a> <cite title="NONE">[Application-Roles]</cite> needs to be included in the request sent to fetch the resource.  If the value of this attribute is <samp>true</samp>, the container MUST include the identity of the Viewer.</p>
<h1 id="rfc.section.2.2.13">
<a href="#rfc.section.2.2.13">2.2.13.</a> Extensibility</h1>
<p id="rfc.section.2.2.13.p.1">This specification defines the complete XML vocabulary of the OpenSocial Application Specification document. Markup from other vocabularies ("foreign markup") can be used within an Application Specification.</p>
<p id="rfc.section.2.2.13.p.2">Note that future versions of this specification can add elements and attributes to the Application Specification vocabulary. Software written to conform to this version of the specification will be unable to process such markup correctly and will not be able to distinguish it from markup error. For the purposes of this discussion, all unrecognized markup from the Application Specification vocabulary will be considered to be "foreign markup".</p>
<p id="rfc.section.2.2.13.p.3">This vocabulary allows foreign markup anywhere in an Application Specification document, except where it is explicitly forbidden.  Containers that encounter foreign markup in a location that is legal according to this specification MUST NOT stop processing or signal an error.  It might be the case that the container is able to process the foreign markup correctly and does so.  Otherwise, such markup is termed "unknown foreign markup".</p>
<p id="rfc.section.2.2.13.p.4">When unknown foreign markup is encountered as a child of any element, containers MAY bypass the markup and any textual content and MUST NOT change their behavior as a result of the markup's presence.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Container-Provided Capabilities</h1>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#authentication" id="authentication">Authentication</a>
</h1>
<p id="rfc.section.3.1.p.1">Many applications require the ability to access content and resources that are external to the container currently hosting instances of the application. Such information and resources are often sensitive in nature and requests need to include authentication and authorization details.</p>
<p id="rfc.section.3.1.p.2">All containers are required to provide at least three basic mechanisms for authenticating requests to remote endpoints: </p>

<dl>
<dt>OAuth 1.0a</dt>
<dd style="margin-left: 8">Is a variation of the original OAuth 1.0 specification described by <a href="#RFC5849">[RFC5849]</a>. Within the OAuth model, the owner's of protected resources grant third parties (in this case the OpenSocial Container) authority to access the resource for a specific purpose and a limited period of time.</dd>
<dt>OAuth 2.0</dt>
<dd style="margin-left: 8">Is an as-yet unfinished update to the original OAuth protocol that simplifies the communication between the various parties but maintains the same fundamental authorization model.</dd>
<dt>Signed Fetch</dt>
<dd style="margin-left: 8">Is a simplified mechanism based on a subset of the OAuth 1.0a protocol that allows a container to "sign" requests sent to a remote endpoint. Such signatures provide only a reasonable assurance that certain content contained within the request has not been modified by a malicious party. Once the receiving endpoint determines that it is able to trust the signed request, it can decide to provide limited access to certain protected resources without having to walk through the entire typical OAuth protocol.</dd>
</dl>

<p> </p>
<p id="rfc.section.3.1.p.3">These authentication mechanisms are available for use whenever access to a remote resource is required, including: </p>

<ul>
<li>Processing &lt;Preload&gt; and &lt;Link&gt; elements within the specification document's &lt;ModulePrefs&gt;,</li>
<li>Processing Data Pipeline &lt;os:HttpRequest&gt; elements,</li>
<li>Processing proxy and redirect type &lt;Content&gt; elements,</li>
<li>All uses of the <samp>osapi</samp> JavaScript APIs, and </li>
<li>All uses of the <samp>gadgets.io.makeRequest</samp> JavaScript API</li>
</ul>

<p> </p>
<p id="rfc.section.3.1.p.4">It is important to note that for authentication and authorization purposes, regardless of whether the application is accessing remote content or social data provided by the container itself, every individual instance of an application MUST be considered a distinct entity for which authentication credentials and authorized permissions MUST be individually established. Containers MUST NOT assume that authorization given to one instance of an application applies to all instances of that same application. Nor MUST the container assume that authorization extends to any other applications provided by the same developer.</p>
<p id="rfc.section.3.1.p.5">Authentication and authorization for an application instance is further constrained by the Viewer for whom an application is currently being rendered.  That is, for example, if a single application instance can be rendered for more than one Viewer, the container is required to authorize each individual Viewer prior to displaying potentially sensitive content.  Such authorization MUST be obtained for each individual application instance rendered for a particular Viewer.</p>
<p id="rfc.section.3.1.p.6">Specific considerations for each of the three types of request authorization mechanisms are discussed in the sections that follow.</p>
<h1 id="rfc.section.3.1.1">
<a href="#rfc.section.3.1.1">3.1.1.</a> <a href="#SignedFetch" id="SignedFetch">Signed Fetch</a>
</h1>
<p id="rfc.section.3.1.1.p.1">The "Signed Fetch" mechanism is a capability provided by all OpenSocial containers that provides a reasonable level of assurance that an HTTP request sent from the container on behalf of an application to a remote endpoint has not been inappropriately modified by a malicious third party.</p>
<p id="rfc.section.3.1.1.p.2">To illustrate the value and operation of Signed Fetch, assume that a developer uses the <samp>gadgets.io.makeRequest</samp> JavaScript API to access a third party service to retrieve private data belonging to the current Viewer. By default, and if required by the remote endpoint, the application is responsible for providing the request with the current identity of the user for whom the request is being sent:</p>
<div id="#rfc.figure.46"></div>
<pre>
  gadgets.io.makeRequest(
    "http://example.org/my/endpoint", 
    function(result) {...}, 
    {"opensocial_viewer_id": opensocial.data.getDataSet("Viewer").id});
        </pre>
<p id="rfc.section.3.1.1.p.3">When the container sends the request to the specified endpoint, it includes the exact value provided by the JavaScript code:</p>
<div id="#rfc.figure.47"></div>
<pre>
  GET /my/endpoint?opensocial_viewer_id=alice HTTP/1.1
  Host: example.org   
        </pre>
<p id="rfc.section.3.1.1.p.4">Assume, however, that the application is being accessed by a malicious Viewer identified as "tom". Such a user can use a variety of techniques to trick the application into using a different user's identity when using the <samp>gadgets.io.makeRequest</samp> API. Because the default behavior is for the container to send the request to the remote endpoint exactly as requested, the container and the remote endpoint can be fooled into disclosing a legitimate user's private data to the malicious Viewer.</p>
<div id="#rfc.figure.48"></div>
<pre>
  var user = opensocial.data.getDataSet("Viewer").id; // returns "tom"
  // malicious user injects a different id ...
  user = "alice";
  // the code then executes as normal...
  var params = {
    "opensocial_viewer_id" : user};
  gadgets.io.makeRequest(
    "http://example.org/my/endpoint", 
    callback, 
    params);
        </pre>
<p id="rfc.section.3.1.1.p.5">Signed Fetch defends against such attacks by allowing the container to: </p>

<ol>
<li>Include it's own information about the current Viewer's identity, and</li>
<li>Generate a cryptographic signature usable by the receiving endpoint to verify that the container-provided information has not been tampered with.</li>
</ol>

<p> </p>
<p id="rfc.section.3.1.1.p.6">Containers are required to use the following process when signing HTTP requests: </p>

<ol>
<li>The container MUST first remove all query string parameters passed in with the request whose names begin with any case-insensitive variation of "oauth", "xoauth", or "opensocial". This is done by examining both the input URI and any additional optional parameters provided in the request and filtering out the unwanted items.</li>
<li>The container then MUST add the following query string parameters to the request URI: <dl>
<dt>opensocial_owner_id</dt>
<dd style="margin-left: 8">Identifies the "owner" the application instance for which the request is being sent.  </dd>
<dt>opensocial_app_url</dt>
<dd style="margin-left: 8">An IRI provided by the container that represents the application for which the request is being sent. The IRI provided is used to identify the application specification rather than individual instances.  </dd>
</dl>
<p> </p>
</li>
<li>The container MAY also add the following query string parameters to the request URI: <dl>
<dt>opensocial_viewer_id</dt>
<dd style="margin-left: 8">Provides the ID of the current Viewer for whom content is being displayed.  </dd>
<dt>opensocial_instance_id</dt>
<dd style="margin-left: 8">Provides an opaque identifier for the specific instance of the application for which the request is being sent. The combination of the "opensocial_app_url" and "opensocial_instance_id" parameters uniquely identify each instance.  </dd>
<dt>opensocial_app_id</dt>
<dd style="margin-left: 8">An opaque identifier for the application specification, unique to the container. Implementations that wish to maintain backwards compatibility with version 0.7 of the OpenSocial specification can include this parameter.  </dd>
<dt>xoauth_public_key</dt>
<dd style="margin-left: 8">An opaque identifier for the public key used to sign the request. This parameter can be omitted by containers that do not use public/private key pairs to sign requests, or if the container arranges other means of negotiating or distributing keys with the remote endpoint receiving the request.  </dd>
</dl>
<p> </p>
</li>
<li>Finally, the container MUST follow the procedure outlined in Section 3.4 of the OAuth 1.0 specification <a href="#RFC5849">[RFC5849]</a> to generate and append the signature to the request with the exception that the <samp>oauth_token</samp> parameter MUST be omitted.</li>
</ol>

<p> </p>
<p id="rfc.section.3.1.1.p.7">Note that upon generating the signature, the container will include a range of additional query string parameters required by the OAuth 1.0 specification, including information about the signing algorithm used, the date and time at which the signature was generated, as so forth.</p>
<div id="#rfc.figure.49"></div>
<p>The following example generally illustrates how a typical signed fetch request will appear (note: line breaks are added for readability):</p>
<pre>
  GET /foo?opensocial_owner_id=bob
    &amp;opensocial_viewer_id=alice
    &amp;opensocial_app_url=http://example.org/gadgets/foo
    &amp;opensocial_instance_id=1
    &amp;xoauth_public_key=org.example.key1
    &amp;oauth_timestamp=123456789
    &amp;oauth_signature_method=HMAC_SHA1
    &amp;oauth_consumer_key=...
    &amp;oauth_token=...
    &amp;oauth_nonce=...
    &amp;oauth_signature=...
        </pre>
<p id="rfc.section.3.1.1.p.8">It is important to stress that the Signed Fetch mechanism provides only a reasonable level of assurance that the information provided by certain parameters in the request URI have not been tampered with. Signed Fetch, by itself, is not adequate for identity authentication, nor does it protect against tampering with any other part of the HTTP request such as the collection of request headers or the request payload, if any.</p>
<h1 id="rfc.section.3.1.1.1">
<a href="#rfc.section.3.1.1.1">3.1.1.1.</a> Using Signed Fetch</h1>
<p id="rfc.section.3.1.1.1.p.1">Application developers can make use of the Signed Fetched capability with all uses of the <samp>osapi</samp> and <samp>gadgets.io.makeRequest</samp> APIs; and with all &lt;Preload&gt;, &lt;Link&gt; and proxy or redirect type &lt;Content&gt; elements.</p>
<div id="#rfc.figure.50"></div>
<p>Using Signed Fetch with JavaScript APIs:</p>
<pre>
  &lt;Module&gt;
    &lt;Content type="html"&gt;
      ...
      &lt;script&gt;
        var params = {};
        params["href"] = 
          "http://data.example.org/resource/foo";
        params[gadgets.io.RequestParameters.AUTHORIZATION] = 
          gadgets.io.AuthorizationType.SIGNED;
      
        function fetchData() {
          osapi.http.get(params).execute(
            function(result) { ... }
          );
        }

        gadgets.util.registerOnLoadHandler(fetchData);
      &lt;/script&gt;
      ...
    &lt;/Content&gt;
  &lt;/Module&gt;
          </pre>
<p id="rfc.section.3.1.1.1.p.2">To use Signed Fetch with the JavaScript APIs, the value of the <samp>AUTHORIZATION</samp> parameter (represented in JavaScript by the constant gadgets.io.RequestParameter.AUTHORIZATION) MUST be <samp>signed</samp>. The following additional parameters that affect the signing of a request MAY also be specified: </p>

<dl>
<dt>SIGN_OWNER</dt>
<dd style="margin-left: 8">Represented in JavaScript by the constant gadgets.io.RequestParameter.SIGN_OWNER, the value is a boolean that indicates whether the container SHOULD include the identity of the <a href="#Application-Roles">Instance Owner</a> <cite title="NONE">[Application-Roles]</cite> when signing the request. If not specified, the container is required to assume a value of True.</dd>
<dt>SIGN_VIEWER</dt>
<dd style="margin-left: 8">Represented in JavaScript by the constant gadgets.io.RequestParameter.SIGN_VIEWER, the value is a boolean that indicates whether the container SHOULD include the identity of the current Viewer when signing the request. If not specified, the container is required to assume a value of True.</dd>
</dl>

<p> </p>
<div id="#rfc.figure.51"></div>
<p>Within &lt;Preload&gt;, &lt;Link&gt; and &lt;Content&gt; elements:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      ...
      &lt;Preload authz="signed" href="http://example.org/resources/bar" /&gt;
      &lt;Link authz="signed" href="http://example.org/images/foo.png" rel="icon" /&gt;
      ...
    &lt;/ModulePrefs&gt;
    &lt;Content type="html" href="http://example.org/content" authz="signed" /&gt;
  &lt;/Module&gt;
          </pre>
<p id="rfc.section.3.1.1.1.p.3">To use Signed Fetch with the &lt;Preload&gt;, &lt;Link&gt; and &lt;Content&gt; elements, the <samp>authz</samp> attribute MUST be specified with a value of <samp>signed</samp>.  The following additional attributes that affect the signing of a request MAY also be specified: </p>

<dl>
<dt>sign_owner</dt>
<dd style="margin-left: 8">Equivalent to the SIGN_OWNER parameter used in the JavaScript API, the value is a String matching either <samp>true</samp> or <samp>false</samp> indicating whether the container SHOULD include the identity of the <a href="#Application-Roles">Instance Owner</a> <cite title="NONE">[Application-Roles]</cite> when signing the request.  If not specified, the container is required to assume a value of <samp>true</samp>.</dd>
<dt>sign_viewer</dt>
<dd style="margin-left: 8">Equivalent to the SIGN_VIEWER parameter used in the JavaScript API, the value is a String matching either <samp>true</samp> or <samp>false</samp> indicating whether the container SHOULD include the identity of the current Viewer when signing the request.  If not specified, the container is required to assume a value of <samp>true</samp>.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.3.1.2">
<a href="#rfc.section.3.1.2">3.1.2.</a> <a href="#oauth-support" id="oauth-support">OAuth Support</a>
</h1>
<p id="rfc.section.3.1.2.p.1">The OAuth protocol provides the ability for the owner of a resource to grant limited permission to an application to perform actions on behalf of the owner. For instance, an application might wish to display a listing of documents owned by the current Viewer. To do so, the application can work with the Container to request authorization from the Viewer to access the service the Viewer uses to manage documents and files. When granted, such access can be limited, for example, to allow only the most basic read operations occurring within a specified period of time.</p>
<p id="rfc.section.3.1.2.p.2">Currently, OpenSocial Containers are required to implement support for versions <a href="#RFC5849">1.0a</a> <cite title="NONE">[RFC5849]</cite> and <a href="#I-D.ietf-oauth-v2">2.0</a> <cite title="NONE">[I-D.ietf-oauth-v2]</cite> of the OAuth protocol.  Specifically, the container MUST be capable of acting as either an OAuth 1.0a or OAuth 2.0 client on behalf of application instances hosted by the container. That is, whenever an application requires access to protected external resources, the container MUST be capable of using either version of the OAuth Protocol to request appropriate permission to access the resource.</p>
<p id="rfc.section.3.1.2.p.3">Likewise, when an application or some other third party wishes to access social data provided by the OpenSocial Container, the Container MUST be capable of providing an OAuth Authorization Service -- implementing either or both versions of the OAuth protocol -- that those applications can work with to acquire appropriate access permissions. If a container implementation chooses not to support the use of one of the required versions of the OAuth protocol, it SHOULD, at the very least, implement the minimal level of functionality required to issue properly formed negative responses to requests using that version. For instance, if a client application sends an OAuth 1.0a authorization token request to a container that only supports OAuth 2.0, the container SHOULD be capable of responding to that request with an appropriate OAuth 1.0a response rejecting the request.</p>
<p id="rfc.section.3.1.2.p.4">From the Application developer's point of view, there are no differences between working with OAuth-protected resources provided by the container or those provided by a third-party. The sections that follow detail the responsibilities, requirements and mechanisms application developers need to work with the OAuth protocol. Additional requirements and considerations for OpenSocial Container implementations are discussed within the OpenSocial Common Container specification [TODO: Ref CC spec].</p>
<h1 id="rfc.section.3.1.2.1">
<a href="#rfc.section.3.1.2.1">3.1.2.1.</a> <a href="#declaring-oauth" id="declaring-oauth">Declaring and Using OAuth Services</a>
</h1>
<p id="rfc.section.3.1.2.1.p.1">Before an application can make use of OAuth protected resources, the specification document MUST tell the container about the OAuth services to use. This is done by using one or more &lt;OAuth&gt; or &lt;OAuth2&gt; elements within the &lt;ModulePrefs&gt;.</p>
<div id="#rfc.figure.52"></div>
<p>In the partial specification below, the &lt;OAuth&gt; element is used to declare a dependency on a third party service providing OAuth 1.0a support.</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      ...
      &lt;OAuth&gt;
        &lt;Service view="oauth"&gt;
          &lt;Request url="http://example.com/request" method="get" /&gt;
          &lt;Access url="http://example.com/access" method="get" /&gt;
          &lt;Authorization url="http://example.com/authorization" /&gt;
        &lt;/Service&gt;
      &lt;/OAuth&gt;
      ...
    &lt;/ModulePrefs&gt;
    ...
    &lt;Content type="html" view="oauth"&gt;
      ...
    &lt;/Content&gt;
  &lt;/Module&gt;
          </pre>
<p id="rfc.section.3.1.2.1.p.2">The &lt;Service&gt; element provides the container with the locations of the various OAuth service components that are used to acquire authorization as well as the name of an Application View the container can use to interact with the Viewer whenever it determines that authorization must be acquired to continue.</p>
<div id="#rfc.figure.53"></div>
<p>Similarly, dependencies on OAuth 2.0-based services are declared using the &lt;OAuth2&gt; element:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      ...
      &lt;OAuth2&gt;
        &lt;Service view="oauth"&gt;
          &lt;Authorization url="http://example.com/authorization" method="get" /&gt;
          &lt;Token url="http://example.org/token" method="get" /&gt;
        &lt;/Service&gt;
      &lt;/OAuth2&gt;
      ...
      &lt;Content type="html" view="oauth"&gt;
        ...
      &lt;/Content&gt;
    &lt;/ModulePrefs&gt;
    ...
  &lt;/Module&gt;         
          </pre>
<p id="rfc.section.3.1.2.1.p.3">Once declared, developers can use the specified OAuth services anywhere within the specification document where remote resources are accessed, including uses of the <samp>osapi</samp> and <samp>gadgets.io.makeRequest</samp> JavaScript APIs, &lt;Preload&gt; elements, &lt;Link&gt; elements, and Redirect or Proxy type &lt;Content&gt; elements.</p>
<p id="rfc.section.3.1.2.1.p.4">The examples that follow illustrate various uses of the OAuth services.</p>
<div id="#rfc.figure.54"></div>
<p>Within uses of the <samp>osapi.http</samp> API:</p>
<pre>
  &lt;Module&gt;
    ...
    &lt;Content type="html"&gt; 
      ...
      &lt;script&gt;
        var params = {};
        params["href"] = 
          "http://data.example.org/resource/foo";
        params[gadgets.io.RequestParameters.AUTHORIZATION] = 
          gadgets.io.AuthorizationType.OAUTH;
      
        function fetchData() {
          osapi.http.get(params).execute(
            function(result) { ... }
          );
        }
        
        gadgets.util.registerOnLoadHandler(fetchData);
      &lt;/script&gt;
      ...
    &lt;/Content&gt;
  &lt;/Module&gt;
          </pre>
<p id="rfc.section.3.1.2.1.p.5">When using OAuth version 1.0a with the JavaScript APIs, the value of the <samp>AUTHORIZATION</samp> parameter, represented by the <samp>constant gadgets.io.RequestParameters.AUTHORIZATION</samp> alias in JavaScript, MUST equal <samp>oauth</samp> (represented in JavaScript using the alias <samp>gadgets.io.RequestParameters.OAUTH</samp>).</p>
<p id="rfc.section.3.1.2.1.p.6">When using OAuth version 2.0, the value of the <samp>AUTHORIZATION</samp> parameter MUST be <samp>oauth2</samp> (represented in JavaScript using the alias <samp>constant gadgets.io.RequestParameters.OAUTH2</samp>).</p>
<p id="rfc.section.3.1.2.1.p.7">The following additional parameters that affect the containers application of the OAuth protocol MAY also be specified:</p>
<div id="#rfc.table.3"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Name</th>
<th class="left">Alias</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left"><samp>OAUTH_RECEIVED_CALLBACK</samp></td>
<td class="left">gadgets.io.RequestParameters.OAUTH_RECEIVED_CALLBACK</td>
<td class="left">When the container sends a request to an OAuth service provider asking for permission to access a given resource, it will, by default, specify a default container-specific callback URI that the OAuth service provider will use to redirect control back to the container and deliver the requested access token. In certain cases, a specific application instance might need to override the default callback URI.  The <samp>OAUTH_RECEIVED_CALLBACK</samp> parameter can be used to specify an alternative absolute URI reference.</td>
</tr>
<tr>
<td class="left"><samp>OAUTH_REQUEST_TOKEN</samp></td>
<td class="left">gadgets.io.RequestParameters.OAUTH_REQUEST_TOKEN</td>
<td class="left">In certain circumstances, instances of an application can be preauthorized to access particular resources and issued an OAuth Request Token in advance. The OAUTH_REQUEST_TOKEN parameter allows the application to provide such preapproved request tokens to the container for use.</td>
</tr>
<tr>
<td class="left"><samp>OAUTH_REQUEST_TOKEN_SECRET</samp></td>
<td class="left">gadgets.io.RequestParameters.OAUTH_REQUEST_TOKEN_SECRET</td>
<td class="left">When using preapproed request tokens with the OAUTH_REQUEST_TOKEN parameter, the OAUTH_REQUEST_TOKEN_SECRET parameter can be used to provide the associated request token secret.</td>
</tr>
<tr>
<td class="left"><samp>OAUTH2_SCOPE</samp></td>
<td class="left">gadgets.io.RequestParameters.OAUTH2_SCOPE</td>
<td class="left">When using OAuth version 2.0, the OAUTH2_SCOPE parameter is used to specify the scope to be used with this request.  Access Token Scope is defined in Section 3.3 of <a href="#I-D.ietf-oauth-v2">[I-D.ietf-oauth-v2]</a>.</td>
</tr>
<tr>
<td class="left"><samp>OAUTH_SERVICE_NAME</samp></td>
<td class="left">gadgets.io.RequestParameters.OAUTH_SERVICE_NAME</td>
<td class="left">When multiple OAuth services are declared within the &lt;ModulePrefs&gt; of an Application, the OAUTH_SERVICE_NAME parameter can be used to specify which service to use for the request.</td>
</tr>
<tr>
<td class="left"><samp>OAUTH_TOKEN_NAME</samp></td>
<td class="left">gadgets.io.RequestParameters.OAUTH_TOKEN_NAME</td>
<td class="left">Provides a simple label that application can use to refer to the OAuth Access Token granting access to particular resources.  If unspecified the value is assumed to be an empty string.  Gadget instances can use multiple token names if they access multiple resources from a single source. For example, an application that accesses a contact list and a calendar might used the token name "contacts" to refer to the OAuth token providing access to the contact data and the name "calendar" to refer to the token providing access to the calendar.</td>
</tr>
<tr>
<td class="left"><samp>OAUTH_USE_TOKEN</samp></td>
<td class="left">gadgets.io.RequestParameters.OAUTH_USE_TOKEN</td>
<td class="left">For certain kinds of actions on certain resources, an OAuth service provider might not require that the container and application walk through the complete OAuth process to acquire an Access Token. In such scenarios, the service providing access to the resource will verify the OAuth Consumer Key provided within the request then allow the request to proceed. In other cases, a resource provider might grant limited access to a requester if the resource owner has not provided explicit authorization but offer additional functionality if an OAuth Access Token has been issued. Typically, however, most resource providers will only allow a requester to access protected resources if an Access Token is included in the request. The OAUTH_USE_TOKEN parameter can be used by the application as a hint to the container as to whether the acquisition and use of an Access Token is required or optional. The acceptable values for the OAUTH_USE_TOKEN are defined in <a href="#oauth_use_token_value">Section 3.1.2.1.1</a>.</td>
</tr>
</tbody>
</table>
<div id="#rfc.figure.55"></div>
<p>Within &lt;Preload&gt; and &lt;Link&gt; elements:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      ...
      &lt;OAuth&gt;...&lt;/OAuth&gt;
      &lt;Preload authz="oauth" href="http://example.org/resources/bar" /&gt;
      &lt;Link authz="oauth" href="http://example.org/images/foo.png" rel="icon" /&gt;
      ...
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt; 
      ...
    &lt;/Content&gt;
  &lt;/Module&gt;
          </pre>
<div id="#rfc.figure.56"></div>
<p>Within proxy or redirect type &lt;Content&gt; elements:</p>
<pre>
  &lt;Module&gt;
    ...
    &lt;Content authz="oauth" href="http://example.org/content/foo" /&gt;
    ...
  &lt;/Module&gt;
          </pre>
<p id="rfc.section.3.1.2.1.p.8">When using OAuth 1.0a with the &lt;Preload&gt;, &lt;Link&gt; and &lt;Content&gt; elements, the <samp>authz</samp> attribute MUST be specified with a value of <samp>oauth</samp>.</p>
<p id="rfc.section.3.1.2.1.p.9">When using OAuth 2.0, the <samp>authz</samp> attribute MUST specify a value of <samp>oauth2</samp>.</p>
<p id="rfc.section.3.1.2.1.p.10">The following additional attributes that affect the containers application of the OAuth protocol MAY also be specified. Each corresponds to one of the optional parameters for the JavaScript API listed above and specify identical values: </p>

<ul>
<li><samp>oauth_received_callback</samp></li>
<li><samp>oauth_request_token</samp></li>
<li><samp>oauth_request_token_secret</samp></li>
<li><samp>oauth2_scope</samp></li>
<li><samp>oauth_service_name</samp></li>
<li><samp>oauth_token_name</samp></li>
<li><samp>oauth_use_token</samp></li>
</ul>

<p> </p>
<p id="rfc.section.3.1.2.1.p.11">If an application requires access to multiple OAuth service providers, then it MUST declare each provider and specify a unique label for each that identifies the specific provider to be used for each request. Each of the &lt;OAuth&gt; and &lt;OAuth2&gt; elements can contain as many &lt;Service&gt; element instances as is necessary.</p>
<div id="#rfc.figure.57"></div>
<p>For instance, in the example that follows, both the &lt;Preload&gt; element and the JavaScript API call use the OAuth service labeled as "other" within the &lt;ModulePrefs&gt;, while the &lt;Link&gt; element uses the "default" OAuth service defined by the &lt;Service&gt; tag that omits the name attribute.</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      ...
      &lt;OAuth&gt;
        &lt;Service view="oauth"&gt;
          &lt;Request url="http://example1.com/request" method="get" /&gt;
          &lt;Access url="http://example1.com/access" method="get" /&gt;
          &lt;Authorization url="http://example1.com/authorization" /&gt;      
        &lt;/Service&gt;
        &lt;Service name="other" view="other.oauth"&gt;
          &lt;Request url="http://example2.net/request" method="get" /&gt;
          &lt;Access url="http://example2.net/access" method="get" /&gt;
          &lt;Authorization url="http://example2.net/authorization" /&gt;      
        &lt;/Service&gt;
        &lt;Preload authz="oauth" oauth_service_name="other" 
          href="http://example.org/resources/bar" /&gt;
        &lt;Link authz="oauth" href="http://example.org/images/foo.png" rel="icon" /&gt;
      &lt;/OAuth&gt;
      &lt;Content type="html"&gt;
        ...
        &lt;script&gt;
          var params = {};
          params["href"] = 
            "http://data.example.org/resource/foo";
          params[gadgets.io.RequestParameters.AUTHORIZATION] = 
            gadgets.io.AuthorizationType.OAUTH;
          params[gadgets.io.RequestParameters.OAUTH_SERVICE_NAME] =
            "other";
        
          function fetchData() {
            osapi.http.get(params).execute(
              function(result) { ... }
            );
          }
          
          gadgets.util.registerOnLoadHandler(fetchData);
        &lt;/script&gt;
        ...
      &lt;/Content&gt;
      &lt;Content type="html" view="oauth"&gt;
        ...
      &lt;/Content&gt;
      &lt;Content type="html" view="other.oauth"&gt;
        ...
      &lt;/Content&gt;
    &lt;/ModulePrefs&gt;
  &lt;/Module&gt;
          </pre>
<p id="rfc.section.3.1.2.1.p.12">When multiple OAuth services are used, the <samp>OAUTH_SERVICE_NAME</samp> parameter and the <samp>oauth_service_name</samp> attribute are used within the JavaScript API and XML elements to indicate the appropriate OAuth service to use for the request.</p>
<h1 id="rfc.section.3.1.2.1.1">
<a href="#rfc.section.3.1.2.1.1">3.1.2.1.1.</a> <a href="#oauth_use_token_value" id="oauth_use_token_value">The "OAUTH_USE_TOKEN" parameter</a>
</h1>
<p id="rfc.section.3.1.2.1.1.p.1">The value of the <samp>OAUTH_USE_TOKEN</samp> parameter MUST be one of: </p>

<dl>
<dt>never</dt>
<dd style="margin-left: 8">Tells the container that the Access Token is never required. Requests will be sent to the remote endpoint without an OAuth Access Token.  </dd>
<dt>if_available</dt>
<dd style="margin-left: 8">Tells the container that use of the Access Token is optional. If an Access token has been acquired, it will be included in the request sent to the remote endpoint, otherwise the request will be sent without an Access Token.  </dd>
<dt>always</dt>
<dd style="margin-left: 8">Tells the container that use of the Access Token is required. If an appropriate Access Token has not yet been acquired, the container will work with the application and the OAuth Service Provider to seek appropriate authorization and acquire an Access Token.  </dd>
</dl>

<p> </p>
<p id="rfc.section.3.1.2.1.1.p.2">If the OAUTH_USE_TOKEN parameter is not specified, the value is assumed to be <samp>always</samp>.</p>
<h1 id="rfc.section.3.1.2.2">
<a href="#rfc.section.3.1.2.2">3.1.2.2.</a> <a href="#oauth-processing-model" id="oauth-processing-model">Processing Model</a>
</h1>
<p id="rfc.section.3.1.2.2.p.1">When the container receives any request for which the OAuth protocol is to be used, regardless of whether the request is submitted via the JavaScript API or via elements in the specification document, it MUST adhere to the following requirements and processing model: </p>

<ol>
<li>For any request for which an access token is not required (e.g. the value of the <samp>OAUTH_USE_TOKEN</samp> parameter equals <samp>never</samp>): <ul>
<li>When OAuth 1.0a is used, the container will send a request to the remote endpoint as described in Section 3 of <a href="#RFC5849">[RFC5849]</a> with the exception that the <samp>oauth_token</samp> will be omitted.  Such requests are generally identical to those sent when using the Signed Fetch mechanism.</li>
<li>When OAuth version 2.0 is used, requests are sent without any authentication information included. This is the same as sending the request using an <samp>AUTHORIZATION</samp> value of <samp>NONE</samp>.</li>
</ul>
<p> </p>
</li>
<li>For any request for which an access token is considered optional (e.g. the value of the OAUTH_USE_TOKEN parameter is "if_available"): <ul>
<li>When OAuth 1.0a is used and an Access Token appropriate to the current request is known to the container, a request that includes the token will be sent to the remote endpoint as described in Section 7 of <a href="#RFC5849">[RFC5849]</a>. When using OAuth 2.0, the container will send a request using the access token as described in <a href="#oauth2-requests">Section 3.1.2.2.2</a>.</li>
<li>If an appropriate Access Token, and OAuth 1.0a is used, the container will send a request to the remote endpoint as described in Section 3 of <a href="#RFC5849">[RFC5849]</a> with the exception that the <samp>oauth_token</samp> will be omitted. Such requests are generally identical to those sent when using the Signed Fetch mechanism. If OAuth 2.0 is used, requests are sent without any authentication information included.</li>
</ul>
<p> </p>
</li>
<li>For any request for which an access token is required (e.g. the value of the OAUTH_USE_TOKEN parameter is "always" or the OAUTH_USE_TOKEN is unspecified): <ul>
<li>If using OAuth 1.0a and an appropriate Access Token is known by the container, a request as defined in Section 3 of <a href="#RFC5849">[RFC5849]</a> is sent to the remote endpoint.  If using OAuth 2.0, a request is sent as described in <a href="#oauth2-requests">Section 3.1.2.2.2</a> is sent.</li>
<li>When an appropriate Access Token is not known to the container, the container MUST acquire an access token using the processes described in <a href="#oauth-get-tokens">Section 3.1.2.2.1</a>.  Once an Access Token is acquired, a request using the token will be sent to the server. If a token cannot be acquired, the container will report an error back to the application.</li>
</ul>
<p> </p>
</li>
</ol>

<p> </p>
<h1 id="rfc.section.3.1.2.2.1">
<a href="#rfc.section.3.1.2.2.1">3.1.2.2.1.</a> <a href="#oauth-get-tokens" id="oauth-get-tokens">Acquiring Access Tokens</a>
</h1>
<p id="rfc.section.3.1.2.2.1.p.1">When using any version of OAuth, a container will first need to seek authorization from the owner of a resource prior to attempting to access it. Generally, this is done first by the container interacting with the OAuth Authorization Provider to retrieve a "request token" which is then exchanged for an "access token". The details for how each of those steps are completed varies for each version of the OAuth protocol.</p>
<p id="rfc.section.3.1.2.2.1.p.2">First, once the container determines that an access token needs to be acquired prior to completing a request, it will examine the <samp>view</samp> attribute on the appropriate OAuth &lt;Service&gt; element to determine the name of the Application View it will render to interact with the Viewer.</p>
<p id="rfc.section.3.1.2.2.1.p.3">If the view specified by the attribute does not exist, or if the <samp>view</samp> attribute is not specified: </p>

<ul>
<li>And the request being processed is to retrieve content specified from either the &lt;Link&gt;, &lt;Preload&gt;, &lt;Content&gt; or &lt;os:HttpRequest&gt; elements, the container MUST abort the request and signal an error to the Viewer indicating that the OAuth authorization could not be completed; or</li>
<li>If the request being processed is the result of invoking either the <samp>gadgets.io.makeRequest</samp>, <samp>osapi.http</samp> or any of the <samp>osapi.*</samp> service JavaScript APIs, the container SHOULD abort the request and invoke the callback function passed in to the JavaScript method with an indication that OAuth Authorization is required. The Application can then choose to handle the authentication on it's own, as described in <a href="#gadgets.oauth.Popup">Section 4.2.8</a>. However, the container MAY choose to abort the request and signal an error that the OAuth authorization could not be completed.</li>
</ul>

<p> </p>
<p id="rfc.section.3.1.2.2.1.p.4">If the view specified by the attribute does exist, the container will render the view -- typically within a modal user interface element that blocks all other interactions with the container until the authorization is complete or canceled. The rendered view MUST handle the Viewers interaction with the third party OAuth Authorization service as described in <a href="#gadgets.oauth.Popup">Section 4.2.8</a> then return control back to the container once the authorization process has been completed and an access token has been issued.  Once the view has been dismissed, the container will proceed with the request using the acquired access token.</p>
<h1 id="rfc.section.3.1.2.2.2">
<a href="#rfc.section.3.1.2.2.2">3.1.2.2.2.</a> <a href="#oauth2-requests" id="oauth2-requests">Sending OAuth 2.0 Protected Requests</a>
</h1>
<p id="rfc.section.3.1.2.2.2.p.1">When using OAuth 2.0 to premptively send authenticated requests, containers MUST support the use of OAuth 2.0 Bearer Tokens as described by <a href="#I-D.ietf-oauth-v2-bearer">[I-D.ietf-oauth-v2-bearer]</a> and Mac Tokens as described by <a href="#I-D.ietf-oauth-v2-http-mac">[I-D.ietf-oauth-v2-http-mac]</a>.  Implementations MAY choose to support additional types of tokens.</p>
<p id="rfc.section.3.1.2.2.2.p.2">The determination of exactly how the OAuth 2.0 access token is conveyed within a request to a protected resource is determined entirely by the type of access token that was issued.</p>
<p id="rfc.section.3.1.2.2.2.p.3">If the access token issued to the container is a Bearer-type token, the request sent to the remote endpoint MUST contain an Authorization header field using the "Bearer" scheme that includes the access token:</p>
<div id="#rfc.figure.58"></div>
<p>For example:</p>
<pre>
  GET /some/remote/content HTTP/1.1
  Host: example.org
  Authorization: Bearer ABCDEF1234567FEDCBA
            </pre>
<p id="rfc.section.3.1.2.2.2.p.4">Because access tokens sent using the Bearer scheme are sent in clear-text, all requests using the Bearer authentication scheme MUST be sent using SSL or TLS.</p>
<p id="rfc.section.3.1.2.2.2.p.5">If the access token issued to the container is a Mac-type token, the request sent to the remote endpoint MUST contain an Authorization header field using the "Mac" scheme that includes "id", "nonce" and "mac" fields as described by <a href="#I-D.ietf-oauth-v2-http-mac">[I-D.ietf-oauth-v2-http-mac]</a>.</p>
<div id="#rfc.figure.59"></div>
<p>For example:</p>
<pre>
  GET /some/remote/content HTTP/1.1
  Host: example.org
  Authorization: MAC id="h480djs93hd8",
                 nonce="274312:dj83hs9s",
                 mac="kDZvddkndxvhGRXZhvuDjEWhGeE="
            </pre>
<h1 id="rfc.section.3.1.2.2.3">
<a href="#rfc.section.3.1.2.2.3">3.1.2.2.3.</a> <a href="#responses.unauthorized" id="responses.unauthorized">401 Unauthorized Responses</a>
</h1>
<p id="rfc.section.3.1.2.2.3.p.1">When attempting to interact with protected remote resources on behalf of an Application, and an authentication mechanism is not prespecified by the Application using either the <samp>AUTHORIZATION</samp> request parameter or the <samp>authz</samp> attribute; or when the authentication mechanism specified by the Application does not match the authentication scheme required by the remote resource, the container might receive an error response from the remote endpoint indicating that authentication is required. Such responses typically take the form of 401 Unauthorized messages.</p>
<p id="rfc.section.3.1.2.2.3.p.2">When encountering such a response, the container will determine, if possible, the authentication scheme required by the remote endpoint by examining the WWW-Authentication header field included in the response.</p>
<p id="rfc.section.3.1.2.2.3.p.3">If the WWW-Authentication header specifies support for the "OAuth" scheme, the container MAY either choose to abort the request and signal to the Application that an error has occurred and that the request cannot be completed or, it MAY attempt to reprocess the request as specified in <a href="#oauth-processing-model">Section 3.1.2.2</a> using the OAuth 1.0a protocol.</p>
<p id="rfc.section.3.1.2.2.3.p.4">If the WWW-Authentication header specifies support for either the "Bearer" or "Mac" schemes, the container MAY either choose to abort the request and signal to the Application that an error has occurred and that the request cannot be completed or, it MAY attempt to reprocess the request as specified in <a href="#oauth-processing-model">Section 3.1.2.2</a> using the OAuth 2.0 protocol.</p>
<p id="rfc.section.3.1.2.2.3.p.5">If the WWW-Authentication header field specifies multiple supported authentication schemes, the container SHOULD evaluate each in the order they are encoded within the field value and use the first supported scheme it finds.</p>
<p id="rfc.section.3.1.2.2.3.p.6">When the selected authentication scheme is OAuth 1.0 or OAuth 2.0, the container will check the Application specification for an appropriate OAuth &lt;Service&gt; element it can use to acquire the necessary authorization. It will do so by first checking to see if any of the provided &lt;Service&gt; elements contain a "realm" attribute that is equal to the realm specified by the WWW-Authenticate header field, if any. If a matching &lt;Service&gt; element is found, it is selected. If, however, the realm is not specified in the WWW-Authenticate header field -- as will typically be the case when using the Mac authentication scheme -- or if a matching &lt;Service&gt; element cannot be found, the container will look for an &lt;Service&gt; element that matches the version of the OAuth protocol selected and that does not specify a name attribute.</p>
<p id="rfc.section.3.1.2.2.3.p.7">If an appropriate OAuth &lt;Service&gt; element is not provided by the Application, the container MUST abort the request and signal an error to the Application indicating the request cannot be completed.</p>
<p id="rfc.section.3.1.2.2.3.p.8">Containers MAY choose to support any other authentication schemes that might be indicated by the WWW-Authentication header; however, such support is undefined by this specification.</p>
<p id="rfc.section.3.1.2.2.3.p.9">If the container does not support any of the schemes specified by the WWW-Authentication header, then it MUST abort the request and signal an error to the Application indicating the request cannot be completed.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#caching" id="caching">Caching</a>
</h1>
<p id="rfc.section.3.2.p.1">Application developers are provided with a variety of mechanisms for accessing external, web-accessible resources. They can, for instance: </p>

<ul>
<li>Use Redirected or Proxy type &lt;Content&gt; elements,</li>
<li>Preload resources using the &lt;Preload&gt; elements,</li>
<li>Link to icons, screenshots and thumbnail images,</li>
<li>Send arbitary HTTP requests using the <samp>osapi.http</samp> and <samp>gadgets.io.makeRequest</samp> APIs,</li>
<li>or use <a href="#DataPipelining">Data Pipeline elements</a> <cite title="NONE">[DataPipelining]</cite> to access resources.</li>
</ul>

<p> </p>
<p id="rfc.section.3.2.p.2">The container is also permitted to cache the Application Specification Document itself.</p>
<p id="rfc.section.3.2.p.3">In each of these cases, the container is responsible for sending the actual HTTP request messages to the remote resource and making the data returned in the response available to the application. In order to optimize performance and reduce the overall number of HTTP requests that are actually sent, containers SHOULD provide caching of HTTP responses as defined in <a href="#RFC2616">[RFC2616]</a>. If the container provides caching, it MUST honor all requirements as specified by <a href="#RFC2616">[RFC2616]</a>.  Containers MAY support caching for all requests or MAY determine whether to provide caching per request.</p>
<div id="#rfc.figure.60"></div>
<p>For example, given the following partial application specification document:</p>
<pre>
  &lt;Module&gt;
    ...
    &lt;Content type="html" href="http://example.org/foo" /&gt;
  &lt;/Module&gt;
      </pre>
<div id="#rfc.figure.61"></div>
<p>When the container attempts to render the default view of the application, it will send an HTTP GET request to the IRI provided</p>
<pre>
  GET /foo HTTP/1.1
  Host: example.org
      </pre>
<div id="#rfc.figure.62"></div>
<p>Assuming the server return a successful response that includes appropriate caching instructions:</p>
<pre>
  HTTP/1.1 200 OK
  Content-Type: text/html
  Cache-Control: must-revalidate, max-age=3600
  ETag: "abc123zyx"
  
  &lt;html&gt;...&lt;/html&gt;
      </pre>
<p id="rfc.section.3.2.p.4">The container is permitted to cache the response and use the cached representation in response to all subsequent requests to the same request URI, without revalidation for a period of 3600 seconds (1 hour), after which the container is required to revalidate the resource to determine if any changes to the resource representation have occurred.</p>
<div id="#rfc.figure.63"></div>
<p>Such revalidation is performed by issuing a conditional HTTP request as defined by <a href="#RFC2616">[RFC2616]</a>:</p>
<pre>
  GET /foo HTTP/1.1
  Host: example.org
  If-None-Match: "abc123zyx"
      </pre>
<p id="rfc.section.3.2.p.5">If the server returns a response indicating that the resource has been modified (i.e. with a 412 Precondition Failed in this example), the container is permitted to continue using the cached representation of the resource to fulfill the request.</p>
<p id="rfc.section.3.2.p.6">For all XML elements within the Application Specification Document that represent a request for an external resource (&lt;Preload&gt;, &lt;Link&gt;, &lt;Content&lt; and &lt;os:HttpRequest&gt;), an additional <samp>refresh_interval</samp> attribute MAY be specified whose value indicates the total number of seconds the container SHOULD consider a cached response to be valid. If specified, and the value indicates a period of time that is less than the period of time established by either the Expires header in the HTTP response or either the Cache-Control max-age or s-maxage directives (as specified by <a href="#RFC2616">[RFC2616]</a>), then the value of the <samp>refresh_interval</samp> attribute overrides the default caching characteristics. The container MUST NOT cache a response for longer than the period of time specified by either the Expires header, max-age directive or s-maxage directives.</p>
<div id="#rfc.figure.64"></div>
<p>For example:</p>
<pre>
  &lt;Content type="html" href="http://example.org/foo" refresh_interval="3600" /&gt;
      </pre>
<p id="rfc.section.3.2.p.7">For all JavaScript API requests that represent a request for an external resource, such as each of the <samp>osapi.http</samp> methods and the <samp>gadgets.io.makeRequest</samp> API, an optional "REFRESH_INTERVAL" parameter MAY be specified whose value indicates the total number of seconds that container SHOULD consider a cached response to be valid. If specified, the same rules apply as those specified for the <samp>refresh_interval</samp> attribute.</p>
<p id="rfc.section.3.2.p.8">For convenience, the JavaScript alias <samp>gadgets.io.RequestParameters.REFRESH_INTERVAL</samp> is provided for the "REFRESH_INTERVAL" parameter.</p>
<div id="#rfc.figure.65"></div>
<p>For example:</p>
<pre>
  gadgets.io.makeRequest(
    "http://example.org/foo",
    function(response) {
      // ...
    },
    {
      gadgets.io.RequestParameters.REFRESH_INTERVAL: 3600
    }
  );
      </pre>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#VariableSubstitution" id="VariableSubstitution">Variable Substitution</a>
</h1>
<p id="rfc.section.3.3.p.1">The Variable Substitution capability provides the ability for application developers to use special "Expression Language" (EL) statements within their application specifications that the container will replace with appropriate values when a View is rendered.</p>
<div id="#rfc.figure.66"></div>
<p>For example, given the following partial application specification:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      ...
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;
      One plus one is equal to ${1+1}.
    &lt;/Content&gt;
  &lt;/Module&gt;
      </pre>
<p id="rfc.section.3.3.p.2">When the default view for this application is rendered, the expression "${1+1}" will be evaluated and replaced with the value "2", resulting in the output:</p>
<div id="#rfc.figure.67"></div>
<pre>
  One plus one is equal to 2.
      </pre>
<p id="rfc.section.3.3.p.3">Expression Language statements can be used to to access values provided by reserved variable keys, variables defined using data pipeline tags as defined by <a href="#DataPipelining">Section 3.6</a>, or literal values as in the previous example.</p>
<p id="rfc.section.3.3.p.4">The syntax for expressions is based on a subset of the <a href="#JSPEL">Java Server Pages Expression Language (JSPEL)</a> <cite title="NONE">[JSPEL]</cite>.  All basic operations defined by the JSPEL specification, such as string concatenation and matching, are supported.  However, the definition of custom functions, as defined in <a href="#JSPEL">[JSPEL]</a>, Section 1.15, is not supported at this time.</p>
<p id="rfc.section.3.3.p.5">Containers are required to support variable substitution using this Expression Language syntax.</p>
<h1 id="rfc.section.3.3.1">
<a href="#rfc.section.3.3.1">3.3.1.</a> Using Literal Statements</h1>
<p id="rfc.section.3.3.1.p.1">As is defined by the <a href="#JSPEL">JSPEL</a> <cite title="NONE">[JSPEL]</cite> specification, literal statements can be used. For instance, the "${1+1}" used in the previous example is a literal statement that outputs the results of adding the two numbers together. All forms of literal statement allowed by JSPEL may be used within OpenSocial.</p>
<p id="rfc.section.3.3.1.p.2">It is also possible to combine the use of literal statements with other variables. For instance, the expression "${1 + count}" will be replaced by the numeric value of the variable "count" plus the number one.</p>
<h1 id="rfc.section.3.3.2">
<a href="#rfc.section.3.3.2">3.3.2.</a> Using Data Pipeline Variables</h1>
<p id="rfc.section.3.3.2.p.1">For all application instances, there is a <samp>DataContext</samp> object that stores and provides access to all of the data associated with the Application's use of the <a href="#DataPipelining">Data Pipelining</a> <cite title="NONE">[DataPipelining]</cite> capability. The information stored within the <samp>DataContext</samp> can be accessed either via expression statements or using the <samp>opensocial.data</samp> API.</p>
<div id="#rfc.figure.68"></div>
<p>For instance, if we define a simple variable using the data pipelining tags, we can access the value of that variable by naming it within a substitution expression:</p>
<pre>
  &lt;Module xmlns:os="http://ns.opensocial.org/2008/markup"&gt;
    ...
    &lt;Data&gt;
      &lt;os:Var key="myNumber" value="1" /&gt;
    &lt;/Data&gt;
    &lt;Content type="html"&gt;
      The value of myNumber is: ${myNumber}
    &lt;/Content&gt;
  &lt;/Module&gt;
        </pre>
<p id="rfc.section.3.3.2.p.2">Additional information on the use of the <samp>DataContext</samp> with variable substitution can be found in <a href="#DataPipelining">Section 3.6</a> and <a href="#OpenSocial-Templating">[OpenSocial-Templating]</a>.</p>
<h1 id="rfc.section.3.3.3">
<a href="#rfc.section.3.3.3">3.3.3.</a> <a href="#ReservedVariableKeys" id="ReservedVariableKeys">Using Reserved Variable Keys</a>
</h1>
<p id="rfc.section.3.3.3.p.1">Reserved Variable Keys are reserved variables names whose values are provided by the container. The keys take the form <samp>{Prefix}.{Var}</samp> where <samp>{Prefix}</samp> identifies one of the predefined scopes below, and <samp>{Var}</samp> specifies a specific variable within the identified scope. The applicability of each Prefix and Var combination will vary depending on where within the specification document the variable substitution is occurring.</p>
<p id="rfc.section.3.3.3.p.2">Container implementations and individual extensions to the core OpenSocial specification are free to introduce additional reserved variable key <samp>{Prefix}</samp> names in addition to those listed here.</p>
<div id="#rfc.table.4"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Prefix</th>
<th class="left">Description</th>
<th class="left">Applicability</th>
</tr></thead>
<tbody>
<tr>
<td class="left">Msg</td>
<td class="left">References all message bundle variables for the current locale.  The values of the <samp>{Var}</samp> component are selected from the applicable message bundle. For instance, if the bundle includes a key <samp>FOO</samp>, then the expression <samp>${Msg.FOO}</samp> will be replaced by the localized value associated with <samp>FOO</samp> in the bundle.</td>
<td class="left">
<samp>Msg.*</samp> variables are available anywhere within the application, including ModulePrefs and root Module element.  Message bundle values may reference other message bundle variables by making use of the <samp>${Msg.*}</samp> syntax within the value.</td>
</tr>
<tr>
<td class="left">Bidi</td>
<td class="left">Used to reference information about the currently selected Locale's default text directionality as specified by the text_direction attribute on the &lt;Locale&gt; element. The BIDI variables are discussed in detail in <a href="#Localization">Section 3.4</a>.</td>
<td class="left">
<samp>Bidi.*</samp> variables are available anywhere within the application, including ModulePrefs and root Module element.</td>
</tr>
<tr>
<td class="left">ViewParams</td>
<td class="left">References all values passed using the <samp>viewParams</samp> parameter when calling to <a href="#gadgets.views.requestNavigateTo">gadgets.views.requestNavigateTo</a> <cite title="NONE">[gadgets.views.requestNavigateTo]</cite>.  The values of the <samp>{Var}</samp> component correlates to each view parameter. Expression statements using this prefix will resolve to the same values as calls made to the <samp>gadgets.views.getParams</samp> API. For instance, the expression <samp>${ViewParams.FOO}</samp> will be replaced by the same value returned by the API call <samp>gadgets.views.getParams()["FOO"]</samp>.</td>
<td class="left">
<samp>ViewParam.*</samp> variables are available only within Content blocks and <a href="#DataPipelining">Data Pipeline</a> <cite title="NONE">[DataPipelining]</cite> tags.</td>
</tr>
<tr>
<td class="left">Prefs</td>
<td class="left">References all named values defined by &lt;UserPref&gt; elements contained in the application specification. The values of the <samp>{Var}</samp> component correlate to each defined user preference. Expression statements using this prefix will resolve to the same values as calls to the <samp>gadgets.Prefs</samp> API.  For instance, the expression <samp>${Prefs.Lang}</samp> will be replaced by the same value returned by the API call <samp>gadgets.Prefs.getLang()</samp>; The expression <samp>${Prefs.FOO}</samp> will be replaced by the same value returned by the API call <samp>gadgets.Prefs.getString("FOO")</samp>
</td>
<td class="left">Available anywhere within the application .</td>
</tr>
<tr>
<td class="left">Viewer</td>
<td class="left">Reserved for future use.</td>
<td class="left">N/A</td>
</tr>
<tr>
<td class="left">Owner</td>
<td class="left">Reserved for future use.</td>
<td class="left">N/A</td>
</tr>
<tr>
<td class="left">Gadget</td>
<td class="left">Reserved for future use.</td>
<td class="left">N/A</td>
</tr>
</tbody>
</table>
<div id="#rfc.figure.69"></div>
<p>The following example illustrates the use of Reserved Variables Names using the <samp>Msg</samp> prefix:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs title="${Msg.TITLE}"&gt;
      ...
      &lt;Locale lang="en" country="US"&gt;
        &lt;msg name="TITLE"&gt;My Gadget&lt;/msg&gt;
        &lt;msg name="GREETING"&gt;Hello There!&lt;/msg&gt;
      &lt;/Locale&gt;
      ...
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;&lt;![CDATA[
      &lt;div&gt;${Msg.GREETING}&lt;/div&gt;
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
        </pre>
<h1 id="rfc.section.3.3.4">
<a href="#rfc.section.3.3.4">3.3.4.</a> Deprecated Expression Syntax</h1>
<p id="rfc.section.3.3.4.p.1">Previous versions of this specification supported a -- now deprecated -- alternative expression syntax. Container implementations are permitted to continue supporting the deprecated syntax to provide backwards compatibility for older, existing specification documents, however, developers creating new applications MUST NOT use the deprecated format.</p>
<p id="rfc.section.3.3.4.p.2">The legacy syntax takes the form <samp>__{Prefix}_{Var}__</samp> where <samp>{Prefix}</samp> identifies one of the predefined scopes below, and <samp>{Var}</samp> specifies a specific variable within the identified scope.</p>
<div id="#rfc.figure.70"></div>
<p>For instance, in the partial example that follows, the expression <samp>__MSG_FOO__</samp> is replaced for the localized value identified by the key <samp>FOO</samp> within the localized message bundle:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs title="__MSG_FOO__"&gt;
      ...
      &lt;Locale language="en" country="US"&gt;
        &lt;msg name="FOO"&gt;Hello World!&lt;/msg&gt;
      &lt;/Locale&gt;
      ...
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;
      ...
    &lt;/Content&gt;
  &lt;/Module&gt;
        </pre>
<p id="rfc.section.3.3.4.p.3">The <samp>{Prefix}</samp> keys supported by the legacy syntax are:</p>
<div id="#rfc.table.5"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Prefix</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">MSG</td>
<td class="left">References all message bundle variables for the current locale.  The values of the <samp>{Var}</samp> component are selected from the applicable message bundle. For instance, if the bundle includes a key <samp>FOO</samp>, then the expression <samp>__MSG_FOO__</samp> will be replaced by the localized value associated with <samp>FOO</samp> in the bundle.</td>
</tr>
<tr>
<td class="left">BIDI</td>
<td class="left">References BIDI substitution variables whose values will reflect the default text direction as specified by the selected locale.  The BIDI variables are discussed in detail in <a href="#Localization">Section 3.4</a>.</td>
</tr>
<tr>
<td class="left">MODULE</td>
<td class="left">Originally intended to provide a context for information about the specification document itself. Currently, <samp>ID</samp> is the only variable key supported (e.g. <samp>__MODULE_ID__</samp>).  When used, the container SHOULD replace the <samp>__MODULE_ID__</samp> expression with a unique ID value for each instance of an application displayed simultaneously.</td>
</tr>
<tr>
<td class="left">UP</td>
<td class="left">References all named values defined by &lt;UserPref&gt; elements contained in the specification document. The values of the <samp>{Var}</samp> component correlate to each defined user preference. Expression statements using this prefix will resolve to the same values as calls to the <samp>gadgets.Prefs</samp> API. For instance, the expression <samp>__UP_Lang__</samp> will be replaced by the same value returned by the API call <samp>gadgets.Prefs.getLang()</samp>; The expression <samp>__UP_FOO__</samp> will be replaced by the same value returned by the API call <samp>gadgets.Prefs.getString("FOO")</samp>
</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.3.3.5">
<a href="#rfc.section.3.3.5">3.3.5.</a> Processing Requirements</h1>
<p id="rfc.section.3.3.5.p.1">Containers perform Variable Substitution when application views are rendered or when metadata about the application is displayed.  For instance, if the container includes an application specification within a listing of applicatioms available to install and use on a page, then the container will perform any substitution necessary on the displayed values (e.g. title, description, etc).</p>
<p id="rfc.section.3.3.5.p.2">Containers are required to perform substitution on all attributes or elements in the application specification document exception of &lt;Locale&gt;, &lt;msg&gt;, &lt;EnumValue&gt; elements, but only when the content of those elements and attributes is currently being rendered. If, for instance, a application contains multiple &lt;Content&gt; elements, each of which identify different views, the container will only process substitutions that are included within the content for the view currently being rendered.  Further, containers are required to perform all substitutions that use either the Msg reserved variable key (i.e.  <samp>${Msg.FOO}</samp>) or the MSG legacy syntax format (i.e. <samp>__MSG_FOO__</samp>) -- if supported -- before applying any other substitutions.</p>
<p id="rfc.section.3.3.5.p.3">Variable substitution MUST NOT be applied recursively and circular dependencies detected within variables MUST be ignored and treated as literal values rather than expressions. For instance, within the following partial application specification:</p>
<div id="#rfc.figure.71"></div>
<pre>
  &lt;Module xmlns:os="http://ns.opensocial.org/2008/markup"&gt;
    ...
    &lt;Data&gt;
      &lt;os:Var key="key1" value="${key2}" /&gt;
      &lt;os:Var key="key2" value="${key1}" /&gt;
    &lt;/Data&gt;
    &lt;Content type="html"&gt;
      ${key1}
      ${key2}
    &lt;/Content&gt;
  &lt;/Module&gt;
        </pre>
<p id="rfc.section.3.3.5.p.4">The value of <samp>key1</samp> would be resolved as the literal value <samp>${key1}</samp>. The value of <samp>key2</samp> would be resolved as the literal value <samp>${key2}</samp>. The rendered output generated by the container would be:</p>
<div id="#rfc.figure.72"></div>
<pre>
  ${key1}
  ${key2}
        </pre>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> <a href="#Localization" id="Localization">Localization</a>
</h1>
<p id="rfc.section.3.4.p.1">Localization of an application is achieved primarily through <a href="#VariableSubstitution">Variable Substitution</a> <cite title="NONE">[VariableSubstitution]</cite>, using the Msg reserved variable key and &lt;Locale&gt; elements.</p>
<p id="rfc.section.3.4.p.2">To determine the appropriate keys and values to use for substitution, containers will inspect the application specification document for a &lt;Locale&gt; element that matches the current view being rendered, as well as the language and country of the Viewer.</p>
<p id="rfc.section.3.4.p.3">A &lt;Locale&gt; is considered a match if either: </p>

<ul>
<li>The default unnamed view is being rendered and the &lt;Locale&gt; elements view attribute is unspecified, or the specific view being rendered is named explicitly within the &lt;Locale&gt; element's view attribute, and </li>
<li>The language and country attributes on the &lt;Locale&gt; element exactly match those of the Viewer, or</li>
<li>The language attribute is an exact match for the Viewer and the country attribute specifies "all", or</li>
<li>Both the language and country attributes specify "all".</li>
</ul>

<p> </p>
<p id="rfc.section.3.4.p.4">How the container determines the current language and country of the Viewer is not defined by this specification.</p>
<p id="rfc.section.3.4.p.5">If a matching &lt;Locale&gt; is not found within the specification document, the container is permitted to provide it's own localization data.</p>
<p id="rfc.section.3.4.p.6">Once an appropriate &lt;Locale&gt; has ben selected, containers are required to replace all Msg expressions for which a replacement value can be determined.</p>
<p id="rfc.section.3.4.p.7">For example, given the following partial specification:</p>
<div id="#rfc.figure.73"></div>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      ...
      &lt;Locale language="en" country="all"&gt;
        &lt;msg name="greeting"&gt;Hello World!&lt;/msg&gt;
      &lt;/Locale&gt;
      &lt;Locale language="en" country="all" views="other"&gt;
        &lt;msg name="greeting"&gt;Howdy!&lt;/msg&gt;
      &lt;/Locale&gt;
      &lt;Locale language="fr" country="all"&gt;
        &lt;msg name="greeting"&gt;Bonjour tout le monde!&lt;/msg&gt;
      &lt;/Locale&gt;
      ...
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;
      ${Msg.greeting}
    &lt;/Content&gt;
  &lt;/Module&gt;
      </pre>
<p id="rfc.section.3.4.p.8">When rendering the default view, the container will output "Hello World!" for English-speaking Viewers and "Bonjour tout le monde!" for French-speaking Viewers.</p>
<h1 id="rfc.section.3.4.1">
<a href="#rfc.section.3.4.1">3.4.1.</a> Considerations for Bidirectional Text</h1>
<p id="rfc.section.3.4.1.p.1">Gadget developers need to take care when working with languages that require a default Right-to-Left ordering when rendering text.  The <samp>Bidi</samp> reserved variable key can be used within Variable Substitution expression statements to access information about the default text directionality as specified by the currently selected locale.</p>
<p id="rfc.section.3.4.1.p.2">The variables supported by the <samp>Bidi</samp> reserved variable key are: </p>

<dl>
<dt>START_EDGE</dt>
<dd style="margin-left: 8">When the selected &lt;Locale&gt; element's <samp>text_direction</samp> attribute specifies <samp>rtl</samp> (Right-to-Left"), the value of the <samp>Bidi.START_EDGE</samp> reserved variable key will be <samp>right</samp>.  When the attribute is either <samp>ltr</samp> (Left-to-Right) or unspecified, the value will be <samp>left</samp>.</dd>
<dt>END_EDGE</dt>
<dd style="margin-left: 8">When the text direction is <samp>rtl</samp>, the value of <samp>Bidi.END_EDGE</samp> will be <samp>left</samp>. When the attribute is either <samp>ltr</samp> or unspecified, the value will be <samp>right</samp>.</dd>
<dt>DIR</dt>
<dd style="margin-left: 8">The reserved variable key <samp>Bidi.DIR</samp> returns the value of the &lt;Locale&gt; element's <samp>text_direction</samp> attribute or <samp>ltr</samp> if the attribute is unspecified.</dd>
<dt>REVERSE_DIR</dt>
<dd style="margin-left: 8">The reserved variable key <samp>Bidi.REVERSE_DIR</samp> returns the opposite of the &lt;Locale&gt; element's <samp>text_direction</samp> attribute value. If <samp>text_direction</samp> is <samp>ltr</samp>,  <samp>Bidi.REVERSE_DIR</samp> will return <samp>rtl</samp>. If text_direction is <samp>rtl</samp>, <samp>Bidi.REVERSE_DIR</samp> will return <samp>ltr</samp>.</dd>
</dl>

<p> </p>
<div id="#rfc.figure.74"></div>
<p>The Bidi variables can be used to establish the correct text directionality when rendering. For instance:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      ...
      &lt;Locale language="en" country="all"&gt;
        &lt;msg name="greeting"&gt;Hello World!&lt;/msg&gt;
      &lt;/Locale&gt;
      &lt;Locale language="ar" country="all" text_direction="rtl"&gt;
        &lt;msg name="greeting"&gt;&amp;#0645;&amp;#0631;&amp;#062D;&amp;#0628;&amp;#0627 &amp;#0627;&amp;#0644;&amp;#0639;&amp;#0627;&amp;#0644;&amp;#0645!&lt;/msg&gt;
      &lt;/Locale&gt;
      ...
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;
      &lt;div dir="${Bidi.DIR}"&gt;${Msg.greeting}&lt;/div&gt;
    &lt;/Content&gt;
  &lt;/Module&gt;        
        </pre>
<h1 id="rfc.section.3.4.2">
<a href="#rfc.section.3.4.2">3.4.2.</a> <a href="#MessageBundles" id="MessageBundles">Message Bundle Documents</a>
</h1>
<p id="rfc.section.3.4.2.p.1">The &lt;Locale&gt; element can either directly contain &lt;msg&gt; elements that define the keys and values used for localization or can reference "Message Bundle Documents" that provide the collection of &lt;msg&gt; elements.</p>
<div id="#rfc.figure.75"></div>
<p>For instance, the following &lt;Locale&gt; element:</p>
<pre>
  &lt;Locale language="en" country="US"&gt;
    &lt;msg name="color"&gt;Color&lt;/msg&gt;
    &lt;msg name="red"&gt;Red&lt;/msg&gt;
    &lt;msg name="green"&gt;Green&lt;/msg&gt;
    &lt;msg name="blue"&gt;Blue&lt;/msg&gt;
  &lt;/Locale&gt;
        </pre>
<div id="#rfc.figure.76"></div>
<p>Can be replaced with a &lt;Locale&gt; that references an external Message Bundle that includes the same &lt;msg&gt; elements:</p>
<pre>
  &lt;Locale language="en" country="US" messages="http://example.com/en/messages.xml" /&gt;
        </pre>
<div id="#rfc.figure.77"></div>
<p>The Message Bundle at http://example.com/en/messages/xml:</p>
<pre>
  &lt;messagebundle&gt;
    &lt;msg name="color"&gt;Color&lt;/msg&gt;
    &lt;msg name="red"&gt;Red&lt;/msg&gt;
    &lt;msg name="green"&gt;Green&lt;/msg&gt;
    &lt;msg name="blue"&gt;Blue&lt;/msg&gt;
  &lt;/messagebundle&gt;
        </pre>
<p id="rfc.section.3.4.2.p.2">As illustrated, Message Bundles are XML documents whose root element is a &lt;messagebundle&gt; that contains zero or more &lt;msg&gt; elements that use the same format as the children of the &lt;Locale&gt; element. No XML Namespace is defined for the &lt;messagebundle&gt; or &lt;mgs&gt; elements.</p>
<div id="#rfc.figure.78"></div>
<pre>
  messagebundle = element messagebundle {
    undefinedAttribute*,
    element msg {
      attribute name { text },
      text
    }
  }
        </pre>
<p id="rfc.section.3.4.2.p.3">Variable substitution expressions MAY be used within Message Bundle Documents.</p>
<p id="rfc.section.3.4.2.p.4">Each Message Bundle Document provides &lt;msg&gt; elements for a single locale. By convention, Message Bundle documents are named as <samp>{language}_{country}.xml</samp>, where <samp>{language}</samp> is either an ISO-639-1 Language Code or <samp>ALL</samp> and <samp>{country}</samp> is an ISO-3166-1 Country Code or <samp>ALL"</samp>. For instance, a Message Bundle providing values for English-language speakers within the United States would be named <samp>en_US.xml</samp>, while a Message Bundle providing German-language values for German-language speakers regardless of country would be named <samp>de_ALL.xml</samp>. The Message Bundle named <samp>ALL_ALL.xml</samp> would apply to all languages in any country.</p>
<h1 id="rfc.section.3.5">
<a href="#rfc.section.3.5">3.5.</a> <a href="#gadget-lifecycle-events" id="gadget-lifecycle-events">Application Lifecycle Events</a>
</h1>
<p id="rfc.section.3.5.p.1">The Application Lifecycle Event capability allows an OpenSocial server and container to send notifications to a remote endpoint of the application developer's choosing whenever events significant to the lifecycle of an individual instance of the application occur.  Such notifications can be used for a variety of purposes, including, but not limited to, the provisioning of additional resources external to the container that instances of the application require to operate.</p>
<p id="rfc.section.3.5.p.2">Every instance of an application processed and rendered by a container follows the same basic general lifecycle.</p>
<p id="rfc.section.3.5.p.3">The syntax used to identify individual types of events within the application lifecycle is: </p>
<div id="#rfc.figure.79"></div>
<pre>
  segment = 1*( ALPHA / DIGIT )
  prefix = segment *("." segment ) "."
  name = segment *("." segment)
  event = [prefix] "event" [ "." name ]
      </pre>
<p id="rfc.section.3.5.p.4">The following events are defined:</p>
<div id="#rfc.table.6"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Name</th>
<th class="left">Identifier</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">Pending</td>
<td class="left">org.opensocial.event.pending</td>
<td class="left">occurs prior to an application specification document being "Registered" with the container. This is an intermediate step in a application's lifecycle that occurs, for example, when a developer first submits the specification document to the container, or when an Embedded Experience that references a previously unknown specification is encountered, and that specification has not yet been processed. This phase in the lifecycle implies that additional action might be required before the application can be considered to be "Registered".</td>
</tr>
<tr>
<td class="left">Rejected</td>
<td class="left">org.opensocial.event.rejected</td>
<td class="left">occurs when "Registration" of a "Pending" specification document cannot be completed for any reason. For instance, if the registration is rejected by an administrator.</td>
</tr>
<tr>
<td class="left">Registered</td>
<td class="left">org.opensocial.event.registered</td>
<td class="left">occurs after the container first becomes aware of the Application Specification Document. For instance, when an administrator adds an application to a catalog of available applications, or when a previously unknown application is referenced within an Embedded Experience currently being processed by a container.</td>
</tr>
<tr>
<td class="left">Available</td>
<td class="left">org.opensocial.event.available</td>
<td class="left">occurs when the application becomes available for use by the container. In order to be considered "Available", an application MUST have first passed through the "Registered" phase. There are a number of actions that can trigger the availability of an application such as an administrator approving the registration or adding the application to a "whitelist" of acceptable applications.</td>
</tr>
<tr>
<td class="left">Unavailable</td>
<td class="left">org.opensocial.event.unavailable</td>
<td class="left">occurs when the application becomes unavailable for use by the container. Unavailable applications are known to the container ("Registered") but cannot be used for some reason.  Examples include applications that have been added to a "blacklist" or have otherwise been disabled for some reason.</td>
</tr>
<tr>
<td class="left">Updated</td>
<td class="left">org.opensocial.event.updated</td>
<td class="left">occurs whenever the application specification known to the container has been updated. This can happen whenever a new version of the application is provided to the container.</td>
</tr>
<tr>
<td class="left">Installed</td>
<td class="left">org.opensocial.event.installed</td>
<td class="left">occurs when a specific instance of an application is provisioned for use. For instance, when an instance is added to a page. Only "Available" applications can be "Installed". Installing an application is not the same as "opening" or "rendering" the application.</td>
</tr>
<tr>
<td class="left">Configured</td>
<td class="left">org.opensocial.event.configured</td>
<td class="left">occurs whenever the configuration details for an installed application have been modified.</td>
</tr>
<tr>
<td class="left">Restriction</td>
<td class="left">org.opensocial.event.restriction</td>
<td class="left">occurs whenever the functionality of a particular instance of the application has been restricted in some way. For instance, if the operation of the application has caused it to exceed request rate limitations or quotas and the container responds by limiting the actions the application instance is permitted to perform. Another example could be when the container has limited the security policy permissions underwhich the instance of the application is operating.</td>
</tr>
<tr>
<td class="left">Opened</td>
<td class="left">org.opensocial.event.opened</td>
<td class="left">occurs whenever an "Installed" instance of an application is opened or rendered by the container.</td>
</tr>
<tr>
<td class="left">Closed</td>
<td class="left">org.opensocial.event.closed</td>
<td class="left">occurs whenever an "Installed" instance of an application is closed by the container. Note that closing an application is not the same as uninstalling it. A closed application can be reopened later.</td>
</tr>
<tr>
<td class="left">Uninstalled</td>
<td class="left">org.opensocial.event.uninstalled</td>
<td class="left">occurs when a provisioned instance of an application is destroyed. This lifecycle event implies that all resources associated with a specific application instance are to be deallocated.</td>
</tr>
<tr>
<td class="left">Unregistered</td>
<td class="left">org.opensocial.event.unregistered</td>
<td class="left">occurs when a "Registered" application specification is removed from the container.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.3.5.p.5">A developer can indicate interest in receiving notification whenever any of these lifecycle events occur by using the &lt;Link&gt; element with a <samp>rel</samp> attribute value equal to the identifier of the event. Containers are not, however, required to send lifecycle event notifications and MAY ignore any &lt;Link&gt; element specifying an event identifier.</p>
<p id="rfc.section.3.5.p.6">The special identifier <samp>org.opensocial.event</samp> can be used to indicate interest in receiving notification for all event types.</p>
<p id="rfc.section.3.5.p.7">Use of the <samp>org.opensocial.</samp> prefix is reserved by this specification. Implementations MUST NOT use event identifiers that use the <samp>org.opensocial.</samp> prefix other than those defined above. Implementations are free to define additional event type identifiers that use prefixes other than <samp>org.opensocial.</samp>.</p>
<p id="rfc.section.3.5.p.8">The optional <samp>method</samp> attribute can be specified on the &lt;Link&gt; element to indicate the HTTP request method to be used when sending the event notification. Valid values are either <samp>GET</samp> or <samp>POST</samp>.  When not specified, the default is assumed to be <samp>GET</samp>.</p>
<div id="#rfc.figure.80"></div>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      ...
      &lt;Link rel="org.opensocial.event" href="http://example.org/event" method="POST" /&gt;
      &lt;Link rel="org.opensocial.event.registered" href="http://example.org/event/registered" /&gt;
      &lt;Link rel="org.opensocial.event.unregistered" href="http://example.org/event/unregistered" /&gt;
      ...
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;
      ...
    &lt;/Content&gt;
  &lt;/Module&gt;
      </pre>
<h1 id="rfc.section.3.5.1">
<a href="#rfc.section.3.5.1">3.5.1.</a> Lifecycle Event Notifications</h1>
<p id="rfc.section.3.5.1.p.1">Whenever a significant lifecycle event occurs for a particular application, the container MAY send an event notification to the IRI identified by any &lt;Link&gt; element provided whose <samp>rel</samp> attribute values identify the event.  If the container supports sending event notifications, one notification SHOULD be sent for each matching &lt;Link&gt; element.</p>
<p id="rfc.section.3.5.1.p.2">For instance, given the following partial specification:</p>
<div id="#rfc.figure.81"></div>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      ...
      &lt;Link rel="org.opensocial.event" href="http://example.org/event" method="POST" /&gt;
      &lt;Link rel="org.opensocial.event.registered" href="http://example.org/event/registered" /&gt;
      &lt;Link rel="org.opensocial.event.unregistered" href="http://example.org/event/unregistered" /&gt;
      ...
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;
      ...
    &lt;/Content&gt;
  &lt;/Module&gt;
        </pre>
<p id="rfc.section.3.5.1.p.3">When the application is registered with the container, two event notifications will be sent: </p>

<ul>
<li>One to the endpoint "http://example.org/event" identified by the <samp>org.opensocial.event</samp> rel value, and</li>
<li>One to the endpoint "http://example.org/event/registered" identified by the <samp>org.opensocial.event.registered</samp> rel value.</li>
</ul>

<p> </p>
<p id="rfc.section.3.5.1.p.4">Each event notification is sent as an HTTP request message using the method declared by the &lt;Link&gt; elements <samp>method</samp> attribute. If the <samp>method</samp> attribute is not specified, then the HTTP GET method is used.</p>
<p id="rfc.section.3.5.1.p.5">The container MUST add the additional <samp>eventtype</samp> query string parameter to the IRI specified by the &lt;Link&gt; element.  The value MUST be the name part of the event identifier provided in the <samp>rel</samp> attribute (e.g. if <samp>rel="org.opensocial.event.registered"</samp>, then <samp>eventtype</samp> will equal <samp>registered</samp>).  If the event identifier does not have a name component (as is the case with the special identifier <samp>org.opensocial.event</samp>) then value of <samp>eventtype</samp> MUST be set to a name specific to event that triggered the notification.</p>
<p id="rfc.section.3.5.1.p.6">If the &lt;Link&gt; element includes an <samp>authz</samp> attribute that specifies a value other than <samp>none</samp>, the notification MUST be authenticated using the authentication mechanism specified as described in <a href="#authentication">Section 3.1</a>. If the <samp>authz</samp> attribute specifies a value of <samp>none</samp>, no authentication mechanism is to be used. If the <samp>authz</samp> attribute is not specified, the notification MUST be authenticated using the <a href="#SignedFetch">Signed Fetch</a> <cite title="NONE">[SignedFetch]</cite> mechanism.</p>
<div id="#rfc.figure.82"></div>
<p>In the example given, the notification sent to "http://example.org/event" will utilize the HTTP POST method (line breaks are added to the request URI for readability):</p>
<pre>
  POST /event?eventtype=registered
    &amp;oauth_consumer_key=myappkey
    &amp;oauth_nonce=7sGE00xSfY4PBStICbXyPbIliNymOhu2
    &amp;oauth_signature_method=HMAC-SHA1
    &amp;oauth_timestamp=1290013827
    &amp;oauth_version=1.0
    &amp;opensocial_app_id=myappid
    &amp;opensocial_app_url=
    &amp;oauth_signature=N7mODAf9OJ1DXQRPisRqGK4DNMo= HTTP/1.1
  Host: example.org
        
        </pre>
<div id="#rfc.figure.83"></div>
<p>The notification sent to "http://example.org/event/registered" will utilize HTTP GET (line breaks are added to the request URI for readability):</p>
<pre>
  GET /event?eventtype=registered
    &amp;oauth_consumer_key=myappkey
    &amp;oauth_nonce=7sGE00xSfY4PBStICbXyPbIliNymOhu2
    &amp;oauth_signature_method=HMAC-SHA1
    &amp;oauth_timestamp=1290013827
    &amp;oauth_version=1.0
    &amp;opensocial_app_id=myappid
    &amp;opensocial_app_url=
    &amp;oauth_signature=N7mODAf9OJ1DXQRPisRqGK4DNMo= HTTP/1.1
  Host: example.org
        </pre>
<p id="rfc.section.3.5.1.p.7">Responses to event notification requests are considered to be insignificant by this specification.</p>
<h1 id="rfc.section.3.5.2">
<a href="#rfc.section.3.5.2">3.5.2.</a> Legacy Support</h1>
<p id="rfc.section.3.5.2.p.1">Previous version of this specification defined the following deprecated event identifiers that MAY continued to be supported by containers for backwards compatibility: </p>

<dl>
<dt>event</dt>
<dd style="margin-left: 8">Equivalent to <samp>org.opensocial.event</samp>.</dd>
<dt>event.addapp</dt>
<dd style="margin-left: 8">Equivalent to <samp>org.opensocial.event.installed</samp>
</dd>
<dt>event.removeapp</dt>
<dd style="margin-left: 8">Equivalent to <samp>org.opensocial.event.uninstalled</samp>
</dd>
<dt>event.app</dt>
<dd style="margin-left: 8">Provides an indication that some action has been performed on the application. The specific action performed is identified by adding an additional <samp>action</samp> parameter to the GET or POST request. The valid "action" values are: <ul>
<li>
<samp>enabled</samp>, </li>
<li>
<samp>disabled</samp>, </li>
<li>
<samp>approved</samp>, </li>
<li>
<samp>submitted</samp>, </li>
<li>
<samp>rejected</samp>, </li>
<li>
<samp>new</samp>, and </li>
<li><samp>banned</samp></li>
</ul>
<p> </p>
</dd>
</dl>

<p> </p>
<h1 id="rfc.section.3.6">
<a href="#rfc.section.3.6">3.6.</a> <a href="#DataPipelining" id="DataPipelining">Data Pipelining</a>
</h1>
<p id="rfc.section.3.6.p.1">Data Pipelining is a declarative mechanism for defining the data an application requires from the container. XML Elements are used to associate variable keys with specific kinds of data from a variety of different sources. For instance, the &lt;os:DataRequest&gt; element can be used to access social data provided by the OpenSocial container, while the &lt;os:HttpRequest&gt; element can provide access to content from any HTTP endpoint.</p>
<p id="rfc.section.3.6.p.2">All Data Pipeline elements have a <samp>key</samp> attribute whose value is used to uniquely identify the data. Such keys can be used within Expression Language statements used for Variable Substitution or with JavaScript API calls. Key names are always case-sensitive.</p>
<div id="#rfc.figure.84"></div>
<p>The following illustrates a basic example of Data Pipelining in a partial application specification:</p>
<pre>
  &lt;Module xmlns:os="http://ns.opensocial.org/2008/markup"&gt;
    ...
    &lt;Data&gt;
      &lt;os:DataRequest key="viewer" method="people.get" userId="@viewer" fields="name,birthday" /&gt;
      &lt;os:HttpRequest key="remote" href="http://example.com/api" /&gt;
    &lt;/Data&gt;
    &lt;Content type="html"&gt;
      The viewer name is ${viewer.name}.
      
      The remote content is "${remote.result.content}".
    &lt;/Content&gt;
  &lt;/Module&gt;
      </pre>
<p id="rfc.section.3.6.p.3">The Data Pipeline elements can appear: </p>

<ul>
<li>As children of the &lt;Data&gt; element,</li>
<li>As direct children of the &lt;Content&gt; element when the Proxied Content model is used, and </li>
<li>Within specially formatted HTML &lt;script&gt; tags included within HTML Content.</li>
</ul>

<p> </p>
<p id="rfc.section.3.6.p.4">The placement of Data Pipeline elements will determine when and where the data associated with the key specified will be made available to the container while an application view is being rendered. The considerations and requirements for each of the options listed above are discussed in detail in the relevant sections that follow.</p>
<h1 id="rfc.section.3.6.1">
<a href="#rfc.section.3.6.1">3.6.1.</a> <a href="#DataContext" id="DataContext">The DataContext</a>
</h1>
<p id="rfc.section.3.6.1.p.1">For every application instance, a <samp>DataContext</samp> object is created that maintains all of the data associated with the instance's Data Pipeline elements. The information contained within the <samp>DataContext</samp> is available for use with Variable Substitution via Expression Language statements or via the <samp>opensocial.data</samp> APIs; and while the data contained within the <samp>DataContext</samp> is generally populated through processing of the Data Pipeline elements, the <samp>opensocial.data</samp> APIs can be used to modify values or add additional keys.</p>
<h1 id="rfc.section.3.6.2">
<a href="#rfc.section.3.6.2">3.6.2.</a> Data Pipeline Elements and the Data Block</h1>
<p id="rfc.section.3.6.2.p.1">By default, when Data Pipeline elements appear as children of the &lt;Data&gt; element, the container will process the elements and register the resulting data with the <samp>DataContext</samp> for all views.</p>
<p id="rfc.section.3.6.2.p.2">Individual Data Pipeline elements, however, MAY specify a <samp>view</samp> attribute whose value is a comma separated list of specific views for which the element is associated.  Such elements will only be processed and added to the <samp>DataContext</samp> when the identified views are being rendered.</p>
<div id="#rfc.figure.85"></div>
<p>In the following example, the &lt;os:HttpRequest&gt; element using key <samp>foo</samp> is registered globally and available within all views while the &lt;os:HttpRequest&gt; element using key <samp>bar</samp> is only processed and available when the <samp>example</samp> view is being rendered:</p>
<pre>
  &lt;Module&gt;
    ...
    &lt;Data&gt;
      &lt;os:HttpRequest key="foo" href="http://example.org/api" /&gt;
      &lt;os:HttpRequest key="bar" href="http://example.com/api" view="example"/&gt;
    &lt;/Data&gt;
    &lt;Content type="html"&gt;
      ...
    &lt;/Content&gt;
    &lt;Content type="html" view="example"&gt;
      ...
    &lt;/Content&gt;
  &lt;/Module&gt;
        </pre>
<p id="rfc.section.3.6.2.p.3">Multiple Data Pipeline elements MUST NOT share the same value for the key attribute unless each is specifically targeted at a different view. In the following example, the key <samp>foo</samp> would resolve to the value <samp>abc</samp> when the default view is rendered and to <samp>123</samp> when the <samp>example</samp> view is rendered:</p>
<div id="#rfc.figure.86"></div>
<pre>
  &lt;Module&gt;
    ...
    &lt;Data&gt;
      &lt;os:Var key="foo" value="abc" /&gt;
      &lt;os:Var key="foo" value="abc" view="example" /&gt;
    &lt;/Data&gt;
    &lt;Content type="html"&gt;
      The value is ${foo}
    &lt;/Content&gt;
    &lt;Content type="html" view="example"&gt;
      The value is ${foo}
    &lt;/Content&gt;
  &lt;/Module&gt;       
        </pre>
<p id="rfc.section.3.6.2.p.4">Note that currently, this specification does not specify exactly when the container processes the collection of Data Pipeline elements, nor are containers required to process data elements in any particular order. Containers that process Data Pipeline elements to populate the <samp>DataContext</samp> will likely do so regardless of whether the referenced key is ever actually used within an expression statement or API call.</p>
<h1 id="rfc.section.3.6.3">
<a href="#rfc.section.3.6.3">3.6.3.</a> Data Pipeline Elements within HTML Content</h1>
<p id="rfc.section.3.6.3.p.1">When using HTML Content, Data Pipeline elements MAY appear within the HTML inside a special &lt;script&gt; tag.</p>
<div id="#rfc.figure.87"></div>
<p>For instance,</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      &lt;Require feature="opensocial-data" /&gt;
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;&lt;![CDATA[
      &lt;script xmlns:os="http://ns.opensocial.org/2008/markup" type="text/os-data"&gt;
        &lt;os:HttpRequest key="foo" href="http://example.com/api" /&gt;
        &lt;os:Var key="bar" value="abc123"/&gt;
      &lt;/script&gt;
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
        </pre>
<p id="rfc.section.3.6.3.p.2">As illustrated, when Data Pipeline elements are embedded within HTML Content, the specification document MUST require the "opensocial-data" feature using the &lt;Require&gt; element within the &lt;ModulePrefs&gt;.</p>
<p id="rfc.section.3.6.3.p.3">The Data Pipeline elements themselves are contained within an HTML script tag whose <samp>type</samp> attribute specifies the value <samp>text/os-data</samp>. Also note that the Data Pipeline XML namespace is declared for the "os:" prefix. This is required in order for the embedded Data Pipeline elements to processed properly while the content is being rendered.</p>
<p id="rfc.section.3.6.3.p.4">Data Pipeline elements defined in this manner are scoped specifically to the &lt;Content&gt; element in which they are embedded, meaning that the data each provides to the <samp>DataContext</samp> will be available only for expression statements and API calls that are also in the same &lt;Content&gt; element.</p>
<p id="rfc.section.3.6.3.p.5">If an embedded Data Pipeline element specifies the same key as a Data Pipeline element contained within the &lt;Data&gt; element, the value provided by the embedded elements takes precedence. In the following example, the variable "foo" will resolve to "123" when the default unnamed view is rendered:</p>
<div id="#rfc.figure.88"></div>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      &lt;Require feature="opensocial-data" /&gt;
    &lt;/ModulePrefs&gt;
    &lt;Data&gt;
     &lt;os:Var key="foo" value="abc"/&gt;
    &lt;/Data&gt;
    &lt;Content type="html"&gt;&lt;![CDATA[
      &lt;script xmlns:os="http://ns.opensocial.org/2008/markup" type="text/os-data"&gt;
        &lt;os:Var key="foo" value="123"/&gt;
      &lt;/script&gt;
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
        </pre>
<h1 id="rfc.section.3.6.4">
<a href="#rfc.section.3.6.4">3.6.4.</a> <a href="#data-pipeline-proxy" id="data-pipeline-proxy">Data Pipeline Elements and Proxied Content</a>
</h1>
<p id="rfc.section.3.6.4.p.1">When using Proxied Content to render a view for an application, the container typically sends an HTTP GET request to the IRI provided by the &lt;Content&gt; element's href attribute.  In such cases, any information the remote endpoint needs to generate the necessary content in response is provided within the IRI as query string parameters. There are times, however, when the endpoint requires significantly more information than what can be adequately conveyed by the limited nature of query string parameters. To address such cases, Data Pipeline elements can be used directly within a &lt;Content&gt; element to define a collection of data that is to be sent to the remote IRI using an HTTP POST request instead of GET.</p>
<div id="#rfc.figure.89"></div>
<p>For instance, with typical, non-pipelined Proxy content:</p>
<pre>
  &lt;Content type="html" href="http://example.org/remote-server?id=${ViewParams.id}" /&gt;
        </pre>
<div id="#rfc.figure.90"></div>
<p>The <samp>${ViewParams.id}</samp> expression would be replaced with an appropriate value drawn from the View Parameters passed into the application, and HTTP request sent to the remote endpoint by the container would use HTTP GET:</p>
<pre>
  GET /remote-server?id=abc123 HTTP/1.1
  Host: example.org
  Accept: application/json
        </pre>
<div id="#rfc.figure.91"></div>
<p>However, when using Proxied Content with the Data Pipeline elements, a developer can pass complex structured data to remote endpoint:</p>
<pre>
  &lt;Content type="html" href="http://example.org/remote-server"&gt;
    &lt;os:Var key="id" value="${ViewParams.id}" /&gt;
    &lt;os:Var key="name"&gt;
      {
        "givenName": "John",
        "familyName": "Doe"
      }
    &lt;/os:Var&gt;
  &lt;/Content&gt;
        </pre>
<div id="#rfc.figure.92"></div>
<p>The request is transformed into an HTTP POST with a JSON-formatted payload containing the data specified by the pipeline elements:</p>
<pre>
  POST /remote-server HTTP/1.1
  Host: example.org
  Content-Type: application-json
  
  {
    "id" : "abc123",
    "name": {
      "givenName": "John",
      "familyName": "Doe"
    }
  }
        </pre>
<p id="rfc.section.3.6.4.p.2">As illustrated by the example, each of the keys defined by the Data Pipeline elements contained within the &lt;Content&gt; are used as the property names in the JSON object sent to the remote endpoint. The value of each property is the value returned by processing the Data Pipeline element.</p>
<p id="rfc.section.3.6.4.p.3">&lt;Content&lt; element's of this type can contain any number of Data Pipeline elements, each of which MUST have a corresponding property in the generated JSON object that is sent to the server, regardless of whether the attempt to process a particular Data Pipeline element results in an error or not. The value will be included within the JSON exactly as it is provided by the <samp>DataContext</samp>.  Only pipelined data contained within the &lt;Content&gt; will be included in the generated JSON object.</p>
<div id="#rfc.figure.93"></div>
<p>In the follow example, assume that the processing of the &lt;os:DataRequest&gt; element fails and error details are provided by the <samp>DataContext</samp>:</p>
<pre>
  &lt;Content type="html" href="http://example.org"&gt;
    &lt;os:Var key="key1" value="abc" /&gt;
    &lt;os:DataRequest key="key2" method="people.get" userId="@viewer" groupId="@frields" /&gt;
  &lt;/Content&gt;
        </pre>
<div id="#rfc.figure.94"></div>
<p>The JSON data posted to the remote server would include the value of <samp>key1</samp> and the error information for <samp>key2</samp>:</p>
<pre>
  POST / HTTP/1.1
  Host: example.org
  Content-Type: application/json
  
  {
    "key1" : "abc",
    "key2" : {
      "error" : {
        "message" : "Processing Error",
        "code" : 500
      }
    }
  }
        </pre>
<p id="rfc.section.3.6.4.p.4">When an application specification uses unrecognized Data Pipeline tags, the container is given the choice of either ignoring it or specifying a 404 (Not Found) error within the JSON structure using an <a href="#core-api">Error Object</a> <cite title="NONE">[core-api]</cite>.</p>
<div id="#rfc.figure.95"></div>
<p>In the example below, the application specification uses an undefined, hypothetical Data Pipeline extension:</p>
<pre>
  &lt;Content type="html" href="http://example.org"&gt;
    &lt;os:Var key="key1" value="abc" /&gt;
    &lt;osx:MyExtension key="key2" attr="val" /&gt;
  &lt;/Content&gt;
        </pre>
<div id="#rfc.figure.96"></div>
<p>The JSON generated for the HTTP POST would either omit <samp>key2</samp> entirely:</p>
<pre>
  POST / HTTP/1.1
  Host: example.org
  Content-Type: application/json
   
  {
    "key1" : "abc"
  }
        </pre>
<div id="#rfc.figure.97"></div>
<p>Or indicate that <samp>key2</samp> could not be resolved:</p>
<pre>
  POST / HTTP/1.1
  Host: example.org
  Content-Type: application/json
   
  {
    "key1" : "abc",
    "key2" : {
      "error: {
        "message": "Not Found",
        "code": 404
      }
    }
  }
        </pre>
<h1 id="rfc.section.3.6.5">
<a href="#rfc.section.3.6.5">3.6.5.</a> The Data Pipeline Elements</h1>
<p id="rfc.section.3.6.5.p.1">This specification currently defines three Data Pipeline elements: </p>

<dl>
<dt>os:DataRequest</dt>
<dd style="margin-left: 8">Used to access social data provided by the container.</dd>
<dt>os:HttpRequest</dt>
<dd style="margin-left: 8">Used to access data provided by a remote endpoint.</dd>
<dt>os:Var</dt>
<dd style="margin-left: 8">Used to define static, literal variables.</dd>
</dl>

<p> </p>
<p id="rfc.section.3.6.5.p.2">The XML Namespace for each of the Data Pipeline elements is <samp>http://ns.opensocial.org/2008/markup</samp>.  By convention, this specification uses the namespace prefix "os:" for the Data Pipeline Namespace. Note, however, that the choice of prefix is arbitrary and not semantically equivalent.</p>
<p id="rfc.section.3.6.5.p.3">Implementations MAY define additional Data Pipeline elements that use an XML Namespace other than <samp>http://ns.opensocial.org/2008/markup</samp>.  Such extensions MUST contain a <samp>key</samp> attribute whose value specifies the name that will be used to associate that element's resolved value within the <samp>DataContext</samp>.  Containers are recommended to ignore any Data Pipeline elements they do not support or do not understand.</p>
<div id="#rfc.figure.98"></div>
<pre>
  namespace os = "http://ns.opensocial.org/2008/markup"
        
  BaseDataPipeline = {
    attribute key { text },
    undefinedAttribute*
  }
        </pre>
<h1 id="rfc.section.3.6.5.1">
<a href="#rfc.section.3.6.5.1">3.6.5.1.</a> <a href="#DataRequest" id="DataRequest">The &lt;os:DataRequest&gt; Element</a>
</h1>
<p id="rfc.section.3.6.5.1.p.1">The &lt;os:DataRequest&gt; element is used to access social data provided by the container. It is generally equivalent to the JavaScript API methods provided to the application by the container to access information such as the identity of the current Viewer, a particular users group of friends, an activity stream, and so forth.  the &lt;os:DataRequest&gt; element can only be used to access content and cannot be used to modify social data stored by the container.</p>
<div id="#rfc.figure.99"></div>
<pre>
  DataRequest = element os:DataRequest {
    BaseDataPipeline,
    attribute method { text }
  }
          </pre>
<p id="rfc.section.3.6.5.1.p.2">In addition to the <samp>key</samp> attribute required for all Data Pipeline elements, the &lt;os:DataRequest&gt; element MUST contain a <samp>method</samp> attribute whose value is an Operation Identifier as defined in <a href="#core-api">[core-api]</a>.  All additional attributes contained by the &lt;os:DataRequest&gt; are to be mapped directly to the identically named input parameters for the data retrieval operation specified by the <samp>method</samp>.</p>
<p id="rfc.section.3.6.5.1.p.3">Child elements or any additional content provided within the &lt;os:DataRequest&gt; element SHOULD be ignored.</p>
<p id="rfc.section.3.6.5.1.p.4">For example, the <samp>people.get</samp> Operation Identifier defined within <a href="#social-app">[social-app]</a> allows an Application to retrieve information about people known to the container.  It can, for instance, be used to retrieve basic profile details about an individual or retrieve a listing of associated profiles (e.g. a "friends" list).</p>
<div id="#rfc.figure.100"></div>
<p>When invoked using the JavaScript API to retrieve the listing of profiles associated with the application's current Viewer, the method is invoked as:</p>
<pre>
  var params = {"userId": "@viewer", "groupId": "@friends"};
  osapi.people.get(params).execute(callback);
  
  function callback(friends) { ... }
          </pre>
<div id="#rfc.figure.101"></div>
<p>The equivalent operation using the &lt;os:DataRequest&gt; element would be:</p>
<pre>
  &lt;os:DataRequest key="friends" method="people.get" userId="@viewer" groupId="@friends" /&gt;
          </pre>
<p id="rfc.section.3.6.5.1.p.5">Assuming the operation was processed successfully, the <samp>friends</samp> variable will be added to the <samp>DataContext</samp> with a value identical to that provided as input to the callback function in the previous JavaScript API.</p>
<h1 id="rfc.section.3.6.5.2">
<a href="#rfc.section.3.6.5.2">3.6.5.2.</a> <a href="#HttpRequest" id="HttpRequest">The &lt;os:HttpRequest&gt; Element</a>
</h1>
<p id="rfc.section.3.6.5.2.p.1">The &lt;os:HttpRequest&gt; element is used to access arbitrary content from a remote HTTP endpoint. It is generally equivalent to the <samp>osapi.http</samp> JavaScript API methods provided to the application by the container. Currently, only HTTP GET and POST methods are supported.</p>
<div id="#rfc.figure.102"></div>
<pre>
  HttpRequest = element os:HttpRequest {
    BaseDataPipeline,
    SignedFetch,
    attribute method { "get" | "post" },
    attribute href { IRI }
  }
          </pre>
<p id="rfc.section.3.6.5.2.p.2">In addition to the <samp>key</samp> attribute required for all Data Pipeline elements, the &lt;os:HttpRequest&gt; element MUST contain a <samp>method</samp> attribute whose value is either <samp>get</samp> or <samp>post</samp> indicating the HTTP request method to use for the request, and an <samp>href</samp> attribute whose value specifies a dereferenceable IRI to which the request will be sent. If not specified, the value of the <samp>method</samp> attribute will be assumed to be <samp>get</samp>.  All additional attributes contained by the &lt;os:HttpRequest&gt; are to be mapped directly to the identically named input parameters defined for corresponding <samp>osapi.http.get</samp> or <samp>osapi.http.post</samp> JavaScript APIs.</p>
<p id="rfc.section.3.6.5.2.p.3">Child elements or any additional content provided within the &lt;os:HttpRequest&gt; element SHOULD be ignored.</p>
<div id="#rfc.figure.103"></div>
<p>For example, the <samp>osapi.http.get</samp> operation can be used to retrieve content from a remote endpoint located at "http://example.org/foo":</p>
<pre>
  var params = {
    "href": "http://example.org/foo",
    "format":"json", 
    "authz":"signed"};
  osapi.http.get(params).execute(callback);
  
  function callback(results) { ... }
          </pre>
<div id="#rfc.figure.104"></div>
<p>The equivalent operation using the &lt;os:HttpRequest&gt; element would be:</p>
<pre>
  &lt;os:HttpRequest key="results" 
    href="http://example.org/foo" 
    format="json" authz="signed" /&gt;
          </pre>
<p id="rfc.section.3.6.5.2.p.4">Assuming the method identified was processed successfully, the "results" variable will be added to the <samp>DataContext</samp> with a value identical to that provided as input to the callback function in the previous JavaScript API.</p>
<p id="rfc.section.3.6.5.2.p.5">The exact structure of the value stored within the <samp>DataContext</samp> will depend on the type of response returned by the remote endpoint.  Currently, the only supported options are for the server to return JSON-formatted data, textual content (e.g. plain text or HTML) or an error response. Binary content is currently not supported.</p>
<div id="#rfc.figure.105"></div>
<p>If the server returns a JSON formatted response such as:</p>
<pre>
  HTTP/1.1 200 OK
  Content-Type: application/json
  
  { "data" : "xyz" }
          </pre>
<div id="#rfc.figure.106"></div>
<p>The value stored within the <samp>DataContext</samp> would be:</p>
<pre>
  {
    "result" : {
      "content" : {
        "data" : "xyz"
      },
      "status" : 200,
      "headers" : {
        "Content-Type" : [
          "application/json"
        ]
      }
    }
  }
          </pre>
<div id="#rfc.figure.107"></div>
<p>If the server turns textual content such as:</p>
<pre>
  HTTP/1.1 200 OK
  Content-Type: text/html
  
  &lt;html&gt;&lt;head&gt;...&lt;/head&gt;&lt;body&gt;Hello World&lt;/body&gt;&lt;/html&gt;
          </pre>
<div id="#rfc.figure.108"></div>
<p>The value stored within the <samp>DataContext</samp> would be:</p>
<pre>
  {
    "result" : {
      "content" : "&lt;html&gt;&lt;head&gt;...&lt;/head&gt;&lt;body&gt;Hello World&lt;/body&gt;&lt;/html&gt;",
      "result": 200,
      "headers" : {
        "Content-Type" : [
          "text/html"
        ]
      }
    }
  }
          </pre>
<div id="#rfc.figure.109"></div>
<p>If the server returns an error, or if the content returned by the server is neither text-based or valid JSON, the value stored by the <samp>DataContext</samp> will specify an <a href="#core-api">Error Object</a> <cite title="NONE">[core-api]</cite> with an appropriate value indicating the nature of the error. Within the value of the "error" property, the "data" property contains the content actually returned by the server, if any.</p>
<pre>
  {
    "error" : {
      "code" : 404,
      "message" : "Not Found",
      "data" : {
        "content" : "&lt;html&gt;&lt;body&gt;File not found&lt;/body&gt;&lt;/html&gt;",
        "headers" : {
          "Content-Type" : [
            "text/html"
          ]
        }
      }
    }
  }
          </pre>
<h1 id="rfc.section.3.6.5.3">
<a href="#rfc.section.3.6.5.3">3.6.5.3.</a> <a href="#Var" id="Var">The &lt;os:Var&gt; Element</a>
</h1>
<p id="rfc.section.3.6.5.3.p.1">The &lt;os:Var&gt; element is used to declare a string JSON object, or JavaScript array as a literal value or associate the results of evaluating an Expression Statement with a key.</p>
<div id="#rfc.figure.110"></div>
<pre>
  SimpleVar = element os:Var {
    BaseDataPipeline,
    value { text }
  }
  
  JsonVar = element os:Var {
    BaseDataPipeline,
    text
  }
  
  Var = SimpleVar | JsonVar
          </pre>
<p id="rfc.section.3.6.5.3.p.2">In addition to the <samp>key</samp> attribute required for all Data Pipeline elements, the &lt;os:Var&gt; element can either contain a <samp>value</samp> attribute or contain textual content.</p>
<div id="#rfc.figure.111"></div>
<p>The following &lt;os:Var&gt; examples are equivalent:</p>
<pre>
  &lt;os:Var key="key1" value="ABC" /&gt;
  
  &lt;os:Var key="key1"&gt;ABC&lt;/os:Var&gt;
          </pre>
<p id="rfc.section.3.6.5.3.p.3">When determining the value to store within the <samp>DataContext</samp>, the container will: </p>

<ul>
<li>First apply Variable Substitution to replace all Expression Language statements appearing within the value,</li>
<li>Then, attempt to parse the string as a JavaScript Array. For instance, if the value is "[1,2,3,4,5]", then a JavaScript Array containing the values 1, 2, 3, 4 and 5 will be created. If successfully parsed, the Array will be stored into the <samp>DataContext</samp> and processing will end.</li>
<li>If unable to parse as an Array, the container will attempt to parse the value as a JSON Object. If successfully parsed, the object will be stored into the <samp>DataContext</samp> and processing will end.</li>
<li>If the value is still unable to be parsed, it will be stored within the <samp>DataContext</samp> as a literal string value.</li>
</ul>

<p> </p>
<div id="#rfc.figure.112"></div>
<p>Given the example,</p>
<pre>
  &lt;os:Var key="key1"&gt;
    [{"data": ${1+1}}]
  &lt;os:Var&gt;
          </pre>
<div id="#rfc.figure.113"></div>
<p>The value stored within the <samp>DataContext</samp> will be a JavaScript array containing a JSON object with a single property "data" whose value is the result of processing the Expression Language statement "${1+1}":</p>
<pre>
  [
    { "data":2 }
  ]
          </pre>
<h1 id="rfc.section.3.6.5.4">
<a href="#rfc.section.3.6.5.4">3.6.5.4.</a> Expression Statements within Data Pipeline Attributes</h1>
<p id="rfc.section.3.6.5.4.p.1">The attributes used with the &lt;os:DataRequest&gt; and &lt;os:HttpRequest&gt; elements often require values that vary depending on a range of criteria including input parameters or the results returned by other Data Pipeline elements.</p>
<p id="rfc.section.3.6.5.4.p.2">For instance, when the application needs to display the next set of results from a paged-collection, the view parameters specifying the current page can be passed into the &lt;os:HttpRequest&gt; or &lt;os:DataRequest&gt; using Expression Language statements:</p>
<div id="#rfc.figure.114"></div>
<pre>
  &lt;os:DataRequest key="PagedFriends" method="people.get" 
    userId="@owner" groupId="@friends" 
    startIndex="${ViewParams.first}" 
    count="20"/&gt;
          </pre>
<p id="rfc.section.3.6.5.4.p.3">Likewise, the results of one Data Pipeline element can be passed as attribute values in another. For instance, we can reference the stored value for the "PagedFriends" key generated by processing the previous example within an &lt;os:HttpRequest&gt;:</p>
<div id="#rfc.figure.115"></div>
<pre>
  &lt;os:HttpRequest href="http://example.com/api?ids=${PagedFriends.ids}"/&gt;
          </pre>
<p id="rfc.section.3.6.5.4.p.4">When referencing the results of other Data Pipeline elements in this way, Expression Language statements can access the input parameters and additional metadata about the referenced results by using the special reserved <samp>Request</samp> property on the referenced key, e.g.  <samp>${PagedFriends.Request.userId}</samp>.</p>
<p id="rfc.section.3.6.5.4.p.5">The metadata properties provided by the <samp>Request</samp> property include: </p>

<ul>
<li>All of the attributes defined on the referenced Data Pipeline element (in the previous example, these would include "key", "method", "userId", "groupId", "startIndex", and "count"), </li>
<li>The properties "totalResults", "count" and "startIndex" if the value stored by referenced key is a Collection object as defined by <a href="#core-api">[core-api]</a>; the values of which map to the corresponding values of the stored collection.</li>
</ul>

<p> </p>
<p id="rfc.section.3.6.5.4.p.6">These properties are determined dynamically by the container and can be used within any Expression Language statement:</p>
<div id="#rfc.figure.116"></div>
<pre>
  &lt;os:DataRequest key="Page1" method="people.get"
    userId="@owner" groupId="@friends"
    startIndex="${ViewParams.first}" count="20"/&gt;

  &lt;os:DataRequest key="Page2" method="people.get" 
    userId="${Page1.Request.userId}" groupId="@friends"
    startIndex="${Page1.Request.startIndex + Page1.Request.count}"
    count="${Page1.Request.count}"/&gt;          
          </pre>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Container-Provided Features</h1>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Core Features</h1>
<p id="rfc.section.4.1.p.1">Core Features are provided automatically by the container for all application instances without requiring the application to declare them using either the &lt;Require&gt; or &lt;Optional&gt; element in the &lt;ModulePrefs&gt;</p>
<h1 id="rfc.section.4.1.1">
<a href="#rfc.section.4.1.1">4.1.1.</a> <a href="#gadgets.log" id="gadgets.log">The Logging Feature</a>
</h1>
<p id="rfc.section.4.1.1.p.1">The Logging Feature provides a basic mechanism to log messages for debugging and informational purposes. The "Log" to which such messages are recorded is container specific.  Whether and how each container chooses to provide access to the collection of recorded messages is considered beyond the scope of this specification.</p>
<h1 id="rfc.section.4.1.1.1">
<a href="#rfc.section.4.1.1.1">4.1.1.1.</a> JavaScript API</h1>
<p id="rfc.section.4.1.1.1.p.1">The Logging Feature provides the following JavaScript API methods and constants to developers:</p>
<h1 id="rfc.section.4.1.1.1.1">
<a href="#rfc.section.4.1.1.1.1">4.1.1.1.1.</a> gadgets.log</h1>
<p id="rfc.section.4.1.1.1.1.p.1">The <samp>gadgets.log</samp> method is used to record an informational message to the container provided Log.</p>
<div id="#rfc.figure.117"></div>
<pre>
  &lt;static&gt; &lt;Void&gt; gadgets.log(message)
           </pre>
<p id="rfc.section.4.1.1.1.1.p.2">The method takes a single input parameter that can be any valid JSON-serializable Object. No return value is specified.</p>
<div id="#rfc.figure.118"></div>
<p>For example:</p>
<pre>
  gadgets.log("This is a message");
  
  gadgets.log(
    {"code":123, "data": "This is a message"}
  );
           </pre>
<h1 id="rfc.section.4.1.1.1.2">
<a href="#rfc.section.4.1.1.1.2">4.1.1.1.2.</a> <a href="#gadgets.warn" id="gadgets.warn">gadgets.warn</a>
</h1>
<p id="rfc.section.4.1.1.1.2.p.1">The <samp>gadgets.warn</samp> method is used to record a warning message to the container provided Log.</p>
<div id="#rfc.figure.119"></div>
<pre>
  &lt;static&gt; &lt;Void&gt; gadgets.warn(message)
           </pre>
<p id="rfc.section.4.1.1.1.2.p.2">The method takes a single input parameter that can be any valid JSON-serializable Object. No return value is specified.</p>
<div id="#rfc.figure.120"></div>
<p>For example:</p>
<pre>
  gadgets.warn("This is a warning!");
  
  gadgets.log(
    {"code":123, "data": "This is a warning!"}
  );
           </pre>
<h1 id="rfc.section.4.1.1.1.3">
<a href="#rfc.section.4.1.1.1.3">4.1.1.1.3.</a> <a href="#gadgets.error" id="gadgets.error">gadgets.error</a>
</h1>
<p id="rfc.section.4.1.1.1.3.p.1">The <samp>gadgets.error</samp> method is used to record an error message to the container provided Log.</p>
<div id="#rfc.figure.121"></div>
<pre>
  &lt;static&gt; &lt;Void&gt; gadgets.error(message)
           </pre>
<p id="rfc.section.4.1.1.1.3.p.2">The method takes a single input parameter that can be any valid JSON-serializable object. No return value is specified.</p>
<div id="#rfc.figure.122"></div>
<p>For example:</p>
<pre>
  gadgets.error("This is an error");
  
  gadgets.error(
    {"code":123, "data": "This is an error"}
  );
           </pre>
<h1 id="rfc.section.4.1.1.1.4">
<a href="#rfc.section.4.1.1.1.4">4.1.1.1.4.</a> <a href="#gadgets.setLogLevel" id="gadgets.setLogLevel">gadgets.setLogLevel</a>
</h1>
<p id="rfc.section.4.1.1.1.4.p.1">The <samp>gadgets.setLogLevel</samp> method establishes the minimum log level threshold at which containers SHOULD record messages sent to the Log.</p>
<div id="#rfc.figure.123"></div>
<pre>
  &lt;static&gt; &lt;Void&gt; gadgets.setLogLevel(logLevel)
           </pre>
<p id="rfc.section.4.1.1.1.4.p.2">The method takes a single parameter whose value is a non-negative integer indicating the log level as defined below. No return value is specified.</p>
<p id="rfc.section.4.1.1.1.4.p.3">The acceptable values for the logLevel input parameter are as follows. For convenience, a corresponding alias for each value is also defined and MAY be used in place of the literal numeric value:</p>
<div id="#rfc.table.7"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Value</th>
<th class="left">Alias</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left"><samp>1</samp></td>
<td class="left"><samp>gadgets.log.INFO</samp></td>
<td class="left">Specifies that the container provided Log SHOULD record all informational, warning and error messages.</td>
</tr>
<tr>
<td class="left"><samp>2</samp></td>
<td class="left"><samp>gadgets.log.WARN</samp></td>
<td class="left">Specifies that the container provided Log SHOULD record all warning and error messages but ignore informational messages.</td>
</tr>
<tr>
<td class="left"><samp>3</samp></td>
<td class="left"><samp>gadgets.log.ERROR</samp></td>
<td class="left">Specifies that the container provided Log SHOULD record all error messages but ignore informational and error messages.</td>
</tr>
<tr>
<td class="left"><samp>4</samp></td>
<td class="left"><samp>gadgets.log.NONE</samp></td>
<td class="left">Specifies that the container provided Log SHOULD ignore all messages.</td>
</tr>
</tbody>
</table>
<div id="#rfc.figure.124"></div>
<p>For example, to record all messages:</p>
<pre>
  gadgets.setLogLevel(1);
  // or
  gadgets.setLogLevel(gadgets.log.INFO);
           </pre>
<div id="#rfc.figure.125"></div>
<p>Or to record only error messages:</p>
<pre>
  gadgets.setLogLevel(3);
  // or
  gadgets.setLogLevel(gadgets.log.ERROR);
           </pre>
<h1 id="rfc.section.4.1.2">
<a href="#rfc.section.4.1.2">4.1.2.</a> The IO Feature</h1>
<p id="rfc.section.4.1.2.p.1">The IO Feature provides a mechanism for retrieving external content provided either by the container or other remote endpoints.</p>
<p id="rfc.section.4.1.2.p.2">The IO Feature is automatically enabled for all applications.</p>
<h1 id="rfc.section.4.1.2.1">
<a href="#rfc.section.4.1.2.1">4.1.2.1.</a> JavaScript API</h1>
<p id="rfc.section.4.1.2.1.p.1">The IO Feature provides the following JavaScript API methods and constants to developers:</p>
<h1 id="rfc.section.4.1.2.1.1">
<a href="#rfc.section.4.1.2.1.1">4.1.2.1.1.</a> <a href="#gadgets.io.encodeValues" id="gadgets.io.encodeValues">gadgets.io.encodeValues</a>
</h1>
<p id="rfc.section.4.1.2.1.1.p.1">The <samp>gadgets.io.encodeValues</samp> method converts an input JavaScript object into a URL-encoded string as defined by Section 2.1 of <a href="#RFC3986">[RFC3986]</a>.</p>
<div id="#rfc.figure.126"></div>
<pre>
  &lt;static&gt; &lt;String&gt; gadgets.io.encodeValues(object)
             </pre>
<p id="rfc.section.4.1.2.1.1.p.2">The method takes as input a single JavaScript object whose property names and values will be enumerated and converted into a proper URL-formatted String that is returned to the caller. The resulting String will be constructed such that each property and value pair is separated by an ampersand (&amp;) character.</p>
<div id="#rfc.figure.127"></div>
<p>For example, given the following object:</p>
<pre>
  var data = {
    "foo" : "bar",
    "abc" : 123,
    "zyx" : true,
    "baz" : ["a","b","c"]
  }
             </pre>
<div id="#rfc.figure.128"></div>
<p>Calling <samp>gadgets.io.encodeValues(data)</samp> would generate the output:</p>
<pre>
  foo=bar&amp;abc=123&amp;zyx=true&amp;baz=a,b,c
             </pre>
<p id="rfc.section.4.1.2.1.1.p.3">If the value of top-level property or member of an Array is any value other than a JavaScript primitive, it's value will be encoded as a JSON-serialized String as returned by the <samp>gadgets.json.stringify</samp> method.</p>
<div id="#rfc.figure.129"></div>
<p>For instance, given the following input:</p>
<pre>
  var data = {
    "foo" : {
      "a" : "b",
      "c" : "d"
    },
    "bar" : [
      { "xyz" : "123" },
      { "abc" : 321 }
    ]
  }
             </pre>
<div id="#rfc.figure.130"></div>
<p>Calling <samp>gadgets.io.encodeValues(data)</samp> would generate the output:</p>
<pre>
  foo=%7B%22a%22%3A%22b%22%2C%22c%22%3A%22d%22%7D&amp;bar=%7B%22xyz%22%3A%22123%22%7D,%7B%22abc%22%3A321%7D
             </pre>
<h1 id="rfc.section.4.1.2.1.2">
<a href="#rfc.section.4.1.2.1.2">4.1.2.1.2.</a> <a href="#gadgets.io.getProxyUrl" id="gadgets.io.getProxyUrl">gadgets.io.getProxyUrl</a>
</h1>
<p id="rfc.section.4.1.2.1.2.p.1">When an application needs to load data from an external source -- for instance, an image or script resource -- it can either choose to access that content directly or proxy the request for the content through the container. In the latter case, the <samp>gadgets.io.getProxyUrl</samp> can be used to ask the container to generate a "Proxy URL" for the remote resource that the application would use in place of the resource's own direct URL.</p>
<div id="#rfc.figure.131"></div>
<pre>
  &lt;static&gt; &lt;String&gt; gadgets.io.getProxyUrl(url, opt_params)
             </pre>
<p id="rfc.section.4.1.2.1.2.p.2">The method accepts as input the remote URL for which the Proxy URL is to be generated and an optional collection of additional properties the container will use when generating the returned Proxy URL.</p>
<p id="rfc.section.4.1.2.1.2.p.3">The following table lists the additional properties currently defined by this specification. For convenience, an alias is defined for each that MAY be used in place of the literal property name in JavaScript code:</p>
<div id="#rfc.table.8"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Name</th>
<th class="left">Alias</th>
<th class="left">Description</th>
</tr></thead>
<tbody><tr>
<td class="left">REFRESH_INTERVAL</td>
<td class="left">gadgets.io.ProxyUrlRequestParameters.REFRESH_INTERVAL</td>
<td class="left">Explicitly sets the numer of seconds content will be cached by the container as described in <a href="#caching">Section 3.2</a>.</td>
</tr></tbody>
</table>
<p id="rfc.section.4.1.2.1.2.p.4">Containers are free to accept additional optional parameters, however the definition and use of such parameters are undefined by this specification.</p>
<div id="#rfc.figure.132"></div>
<p>The following example creates a Proxy URL for a remote image file and sets a cache timeout of one hour. The proxy URL is then used within the src attribute of an HTML image tag.  When the image tag is rendered, a request will be sent to the Proxy URL causing the container to fetch the image from the remote source and cache it locally.</p>
<pre>
  &lt;?xml version="1.0" encoding="UTF-8" ?&gt;
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      &lt;Require feature="osapi" /&gt;
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;&lt;![CDATA[
      ...
      &lt;script&gt;
        function fetchImage() {
          var imgsrc = "http://example.org/avatars/bob.png"; 
          var img = document.createElement("img");
          img.src = gadgets.io.getProxyUrl(imgsrc);
          ...
        }
        gadgets.util.registerOnLoadHandler(fetchImage);
      &lt;/script&gt;
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
             </pre>
<h1 id="rfc.section.4.1.2.1.3">
<a href="#rfc.section.4.1.2.1.3">4.1.2.1.3.</a> <a href="#gadgets.io.makeRequest" id="gadgets.io.makeRequest">gadgets.io.makeRequest</a>
</h1>
<p id="rfc.section.4.1.2.1.3.p.1">The <samp>gadgets.io.makeRequest</samp> method is used to send HTTP requests to a provided URL and pass the returned content to a callback function.</p>
<div id="#rfc.figure.133"></div>
<pre>
  &lt;static&gt; &lt;Void&gt; gadgets.io.makeRequest(url, callback, opt_params)
             </pre>
<p id="rfc.section.4.1.2.1.3.p.2">The method takes as input a single URL to which requests will be sent, a reference to a callback function that the container will invoke when the request has completed, and an object containing an optional collection of additional parameters. No return value is specified for the method.</p>
<div id="#rfc.figure.134"></div>
<p>In the following example, a simple HTTP GET request is sent to a remote endpoint with no additional request parameters:</p>
<pre>
  gadgets.io.makeRequest(
    "http://example.org/foo",
    function(response) {
      // handle the response
    }
  );       
             </pre>
<p id="rfc.section.4.1.2.1.3.p.3">The following table lists the additional properties currently defined by this specification. For convenience, an alias is defined for each that MAY be used in place of the literal property name in JavaScript code:</p>
<div id="#rfc.table.9"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Name</th>
<th class="left">Alias</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left"><samp>ALIAS</samp></td>
<td class="left"><samp>gadgets.io.RequestParameters.ALIAS</samp></td>
<td class="left">When a specification document uses the &lt;ExternalService&gt; element to define an alias for a Container-managed external service, the optional <samp>ALIAS</samp> parameter can be used in place of the <samp>gadgets.io.makeRequest</samp> methods <samp>url</samp> parameter to identify the external service to which the request is to be directed. If unspecified, the default value for this parameter is assumed to be null.</td>
</tr>
<tr>
<td class="left"><samp>AUTHORIZATION</samp></td>
<td class="left"><samp>gadgets.io.RequestParameters.AUTHORIZATION</samp></td>
<td class="left">Specifies the authorization method to use. Valid values are: <samp>none</samp>, <samp>signed</samp>, <samp>oauth</samp> and <samp>oauth2</samp>.  For convenience, aliases for each of these values have been provided for use in JavaScript code. These aliases are: <samp>gadgets.io.AuthorizationType.NONE</samp>, <samp>gadgets.io.AuthorizationType.SIGNED</samp>, <samp>gadgets.io.AuthorizationType.OAUTH</samp> and <samp>gadgets.ioAuthorizationType.OAUTH2</samp>.  If not specified, the default value for this parameter is assumed to be <samp>none</samp>.</td>
</tr>
<tr>
<td class="left"><samp>CONTENT_TYPE</samp></td>
<td class="left"><samp>gadgets.io.RequestParameters.CONTENT_TYPE</samp></td>
<td class="left">The value of the <samp>CONTENT_TYPE</samp> parameter serves as a hint to the container as to what kind of content the request is expected to return so that the container can perform any appropriate additional processing necessary on the response. Valid values are: <samp>DOM</samp>, <samp>FEED</samp>, <samp>JSON</samp> and <samp>TEXT</samp>. For convenience, aliases for each of these values have been provided for use in JavaScript code. These aliases are: <samp>gadgets.io.ContentType.DOM</samp>, <samp>gadgets.io.ContentType.FEED</samp>, <samp>gadgets.io.ContentType.JSON</samp> and <samp>gadgets.io.ContentType.TEXT</samp>.  If not specified, the default value for this is assumed to be <samp>TEXT</samp>, indicating that no specific content-type is to be assumed.</td>
</tr>
<tr>
<td class="left"><samp>GET_FULL_HEADERS</samp></td>
<td class="left"><samp>gadgets.io.RequestParameters.GET_FULL_HEADERS</samp></td>
<td class="left">The value of the <samp>GET_FULL_HEADERS</samp> parameter is a boolean. If true, the response object passed to the callback function will contain the complete collection of Headers and their associated values as returned in the HTTP response. If unspecified, the default value is assumed to be False, in which case the container will determine which collection of headers to pass to the callback function.</td>
</tr>
<tr>
<td class="left"><samp>GET_SUMMARIES</samp></td>
<td class="left"><samp>gadgets.io.RequestParameters.GET_SUMMARIES</samp></td>
<td class="left">When the <samp>CONTENT_TYPE</samp> parmameter equals the value <samp>feed</samp>, the <samp>GET_SUMMARIES</samp> parameter specifies a boolean that when set to True, instructs the container to pass only summarized versions of the retrieved items in the feed to the callback function. It is the containers responsibility to determine what constitutes a the summarized version of the item. If not specified, the default value for this parameter is assumed to be False.</td>
</tr>
<tr>
<td class="left"><samp>HEADERS</samp></td>
<td class="left"><samp>gadgets.io.RequestParameters.HEADERS</samp></td>
<td class="left">Specifies the collection of HTTP Request Headers the container SHOULD include in the request. The value is specifies as an associative map using the header names as a key and a literal String value. For example, to include <samp>Accept-Language</samp> and <samp>X-Custom</samp> headers in the request, the value of the <samp>HEADERS</samp> property would be set to <samp>{"Accept-Language":"de-DE", "X-Custom":"abc"}</samp>.</td>
</tr>
<tr>
<td class="left"><samp>METHOD</samp></td>
<td class="left"><samp>gadgets.io.RequestParameters.METHOD</samp></td>
<td class="left">Specifies the HTTP method that MUST be used for the request.  Valid values are <samp>DELETE</samp>, <samp>GET</samp>, <samp>HEAD</samp>, <samp>PATCH</samp>, <samp>POST</samp> and <samp>PUT</samp>. For convenience, aliases for each of these values have been provided for use in JavaScript code. The aliases are: <samp>gadgets.io.MethodType.DELETE</samp>, <samp>gadgets.io.MethodType.GET</samp>, <samp>gadgets.io.MethodType.HEAD</samp>, <samp>gadgets.io.MethodType.PATCH</samp>, <samp>gadgets.io.MethodType.POST</samp> and <samp>gadgets.io.MethodType.PUT</samp>.  If not specified, the default value is assumed to be <samp>GET</samp>.</td>
</tr>
<tr>
<td class="left"><samp>NUM_ENTRIES</samp></td>
<td class="left"><samp>gadgets.io.RequestParameters.NUM_ENTRIES</samp></td>
<td class="left">When the <samp>CONTENT_TYPE</samp> parameter equals the value <samp>feed</samp>, the <samp>NUM_ENTRIES</samp> parameter specifies the maximum number of items from the feed to return to the callback function. If not specified, the default value for this parameter is assumed to be <samp>3</samp>.</td>
</tr>
<tr>
<td class="left"><samp>OAUTH_RECEIVED_CALLBACK</samp></td>
<td class="left"><samp>gadgets.io.RequestParameters.OAUTH_RECEIVED_CALLBACK</samp></td>
<td class="left">When the container sends a request to an OAuth service provider asking for permission to access a given resource, it will, by default, specify a default container-specific callback URI that the OAuth service provider will use to redirect control back to the container and deliver the requested access token. In certain cases, a specific application instance might need to override the default callback URI.  The <samp>OAUTH_RECEIVED_CALLBACK</samp> parameter can be used to specify an alternative absolute URI reference.</td>
</tr>
<tr>
<td class="left"><samp>OAUTH_REQUEST_TOKEN</samp></td>
<td class="left"><samp>gadgets.io.RequestParameters.OAUTH_REQUEST_TOKEN</samp></td>
<td class="left">When the <samp>AUTHORIZATION</samp> parameter is equal to either <samp>OAUTH</samp> or <samp>OAUTH2</samp>, the <samp>OAUTH_REQUEST_TOKEN</samp> parameter can be used to specified a pre-authorized OAuth Request Token for use in the request. If the container does not already have an OAuth Access Token suitable for use with the request, the container SHOULD use the supplied Request Token to request and acquire a new Access Token. If not specified, the default value is assumed to be null.</td>
</tr>
<tr>
<td class="left"><samp>OAUTH_REQUEST_TOKEN_SECRET</samp></td>
<td class="left"><samp>gadgets.io.RequestParameters.OAUTH_REQUEST_TOKEN_SECRET</samp></td>
<td class="left">When the <samp>OAUTH_REQUEST_TOKEN</samp> parameter is specified, the <samp>OAUTH_REQUEST_TOKEN_SECRET</samp> parameter can be used to supply an associated Request Token Secret. If not specified, the default value is assumed to be null.</td>
</tr>
<tr>
<td class="left"><samp>OAUTH_SERVICE_NAME</samp></td>
<td class="left"><samp>gadgets.io.RequestParameters.OAUTH_SERVICE_NAME</samp></td>
<td class="left">When the <samp>AUTHORIZATION</samp> parameter is equal to either <samp>OAUTH</samp> or <samp>OAUTH2</samp>, and the specification document uses the &lt;OAuth&gt; or &lt;OAuth2&gt; elements within the &lt;ModulePrefs&gt; to define associated OAuth services, the <samp>OAUTH_SERVICE_NAME</samp> parameter specifies the name of the &lt;Service&gt; element that provides the OAuth Service details to use for the request.  When not specified, the default value is assumed to be an empty string (e.g. "").</td>
</tr>
<tr>
<td class="left"><samp>OAUTH2_SCOPE</samp></td>
<td class="left"><samp>gadgets.io.RequestParameters.OAUTH2_SCOPE</samp></td>
<td class="left">When the <samp>AUTHORIZATION</samp> parameter is equal to <samp>OAUTH2</samp>, the <samp>OAUTH2_SCOPE</samp> parameter specifies the value of the OAuth 2.0 scope parameter the container SHOULD use with the request. The scope parameter is defined in <a href="#I-D.ietf-oauth-v2">[I-D.ietf-oauth-v2]</a>. If not specified, the default value is assumed to be null, indicating that no scope parameter is to be provided.</td>
</tr>
<tr>
<td class="left"><samp>OAUTH_TOKEN_NAME</samp></td>
<td class="left"><samp>gadgets.io.RequestParameters.OAUTH_TOKEN_NAME</samp></td>
<td class="left">When the <samp>AUTHORIZATION</samp> parameter is equal to either <samp>OAUTH</samp> or <samp>OAUTH2</samp>, the application MAY use the <samp>OAUTH_TOKEN_NAME</samp> to specify an alias for the OAuth Access Token used for the request. If the container does not yet have an appropriate Access Token to use with the request, it will follow the appropriate steps to acquire one and cache it using the specified <samp>OAUTH_TOKEN_NAME</samp> value. On subsequent requests, the specified <samp>OAUTH_TOKEN_NAME</samp> will be used to locate and use the cached Access Token. If not specified, the default value is assumed to be an empty string (e.g. "").</td>
</tr>
<tr>
<td class="left"><samp>OAUTH_USE_TOKEN</samp></td>
<td class="left"><samp>gadgets.io.RequestParameters.OAUTH_USE_TOKEN</samp></td>
<td class="left">When the <samp>AUTHORIZATION</samp> parameter is equal to either <samp>OAUTH</samp> or <samp>OAUTH2</samp>, the container is typically required to acquire an appropriate OAuth Access Token prior to sending the request to the URL. The <samp>OAUTH_USE_TOKEN</samp> parameter can be used to modify this default behavior. Valid values are: <samp>never</samp>, <samp>if_available</samp> and <samp>always</samp>.  If not specified, the default value is assumed to be <samp>always</samp>. When <samp>OAUTH_USE_TOKEN</samp> is equal to <samp>never</samp>, the container SHOULD NOT attempt to acquire an Access Token for the request but SHOULD send the request to the URL just as it would any other request using with OAuth 1.0a or OAuth 2.0 protocols.  When <samp>OAUTH_USE_TOKEN</samp> is equal to <samp>if_available</samp>, the container SHOULD include the Access Token in the request only if an appropriate token is available. If an Access Token is not available, the request SHOULD be sent to the URL without the Access Token. When <samp>OAUTH_USE_TOKEN</samp> is equal to <samp>always</samp>, the container is required to acquire an Access Token prior to sending the request and MUST include that token in the request sent to the URL.</td>
</tr>
<tr>
<td class="left"><samp>POST_DATA</samp></td>
<td class="left"><samp>gadgets.io.RequestParameters.POST_DATA</samp></td>
<td class="left">When the <samp>METHOD</samp> parameter equals either <samp>POST</samp>, <samp>PATCH</samp>, or <samp>PUT</samp>, the <samp>POST_DATA</samp> parameter specifies the data that is to be included as the payload of the request. The value is specified as a String. If not specified, the value defaults to null, indicating that no payload is to be sent.</td>
</tr>
<tr>
<td class="left"><samp>REFRESH_INTERVAL</samp></td>
<td class="left"><samp>gadgets.io.RequestParameters.REFRESH_INTERVAL</samp></td>
<td class="left">Explicitly sets the numer of seconds content will be cached by the container as specified by <a href="#caching">Section 3.2</a>.</td>
</tr>
<tr>
<td class="left"><samp>SIGN_OWNER</samp></td>
<td class="left"><samp>gadgets.io.RequestParameters.SIGN_OWNER</samp></td>
<td class="left">When the <samp>AUTHORIZATION</samp> parameter equals either <samp>SIGNED</samp> or <samp>OAUTH</samp>, the <samp>SIGN_OWNER</samp> parameter indicates whether the container SHOULD include the identity of the <a href="#Application-Roles">Instance Owner</a> <cite title="NONE">[Application-Roles]</cite> when signing the request as described in <a href="#authentication">Section 3.1</a>.  The value is specified as a Boolean. When not specified, the default value is assumed to be False.</td>
</tr>
<tr>
<td class="left"><samp>SIGN_VIEWER</samp></td>
<td class="left"><samp>gadgets.io.RequestParameters.SIGN_VIEWER</samp></td>
<td class="left">When the <samp>AUTHORIZATION</samp> parameter equals either <samp>SIGNED</samp> or <samp>OAUTH</samp>, the <samp>SIGN_VIEWER</samp> parameter indicates whether the container SHOULD include the identity of the current Viewer when signing the request as described in <a href="#authentication">Section 3.1</a>. The value is specified as a Boolean. When not specified, the default value is assumed to be False.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.1.2.1.3.p.4">Containers are free to accept additional optional parameters, however the definition and use of such parameters are undefined by this specification.</p>
<h1 id="rfc.section.4.1.2.1.3.1">
<a href="#rfc.section.4.1.2.1.3.1">4.1.2.1.3.1.</a> The callback parameter and the Response Object</h1>
<p id="rfc.section.4.1.2.1.3.1.p.1">When the container finished processing the request, the response data is returned to the application by passing a Response Object as a parameter to the provided callback function.</p>
<p id="rfc.section.4.1.2.1.3.1.p.2">The properties of the Response object passed to the callback function are:</p>
<div id="#rfc.table.10"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left"><samp>data</samp></td>
<td class="left">(varies)</td>
<td class="left">Provides the parsed data of the response, if applicable.  The value type will vary depending on the value of the <samp>CONTENT_TYPE</samp> parameter specified for the request. If <samp>CONTENT_TYPE</samp> was not specified, then the value <samp>TEXT</samp> is assumed to have been used. When <samp>CONTENT_TYPE</samp> equals <samp>DOM</samp>, the value is an HTML DOM object. When <samp>CONTENT_TYPE</samp> equals <samp>FEED</samp>, the value is a JSON representation of an RSS or or Atom Document as specified by [TODO: Feed Object Reference]. When <samp>CONTENT_TYPE</samp> equals <samp>JSON</samp>, the value is a JSON Object. When <samp>CONTENT_TYPE</samp> is text, or if the response could not be parsed by the container, the value is a String containing the unparsed content of the response payload.</td>
</tr>
<tr>
<td class="left"><samp>errors</samp></td>
<td class="left">Array of Error Objects</td>
<td class="left">Provides a listing of any errors that occurred during the processing of the request. TODO: Need more detail on this.</td>
</tr>
<tr>
<td class="left"><samp>headers</samp></td>
<td class="left">Headers Object</td>
<td class="left">An object containing the response headers. Header names are used as the keys for this object. TODO: Need more detail on this.</td>
</tr>
<tr>
<td class="left"><samp>rc</samp></td>
<td class="left">Number</td>
<td class="left">Provides a numeric value representing the HTTP status code of the response.</td>
</tr>
<tr>
<td class="left"><samp>text</samp></td>
<td class="left">String</td>
<td class="left">Provides a String containing the unparsed content of the response payload.</td>
</tr>
<tr>
<td class="left"><samp>oauthApprovalUrl</samp></td>
<td class="left">String</td>
<td class="left">When either the OAuth 1.0a or OAuth 2.0 protocols are used to secure a request and the container requires an appropriate Access Token to be acquired in order to continue, the container will abort the request and invoke the callback function, passing in a Response object with the <samp>oauthApprovalUrl</samp> property set. The value is a String providing the URL of an external page provided by the OAuth Service Provider to allow the user to approve the request. Use of the OAuth Popup Feature as defined by <a href="#gadgets.oauth.Popup">Section 4.2.8</a> is recommended. Once approval has been acquired, the call to <samp>gadgets.io.makeRequest</samp> needs to be repeated in order to complete the request.</td>
</tr>
<tr>
<td class="left"><samp>oauthError</samp></td>
<td class="left">String</td>
<td class="left">When either the OAuth 1.0a or OAuth 2.0 protocols are used to secure a request and an OAuth related error occurs at anytime during the processing of the request, the container will abort the request and invoke the callback function, passing in a Response object with the <samp>oauthError</samp> property set. The value will be one of a set of OAuth-specific String constants that identify the error that has occurred.</td>
</tr>
<tr>
<td class="left">oauthErrorText</td>
<td class="left">String</td>
<td class="left">When the Response Object is used to communicate information about an OAuth-related error and the <samp>oauthError</samp> property is set, the <samp>oauthErrorText</samp> property MAY be used by the container to provide a human-readable description of the error for debugging or informational purposes.</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.4.1.3">
<a href="#rfc.section.4.1.3">4.1.3.</a> <a href="#gadgets.json" id="gadgets.json">The JSON Feature</a>
</h1>
<p id="rfc.section.4.1.3.p.1">The JSON Feature provides operations for serializing objects to and from a JSON-formatted String.</p>
<h1 id="rfc.section.4.1.3.1">
<a href="#rfc.section.4.1.3.1">4.1.3.1.</a> JavaScript API</h1>
<p id="rfc.section.4.1.3.1.p.1">The JSON Feature provides the following JavaScript API methods to developers:</p>
<h1 id="rfc.section.4.1.3.1.1">
<a href="#rfc.section.4.1.3.1.1">4.1.3.1.1.</a> <a href="#gadgets.json.parse" id="gadgets.json.parse">gadgets.json.parse</a>
</h1>
<p id="rfc.section.4.1.3.1.1.p.1">The <samp>gadgets.json.parse</samp> method parses a JSON-formatted String and returns the corresponding JavaScript object value.</p>
<div id="#rfc.figure.135"></div>
<pre>
  &lt;static&gt; &lt;Object&gt; gadgets.json.parse(text)
            </pre>
<h1 id="rfc.section.4.1.3.1.2">
<a href="#rfc.section.4.1.3.1.2">4.1.3.1.2.</a> <a href="#gadgets.json.stringify" id="gadgets.json.stringify">gadgets.json.stringify</a>
</h1>
<p id="rfc.section.4.1.3.1.2.p.1">The <samp>gadgets.json.stringify</samp> method serializes a JavaScript value into a JSON-formatted string.</p>
<div id="#rfc.figure.136"></div>
<pre>
  &lt;static&gt; &lt;String&gt; gadgets.json.stringify(object)
            </pre>
<p id="rfc.section.4.1.3.1.2.p.2">The object takes as input any valid JavaScript object and returns an equivalent JSON object. If the value of a property is a reference to another object, the reference object will also be serialized.  Properties whose values are references to Function objects will be ignored and omitted from the resulting JSON-serialization.</p>
<div id="#rfc.figure.137"></div>
<p>For instance, the following example:</p>
<pre>
  var l = {"z":"y"};
  var data = {
    "a" : "a",
    "b" : [1,2,3],
    "c" : l,
    "d" : new Date(),
    "e" : [],
    "f" : {},
    "g" : null
  }
  var output = gadgets.json.stringify(data);
            </pre>
<div id="#rfc.figure.138"></div>
<p>Would yield the following as the value for the output variable:</p>
<pre>
  {"a":"a","b":[1,2,3],"c":{"z":"y"},"d":"2012-03-28T23:16:50.560Z","e":[],"f":{},"g":null}        
            </pre>
<h1 id="rfc.section.4.1.4">
<a href="#rfc.section.4.1.4">4.1.4.</a> <a href="#gadgets.Prefs" id="gadgets.Prefs">The User Preferences Feature</a>
</h1>
<p id="rfc.section.4.1.4.p.1">The User Preferences Feature provides access to user preferences, preferred rendering dimensions and the localized collection of messages selected by the container for a view currently being rendered by the container.</p>
<p id="rfc.section.4.1.4.p.2">The User Preferences Feature is automatically enabled for all applications.</p>
<h1 id="rfc.section.4.1.4.1">
<a href="#rfc.section.4.1.4.1">4.1.4.1.</a> JavaScript API</h1>
<p id="rfc.section.4.1.4.1.p.1">The User Preferences Feature provides the following JavaScript API objects and methods to developers:</p>
<h1 id="rfc.section.4.1.4.1.1">
<a href="#rfc.section.4.1.4.1.1">4.1.4.1.1.</a> <a href="#gadgets.Prefs.ctor" id="gadgets.Prefs.ctor">The gadgets.Prefs Object</a>
</h1>
<p id="rfc.section.4.1.4.1.1.p.1">Instances of the <samp>gadgets.Prefs</samp> Object provide access to the user preferences, preferred rendering dimensions and localized collection of messages selected by the container for a specific application instance.</p>
<p id="rfc.section.4.1.4.1.1.p.2">Instances of the object are created using the JavaScript new keyword. The specific identity of a specific application instance MAY be passed in as an optional parameter.</p>
<div id="#rfc.figure.139"></div>
<p>In the example below, a <samp>gadgets.Prefs</samp> object is created to access the current Viewer's preferred language and the stored value of the "name" user preference:</p>
<pre>
  var prefs = new gadgets.Prefs();
  var name = prefs.getString("name");
  var lang = prefs.getLang();
             </pre>
<p id="rfc.section.4.1.4.1.1.p.3">The <samp>gadgets.Prefs</samp> object provides the following collection of methods:</p>
<h1 id="rfc.section.4.1.4.1.1.1">
<a href="#rfc.section.4.1.4.1.1.1">4.1.4.1.1.1.</a> <a href="#gadgets.Prefs.getArray" id="gadgets.Prefs.getArray">gadgets.Prefs.getArray</a>
</h1>
<p id="rfc.section.4.1.4.1.1.1.p.1">The <samp>gadgets.Prefs.getArray</samp> method returns the stored value associated with the specified user preference key as a JavaScript array. If the value stored is not currently an array, the value will be returned as an an array with a single element. If no value is currently associated with the specified key, an empty array will be returned.</p>
<div id="#rfc.figure.140"></div>
<pre>
  &lt;Array&gt; &lt;instance&gt;.getArray(key)
               </pre>
<div id="#rfc.figure.141"></div>
<p>For example:</p>
<pre>
  var prefs = new gadget.Prefs();
  var array = prefs.getArray("foo");
  for (var n = 0; n &lt; array.length; n++) {
    var item = array[n];
    // ...
  }
               </pre>
<h1 id="rfc.section.4.1.4.1.1.2">
<a href="#rfc.section.4.1.4.1.1.2">4.1.4.1.1.2.</a> <a href="#gadgets.Prefs.getBool" id="gadgets.Prefs.getBool">gadgets.Prefs.getBool</a>
</h1>
<p id="rfc.section.4.1.4.1.1.2.p.1">The <samp>gadgets.Prefs.getBool</samp> method returns the stored value associated with the specified user preference key as a JavaScript Boolean. If the stored value is either not current specified or cannot be interpreted as a Boolean, the value returned will be False. If the stored value is the literal String <samp>true</samp> or a non-zero number (positive or negative) the value returned will be True.</p>
<div id="#rfc.figure.142"></div>
<pre>
  &lt;Boolean&gt; &lt;instance&gt;.getBool(key)
               </pre>
<div id="#rfc.figure.143"></div>
<p>For example:</p>
<pre>
  var prefs = new gadget.Prefs();
  if (prefs.getBool("foo")) {
    // ...
  }
               </pre>
<h1 id="rfc.section.4.1.4.1.1.3">
<a href="#rfc.section.4.1.4.1.1.3">4.1.4.1.1.3.</a> <a href="#gadgets.Prefs.getCountry" id="gadgets.Prefs.getCountry">gadgets.Prefs.getCountry</a>
</h1>
<p id="rfc.section.4.1.4.1.1.3.p.1">The <samp>gadgets.Prefs.getCountry</samp> method returns the current Viewer's country as determined by the container.  The value will be an ISO 3166-1 Country Code.</p>
<div id="#rfc.figure.144"></div>
<pre>
  &lt;String&gt; &lt;instance&gt;.getCountry()
               </pre>
<div id="#rfc.figure.145"></div>
<p>For example:</p>
<pre>
  var prefs = new gadgets.Prefs();
  var country = prefs.getCountry();
               </pre>
<h1 id="rfc.section.4.1.4.1.1.4">
<a href="#rfc.section.4.1.4.1.1.4">4.1.4.1.1.4.</a> <a href="#gadgets.Prefs.getFloat" id="gadgets.Prefs.getFloat">gadgets.Prefs.getFloat</a>
</h1>
<p id="rfc.section.4.1.4.1.1.4.p.1">The <samp>gadgets.Prefs.getFloat</samp> method returns the stored value associated with the specified user preference key as a JavaScript Number containing a floating-point value.  If the stored value is either not current specified or cannot be interpreted as a floating point number, the value returned will be 0.</p>
<div id="#rfc.figure.146"></div>
<pre>
  &lt;Number&gt; &lt;instance&gt;.getFloat(key)
               </pre>
<div id="#rfc.figure.147"></div>
<p>For example:</p>
<pre>
  var prefs = new gadget.Prefs();
  var float = prefs.getFloat("foo");
               </pre>
<h1 id="rfc.section.4.1.4.1.1.5">
<a href="#rfc.section.4.1.4.1.1.5">4.1.4.1.1.5.</a> <a href="#gadgets.Prefs.getInt" id="gadgets.Prefs.getInt">gadgets.Prefs.getInt</a>
</h1>
<p id="rfc.section.4.1.4.1.1.5.p.1">The <samp>gadgets.Prefs.getInt</samp> method returns the stored value associated with the specified user preference key as a JavaScript Number containing an integer value.  If the stored value is either not currently specified or cannot be interpreted as an integer number, the value returned will be <samp>0</samp>.</p>
<div id="#rfc.figure.148"></div>
<pre>
  &lt;Number&gt; &lt;instance&gt;.getInt(key)
               </pre>
<div id="#rfc.figure.149"></div>
<p>For example:</p>
<pre>
  var prefs = new gadget.Prefs();
  var int = prefs.getInt("foo");
               </pre>
<h1 id="rfc.section.4.1.4.1.1.6">
<a href="#rfc.section.4.1.4.1.1.6">4.1.4.1.1.6.</a> <a href="#gadgets.Prefs.getLang" id="gadgets.Prefs.getLang">gadgets.Prefs.getLang</a>
</h1>
<p id="rfc.section.4.1.4.1.1.6.p.1">The <samp>gadgets.Prefs.getLang</samp> method returns the current Viewer's preferred language as determined by the container. The value will be an ISO 639-1 Language Code.</p>
<div id="#rfc.figure.150"></div>
<pre>
  &lt;String&gt; &lt;instance&gt;.getLang()
               </pre>
<div id="#rfc.figure.151"></div>
<p>For example:</p>
<pre>
  var prefs = new gadgets.Prefs();
  var lang = prefs.getLang();
               </pre>
<h1 id="rfc.section.4.1.4.1.1.7">
<a href="#rfc.section.4.1.4.1.1.7">4.1.4.1.1.7.</a> <a href="#gadgets.Prefs.getModuleId" id="gadgets.Prefs.getModuleId">gadgets.Prefs.getModuleId</a>
</h1>
<p id="rfc.section.4.1.4.1.1.7.p.1">The <samp>gadgets.Prefs.getModuleId</samp> method returns the gadget instances unique ID as provided by the container.</p>
<div id="#rfc.figure.152"></div>
<pre>
  &lt;String&gt; &lt;instance&gt;.getModuleId()
               </pre>
<div id="#rfc.figure.153"></div>
<p>For example:</p>
<pre>
  var prefs = new gadgets.Prefs();
  var id = prefs.getModuleId();
               </pre>
<h1 id="rfc.section.4.1.4.1.1.8">
<a href="#rfc.section.4.1.4.1.1.8">4.1.4.1.1.8.</a> <a href="#gadgets.Prefs.getMsg" id="gadgets.Prefs.getMsg">gadgets.Prefs.getMsg</a>
</h1>
<p id="rfc.section.4.1.4.1.1.8.p.1">The <samp>gadgets.Prefs.getMsg</samp> method returns the localized String value associated with the specified key as provided by the Message Bundle selected by the container for the current Viewer's preferred language and country. Messages are defined using &lt;Locale&gt; elements within the &lt;ModulePrefs&gt;.  If the specified key has no associated message, an empty String will be returned.</p>
<div id="#rfc.figure.154"></div>
<pre>
  &lt;String&gt; &lt;instance&gt;.getMsg(key)
               </pre>
<div id="#rfc.figure.155"></div>
<p>For example:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      ...
      &lt;Locale&gt;
        &lt;msg name="foo"&gt;Test message&gt;/msg&gt;
        ...
      &lt;/Locale&gt;
      ...
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;&lt;[CDATA[
      ...
      &lt;script&gt;
        ...
        var prefs = new gadgets.Prefs();
        var foo = prefs.getMsg("foo");
        // foo = "Test message"
        ...
      &lt;/script&gt;
      ...
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
               </pre>
<h1 id="rfc.section.4.1.4.1.1.9">
<a href="#rfc.section.4.1.4.1.1.9">4.1.4.1.1.9.</a> <a href="#gadgets.Prefs.getString" id="gadgets.Prefs.getString">gadgets.Prefs.getString</a>
</h1>
<p id="rfc.section.4.1.4.1.1.9.p.1">The <samp>gadgets.Prefs.getString</samp> method returns the stored value associated with the specified user preference key as a JavaScript String. If the stored value is not currently specified, the value returned will be an empty String.</p>
<div id="#rfc.figure.156"></div>
<pre>
  &lt;String&gt; &lt;instance&gt;.getString(key)
               </pre>
<div id="#rfc.figure.157"></div>
<p>For example:</p>
<pre>
  var prefs = new gadgets.Prefs();
  var str = prefs.getString("foo");
               </pre>
<h1 id="rfc.section.4.1.4.2">
<a href="#rfc.section.4.1.4.2">4.1.4.2.</a> The "setprefs" Feature</h1>
<p id="rfc.section.4.1.4.2.p.1">By default, the <samp>gadgets.Prefs</samp> object provides read-only access to the stored user preferences for particular application instance. In order to modify the user preference values, the "setprefs" feature MUST be specified using either the &lt;Require&gt; or &lt;Optional&gt; element within the &lt;ModulePrefs&gt;.</p>
<p id="rfc.section.4.1.4.2.p.2">Containers MUST provide the "setprefs" feature.</p>
<div id="#rfc.figure.158"></div>
<p>For example:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      ...
      &lt;Require feature="setprefs" /&gt;
      ...
    &lt;/ModulePrefs&gt;
    ...
  &lt;/Module&gt;
           </pre>
<h1 id="rfc.section.4.1.4.2.1">
<a href="#rfc.section.4.1.4.2.1">4.1.4.2.1.</a> JavaScript API</h1>
<p id="rfc.section.4.1.4.2.1.p.1">When the "setprefs" feature is enabled for an application, two additional JavaScript methods: <samp>set</samp> and <samp>setArray</samp> are enabled for use on the <samp>gadgets.Prefs</samp> object.</p>
<h1 id="rfc.section.4.1.4.2.1.1">
<a href="#rfc.section.4.1.4.2.1.1">4.1.4.2.1.1.</a> <a href="#gadget.Prefs.set" id="gadget.Prefs.set">gadgets.Prefs.set</a>
</h1>
<p id="rfc.section.4.1.4.2.1.1.p.1">The <samp>gadgets.Prefs.set</samp> method stores the specified value and associates it with the given key. The value can be any JavaScript primitive. No return value is specified.</p>
<div id="#rfc.figure.159"></div>
<pre>
  &lt;Void&gt; &lt;instance&gt;.set(key,value)
               </pre>
<div id="#rfc.figure.160"></div>
<p>For example:</p>
<pre>
  var prefs = new gadgets.Prefs();
  prefs.set("foo", "Some value");
               </pre>
<h1 id="rfc.section.4.1.4.2.1.2">
<a href="#rfc.section.4.1.4.2.1.2">4.1.4.2.1.2.</a> <a href="#gadget.Prefs.setArray" id="gadget.Prefs.setArray">gadgets.Prefs.setArray</a>
</h1>
<p id="rfc.section.4.1.4.2.1.2.p.1">The <samp>gadgets.Prefs.setArray</samp> method stores the specified Array value and associates it with the given key. The members of the Array can be any JavaScript primitive. No return value is specified.</p>
<div id="#rfc.figure.161"></div>
<pre>
  &lt;Void&gt; &lt;instance&gt;.setArray(key,array)
               </pre>
<div id="#rfc.figure.162"></div>
<p>For example:</p>
<pre>
  var prefs = new gadgets.Prefs();
  prefs.setArray("foo",["a","b","c"]);
               </pre>
<h1 id="rfc.section.4.1.5">
<a href="#rfc.section.4.1.5">4.1.5.</a> <a href="#gadgets.util" id="gadgets.util">The Utility Feature</a>
</h1>
<p id="rfc.section.4.1.5.p.1">The Utility Feature provides general purpose utility functions that are available automatically for all applications.</p>
<h1 id="rfc.section.4.1.5.1">
<a href="#rfc.section.4.1.5.1">4.1.5.1.</a> JavaScript API</h1>
<p id="rfc.section.4.1.5.1.p.1">The Utility Feature provides the following JavaScript API methods to developers:</p>
<h1 id="rfc.section.4.1.5.1.1">
<a href="#rfc.section.4.1.5.1.1">4.1.5.1.1.</a> <a href="#gadgets.util.escapeString" id="gadgets.util.escapeString">gadgets.util.escapeString</a>
</h1>
<p id="rfc.section.4.1.5.1.1.p.1">The <samp>gadgets.util.escapeString</samp> processes the characters of an input String and replaces specific potentially problematic characters with corresponding HTML entities.</p>
<div id="#rfc.figure.163"></div>
<pre>
  &lt;static&gt; &lt;String&gt; gadgets.util.escapeString(str)
            </pre>
<p id="rfc.section.4.1.5.1.1.p.2">The following characters are affected:</p>
<div id="#rfc.table.11"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Character</th>
<th class="left">Unicode Codepoint</th>
<th class="left">Replacement</th>
</tr></thead>
<tbody>
<tr>
<td class="left">newline (\n)</td>
<td class="left">10</td>
<td class="left">&amp;#10;</td>
</tr>
<tr>
<td class="left">carriage return (\r)</td>
<td class="left">13</td>
<td class="left">&amp;#13;</td>
</tr>
<tr>
<td class="left">double quote (")</td>
<td class="left">34</td>
<td class="left">&amp;quot;</td>
</tr>
<tr>
<td class="left">ampersand (&amp;)</td>
<td class="left">38</td>
<td class="left">&amp;amp;</td>
</tr>
<tr>
<td class="left">single quote (')</td>
<td class="left">39</td>
<td class="left">&amp;#39;</td>
</tr>
<tr>
<td class="left">left angle bracket (&lt;)</td>
<td class="left">60</td>
<td class="left">&amp;lt;</td>
</tr>
<tr>
<td class="left">right angle bracket (&gt;)</td>
<td class="left">62</td>
<td class="left">&amp;gt;</td>
</tr>
<tr>
<td class="left">backslash (\)</td>
<td class="left">92</td>
<td class="left">&amp;#92;</td>
</tr>
<tr>
<td class="left">line separator</td>
<td class="left">8232</td>
<td class="left">&amp;#8232;</td>
</tr>
<tr>
<td class="left">paragraph separator</td>
<td class="left">8233</td>
<td class="left">&amp;#8233;</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.4.1.5.1.2">
<a href="#rfc.section.4.1.5.1.2">4.1.5.1.2.</a> <a href="#gadgets.util.getFeatureParameters" id="gadgets.util.getFeatureParameters">gadgets.util.getFeatureParameters</a>
</h1>
<p id="rfc.section.4.1.5.1.2.p.1">The <samp>gadgets.util.getFeatureParameters</samp> returns collection of parameters provided for the given feature as specified by &lt;Param&gt; elements within a &lt;Require&gt; or &lt;Optional&gt; element in the &lt;ModulePrefs&gt;.</p>
<div id="#rfc.figure.164"></div>
<pre>
  &lt;static&gt; &lt;Object&gt; gadgets.util.getFeatureParameters(feature)
            </pre>
<p id="rfc.section.4.1.5.1.2.p.2">The method accepts as input a String specifying the feature name and returns a JavaScript object. Each property of the returned object corresponds to one &lt;Param&gt; element contained by the &lt;Require&gt; or &lt;Optional&gt; element for the named feature. If the feature does not exist in the &lt;ModulePrefs&gt;, a null value is returned.</p>
<div id="#rfc.figure.165"></div>
<p>For example:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      ...
      &lt;Require feature="myFeature"&gt;
        &lt;Param name="foo"&gt;&lt;![CDATA[This is the value]]&gt;&lt;/Param&gt;
      &lt;/Require&gt;
      ...
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;&lt;![CDATA[
      &lt;script&gt;
        ...
        var myFeatureParams = gadgets.util.getFeatureParameters("myFeature");
        var foo = myFeatureParams["foo"]; // returns "This is the value"
        ...
      &lt;/script&gt;
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
            </pre>
<h1 id="rfc.section.4.1.5.1.3">
<a href="#rfc.section.4.1.5.1.3">4.1.5.1.3.</a> <a href="#gadgets.util.hasFeature" id="gadgets.util.hasFeature">gadgets.util.hasFeature</a>
</h1>
<p id="rfc.section.4.1.5.1.3.p.1">The <samp>gadgets.util.hasFeature</samp> returns whether or not the specified feature has been enabled for this application instance.</p>
<div id="#rfc.figure.166"></div>
<pre>
  &lt;static&gt; &lt;Boolean&gt; gadgets.util.hasFeature(feature)
            </pre>
<h1 id="rfc.section.4.1.5.1.4">
<a href="#rfc.section.4.1.5.1.4">4.1.5.1.4.</a> <a href="#gadgets.util.registerOnLoadHandler" id="gadgets.util.registerOnLoadHandler">gadgets.util.registerOnLoadHandler</a>
</h1>
<p id="rfc.section.4.1.5.1.4.p.1">The <samp>gadgets.util.registerOnLoadHandler</samp> method registers a Function that the container will execute immediately after loading the application. Multiple Functions can be registered; all will be invoked in the same order in which they were registered.</p>
<div id="#rfc.figure.167"></div>
<pre>
  &lt;static&gt; &lt;Void&gt; gadgets.util.registerOnLoadHandler(callback)
            </pre>
<p id="rfc.section.4.1.5.1.4.p.2">The <samp>gadgets.util.registerOnLoadHandler</samp> mechanism is generally equivalent to the onLoad event handler on the HTML Body tag. Once the container has fully rendered the content of a particular view, all of the registered callback Functions will be invoked.</p>
<h1 id="rfc.section.4.1.5.1.5">
<a href="#rfc.section.4.1.5.1.5">4.1.5.1.5.</a> <a href="#gadgets.util.sanitizeHtml" id="gadgets.util.sanitizeHtml">gadgets.util.sanitizeHtml</a>
</h1>
<p id="rfc.section.4.1.5.1.5.p.1">The <samp>gadgets.util.sanitizeHtml</samp> method processes a text String that potentially may contain unsafe and untrusted JavaScript code or Stylesheets and returns a modified version that is safe for rendering. The returned value MAY still include HTML markup. If plain text without markup is desired, the <samp>gadgets.util.escapeString</samp> method SHOULD be used instead. Exactly how the String is to be modified is up to each container implementation. </p>
<div id="#rfc.figure.168"></div>
<pre>
  &lt;static&gt; &lt;String&gt; gadgets.util.sanitizeHtml(text)
            </pre>
<p id="rfc.section.4.1.5.1.5.p.2">The method takes as input a single text String value and returns the "sanitized" version of that String.</p>
<h1 id="rfc.section.4.1.5.1.6">
<a href="#rfc.section.4.1.5.1.6">4.1.5.1.6.</a> <a href="#gadgets.util.unescapeString" id="gadgets.util.unescapeString">gadgets.util.unescapeString</a>
</h1>
<p id="rfc.section.4.1.5.1.6.p.1">The <samp>gadgets.util.unescapeString</samp> reverses the processing of the <samp>gadgets.util.escapeString</samp> method by replacing HTML entities with their literal character equivalents</p>
<div id="#rfc.figure.169"></div>
<pre>
  &lt;static&gt; &lt;String&gt; gadgets.util.unescapeString(str)
            </pre>
<div id="#rfc.figure.170"></div>
<p>For example:</p>
<pre>
  var m = "&amp;lt;p&amp;gt;&amp;quot;Hello&amp;quot;&amp;lt;/p&amp;gt;";
  var n = gadgets.util.unescapeString(m);
  // n will equal: &lt;p&gt;"Hello"&lt;/p&gt;
            </pre>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> Recommended Features</h1>
<p id="rfc.section.4.2.p.1">Recommended Features SHOULD be implemented by a container and made available to application instances that specify the feature ID using either the &lt;Require&gt; or &lt;Optional&gt; element in the &lt;ModulePrefs&gt;</p>
<h1 id="rfc.section.4.2.1">
<a href="#rfc.section.4.2.1">4.2.1.</a> <a href="#gadgets.actions" id="gadgets.actions">The Action Contributions Feature</a>
</h1>
<p id="rfc.section.4.2.1.p.1">Some container implementations reserve portions of their user interface for providing links, menus, buttons, etc that are distinct from the applications they host. The "Action Contributions" feature allows applications to contribute functionality to these reserved areas.</p>
<p id="rfc.section.4.2.1.p.2">Additionally, applications can use the feature to associate actions with specific types of OpenSocial objects. In traditional desktop applications, such actions are often rendered as options on context menus when you click on an object such as a person or file. For instance, selecting a Person object might display options like "Start a Chat" or "View Contact Information". With the "Action Contributions" feature, an application can notify the container of which such actions it can provide so that when a user selects the action, the container can direct the appropriate application to carry it out.</p>
<p id="rfc.section.4.2.1.p.3">The "Action Contributions" feature is enabled by specifying the "actions" feature name with either an &lt;Optional&gt; or &lt;Require&gt; element within the &lt;ModulePrefs&gt;. The actions contributed by the application are specified using a &lt;Param&gt; element with the name <samp>action-contributions</samp> within the feature declaration.</p>
<div id="#rfc.figure.171"></div>
<p>The following example defines an optional dependency on the "Action Contributions" feature and contributes a single action to the set of "Navigation Links" provided by the container. The <samp>path</samp> property on the &lt;action&gt; element specifies where the action is being contributed. When the item is selected, the container will invoke the callback handler provided by the JavaScript in the &lt;Content&gt; element.</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs title="Sample VOIP"&gt;
      &lt;Optional feature="actions"&gt;
        &lt;Param name="action-contributions"&gt;&lt;![CDATA[
          &lt;action id="org.samplervoip.navLink" 
            path="container/navigationLinks" 
            label="Phone" /&gt;
        ]]&gt;&lt;/Param&gt;
      &lt;/Optional&gt;
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;&lt;![CDATA[
      &lt;script&gt;
      
        function navLink(selection) { ... }
      
        gadgets.util.registerOnLoadHandler(
          function() {
            if (gadgets.actions) {
              gadgets.actions.updateAction({
                id: "org.samplervoip.navLink",
                callback: navLink
              });
            }
          }
        );
      &lt;/script&gt;
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
     </pre>
<div id="#rfc.figure.172"></div>
<p>Contributing actions to specific OpenSocial data types is similar. Rather than specifying the location to which the action is to be added, the &lt;action&gt; element specifies the data type. In either case, a callback function provided by the application is registered and invoked to handle the action:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs title="Sample VOIP"&gt;
      &lt;Require feature="actions"&gt;
        &lt;Param name="action-contributions"&gt;&lt;![CDATA[
          &lt;action id="org.samplevoip.callbyperson" 
            dataObject="opensocial.Person" 
            label="Call using VOIP Phone" /&gt;
        ]]&gt;&lt;/Param&gt;
      &lt;/Require&gt;
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;&lt;![CDATA[
      &lt;script&gt;
      
        function dial(selection) { ... }
      
        gadgets.util.registerOnLoadHandler(
          function() {
            if (gadgets.actions) {
              gadgets.actions.updateAction({
                id: "org.samplevoip.callbyperson",
                callback: dial
              });
            }
          }
        );
      &lt;/script&gt;
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
     </pre>
<div id="#rfc.figure.173"></div>
<p>Actions can also be contributed programmatically by calling the <samp>gadgets.actions.addAction</samp> API and passing in an "action" object. For instance:</p>
<pre>
  var mycallback = function(){
    ...
  };
  
  var myaction = {
    id: "com.acme.mycallaction",
    tooltip: "My Action Tooltip",
    label: "Call Person",
    icon: "images/myicon.png",
    callback: mycallback,
    dataType: "opensocial.Person"
  }
  
  gadgets.actions.addAction(myaction);      
     </pre>
<div id="#rfc.figure.174"></div>
<p>In some simple cases, an action provided by an application might simply be handled by navigating to an IRI. It such cases, a callback function is not required and the application developer can simply provide the IRI in the action declaration. For instance, in the example below, the container will display the provided IRI in a new tab when the "Contact US" navigation action is selected:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs title="Sample VOIP"&gt;
      &lt;Require feature="actions"&gt;
        &lt;Param name="action-contributions"&gt;&lt;![CDATA[
          &lt;action id="org.example.goSomewhere" 
            path="container/navigationLinks" 
            label="Contact Us!" 
            url="http://www.example.org/contact" 
            viewTarget="TAB" /&gt;
        ]]&gt;&lt;/Param&gt;
      &lt;/Require&gt;
    &lt;/ModulePrefs&gt;
    ...
  &lt;/Module&gt;
     </pre>
<p id="rfc.section.4.2.1.p.4">If a <samp>viewTarget</samp> is not specified, the container will select an appropriate default view target.</p>
<p id="rfc.section.4.2.1.p.5">When registering actions, application developers need only provide basic information about the action such as an identifier, text label, icon and callback function. Containers are responsible for determining how contributed actions are to be rendered.</p>
<h1 id="rfc.section.4.2.1.1">
<a href="#rfc.section.4.2.1.1">4.2.1.1.</a> The &lt;action&gt; Element</h1>
<p id="rfc.section.4.2.1.1.p.1">The &lt;action&gt; element, as illustrated in the previous examples, is used within the value of &lt;Param name="action-contributions"&gt; elements to declaratively define the actions provided by an application. The "action-contributions" parameter value can have any number of &lt;action&gt; elements, each of which MUST specify a unique "id" attribute. Each actions ID SHOULD be unique within the scope of the container -- that is, if multiple application's are rendered by the container, all of the actions contributed by each of the applications SHOULD specify different IDs. If multiple actions are registered that share the same ID, each will be registered and both will be invoked by the container when either of the two actions is triggered.</p>
<p id="rfc.section.4.2.1.1.p.2">There is no XML namespace defined for the &lt;action&gt; element.</p>
<div id="#rfc.figure.175"></div>
<pre>
  BaseAction = {
    attribute id { text },
    attribute label { text },
    attribute tooltip { text }?,
    attribute icon { IRI }?,
    attribute iconSize { text }?,
    attribute iconOffset { text }?,
    attribute view { text }?,
    attribute viewTarget { "TAB" | "DIALOG" | "MODALDIALOG" | "FLOAT" | "SIDEBAR" }?,
    attribute url { IRI }?,
    undefinedAttribute*
  }
       
  PathAction = element action {
    BaseAction,
    attribute path { text }
  }
  
  TypeAction = element action {
    BaseAction,
    attribute type { text }
  }
  
  action = PathAction | TypeAction
       </pre>
<p id="rfc.section.4.2.1.1.p.3">The &lt;action&gt; element MUST contain the "id" and "label" attributes and either the "path" or "type" attributes. The "label" specifies the plain-text label that a container SHOULD display when rendering the action. The "path" attribute specifies a location with the container's user interface where the action is to be rendered. Possible values for the "path" attribute are discussed below. The "type" attribute specifies the OpenSocial data type for which an action is to be associated. The value MUST be a valid OpenSocial Data Type as specified by <a href="#core-api">[core-api]</a>.</p>
<p id="rfc.section.4.2.1.1.p.4">The following additional attributes MAY be specified: </p>

<dl>
<dt>tooltip</dt>
<dd style="margin-left: 8">Additional text that provides additional information about the action. Such text is typically displayed when the user hovers their mouse cursor over the action item.</dd>
<dt>icon</dt>
<dd style="margin-left: 8">An IRI to an image resource that the container can display when rendering the action item. For instance, when rendering the action as a menu item, the contain can display the icon next to the label. If a relative path is provided, it MUST be resolved relative to the URL of the specification document.</dd>
<dt>iconSize</dt>
<dd style="margin-left: 8">TODO: Need more info</dd>
<dt>iconOffset</dt>
<dd style="margin-left: 8">TODO: Need more info</dd>
<dt>view</dt>
<dd style="margin-left: 8">The name of the application view the container SHOULD render when the action is invoked.</dd>
<dt>viewTarget</dt>
<dd style="margin-left: 8">Specifies where the specified view is to be rendered. Different container implementations MAY support the ability for individual application views to be displayed outside the main area allocated to the application by the container. Examples include rendering within a modal dialog box, or within a "sidebar" area provided by the container. Acceptable values for the viewTarget attribute are "TAB", "DIALOG", "MODALDIALOG", "FLOAT" and "SIDEBAR". If not specified, the view will be rendered within the area already allocated to the application.</dd>
<dt>url</dt>
<dd style="margin-left: 8">An IRI to use in place of a callback function.  When used, the container will display the content of the URL when the action is selected rather than invoking a JavaScript callback to handle the action.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.4.2.1.2">
<a href="#rfc.section.4.2.1.2">4.2.1.2.</a> <a href="#gadgets.actions.paths" id="gadgets.actions.paths">Action Contribution Paths</a>
</h1>
<p id="rfc.section.4.2.1.2.p.1">When an application contributes actions to the container's user interface, the intended location where the action is to be rendered is specified using a "path". The collection of available paths for which actions can be contributed is specific to each individual container implementation.  Some containers might not support user interface action contributions at all.</p>
<p id="rfc.section.4.2.1.2.p.2">The following common paths MAY be supported by a container: </p>

<dl>
<dt>"container/navigationLinks"</dt>
<dd style="margin-left: 8">Identifies the area provided by the container for "top-level navigation". These are typically links or menu items that provide users with an overall ability to navigate through the various available services provided by an application.  </dd>
<dt>"container/menus&gt;</dt>
<dd style="margin-left: 8">Identifies the area provided by the container for menu options. These are typically hierarchically nested actions that provide access to a variety of options and tools currently available to the user.  </dd>
<dt>"container/toolbars"</dt>
<dd style="margin-left: 8">Identifies the area provided by the container for toolbars. These are typically shortcuts to commonly used options or tools currently available to the user.  </dd>
<dt>"gadget/menu"</dt>
<dd style="margin-left: 8">Identifies an "options" menu that a container might provide for a application instance. Typically, such menus provide options and tools associated with a specific application instance.  </dd>
</dl>

<p> </p>
<p id="rfc.section.4.2.1.2.p.3">Contribution paths are hierarchical and container specific. For instance, if a container supports a top level menu system such as those typically found in many traditional desktop applications, an application might use path="container/menu/File" to add items to the containers "File" menu. The depth of the path hierarchy is entirely determined by the container. Each segment of the path is separated by the forward slash (/) character.</p>
<h1 id="rfc.section.4.2.1.3">
<a href="#rfc.section.4.2.1.3">4.2.1.3.</a> JavaScript API</h1>
<p id="rfc.section.4.2.1.3.p.1">Gadget developers who contribute actions to the container use the <samp>gadgets.actions</samp> JavaScript API to work with contributed actions.</p>
<p id="rfc.section.4.2.1.3.p.2">The API is used, for instance, to register callback functions to handle actions, register or modify actions programmatically, or work with contributions provided by other specification documents.</p>
<h1 id="rfc.section.4.2.1.3.1">
<a href="#rfc.section.4.2.1.3.1">4.2.1.3.1.</a> <a href="#gadgets.actions.actionobjects" id="gadgets.actions.actionobjects">The Action Object</a>
</h1>
<p id="rfc.section.4.2.1.3.1.p.1">The <samp>Action</samp> object is a JavaScript representation of a contribution action. The properties available on the object correlate to each of the attributes on the &lt;action&gt; element. An additional "callback" property is provided that specifies the callback function the container will invoke when the action is selected.</p>
<div id="#rfc.table.12"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Attribute</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">id</td>
<td class="left">The action identifier.</td>
</tr>
<tr>
<td class="left">label</td>
<td class="left">Text string to display for this action</td>
</tr>
<tr>
<td class="left">path</td>
<td class="left">The container-defined location for this action, as described in <a href="#gadgets.actions.paths">Action Paths</a>.  Example: path=container/menus/Edit</td>
</tr>
<tr>
<td class="left">dataType</td>
<td class="left">The Open Social Data type with which to associate this action. Example: opensocial.Person</td>
</tr>
<tr>
<td class="left">tooltip</td>
<td class="left">Tooltip to display on hovering over an icon</td>
</tr>
<tr>
<td class="left">icon</td>
<td class="left">Path to image icon.</td>
</tr>
<tr>
<td class="left">iconSize</td>
<td class="left">TODO: need more info</td>
</tr>
<tr>
<td class="left">iconOffset</td>
<td class="left">TODO: need more info</td>
</tr>
<tr>
<td class="left">view</td>
<td class="left">The view ID the application should navigate to when the action is invoked.</td>
</tr>
<tr>
<td class="left">viewTarget</td>
<td class="left">The target area to render the view.</td>
</tr>
<tr>
<td class="left">url</td>
<td class="left">Simple actions that are just links can specify a url instead of a callback function.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.1.3.1.p.2">As is the case with the &lt;action&gt; element, the "id" and "label" properties are both required and values for either the "path" or "type" MUST be provided. All other properties are optional.</p>
<h1 id="rfc.section.4.2.1.3.2">
<a href="#rfc.section.4.2.1.3.2">4.2.1.3.2.</a> <a href="#gadgets.actions.addAction" id="gadgets.actions.addAction">gadgets.actions.addAction</a>
</h1>
<p id="rfc.section.4.2.1.3.2.p.1">Programmatically registers an action with the container. Note that if multiple actions are registered using the same identifier, each will be registered separately by the container and both will be invoked when either action is run.</p>
<div id="#rfc.figure.176"></div>
<pre>
  &lt;static&gt; gadgets.actions.addAction(action)
         </pre>
<p id="rfc.section.4.2.1.3.2.p.2">Input Parameters:</p>
<div id="#rfc.table.13"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody><tr>
<td class="left">action</td>
<td class="left">
<a href="#gadgets.actions.actionobjects">Action Object</a> <cite title="NONE">[gadgets.actions.actionobjects]</cite>
</td>
<td class="left">The action to be added to the container</td>
</tr></tbody>
</table>
<div id="#rfc.figure.177"></div>
<p>For example:</p>
<pre>
  var mycallback = function(){
    ...
  };
  
  var myaction = {
    id: "com.acme.mycallaction",
    tooltip: "My Action Tooltip",
    label: "Call Person",
    icon: "images/myicon.png",
    callback: mycallback,
    dataType: "opensocial.Person"  
  }

  gadgets.actions.addAction(myaction);
         </pre>
<h1 id="rfc.section.4.2.1.3.3">
<a href="#rfc.section.4.2.1.3.3">4.2.1.3.3.</a> <a href="#gadgets.actions.updateAction" id="gadgets.actions.updateAction">gadgets.actions.updateAction</a>
</h1>
<p id="rfc.section.4.2.1.3.3.p.1">Modifies the specified action contributed to the container. Note that Applications are only permitted to modify it's own contributed actions.</p>
<div id="#rfc.figure.178"></div>
<pre>
  &lt;static&gt; gadgets.actions.updateAction(action)
         </pre>
<p id="rfc.section.4.2.1.3.3.p.2">Input Parameters:</p>
<div id="#rfc.table.14"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody><tr>
<td class="left">action</td>
<td class="left">
<a href="#gadgets.actions.actionobjects">Action Object</a> <cite title="NONE">[gadgets.actions.actionobjects]</cite>
</td>
<td class="left">A partial representation of the action to be updated within the container</td>
</tr></tbody>
</table>
<p id="rfc.section.4.2.1.3.3.p.3">The Action object passed in to the <samp>gadgets.actions.updateAction</samp> method can be a partial representation of the action that contains the "id" of the action being modified and only the properties that need to be updated.</p>
<div id="#rfc.figure.179"></div>
<p>For instance, to specify the callback function for an action contributed using the &lt;action&gt; element, a developer would invoke <samp>gadgets.actions.updateAction</samp> with an object that specifies only the "id" and "callback" properties:</p>
<pre>
  var mycallback = function(){
    ...
  };
  
  var myaction = {
    id: "com.acme.mycallaction",
    callback: mycallback
  }
  
  gadgets.actions.updateAction(myaction);
         </pre>
<h1 id="rfc.section.4.2.1.3.4">
<a href="#rfc.section.4.2.1.3.4">4.2.1.3.4.</a> <a href="#gadgets.actions.removeAction" id="gadgets.actions.removeAction">gadgets.actions.removeAction</a>
</h1>
<p id="rfc.section.4.2.1.3.4.p.1">Removes the specified action from the container. Note that an Application is only permitted to remove it's own contributed actions.</p>
<div id="#rfc.figure.180"></div>
<pre>
  &lt;static&gt; gadgets.actions.removeAction
         </pre>
<p id="rfc.section.4.2.1.3.4.p.2">Input Parameters:</p>
<div id="#rfc.table.15"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody><tr>
<td class="left">id</td>
<td class="left">String</td>
<td class="left">The ID of the action to be removed.</td>
</tr></tbody>
</table>
<div id="#rfc.figure.181"></div>
<p>For example,</p>
<pre>
  gadgets.actions.removeAction("com.acme.mycallaction");     
         </pre>
<h1 id="rfc.section.4.2.1.3.5">
<a href="#rfc.section.4.2.1.3.5">4.2.1.3.5.</a> <a href="#gadgets.actions.getActionsByPath" id="gadgets.actions.getActionsByPath">gadgets.actions.getActionsByPath</a>
</h1>
<p id="rfc.section.4.2.1.3.5.p.1">Retrieves the collection of all actions registered at the specified path and passes the result to the provided callback function as a JavaScript Array. Note that paths are not considered to be hierarchical.  Passing in a path value of "container/navigationLinks" MUST NOT return any actions contributed to any path that can be considered subordinate to "container/navigationLinks" (e.g. "container/navigationLinks/File").</p>
<div id="#rfc.figure.182"></div>
<pre>
  &lt;static&gt; gadgets.actions.getActionsByPath(path, callback)
         </pre>
<p id="rfc.section.4.2.1.3.5.p.2">Input Parameters:</p>
<div id="#rfc.table.16"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">path</td>
<td class="left">String</td>
<td class="left">The String representation of the path to the actions</td>
</tr>
<tr>
<td class="left">callback</td>
<td class="left">Function</td>
<td class="left">A callback function to handle the returned actions array</td>
</tr>
</tbody>
</table>
<div id="#rfc.figure.183"></div>
<p>For example,</p>
<pre>
  function listActions(actions) { ... }
  
  gadgets.actions.getActionsByPath("container/navigationLinks", callback);
         </pre>
<h1 id="rfc.section.4.2.1.3.6">
<a href="#rfc.section.4.2.1.3.6">4.2.1.3.6.</a> <a href="#gadgets.actions.getActionsByDataType" id="gadgets.actions.getActionsByDataType">gadgets.actions.getActionsByDataType</a>
</h1>
<p id="rfc.section.4.2.1.3.6.p.1">Retrieves the collection of all actions registered for the specified data type and passes the result to the provided callback function a JavaScript Array.</p>
<div id="#rfc.figure.184"></div>
<pre>
  &lt;static&gt; gadgets.actions.getActionsByDataType(dataType, callback)
         </pre>
<p id="rfc.section.4.2.1.3.6.p.2">Input Parameters:</p>
<div id="#rfc.table.17"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">dataType</td>
<td class="left">String</td>
<td class="left">The String representation of the associated data type</td>
</tr>
<tr>
<td class="left">callback</td>
<td class="left">Function</td>
<td class="left">A callback function to handle the returned actions array</td>
</tr>
</tbody>
</table>
<div id="#rfc.figure.185"></div>
<p>For example,</p>
<pre>
  function listActions(actions) { ... }
  
  gadgets.actions.getActionsByType("opensocial.Person", callback);
         </pre>
<h1 id="rfc.section.4.2.1.3.7">
<a href="#rfc.section.4.2.1.3.7">4.2.1.3.7.</a> <a href="#gadgets.actions.runAction" id="gadgets.actions.runAction">gadgets.actions.runAction</a>
</h1>
<p id="rfc.section.4.2.1.3.7.p.1">Invokes the specified actions callback function; or, if the "url" property is specified in place of a callback, causes the container to navigate to the specified IRI. Gadget's can use this method to programmatically invoke an action.</p>
<div id="#rfc.figure.186"></div>
<pre>
  &lt;static&gt; gadgets.actions.runAction (id, opt_selection)
         </pre>
<p id="rfc.section.4.2.1.3.7.p.2">Input Parameters:</p>
<div id="#rfc.table.18"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">id</td>
<td class="left">String</td>
<td class="left">The ID of the action to execute.</td>
</tr>
<tr>
<td class="left">opt_selection</td>
<td class="left">
<a href="#gadgets.selection">Selection Object</a> <cite title="NONE">[gadgets.selection]</cite>
</td>
<td class="left">An optional object that identifies the currently selected object as defined by <a href="#gadgets.selection">Section 4.2.13</a>.</td>
</tr>
</tbody>
</table>
<div id="#rfc.figure.187"></div>
<p>For example,</p>
<pre>
  gadgets.actions.runAction("com.acme.mycallaction");
         </pre>
<p id="rfc.section.4.2.1.3.7.p.3">Note that when an action is invoked, all registered actions with the specified identifier will be invoked. If there are multiple actions that use the same identifier value, each will be invoked, typically in the order in which they were registered with the container. This fact can cause a potential security and privacy risk in that it allows a potentially malicious application to snoop on actions originally directed at another application.  Because of this, care needs to be taken to avoid using the <samp>gadgets.actions.runAction</samp> API to pass potentially secure or private data to an application.</p>
<p id="rfc.section.4.2.1.3.7.p.4">Also note that any action added to the container can be run by any Application, not only the Application that contributed the action.</p>
<h1 id="rfc.section.4.2.1.3.8">
<a href="#rfc.section.4.2.1.3.8">4.2.1.3.8.</a> <a href="#gadgets.actions.registerShowActionsListener" id="gadgets.actions.registerShowActionsListener">gadgets.actions.registerShowActionsListener</a>
</h1>
<p id="rfc.section.4.2.1.3.8.p.1">Registers a callback function that the container will call whenever new actions are added to the container. An application can use this listener to provide a rendering of any action contributed to the container by any other application.</p>
<div id="#rfc.figure.188"></div>
<pre>
  &lt;static&gt; gadgets.actions.registerShowActionsListener (listener)
         </pre>
<p id="rfc.section.4.2.1.3.8.p.2">Input Parameters:</p>
<div id="#rfc.table.19"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody><tr>
<td class="left">listener</td>
<td class="left">Function</td>
<td class="left">The application's function to render actions in its UI. The function will be invoked with one parameter which is an array of action objects to render.</td>
</tr></tbody>
</table>
<div id="#rfc.figure.189"></div>
<p>For Example:</p>
<pre>
  var listener = function(actionObjs){
       // draw the UI, toolbars menus, etc
       // to do the invocation of the action, call the following API:
       // gadgets.actions.runAction(actionObjs[0].id);  
  }
  gadgets.actions.registerShowActionsListener(listener);
         </pre>
<h1 id="rfc.section.4.2.1.3.9">
<a href="#rfc.section.4.2.1.3.9">4.2.1.3.9.</a> <a href="#gadgets.actions.registerHideActionsListener" id="gadgets.actions.registerHideActionsListener">gadgets.actions.registerHideActionsListener</a>
</h1>
<p id="rfc.section.4.2.1.3.9.p.1">Registers a callback function that the container will call whenever the an application that contributes actions is removed from the container.</p>
<div id="#rfc.figure.190"></div>
<pre>
  &lt;static&gt; gadgets.actions.registerHideActionsListener (listener)
         </pre>
<p id="rfc.section.4.2.1.3.9.p.2">Input Parameters:</p>
<div id="#rfc.table.20"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody><tr>
<td class="left">listener</td>
<td class="left">Function</td>
<td class="left">The application's function to render actions in its UI. The function will be invoked with one parameter which is an array of action objects to hide.</td>
</tr></tbody>
</table>
<div id="#rfc.figure.191"></div>
<p>For Example:</p>
<pre>
  var listener = function(actionObjs){
       // remove the UI elements associated with the listed actions
  }
  gadgets.actions.registerHideActionsListener(listener);
         </pre>
<h1 id="rfc.section.4.2.2">
<a href="#rfc.section.4.2.2">4.2.2.</a> The Content Rewriting Feature</h1>
<p id="rfc.section.4.2.2.p.1">In many cases, when a container renders the content provided by an Application Specification, it might wish to make a number of specific modifications to the content intended, in part, to improve overall performance. Examples of such modifications can include changing the URLs of external resources used by the Application such that those resources may possibly be cache and retrieved from a Content Distribution Network (cdn); or optimizing CSS stylesheets and JavaScript code defined by the Specificaiton document.</p>
<p id="rfc.section.4.2.2.p.2">The Content Rewriting Feature allows an Application developer the ability to control which types of modifications the container is permitted to make within the content provided by the application.</p>
<p id="rfc.section.4.2.2.p.3">The Content Rewriting Feature is specified within the &lt;ModulePrefs&gt; with the feature name "content-rewrite" using either the &lt;Optional&gt; or &lt;Require&gt; element. Multiple &lt;Param&gt; elements are used to specify specific configuration options for the feature.  Containers MAY support the Content Rewriting Feature.</p>
<div id="#rfc.figure.192"></div>
<p>For example:</p>
<pre>
  &lt;Optional feature="content-rewrite"&gt;
      &lt;Param name="expires"&gt;86400&lt;/Param&gt;
      &lt;Param name="include-url"&gt;&lt;/Param&gt;
      &lt;Param name="exclude-url"&gt;excluded&lt;/Param&gt;
      &lt;Param name="exclude-url"&gt;moreexcluded&lt;/Param&gt;
      &lt;Param name="minify-css"&gt;true&lt;/Param&gt;
      &lt;Param name="minify-js"&gt;true&lt;/Param&gt;
      &lt;Param name="minify-html"&gt;true&lt;/Param&gt;
  &lt;/Optional&gt;
  </pre>
<p id="rfc.section.4.2.2.p.4">The parameters supported by the "content-rewrite" feature are:</p>
<div id="#rfc.table.21"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Name</th>
<th class="left">Value</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">expires</td>
<td class="left">Integer</td>
<td class="left">The duration in seconds to force as maximum HTTP cache time for content cached by the container via a rewritten URL. The default is 86400 seconds. Note that a container MUST NOT cache a resource for long that the time specified by standard Cache-Control mechanisms included in the HTTP Response returned when the original content is fetched from the remote location.</td>
</tr>
<tr>
<td class="left">include-url</td>
<td class="left">String</td>
<td class="left">Any URL which contains this parameters value as a case-insensitive substring is considered rewriteable. That is, the container MAY choose to redirect fetching of the URLs target resource via a container selected alternative URL or MAY choose to apply various optimization algorithms on the fetched respresentation of the resource. For instance, if the resource returns JavaScript code and the <samp>minify-js</samp> parameter is true, the container MAY choose to optimize the provided JavaScript code in some way. The literal string "*" is a special case and implies all URLs. If not specified an entry with the value "*" is assumed. This parameter MAY appear multiple times within the &lt;Optional&gt; or &lt;Require&lt; tags.</td>
</tr>
<tr>
<td class="left">exclude-url</td>
<td class="left">String</td>
<td class="left">Any URL which contains this parameters value as a case-insensitive substring is excluded from rewriting. The literal string "*" implies all URLs and effectively disables all rewriting. This parameter MAY appear multiple times within the &lt;Optional&gt; or &lt;Require&lt; tags.</td>
</tr>
<tr>
<td class="left">minify-css</td>
<td class="left">Boolean</td>
<td class="left">Specifies whether the container can attempt to optimize CSS in style tags and referenced CSS resources that have not been explicitly excluded from rewriting using the <samp>exclude-url</samp> parameter. Valid values are "true" or "false". Default is "true"</td>
</tr>
<tr>
<td class="left">minify-js</td>
<td class="left">Boolean</td>
<td class="left">Specifies whether the container can attempt to optimize JavaScript contained in Script tags or in referenced JavaScript resources that have not been explicitly excluded from rewriting using the <samp>exclude-url</samp> parameter. Valid values are "true" or "false". Default is "true"</td>
</tr>
<tr>
<td class="left">minify-html</td>
<td class="left">Boolean</td>
<td class="left">Specifies whether the container can attempt to optimize HTML provided directly by the Application or in referenced resources that have not been explicitly excluded from rewriting using the <samp>exclude-url</samp> parameter. Valid values are "true" or "false". Default is "true"</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.2.p.5">When values for both the "exclude-url" and "include-url" are specified, Matches for "exclude-url" take precedence over matches for "include-url".</p>
<p id="rfc.section.4.2.2.p.6">Note that the special use of "*" to denote all URLs should not be interpreted as support for GLOB or RegEx matching on strings.</p>
<p id="rfc.section.4.2.2.p.7">For any resource that is not explicitly excluded from rewriting using the <samp>exclude-url</samp> parameter, containers are free to perform additional optimizations when rewriting links including but not limited to: </p>

<ul>
<li>Extracting @import directives from style tags and converting them into link tags in the head tag of the containing HTML content.</li>
<li>Merging multiple CSS fetches from successive link tags into one link tag that causes the proxy to concatenate the content fetched from the individual URLs.</li>
<li>Merging contiguous &lt;script src=xxx&gt; tags into one concatenating proxy fetch.</li>
</ul>
<p id="rfc.section.4.2.2.p.8">Implementations are free to support additional content-rewite parameters. The definition of such parameters, however, is out of scope of this specification.</p>
<h1 id="rfc.section.4.2.3">
<a href="#rfc.section.4.2.3">4.2.3.</a> <a href="#opensocial.data" id="opensocial.data">The DataContext Feature</a>
</h1>
<p id="rfc.section.4.2.3.p.1">The Data Context Feature allows an application utilizing the <a href="#DataPipelining">Data Pipeline</a> <cite title="NONE">[DataPipelining]</cite> capability provided by the container to access the <samp>DataContext</samp> associated with the application instance.</p>
<p id="rfc.section.4.2.3.p.2">The DataContext feature is enabled for a application by specifying feature="opensocial.data" using either a &lt;Requires&gt; or &lt;Optional&gt; element within the &lt;ModulePrefs&gt;.</p>
<p id="rfc.section.4.2.3.p.3">If the container supports the Data Pipeline capability, the DataContext Feature MUST be supported by the container.</p>
<div id="#rfc.figure.193"></div>
<p>For example:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      ...
      &lt;Require feature="opensocial.data" /&gt;
      ...
    &lt;/ModulePrefs&gt;
    ...
  &lt;/Module&gt;
    </pre>
<p id="rfc.section.4.2.3.p.4">The <samp>DataContext</samp> object is only available to JavaScript code running within either HTML or Proxy-type &lt;Content&gt; elements.</p>
<p id="rfc.section.4.2.3.p.5">The <samp>DataContext</samp> object will not contain any of the pipelined data POSTed to a remote endpoint when using Proxy-type Content as described in <a href="#data-pipeline-proxy">Section 3.6.4</a>.</p>
<h1 id="rfc.section.4.2.3.1">
<a href="#rfc.section.4.2.3.1">4.2.3.1.</a> JavaScript API</h1>
<p id="rfc.section.4.2.3.1.p.1">When enabled for an application instance, the DataContext Feature makes the following methods and objects available for use.</p>
<h1 id="rfc.section.4.2.3.1.1">
<a href="#rfc.section.4.2.3.1.1">4.2.3.1.1.</a> <a href="#opensocial.data.getContext" id="opensocial.data.getContext">opensocial.data.getContext</a>
</h1>
<p id="rfc.section.4.2.3.1.1.p.1">The <samp>opensocial.data.getContext</samp> method returns the <samp>DataContext</samp> object associated with the application instance.</p>
<div id="#rfc.figure.194"></div>
<pre>
  &lt;static&gt; &lt;DataContext&gt; opensocial.data.getContext()
        </pre>
<h1 id="rfc.section.4.2.3.1.2">
<a href="#rfc.section.4.2.3.1.2">4.2.3.1.2.</a> <a href="#DataContext_Client" id="DataContext_Client">The DataContext Object</a>
</h1>
<p id="rfc.section.4.2.3.1.2.p.1">The DataContect object maintains all the data associated with the current application's data pipelining requests. Instances of the object are acquired by calling the <samp>opensocial.data.getContext</samp> method.</p>
<p id="rfc.section.4.2.3.1.2.p.2">Instances of the DataContext object expose the following method:</p>
<h1 id="rfc.section.4.2.3.1.2.1">
<a href="#rfc.section.4.2.3.1.2.1">4.2.3.1.2.1.</a> <a href="#opensocial.data.DataContext.getDataSet" id="opensocial.data.DataContext.getDataSet">opensocial.data.DataContext.getDataSet</a>
</h1>
<p id="rfc.section.4.2.3.1.2.1.p.1">The <samp>opensocial.data.DataContext.getDataSet</samp> method returns the object data currently mapped to the specified key or null if a value for the specified key does not exist.</p>
<div id="#rfc.figure.195"></div>
<pre>
  &lt;Object&gt; &lt;instance&gt;.getDataSet(key)
          </pre>
<h1 id="rfc.section.4.2.3.1.2.2">
<a href="#rfc.section.4.2.3.1.2.2">4.2.3.1.2.2.</a> <a href="#opensocial.data.DataContext.putDataSet" id="opensocial.data.DataContext.putDataSet">opensocial.data.DataContext.putDataSet</a>
</h1>
<p id="rfc.section.4.2.3.1.2.2.p.1">The <samp>opensocial.data.DataContext.putDataSet</samp> method allows data to be stored into the DataContext programmatically as an alternative to using the Data Pipeline elements.</p>
<div id="#rfc.figure.196"></div>
<pre>
  &lt;Void&gt; &lt;instance&gt;.putDataSet(key, value)
          </pre>
<p id="rfc.section.4.2.3.1.2.2.p.2">The method takes as input a key and value pair to store within the DataContext. The value can be any JavaScript object or primitive.  No return value is specified.</p>
<h1 id="rfc.section.4.2.3.1.2.3">
<a href="#rfc.section.4.2.3.1.2.3">4.2.3.1.2.3.</a> <a href="#opensocial.data.DataContext.putDataSets" id="opensocial.data.DataContext.putDataSets">opensocial.data.DataContext.putDataSets</a>
</h1>
<p id="rfc.section.4.2.3.1.2.3.p.1">The <samp>opensocial.data.DataContext.putDataSet</samp> method allows multiple key and value pairs to be stored within the DataContext at once.</p>
<div id="#rfc.figure.197"></div>
<pre>
  &lt;Void&gt; &lt;instance&gt;.putDataSets(dataSets)
          </pre>
<p id="rfc.section.4.2.3.1.2.3.p.2">The key and value pairs are specified as properties on a JavaScript object.</p>
<div id="#rfc.figure.198"></div>
<p>For instance, to store the two keys "foo" and "bar" with respective values of "123" and "abc", the putDataSets method would be called as:</p>
<pre>
  var dataContext = opensocial.data.getContext();
  dataContext.putDataSets(
    {
      "foo":"123",
      "bar":"abc"
    });
          </pre>
<p id="rfc.section.4.2.3.1.2.3.p.3">No return value is specified for the method.</p>
<h1 id="rfc.section.4.2.3.1.2.4">
<a href="#rfc.section.4.2.3.1.2.4">4.2.3.1.2.4.</a> <a href="#opensocial.data.DataContext.registerListener" id="opensocial.data.DataContext.registerListener">opensocial.data.DataContext.registerListener</a>
</h1>
<p id="rfc.section.4.2.3.1.2.4.p.1">The <samp>opensocial.data.DataContext.registerListener</samp> method registers a callback Function that is invoked whenever the value associated with one or more specified keys is modified in the DataContext, either through processing of the Data Pipeline elements or calls to either of the <samp>opensocial.data.DataContext.putDataSet</samp> and <samp>opensocial.data.DataContext.putDataSets</samp> methods.</p>
<div id="#rfc.figure.199"></div>
<pre>
  &lt;Void&gt; &lt;instance&gt;.registerListener(key, callback)
          </pre>
<p id="rfc.section.4.2.3.1.2.4.p.2">The method takes as input either a single key or Array of keys for which the callback Function is to be registered and a single callback Function.</p>
<p id="rfc.section.4.2.3.1.2.4.p.3">When the value of any of the specified keys changes, the DataContext will invoke all registered callback functions registered for the modified keys and pass in a single listing of the key names whose values have been modified.</p>
<div id="#rfc.figure.200"></div>
<p>For example:</p>
<pre>
  var dataContext = opensocial.data.getContext();
  dataContext.registerListener(
    ["foo","bar"],
    function(keys) {
      for (var n = 0; n &lt; keys.length; n++) {
        var new_value = dataContext.getDataSet(keys[n]);
        // ...
      }
    }
  );
          </pre>
<h1 id="rfc.section.4.2.4">
<a href="#rfc.section.4.2.4">4.2.4.</a> <a href="#Embedded-Experiences" id="Embedded-Experiences">The Embedded Experiences Feature</a>
</h1>
<p id="rfc.section.4.2.4.p.1">Embedded experiences provide a mechanism for embedding OpenSocial Applications and other web-accessible content sources directly into a variety of contexts such as Activity Streams, email messages and Atom feeds.  The mechanism works by inserting a small structure of data that includes a reference to the embedded content along with contextual data an OpenSocial container would need to render the content appropriately.</p>
<p id="rfc.section.4.2.4.p.2">This data structure can be serialized as either a JSON object or XML and includes the following properties:</p>
<div id="#rfc.table.22"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Property</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left"><samp>context</samp></td>
<td class="left">If the Embedded Experience is used to embed an OpenSocial Application, the "context" field is used to pass data to the application so that it knows exactly which content to render. For instance, an application that displays a person's profile information will need to know which profile to display; an application that displays an album of recent photos will need to know the identity of the album to display. The content of the "context" field is undefined and specific to each individual application definition with one exception: the special property name "opensocial" is reserved for use by the container implementation.  The "context" properties JSON object value or XML element structure MUST NOT contain a property named "opensocial".</td>
</tr>
<tr>
<td class="left"><samp>gadget</samp></td>
<td class="left">An absolutely IRI to an OpenSocial Application specification document that defines the application to be embedded.</td>
</tr>
<tr>
<td class="left"><samp>imageData</samp></td>
<td class="left">An optional string value that containing Base64-encoded binary data for an image resource that represents the embedded content. This can be the same image resource linked to by the previewImage property or a separate image. An embedded experience SHOULD NOT contain both the imageData and previewImage properties.</td>
</tr>
<tr>
<td class="left"><samp>preferredExperience</samp></td>
<td class="left">An optional collection of properties that describe the preferred way the creator of the embedded experience would like containers to render the content.</td>
</tr>
<tr>
<td class="left"><samp>previewImage</samp></td>
<td class="left">An optional absolute IRI of an image that can be used as a preview for the embedded content.</td>
</tr>
<tr>
<td class="left"><samp>url</samp></td>
<td class="left">An absolutely IRI of a web page to be used as an Embedded Experience.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.4.p.3">The "url" and "gadget" properties each reference content that is to be embedded. At least one of these properties MUST be specified.  When both properties are used within the Embedded Experience, the decision about which to render is left to the container.</p>
<p id="rfc.section.4.2.4.p.4">When serialized as JSON, the embedded experience take the form of a single JSON Object with four distinct properties: "context", "gadget", "previewImage" and "url". Additional extension properties MAY be included in the JSON object.</p>
<div id="#rfc.figure.201"></div>
<p>For instance, a simple JSON Embedded Experience that references an OpenSocial Application:</p>
<pre>
    {
      "gadget" : "http://www.example.com/embedded/gadget.xml",
      "context" : {
        "title" : "Hello World",
        "id" : 123
      },
      "previewImage" : "http://www.example.com/embedded/123.png"
    }
      </pre>
<p id="rfc.section.4.2.4.p.5">When serialized as XML, it is expressed in the form of a root element &lt;embed&gt; containing four child elements, the order of which is considered insignificant: &lt;context&gt;, &lt;gadget&gt;, &lt;previewImage&gt;, and &lt;url&gt;. Additional extension elements and attributes MAY be included in the JSON object.</p>
<div id="#rfc.figure.202"></div>
<p>For example,</p>
<pre>
    &lt;embed&gt;
      &lt;gadget&gt;http://www.example.com/embedded/gadget.xml&lt;/gadget&gt;
      &lt;context&gt;
        &lt;title&gt;Hello World&lt;/title&gt;
        &lt;id&gt;123&lt;/id&gt;
      &lt;/context&gt;
      &lt;previewImage&gt;http://www.example.com/embedded/123.png&lt;/previewImage&gt;
    &lt;/embed&gt;
      </pre>
<p id="rfc.section.4.2.4.p.6">Note that no XML namespace is currently declared for the XML serialization. This means that special care must be taken when including an XML embedded experience into another type of XML document. For example, the following shows an XML embedded experience within a partial Atom Entry Document. Note the addition of <samp>xmlns=""</samp> on the embed element in order to "undeclare" the in-scope default XML namespace.</p>
<div id="#rfc.figure.203"></div>
<pre>
    &lt;entry xmlns="http://www.w3.org/2005/Atom"&gt;
      &lt;id&gt;http://example.org/entries/1&lt;/id&gt;
      ...
      &lt;embed xmlns=""&gt;
        &lt;gadget&gt;http://www.example.com/embedded/gadget.xml&lt;/gadget&gt;
        &lt;context&gt;
          &lt;title&gt;Hello World&lt;/title&gt;
          &lt;id&gt;123&lt;/id&gt;
        &lt;/context&gt;
        &lt;previewImage&gt;http://www.example.com/embedded/123.png&lt;/previewImage&gt;
      &lt;/embed&gt;
    &lt;/entry&gt;
      </pre>
<h1 id="rfc.section.4.2.4.1">
<a href="#rfc.section.4.2.4.1">4.2.4.1.</a> Additional Examples</h1>
<div id="#rfc.figure.204"></div>
<p>A simple URL embedded experience using the JSON serialization:</p>
<pre>
    {
      "url" : "http://www.example.org/embed/123.html"
    }
        </pre>
<div id="#rfc.figure.205"></div>
<p>The same URL embedded experience using the XML serialization:</p>
<pre>
    &lt;embed&gt;
      &lt;url&gt;http://www.example.org/embed/123.html&lt;/url&gt;
    &lt;/embed&gt;
        </pre>
<div id="#rfc.figure.206"></div>
<p>An embedded experience that specifies both a gadget and URL serialized as JSON:</p>
<pre>
    {
      "gadget" : "http://www.example.com/embedded/gadget.xml",
      "url" : "http://www.example.org/embed/123.html",
      "context" : {
        "title" : "Hello World",
        "id" : 123
      },
      "previewImage" : "http://www.example.com/embedded/123.png"
    }
        </pre>
<div id="#rfc.figure.207"></div>
<p>The same embedded experience serialized as XML:</p>
<pre>
    &lt;embed&gt;
      &lt;gadget&gt;http://www.example.com/embedded/gadget.xml&lt;/gadget&gt;
      &lt;url&gt;http://www.example.org/embed/123.html&lt;/url&gt;
      &lt;context&gt;
        &lt;title&gt;Hello World&lt;/title&gt;
        &lt;id&gt;123&lt;/id&gt;
      &lt;/context&gt;
      &lt;previewImage&gt;http://www.example.com/embedded/123.png&lt;/previewImage&gt;
    &lt;/embed&gt;
      </pre>
<h1 id="rfc.section.4.2.4.2">
<a href="#rfc.section.4.2.4.2">4.2.4.2.</a> Considerations for Embedded Gadgets</h1>
<h1 id="rfc.section.4.2.4.2.1">
<a href="#rfc.section.4.2.4.2.1">4.2.4.2.1.</a> The "embedded" View</h1>
<p id="rfc.section.4.2.4.2.1.p.1">When rendering an application as an embedded experience, the container will look within the specification document for a view named "embedded".  Gadget developers can use this view to specify a customized view of the application that is specific to the embedded experience. If an "embedded" view is not found within the specification document, the contain SHOULD render the application's default unnamed view.</p>
<h1 id="rfc.section.4.2.4.2.2">
<a href="#rfc.section.4.2.4.2.2">4.2.4.2.2.</a> Accessing The Context</h1>
<p id="rfc.section.4.2.4.2.2.p.1">An embedded experience application has the option of requiring some contextual information in order to render itself.  By abstracting the data from the application itself, developers can develop generalized applications that can be used for all embedded experiences of a specific type.  For example, an application developed to display videos can be built so that the id of the video is contained and extracted from the embedded experience's "context" property.</p>
<div id="#rfc.figure.208"></div>
<pre>
    {
      "gadget" : "http://example.org/embedded/video.xml",
      "context" : {
        "video-id" : "abc123"
      }
    }
          </pre>
<p id="rfc.section.4.2.4.2.2.p.2">Gadgets that are written to support embedded experiences MUST require the "embedded-experiences" feature within their specification document in order to access the context.  The contextual data is stored within the <a href="#DataContext">data context</a> <cite title="NONE">[DataContext]</cite> object for the application.  The key, "org.opensocial.ee.context", is used to access the context.  Gadgets can add a listener on the data context object for this key, or it may retreive the key's value by using the data context APIs.</p>
<div id="#rfc.figure.209"></div>
<p>For instance, the Gadget below registers a listener with the data context to retrieve any context data included with the embedded experience:</p>
<pre>
    &lt;Module&gt;
      &lt;ModulePrefs title="Embedded Experiences Test" description="Tests the embedded experiences APIs."&gt;
        &lt;Require feature="embedded-experiences"&gt;&lt;/Require&gt;
      &lt;/ModulePrefs&gt;
      &lt;Content type="html" view="embedded"&gt;
          &lt;![CDATA[
            &lt;script type="text/javascript"&gt;
              function myCallback(key) {
                var context = opensocial.data.getDataContext().getDataSet(key);
                var video_id = context["video-id"];
              }
              function initData() {
                opensocial.data.getDataContext().registerListener(
                  "org.opensocial.ee.context", myCallback);
              }
              gadgets.util.registerOnLoadHandler(initData);
          &lt;/script&gt;
           &lt;div id="contextData"&gt;&lt;/div&gt;
      ]]&gt;
      &lt;/Content&gt;
    &lt;/Module&gt;</pre>
<h1 id="rfc.section.4.2.4.2.2.1">
<a href="#rfc.section.4.2.4.2.2.1">4.2.4.2.2.1.</a> <a href="#rootContext" id="rootContext">Additional Container Specific Context</a>
</h1>
<p id="rfc.section.4.2.4.2.2.1.p.1">While the contextual data associated with the "org.opensocial.ee.context" key will generally originate from the information provided by the "context" property within the Embedded Experience document, containers are free to insert additional, container specific contexual data into the object. For example, a container might wish to communicate information about the type of parent object within which the Embedded Experience information was received.</p>
<p id="rfc.section.4.2.4.2.2.1.p.2">If such additional information is provided, the object associated with the "org.opensocial.ee.context" key will have an additional "opensocial" property, whose value is itself a object with at least one property named "associatedContext" whose value is an object whose properties are entirely defined by the specific container implementation.</p>
<div id="#rfc.figure.210"></div>
<p>The following example illustrates how this additional context information is accessed:</p>
<pre>
    function myCallback(key) {
      var context = opensocial.data.getDataContext().getDataSet(key);
      var video_id = context["video-id"];
      
      var associatedContext = context.opensocial.associatedContext;
      // the properties are container specific
      var ac_id = associatedContext.id;
      var ac_type = associatedContext.type;
      // ...
    }
    function initData() {
      opensocial.data.getDataContext().registerListener(
        "org.opensocial.ee.context", myCallback);
    }
    gadgets.util.registerOnLoadHandler(initData);
            </pre>
<p id="rfc.section.4.2.4.2.2.1.p.3">Specific container implementations are free to insert any additional information they wish into both the "associatedContext" and "opensocial" object values. The interpretation and use of any such information is considered out of the scope of this specification.</p>
<h1 id="rfc.section.4.2.4.3">
<a href="#rfc.section.4.2.4.3">4.2.4.3.</a> <a href="#preferredExperience" id="preferredExperience">Preferred Experiences</a>
</h1>
<p id="rfc.section.4.2.4.3.p.1">While the container retains control over deciding exactly how an embedded experience is processed and rendered, there are situations where the creator of the embedded experience might wish to provide clues to the container as to how it would prefer the content to be displayed. These clues are included within the Embedded Experience using the "preferredExperience" property.</p>
<div id="#rfc.figure.211"></div>
<p>The following illustrates a basic example serialized as JSON:</p>
<pre>
    {
      "gadget" : "http://www.example.com/embedded/gadget.xml",
      "url" : "http://www.example.com/foo/bar.html",
      "context" : {
        "title" : "Hello World",
        "id" : 123
      },
      "previewImage" : "http://www.example.com/embedded/123.png",
      "preferredExperience" : {
        "target" : {
          "type" : "gadget",
          "view" : "my-ee-view"
        },
        "display" : {
          "type" : "link"
        }
    }
      </pre>
<div id="#rfc.figure.212"></div>
<p>And the same example using the alternative XML serialization:</p>
<pre>
    &lt;embed&gt;
      &lt;gadget&gt;http://www.example.com/embedded/gadget.xml&lt;/gadget&gt;
      &lt;url&gt;http://www.example.com/foo/bar.html&lt;/url&gt;
      &lt;context&gt;
        &lt;title&gt;Hello World&lt;/title&gt;
        &lt;id&gt;123&lt;/id&gt;
      &lt;/context&gt;
      &lt;previewImage&gt;http://www.example.com/embedded/123.png&lt;/previewImage&gt;
      &lt;preferredExperience&gt;
        &lt;target&gt;
          &lt;type&gt;gadget&lt;/type&gt;
          &lt;view&gt;my-ee-view&lt;/view&gt;
        &lt;/target&gt;
        &lt;display&gt;
          &lt;type&gt;link&lt;/type&gt;
        &lt;/display&gt;
      &lt;/preferredExperience&gt;
    &lt;/embed&gt;
      </pre>
<p id="rfc.section.4.2.4.3.p.2">In this example, we have an embedded experience serialized as JSON.  The structure defines both a "url" and a "gadget" property, both of w which can be used by the container to display embedded content. Typically, the decision of which to display when the embedded experience is rendered is up to the container. The "preferredExperience.target" property allows the creator of the embedded experience to indicate that it would prefer the container to use the "gadget" property for rendering, and specifically that the "my-ee-view" view within that application be used. The "preferredExperience.display" property indicates that rather than simply displaying the application automatically, the embedded experience's creator would rather the container initially display a hyperlink that, when clicked, causes the application to be displayed.</p>
<div id="#rfc.table.23"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Property</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left"><samp>display</samp></td>
<td class="left">Describes preferences for how the embedded experience should initially be displayed by the container. The value of the "display" property is an object that contains a required "type" property, the value of which determines what other properties might appear within the object.</td>
</tr>
<tr>
<td class="left"><samp>target</samp></td>
<td class="left">Describes preferences for which type of embedded experience the container should render. For instance, if the embed includes both a "url" and "gadget" property, the "target" is used to specify which is preferred. The value of the "target" property is an object that contains a required "type" property, the value of which determines what other properties might appear within the object.</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.4.2.4.3.1">
<a href="#rfc.section.4.2.4.3.1">4.2.4.3.1.</a> Display Types</h1>
<p id="rfc.section.4.2.4.3.1.p.1">This specification currently defines two possible values for the required "type" property on the display object: "link", "image".  Each of which are illustrated below.</p>
<div id="#rfc.figure.213"></div>
<p>Display using a hyperlink:</p>
<pre>
    {
      "gadget" : "...",
      ...,
      "preferredExperience" : {
        "target": {...},
        "display": {
          "type" : "link",
          "text" : "Click on me!",
          "title" : "Click on this link!"
        }
      }
    }
        </pre>
<p id="rfc.section.4.2.4.3.1.p.2">When "type" equals "link", the additional properties on the display object are:</p>
<div id="#rfc.table.24"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Property</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left"><samp>text</samp></td>
<td class="left">A required String that provides the text to display with the hyperlink.</td>
</tr>
<tr>
<td class="left"><samp>title</samp></td>
<td class="left">Optional text to display as the "popup help" or "tooltip" of the hyperlink.</td>
</tr>
</tbody>
</table>
<div id="#rfc.figure.214"></div>
<p>Display using the previewImage:</p>
<pre>
    {
      "gadget" : "...",
      ...,
      "previewImage" : "http://example.org/preview.png",
      "preferredExperience" : {
        "target": {...},
        "display": {
          "type" : "image",
          "altText" : "The alt text",
          "width" : 100,
          "height" : 100
        }
      }
    } 
        </pre>
<div id="#rfc.figure.215"></div>
<p>Display using contained Base64-encoded binary data:</p>
<pre>
    {
      "gadget" : "...",
      ...,
      "imageData" : "{Base64-encoded Image}",
      "preferredExperience" : {
        "target": {...},
        "display": {
          "type" : "image",
          "altText" : "The alt text",
          "width" : 100,
          "height" : 100
        }
      }
    } 
        </pre>
<p id="rfc.section.4.2.4.3.1.p.3">When "type" equals "image", the additional properties on the display object are:</p>
<div id="#rfc.table.25"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Property</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left"><samp>altText</samp></td>
<td class="left">Specifies optional, alternative text to display if the image cannot be displayed. Equivalent to the HTML image tags alt attribute.</td>
</tr>
<tr>
<td class="left"><samp>height</samp></td>
<td class="left">Specifies the preferred display height of the image in pixels.</td>
</tr>
<tr>
<td class="left"><samp>width</samp></td>
<td class="left">Specifies the preferred display width of the image in pixels.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.4.3.1.p.4">Implementations are free to define additional display types, each with their own properties. If a container encounters an embedded experience that uses an unknown or unsupported display type, the container MUST ignore the display preferences.</p>
<h1 id="rfc.section.4.2.4.3.2">
<a href="#rfc.section.4.2.4.3.2">4.2.4.3.2.</a> Target Types</h1>
<p id="rfc.section.4.2.4.3.2.p.1">This specification currently defines two possible values for the type property on the target object: "gadget" and "url". Each of which are illustrated below.</p>
<div id="#rfc.figure.216"></div>
<p>Preferring the gadget target:</p>
<pre>
    {
      "gadget" : "...",
      "url" : "...",
      ...,
      "preferredExperience" : {
        "target": {
          "type" : "gadget",
          "view" : "my-ee-view"
        },
        "display": {
          ...
        }
      }
    }
        </pre>
<p id="rfc.section.4.2.4.3.2.p.2">Note that the preferred experience target's "type" property is only required if the preferred target is not obvious within the embedded experience. For instance, if the embedded experience only defines an IRI value for the "gadget" property, then the preferred target type is "gadget". However, if both the "url" and "gadget" properties are specified, as in the example above, the target type in the preferred experience MUST be specified. Containers MUST ignore the preferred experience if the target type value does not match the options specified within the Embedded Experience (e.g. target type specifies "url" but only a "gadget" IRI is provided, etc).</p>
<p id="rfc.section.4.2.4.3.2.p.3">When "type" equals "gadget", the additional properties on the target object are:</p>
<div id="#rfc.table.26"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Property</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left"><samp>view</samp></td>
<td class="left">The preferred application view to render. If not specified, the value "embedded" is assumed.</td>
</tr>
<tr>
<td class="left"><samp>viewTarget</samp></td>
<td class="left">Specifies where the container SHOULD render the view. Possible values are "TAB", "DIALOG", "MODALDIALOG", "FLOAT", and "SIDEBAR".</td>
</tr>
</tbody>
</table>
<div id="#rfc.figure.217"></div>
<p>Preferring the url target:</p>
<pre>
    {
      "gadget" : "...",
      "url" : "...",
      ...,
      "preferredExperience" : {
        "target": {
          "type" : "url",
          "viewTarget" : "_new"
        },
        "display": {
          ...
        }
      }
    }
        </pre>
<p id="rfc.section.4.2.4.3.2.p.4">When "type" equals "url", the additional properties on the target object are:</p>
<div id="#rfc.table.27"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Property</th>
<th class="left">Description</th>
</tr></thead>
<tbody><tr>
<td class="left"><samp>viewTarget</samp></td>
<td class="left">When specifying a URL, rather than being forced to render in an embedded view, the developer may wish to indicate to the container that the page be opened in a new browser window. In this case, the target properties for a URL match those that are defined by the HTML spec, e.g. "_blank".</td>
</tr></tbody>
</table>
<p id="rfc.section.4.2.4.3.2.p.5">Implementations are free to define additional target types, each with their own properties. If a container encounters an embedded experience that uses an unknown or unsupported target type, the container MUST ignore the target preferences.</p>
<h1 id="rfc.section.4.2.4.4">
<a href="#rfc.section.4.2.4.4">4.2.4.4.</a> Security</h1>
<p id="rfc.section.4.2.4.4.p.1">Embedded experiences allow content to be rendered on the page that user has not necessarily requested, therefore it needs to be secured.  The container SHOULD only ever render content that the user has previously approved.  This specification does not dictate how secure rendering of embedded experiences is to be performed.</p>
<h1 id="rfc.section.4.2.4.5">
<a href="#rfc.section.4.2.4.5">4.2.4.5.</a> Embedded Experiences within Activity Streams</h1>
<p id="rfc.section.4.2.4.5.p.1">Embedded experiences can be used within an Activity Streams document in order to provide a more interactive experience. Whereas the core properties of the Activity provide a textual description of the event, an included embedded experience can provide a direct representation of the object involved.</p>
<div id="#rfc.figure.218"></div>
<p>For instance, if a user uploads a collection of photos and creates a new photo album, an embedded experience can be used within the activity to provide a representation of the album itself:</p>
<pre>
    {
      "postedTime": "2011-02-10T15:04:55Z",
      "actor": {
        "objectType" : "person",
        "id": "tag:example.org,2011:martin",
        "displayName": "Martin Smith"
      }
      "verb": "post",
      "object" : {
        "objectType":"collection",
        "objectTypes":["image"]
        "id": "http://example.org/albums/germany-2009",
        "url": "http://example.org/albums/germany-2009",
      },
      "openSocial" : {
        "embed" : {
          "gadget" : "http://example.org/AlbumViewer.xml",
          "context" : {
            "albumName": "Germany 2009",
            "photoUrls": [
              "http://examplephotos.com/3495/3925132517_5959dac775_t.jpg",
              "http://examplephotos.com/3629/3394799776_47676abb46_t.jpg",
              "http://examplephotos.com/4009/4413640211_715d924d9b_t.jpg",
              "http://examplephotos.com/2340/3528537244_d2fb037aba_t.jpg",
              "http://examplephotos.com/36/98407782_9c4c5866d1_t.jpg",
              "http://examplephotos.com/48/180544479_bb0d0f6559_t.jpg",
              "http://examplephotos.com/2668/3858018351_1e7b73c0b7_t.jpg"
            ]
          }
        }
      }
    }</pre>
<p id="rfc.section.4.2.4.5.p.2">As illustrated in the example, when included within an activity, the embedded experience MUST appear as the value of the "embed" property as a child of the "openSocial" property.</p>
<h1 id="rfc.section.4.2.4.6">
<a href="#rfc.section.4.2.4.6">4.2.4.6.</a> Embedded Experiences within Email</h1>
<p id="rfc.section.4.2.4.6.p.1">Numerous services send email notifications to your inbox in order to let you know something took place that you may be interested in.  Most of the time however these notifications do not provide much useful information beyond a link back to the service's website.  By leveraging embedded experiences, services can send an embedded representation of the object the notification is about, and allow the user to take action on the notification directly from within an embedded experiences enabled email client.</p>
<p id="rfc.section.4.2.4.6.p.2">Embedded experiences serialized as either JSON or XML can be embedded Multipart MIME encoded email messages. Such email messages MUST utilize the "multipart/alternative" MIME variant and MUST contain at least two MIME parts -- one containing regular content of the email message encoded as text/html content, and another containing the embedded experience content using either the "application/embed+json" or "application/embed+xml" MIME media type, respectively representing the JSON and XML serializations. Additional MIME parts MAY be included </p>
<div id="#rfc.figure.219"></div>
<p>For instance,</p>
<pre>
    From: notifications@socialnetwork.com
    To: johndoe@example.com
    Subject: Social Network: Mary Has Commented On Your Status
    MIME-Version: 1.0
    Content-Type: multipart/alternative;
            boundary="XXXXboundary text"
  
    Mary has commented on your status.
    
    --XXXXboundary text
    Content-Type: text/plain
    
    Mary has commeneted on your status. 
    
    --XXXXboundary text
    Content-Type: text/html
  
    &lt;html&gt;
    &lt;!-- HTML representation here --&gt;
    &lt;/html&gt;
  
    --XXXXboundary text
    Content-Type: application/embed+json
    {
      "gadget" : "http://www.socialnetwork.com/embedded/commentgadget.xml",
      "context" : 123
    }</pre>
<h1 id="rfc.section.4.2.5">
<a href="#rfc.section.4.2.5">4.2.5.</a> <a href="#gadgets.flash" id="gadgets.flash">The Flash Feature</a>
</h1>
<p id="rfc.section.4.2.5.p.1">The "Flash" feature provides three JavaScript methods that simplify the embedding of Flash-based content in applications.  The feature is enabled by specifying feature="flash" using either the &lt;Require&gt; or &lt;Optional&gt; elements in the &lt;ModulePrefs&gt;. The "Flash" feature defines no parameters.</p>
<p id="rfc.section.4.2.5.p.2">Containers SHOULD support the "Flash" feature.</p>
<div id="#rfc.figure.220"></div>
<p>In the partial application specification below, we declare that the "flash" feature is required and render a remote flash resource within the default view:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      ...
      &lt;Require feature="flash" /&gt;
      ...
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;&lt;[CDATA[
      &lt;div id="container"&gt;&lt;/div&gt;
      &lt;script&gt;
        ...
        gadgets.flash.embedCachedFlash(
          "http://example.org/content/movie.swf",
          "container", 11
        );
        ...
      &lt;/script&gt;
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
      </pre>
<h1 id="rfc.section.4.2.5.1">
<a href="#rfc.section.4.2.5.1">4.2.5.1.</a> JavaScript API</h1>
<p id="rfc.section.4.2.5.1.p.1">The following JavaScript APIs are enabled when the "Flash" feature is enabled for an application.</p>
<h1 id="rfc.section.4.2.5.1.1">
<a href="#rfc.section.4.2.5.1.1">4.2.5.1.1.</a> <a href="#gadgets.flash.embedCachedFlash" id="gadgets.flash.embedCachedFlash">gadgets.flash.embedCachedFlash</a>
</h1>
<p id="rfc.section.4.2.5.1.1.p.1">Embeds a cached Flash document into a container DOM object.</p>
<div id="#rfc.figure.221"></div>
<pre>
  &lt;static&gt; &lt;Boolean&gt; gadgets.flash.embedCachedFlash(url, container, version, options)
          </pre>
<p id="rfc.section.4.2.5.1.1.p.2">Input Parameters:</p>
<div id="#rfc.table.28"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">url</td>
<td class="left">String</td>
<td class="left">The IRI of the Flash resource to embed.</td>
</tr>
<tr>
<td class="left">container</td>
<td class="left">String | Object</td>
<td class="left">Specifies either the DOM identifier or object reference for the existing container object (e.g. a &lt;div&gt;) within which the Flash content will be embedded.</td>
</tr>
<tr>
<td class="left">version</td>
<td class="left">Number</td>
<td class="left">Specifies the minimum Flash Player version required to support the embedded content.</td>
</tr>
<tr>
<td class="left">options</td>
<td class="left">Object</td>
<td class="left">An optional object that MAY contain any property that is valid for the HTML &lt;embed&gt; tag. These properties will be passed directly through the &lt;embed&gt; tag generated by the API call.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.5.1.1.p.3">The method will return either <samp>True</samp> or <samp>False</samp> to indicate whether the method completed successfully or not.</p>
<h1 id="rfc.section.4.2.5.1.2">
<a href="#rfc.section.4.2.5.1.2">4.2.5.1.2.</a> <a href="#gadgets.flash.embedFlash" id="gadgets.flash.embedFlash">gadgets.flash.embedFlash</a>
</h1>
<p id="rfc.section.4.2.5.1.2.p.1">Embeds a cached Flash document into a container DOM object.</p>
<div id="#rfc.figure.222"></div>
<pre>
  &lt;static&gt; &lt;Boolean&gt; gadgets.flash.embedCachedFlash(url, container, version, options)
          </pre>
<p id="rfc.section.4.2.5.1.2.p.2">Input Parameters:</p>
<div id="#rfc.table.29"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">url</td>
<td class="left">String</td>
<td class="left">The IRI of the Flash resource to embed.</td>
</tr>
<tr>
<td class="left">container</td>
<td class="left">String | Object</td>
<td class="left">Specifies either the DOM identifier or object reference for the existing container object (e.g. a &lt;div&gt;) within which the Flash content will be embedded.</td>
</tr>
<tr>
<td class="left">version</td>
<td class="left">Number</td>
<td class="left">Specifies the minimum Flash Player version required to support the embedded content.</td>
</tr>
<tr>
<td class="left">options</td>
<td class="left">Object</td>
<td class="left">An optional object that MAY contain any property that is valid for the HTML &lt;embed&gt; tag. These properties will be passed directly through the &lt;embed&gt; tag generated by the API call.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.5.1.2.p.3">The method will return either <samp>True</samp> or <samp>False</samp> to indicate whether the method completed successfully or not.</p>
<h1 id="rfc.section.4.2.5.1.3">
<a href="#rfc.section.4.2.5.1.3">4.2.5.1.3.</a> <a href="#gadgets.flash.getMajorVersion" id="gadgets.flash.getMajorVersion">gadgets.flash.getMajorVersion</a>
</h1>
<p id="rfc.section.4.2.5.1.3.p.1">Returns the major version of the Flash player supported by the container.</p>
<div id="#rfc.figure.223"></div>
<pre>
  &lt;static&gt; &gt;Number&gt; gadgets.flash.getMajorVersion()
          </pre>
<h1 id="rfc.section.4.2.6">
<a href="#rfc.section.4.2.6">4.2.6.</a> The JavaScript Internationalization (i18n) Feature</h1>
<p id="rfc.section.4.2.6.p.1">The "JavaScript i18n" feature provides a JavaScript API for localized parsing and formatting of dates, times, numbers and currency according to the rules for the application's locale as set by the container. The feature is specified by including either an "Optional" or "Required" element within the "ModulePrefs" The feature identifier is "opensocial-i18n".</p>
<p id="rfc.section.4.2.6.p.2">Once available, developer's can use the feature via the "gadgets.i18n" JavaScript class.</p>
<p id="rfc.section.4.2.6.p.3">The locale used by an application is established by the container when the view is rendered. The i18n feature will use the country and language specified in the locale to load the appropriate formatter and parser for any given date, time, number or currency.</p>
<p id="rfc.section.4.2.6.p.4">The i18n feature provides four distinct methods: formatDateTime, formatNumber, parseDateTime and parseNumber. At a minimum, each method takes as input a format pattern that defines the structure of the data being parsed or formatted and the value to which the pattern is to be applied.</p>
<p id="rfc.section.4.2.6.p.5">For instance, to format an integer using a localized grouping separator (e.g. the number 1234567 formatted as "1,234,567" when the locale is "en-US"), the following can be used:</p>
<div id="#rfc.figure.224"></div>
<pre>
  var str = gadgets.i18n.formatNumber("#,###", 1234567);
    </pre>
<p id="rfc.section.4.2.6.p.6">The i18n feature includes a number of common, predefined format patterns that can be used. The specific definition of these formats are specific to the locale established by the container. For instance, using the predefined "gadgets.i18n.MEDIUM_DATE_FORMAT" pattern to format the date for August, 4th 2006 using the "de" (German) locale using the formatDateTime method would output "04.08.2006". Using the same predefined pattern using the "en-US" (United States) locale, however, would output "08-04-2006".</p>
<div id="#rfc.figure.225"></div>
<pre>
  var date = new Date(2006,7,4);
  var str = gadgets.i18n.formatDateTime(gadgets.i18n.MEDIUM_DATE_FORMAT, date);
    </pre>
<p id="rfc.section.4.2.6.p.7">When parsing and formatting currencies using the predefined patterns, there are several considerations that need to be taken into account.  For example, when the default locale is set to "fr-FR" (France), and the gadgets.i18n.CURRENCY_PATTERN is used to parse a string, the parser will assume that the input string is formatted according to the localized rules for the "fr-FR" locale:</p>
<div id="#rfc.figure.226"></div>
<pre>
  var num = gadgets.i18n.parseNumber(gadgets.i18n.CURRENCY_PATTERN, "20 000 \u20AC");
      </pre>
<p id="rfc.section.4.2.6.p.8">Here, "num" will equal 20000. </p>
<p id="rfc.section.4.2.6.p.9">If a foreign currency is used, U.S. Dollars for instance, the input string MUST still be formatted in accordance to the rules specified for the established locale and an optional currency code can be specified:</p>
<div id="#rfc.figure.227"></div>
<pre>
  var num = gadgets.i18n.parseNumber(gadgets.i18n.CURRENCY_PATTERN, "20 000 $", 0, "USD");
     </pre>
<p id="rfc.section.4.2.6.p.10">If, however, the input string is not formatted in accordance to the localized rules for the established locale, the predefined pattern will not work and a custom pattern needs to be used:</p>
<div id="#rfc.figure.228"></div>
<pre>
  var num = gadgets.i18n.parseNumber("#,###", "$20,000", 0, "USD");
     </pre>
<h1 id="rfc.section.4.2.6.1">
<a href="#rfc.section.4.2.6.1">4.2.6.1.</a> Specifying Format and Parsing Patterns</h1>
<h1 id="rfc.section.4.2.6.1.1">
<a href="#rfc.section.4.2.6.1.1">4.2.6.1.1.</a> Date/Time Pattern Specification</h1>
<p id="rfc.section.4.2.6.1.1.p.1">When formatting and parsing dates and times, the i18n feature utilizes the patten specification defined in Appendix F of the <a href="http://www.unicode.org/reports/tr35/#Date_Format_Patterns">Unicode Locale Data Markup Language</a> with the exception that support for the following symbols is not required: </p>

<ul>
<li>w: Week of year</li>
<li>W: Week of Month.</li>
<li>D: Day of year.</li>
<li>F: Day of Week in Month.</li>
<li>g: Modified Julian day</li>
</ul>
<h1 id="rfc.section.4.2.6.1.2">
<a href="#rfc.section.4.2.6.1.2">4.2.6.1.2.</a> Number Pattern Specification</h1>
<p id="rfc.section.4.2.6.1.2.p.1">Patterns for formatting and parsing numbers are expressed using the same grammar used by the Java Standard Editon's as described <a href="http://docs.oracle.com/javase/7/docs/api/java/text/NumberFormat.html">NumberFormat</a> class.</p>
<p id="rfc.section.4.2.6.1.2.p.2">For example, assuming a locale of "en-US", using the pattern "#,##0.00" to format the number 1234567.1234 using the formatNumber method would output "1,234,567.12".</p>
<h1 id="rfc.section.4.2.6.2">
<a href="#rfc.section.4.2.6.2">4.2.6.2.</a> JavaScript API</h1>
<h1 id="rfc.section.4.2.6.2.1">
<a href="#rfc.section.4.2.6.2.1">4.2.6.2.1.</a> Predefined Format Constants</h1>
<p id="rfc.section.4.2.6.2.1.p.1">The Predefined Format Constants that MUST be supported are listed in the table below. The specific pattern associated with each constant will vary by locale.</p>
<div id="#rfc.table.30"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Property</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left"><samp>gadgets.i18n.CURRENCY_PATTERN</samp></td>
<td class="left">The default currency format, e.g. for the locale "en-US", the number 1234.235 would format as "$1,234.34".</td>
</tr>
<tr>
<td class="left"><samp>gadgets.i18n.DECIMAL_PATTERN</samp></td>
<td class="left">The default decimal number format, e.g. for the locale "de-DE", the number 1234 with a fractional decimal of 13 would format as "1.234,13".</td>
</tr>
<tr>
<td class="left"><samp>gadgets.i18n.PERCENT_PATTERN</samp></td>
<td class="left">The default percentage number format, e.g. for the locale "en-US", the number 123 would format as "12,300%"</td>
</tr>
<tr>
<td class="left"><samp>gadgets.i18n.SCIENTIFIC_PATTERN</samp></td>
<td class="left">The default scientific-notation format, e.g. the number 12345.0 would format as "1E4"</td>
</tr>
<tr>
<td class="left"><samp>gadgets.i18n.FULL_DATE_FORMAT</samp></td>
<td class="left"></td>
</tr>
<tr>
<td class="left"><samp>gadgets.i18n.FULL_DATETIME_FORMAT</samp></td>
<td class="left"></td>
</tr>
<tr>
<td class="left"><samp>gadgets.i18n.FULL_TIME_FORMAT</samp></td>
<td class="left"></td>
</tr>
<tr>
<td class="left"><samp>gadgets.i18n.LONG_DATE_FORMAT</samp></td>
<td class="left"></td>
</tr>
<tr>
<td class="left"><samp>gadgets.i18n.LONG_DATETIME_FORMAT</samp></td>
<td class="left"></td>
</tr>
<tr>
<td class="left"><samp>gadgets.i18n.LONG_TIME_FORMAT</samp></td>
<td class="left"></td>
</tr>
<tr>
<td class="left"><samp>gadgets.i18n.MEDIUM_DATE_FORMAT</samp></td>
<td class="left"></td>
</tr>
<tr>
<td class="left"><samp>gadgets.i18n.MEDIUM_DATETIME_FORMAT</samp></td>
<td class="left"></td>
</tr>
<tr>
<td class="left"><samp>gadgets.i18n.MEDIUM_TIME_FORMAT</samp></td>
<td class="left"></td>
</tr>
<tr>
<td class="left"><samp>gadgets.i18n.SHORT_DATE_FORMAT</samp></td>
<td class="left"></td>
</tr>
<tr>
<td class="left"><samp>gadgets.i18n.SHORT_DATETIME_FORMAT</samp></td>
<td class="left"></td>
</tr>
<tr>
<td class="left"><samp>gadgets.i18n.SHORT_TIME_FORMAT</samp></td>
<td class="left"></td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.4.2.6.2.2">
<a href="#rfc.section.4.2.6.2.2">4.2.6.2.2.</a> <a href="#gadgets.i18n.formatDateTime" id="gadgets.i18n.formatDateTime">gadgets.i18n.formatDateTime</a>
</h1>
<p id="rfc.section.4.2.6.2.2.p.1">The <samp>gadgets.i18n.formatDateTime</samp> method formats a "Date" object with provided pattern specification. The pattern could be a string using ICU notation or a predefined pattern. A string using ICU notation offers the most flexibility. Each field as specified in the pattern has locale specific behavior. The pattern string is allowed to contain string literals, and one type of pattern might not work for all locales. In those case, the pattern itself could also be locale specific, thus not good for sharing among locales.</p>
<div id="#rfc.figure.229"></div>
<pre>
  &lt;static&gt; &lt;String&gt; gadgets.i18n.formatDateTime(pattern,date)
      </pre>
<div id="#rfc.figure.230"></div>
<p>For example:</p>
<pre>
  date = new Date(2006, 6, 27, 13, 10, 10, 250);
  assertEquals("13:10:10", gadgets.i18n.formatDateTime("HH:mm:ss", date));
      </pre>
<p id="rfc.section.4.2.6.2.2.p.2">Input Parameters:</p>
<div id="#rfc.table.31"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">pattern</td>
<td class="left">string/number</td>
<td class="left">String to specify patterns or Number used to reference predefined pattern that a date should be formatted into.</td>
</tr>
<tr>
<td class="left">date</td>
<td class="left">Date</td>
<td class="left">Date object being formatted.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.6.2.2.p.3">The method returns a String representation of the provided date and time.</p>
<h1 id="rfc.section.4.2.6.2.3">
<a href="#rfc.section.4.2.6.2.3">4.2.6.2.3.</a> <a href="#gadgets.i18n.formatNumber" id="gadgets.i18n.formatNumber">gadgets.i18n.formatNumber</a>
</h1>
<p id="rfc.section.4.2.6.2.3.p.1">The <samp>gadgets.i18n.formatNumber</samp> method formats number using the pattern specified. The pattern can be a string pattern or one of the predefined patterns. The formatted string is returned. If an error is encountered, zero will be returned.</p>
<div id="#rfc.figure.231"></div>
<pre>
  &lt;static&gt; &lt;String&gt; gadgets.i18n.formatNumber(pattern, value, opt_currencyCode)
      </pre>
<div id="#rfc.figure.232"></div>
<p>For example:</p>
<pre>
  var str = gadgets.i18n.formatNumber("#,###", 1234567890);
  assertEquals("1,234,567,890", str);
  var str = gadgets.i18n.formatNumber(gadgets.i18n.CURRRENCY_PATTERN, 1234.569);
  assertEquals("$1,234.58", str);
      </pre>
<p id="rfc.section.4.2.6.2.3.p.2">Input Parameters:</p>
<div id="#rfc.table.32"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">pattern</td>
<td class="left">string/number</td>
<td class="left">String to specify patterns or Number used to reference predefined pattern that a number should be formatted into.</td>
</tr>
<tr>
<td class="left">value</td>
<td class="left">number</td>
<td class="left">The number being formatted.</td>
</tr>
<tr>
<td class="left">opt_currencyCode</td>
<td class="left">string</td>
<td class="left">optional international currency code, it determines the currency code/symbol should be used in format/parse. If not given, the currency code for current locale will be used.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.6.2.3.p.3">The method returns the formatted string.</p>
<h1 id="rfc.section.4.2.6.2.4">
<a href="#rfc.section.4.2.6.2.4">4.2.6.2.4.</a> <a href="#gadgets.i18n.parseDateTime" id="gadgets.i18n.parseDateTime">gadgets.i18n.parseDateTime</a>
</h1>
<p id="rfc.section.4.2.6.2.4.p.1">The <samp>gadgets.i18n.parseDateTime</samp> method will parse the input string ("text"), interpretting it as specified by pattern. The parsed result will be saved into a Date object ("date"). "start" indicates from where in the string the parse should start. This method returns the number of characters consumed.</p>
<div id="#rfc.figure.233"></div>
<pre>
  &lt;static&gt; &lt;Number&gt; gadgets.i18n.parseDateTime(pattern, text, start, date)
      </pre>
<div id="#rfc.figure.234"></div>
<p>For example:</p>
<pre>
  var date = gadgets.i18n.parseDateTime("yyMMdd", "991202", 0, date);
  var year = date.getFullYear();
  var month = date.getMonth();
  var day = date.getDate();
      </pre>
<p id="rfc.section.4.2.6.2.4.p.2">Typically, the complete collection of characters in a string are targeted for parsing. However, there are cases when parsing only a subset of the characters is preferred. For that purpose, the optional "start" and "date" parameters can be used.</p>
<div id="#rfc.figure.235"></div>
<p>For example, suppose you want to parse a string like "88/01, 99/03, 98/05, 97/02", and extract each pair of numbers (e.g. 88/01) as a separate Date:</p>
<pre>
  var date_array = [];
  var pos = 0;
  var text = "88/01, 99/03, 98/05, 97/02";
  while(1) {
    var date = new Date;
    var consumed = gadgets.i18n.parseDateTime("yy/MM", text, pos, date);
    if (consumed &lt;= 0) break;
    date_array.push(date);
    pos += consumed;
    if (pos &lt; text.length &amp;&amp; text[pos] == ',') ++pos;
    if (pos &lt; text.length &amp;&amp; text[pos] == ' ') ++pos;
  }
      </pre>
<div id="#rfc.figure.236"></div>
<p>As with the formatting functions, a predefined pattern can also be passed in as the first parameter:</p>
<pre>
  //assume locale has already been set to zh_CN
  var date = new Date();
  gadgets.i18n.parseDateTime(gadgets.i18n.LONG_DATE_FORMAT, "2006&amp;#24180;7&amp;#26376;24&amp;#26085;", 0, date);
  assertEquals(date.getFullYear(), 2006);
  assertEquals(date.getMonth(), 7 - 1);
  assertEquals(date.getDate(), 24);
      </pre>
<p id="rfc.section.4.2.6.2.4.p.3">Input Parameters:</p>
<div id="#rfc.table.33"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">pattern</td>
<td class="left">string/number</td>
<td class="left">String to specify patterns or Number used to reference predefined pattern that a date should be parsed from.</td>
</tr>
<tr>
<td class="left">text</td>
<td class="left">string</td>
<td class="left">The string that need to be parsed.</td>
</tr>
<tr>
<td class="left">start</td>
<td class="left">number</td>
<td class="left">The character position in "text" where parse begins.</td>
</tr>
<tr>
<td class="left">date</td>
<td class="left">Date</td>
<td class="left">The date object that will hold parsed value.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.6.2.4.p.4">The method returns the number of characters parsed or 0 if the attempt to parse failed.</p>
<h1 id="rfc.section.4.2.6.2.5">
<a href="#rfc.section.4.2.6.2.5">4.2.6.2.5.</a> <a href="#gadgets.i18n.parseNumber" id="gadgets.i18n.parseNumber">gadgets.i18n.parseNumber</a>
</h1>
<p id="rfc.section.4.2.6.2.5.p.1">The <samp>gadgets.i18n.parseNumber</samp> method parses a String to get a number the pattern specified. The pattern can be a string pattern or one of the predefined patterns.</p>
<div id="#rfc.figure.237"></div>
<pre>
  &lt;static&gt; &lt;Number&gt; gadgets.i18n.parseNumber(pattern, text, opt_pos, opt_currencyCode)
      </pre>
<div id="#rfc.figure.238"></div>
<p>For example:</p>
<pre>
  var value = gadgets.i18n.parseNumber("0E0", "1.2345E+4");
  assertEquals(12345.0, value);
  //assume locale has already been set to fr
  var value = gadgets.i18n.parseNumber(gadgets.i18n.CURRENCY_PATTERN, "0,30 EUR");
  assertEquals(0.30, value);
      </pre>
<p id="rfc.section.4.2.6.2.5.p.2">Input Parameters:</p>
<div id="#rfc.table.34"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">pattern</td>
<td class="left">string/number</td>
<td class="left">String to specify patterns or Number used to reference predefined pattern that a number should be parsed from.</td>
</tr>
<tr>
<td class="left">text</td>
<td class="left">string</td>
<td class="left">input text being parsed.</td>
</tr>
<tr>
<td class="left">opt_pos</td>
<td class="left">Array</td>
<td class="left">optional one element array that holds position information. It tells from where parse should begin. Upon return, it holds parse stop position.</td>
</tr>
<tr>
<td class="left">opt_currencyCode</td>
<td class="left">string</td>
<td class="left">optional international currency code, it determines the currency code/symbol should be used in format/parse. If not given, the currency code for current locale will be used.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.6.2.5.p.3">The method returns the parsed number or a 0 if the attempt to parse failed.</p>
<h1 id="rfc.section.4.2.7">
<a href="#rfc.section.4.2.7">4.2.7.</a> <a href="#gadgets.MiniMessage" id="gadgets.MiniMessage">The MiniMessage Feature</a>
</h1>
<p id="rfc.section.4.2.7.p.1">The "MiniMessage" feature provides a simple mechanism for displaying temporary messages to users of an application. Such messages typically appear at the top of the area allocated by the container for display of the application and are dismissed either programmatically or by user action.  Examples of typical uses of the MiniMessage feature include: </p>

<ul>
<li>Displaying temporary status messages: loading, saving, etc.</li>
<li>Displaying promotional messages: new features, new application, etc.</li>
<li>Displaying debug and error messages: bad input, failed connection to server, etc.</li>
</ul>

<p> </p>
<p id="rfc.section.4.2.7.p.2">Containers SHOULD support the "MiniMessage" feature.</p>
<p id="rfc.section.4.2.7.p.3">The "MiniMessage" feature is enabled by specifying feature="minimessage" within either a &lt;Require&gt; or &lt;Optional&gt; element within the &lt;ModulePrefs&gt;. JavaScript APIs are used to create and manipulate the messages. No parameters are specified for the MiniMessage feature.</p>
<div id="#rfc.figure.239"></div>
<p>In the partial specification document below, the "MiniMessage" feature is required and a simple message that dismisses automatically after 10 seconds is created:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      &lt;Require feature="minimessage" /&gt;
    &lt;/ModulePrefs&gt;
    &lt;Content type="html" &gt;&lt;[CDATA[
      ...
      &lt;script&gt;
        ... 
        var messages = new gadgets.MiniMessage(gadgets.Prefs.getModuleId());
        var content = document.createElement('div');
        content.innerHTML = "Welcome to my application.";
        messages.createTimerMessage(content, 10);
        ...
      &lt;/script&gt;
      ...
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
      </pre>
<p id="rfc.section.4.2.7.p.4">Typically, only a single <samp>gadgets.MiniMessage</samp> object needs to be created for each view. Multiple messages can be created and managed by a single instance.</p>
<p id="rfc.section.4.2.7.p.5">By default, all messages will be displayed in a special reserved area provided by the container at the top of the area allocated to rendering the view. However, developers can select alternative locations either for all messages or specific individual messages by passing in additional parameters to the JavaScript API.</p>
<div id="#rfc.figure.240"></div>
<p>In the following example, all messages are rendered in an area dedicated by the view for messages:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      &lt;Require feature="minimessage" /&gt;
    &lt;/ModulePrefs&gt;
    &lt;Content type="html" &gt;&lt;[CDATA[
      ...
      &lt;h2&gt;Messages&lt;/h2&gt;
      &lt;div id="messages"&gt;&lt;/div&gt;
      &lt;script&gt;
        ... 
        var messages = new gadgets.MiniMessage(
          gadgets.Prefs.getModuleId(), 
          document.getElementById("messages"));
        messages.createTimerMessage("This is my message", 10);
        ...
      &lt;/script&gt;
      ...
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
      </pre>
<div id="#rfc.figure.241"></div>
<p>Individual messages can be displayed anywhere within the application either by specifying the HTML markup directly within the application and referencing it when creating the message or by using DOM methods in JavaScript. For example, in the following example, a message is created and positioned individually:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      &lt;Require feature="minimessage" /&gt;
    &lt;/ModulePrefs&gt;
    &lt;Content type="html" &gt;&lt;[CDATA[
      ...
      &lt;div id="status"&gt;This message can be dismissed&lt;/div&gt;
      &lt;script&gt;
        ... 
        var messages = new gadgets.MiniMessage(gadgets.Prefs.getModuleId());
        messages.createDismissableMessage(document.getElementById("status"));
        
        var div = document.createElement("div");
        ...
      &lt;/script&gt;
      ...
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;      
      </pre>
<h1 id="rfc.section.4.2.7.1">
<a href="#rfc.section.4.2.7.1">4.2.7.1.</a> JavaScript API</h1>
<p id="rfc.section.4.2.7.1.p.1">When the "MiniMessage" feature is enabled for a application, the follow JavaScript objects and methods are provided:</p>
<h1 id="rfc.section.4.2.7.1.1">
<a href="#rfc.section.4.2.7.1.1">4.2.7.1.1.</a> <a href="#gadgets.MiniMessage.ctor" id="gadgets.MiniMessage.ctor">The gadgets.MiniMessage Object</a>
</h1>
<p id="rfc.section.4.2.7.1.1.p.1">The <samp>gadgets.MiniMessage</samp> object is used to create and manage messages for an application. Typically, only a single instance of the object needs to be created for all messages within a given view.</p>
<div id="#rfc.figure.242"></div>
<p>Instances are created using the JavaScript "new" keyword:</p>
<pre>
  var messages = new gadgets.MiniMessage(id, container);
          </pre>
<p id="rfc.section.4.2.7.1.1.p.2">The object constructor takes two parameters, both of which are optional:</p>
<div id="#rfc.table.35"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">id</td>
<td class="left">String</td>
<td class="left">The container provided unique identifier of the application instance. This value can be determined using the <samp>gadgets.Prefs.getModuleId()</samp> method.</td>
</tr>
<tr>
<td class="left">container</td>
<td class="left">HTMLElement</td>
<td class="left">An object reference to the HTML element, typically a &lt;div&gt; that will serve as the container for all messages managed by this MiniMessage instance.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.7.1.1.p.3">Once created, the <samp>gadgets.MiniMessage</samp> object provides four methods for working with messages.</p>
<h1 id="rfc.section.4.2.7.1.1.1">
<a href="#rfc.section.4.2.7.1.1.1">4.2.7.1.1.1.</a> <a href="#gadgets.MiniMessage.createDismissibleMessage" id="gadgets.MiniMessage.createDismissibleMessage">gadgets.MiniMessage.createDismissibleMessage</a>
</h1>
<p id="rfc.section.4.2.7.1.1.1.p.1">Creates a "dismissible" message that includes a container defined icon that allows users to dismiss the message by clicking on it. When the message is, it is removed from the DOM and an optional callback function, if defined, is invoked.</p>
<div id="#rfc.figure.243"></div>
<pre>
  &lt;HTMLElement&gt; gadgets.MiniMessage.createDismissibleMessage(message, callback)
            </pre>
<p id="rfc.section.4.2.7.1.1.1.p.2">Input Parameters:</p>
<div id="#rfc.table.36"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">message</td>
<td class="left">String | Object</td>
<td class="left">The message as an HTML string or DOM element</td>
</tr>
<tr>
<td class="left">callback</td>
<td class="left">Function</td>
<td class="left">Optional callback function to be called when the message is dismissed. The callback function will not be called until after the existing callstack has completed execution.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.7.1.1.1.p.3">If creation of the message is successful, the method will return a reference to the HTMLElement that contains the created message.</p>
<h1 id="rfc.section.4.2.7.1.1.2">
<a href="#rfc.section.4.2.7.1.1.2">4.2.7.1.1.2.</a> <a href="#gadgets.MiniMessage.createStaticMessage" id="gadgets.MiniMessage.createStaticMessage">gadgets.MiniMessage.createStaticMessage</a>
</h1>
<p id="rfc.section.4.2.7.1.1.2.p.1">Creates a "static" message that can only by dismissed programmatically by calling the <samp>gadgets.MiniMessage.dismissMessage</samp> method.</p>
<div id="#rfc.figure.244"></div>
<pre>
  &lt;HTMLElement&gt; gadgets.MiniMessage.createStatusMessage(message)
            </pre>
<p id="rfc.section.4.2.7.1.1.2.p.2">Input Parameters:</p>
<div id="#rfc.table.37"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody><tr>
<td class="left">message</td>
<td class="left">String | Object</td>
<td class="left">The message as an HTML string or DOM element</td>
</tr></tbody>
</table>
<p id="rfc.section.4.2.7.1.1.2.p.3">If creation of the message is successful, the method will return a reference to the HTMLElement that contains the created message.</p>
<h1 id="rfc.section.4.2.7.1.1.3">
<a href="#rfc.section.4.2.7.1.1.3">4.2.7.1.1.3.</a> <a href="#gadgets.MiniMessage.createTimerMessage" id="gadgets.MiniMessage.createTimerMessage">gadgets.MiniMessage.createTimerMessage</a>
</h1>
<p id="rfc.section.4.2.7.1.1.3.p.1">Creates a message that displays for a specified number of seconds. When the timer expires, the message is dismissed automatically and an optional callback function, if provided, is invoked.</p>
<div id="#rfc.figure.245"></div>
<pre>
  &lt;HTMLElement&gt; gadgets.MiniMessage.createTimerMessage(message, seconds, callback)
            </pre>
<p id="rfc.section.4.2.7.1.1.3.p.2">Input Parameters:</p>
<div id="#rfc.table.38"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">message</td>
<td class="left">String | Object</td>
<td class="left">The message as an HTML string or DOM element</td>
</tr>
<tr>
<td class="left">seconds</td>
<td class="left">Number</td>
<td class="left">The number of seconds to wait before dismissing the message.</td>
</tr>
<tr>
<td class="left">callback</td>
<td class="left">Function</td>
<td class="left">Optional callback function to be called when the message is dismissed. The callback function will not be called until after the existing callstack has completed execution.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.7.1.1.3.p.3">If creation of the message is successful, the method will return a reference to the HTMLElement that contains the created message.</p>
<h1 id="rfc.section.4.2.7.1.1.4">
<a href="#rfc.section.4.2.7.1.1.4">4.2.7.1.1.4.</a> <a href="#gadgets.MiniMessage.dismissMessage" id="gadgets.MiniMessage.dismissMessage">gadgets.MiniMessage.dismissMessage</a>
</h1>
<p id="rfc.section.4.2.7.1.1.4.p.1">Dismisses the specified message.</p>
<div id="#rfc.figure.246"></div>
<pre>
  &lt;Void&gt; gadgets.MiniMessage.dismissMessage(message)
            </pre>
<p id="rfc.section.4.2.7.1.1.4.p.2">The method takes a single input parameter which is the HTMLElement of the message to dismiss as returned by one of the three creation messages.</p>
<h1 id="rfc.section.4.2.8">
<a href="#rfc.section.4.2.8">4.2.8.</a> <a href="#gadgets.oauth.Popup" id="gadgets.oauth.Popup">The OAuth Popup Feature</a>
</h1>
<p id="rfc.section.4.2.8.p.1">When an application attempts to access remote resources that are protected using either the OAuth 1.0a or 2.0 protocol, the container is required to first determine if the application has received appropriate authorization in the form of an "Access Token".  If a token is not available, the container must ask the application to first acquire the appropriate authorization.</p>
<p id="rfc.section.4.2.8.p.2">With most scenarios, this is achieved by redirecting the user to the third party OAuth Authorization Service and asking them to approve access. While application developers are responsible for determining how such redirection occurs, they can use the OAuth Popup Feature to simplify the process and to promote consistent, familiar behavior.</p>
<p id="rfc.section.4.2.8.p.3">The feature works by generating a hyperlink within the application's user interface that, when clicked, opens a window that displays the third party OAuth Authoriation Service's interface. When opened, the application is notified via a callback function that the window is open.  The user will either approve or deny the request and then dismiss the window, returning the user back to the application's user interface. The application can either then automatically proceed with processing the request or wait for the user to notify it when it continue.</p>
<p id="rfc.section.4.2.8.p.4">Use of the OAuth Popup Feature is enabled within an application by using feature="oauthpopup" in either a &lt;Require&gt; or &lt;Optional&gt; element with the &lt;ModulePrefs&gt;. Once enabled, the <samp>gadgets.oauth.Popup</samp> object will become available for use within the JavaScript of a view.</p>
<div id="#rfc.figure.247"></div>
<p>The example below illustrates the basic operation of the OAuth Popup Feature:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      &lt;Require feature="oauthpopup" /&gt;
      &lt;OAuth&gt;
        &lt;Service&gt;...&lt;/Service&gt;
      &lt;/OAuth&gt;
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;&lt;![CDATA[
      &lt;div&gt;
        &lt;a href="#" id="personalize"&gt;Personalize this application&lt;/a&gt;
      &lt;/div&gt;
  
      &lt;div&gt;Please click
        &lt;a href="#" id="approvaldone"&gt;I've approved access&lt;/a&gt;
        once you've approved access to your data.
      &lt;/div&gt;
  
      &lt;script type="text/javascript"&gt;
        function $(x) {
          return document.getElementById(x);
        }
  
        function fetchData() {
          var url = "http://localhost:8080/social/rest/people/@me/@self";
          var params = {};
          params[gadgets.io.RequestParameters.CONTENT_TYPE] =
            gadgets.io.ContentType.TEXT;
          params[gadgets.io.RequestParameters.AUTHORIZATION] =
            gadgets.io.AuthorizationType.OAUTH;
          params[gadgets.io.RequestParameters.METHOD] =
            gadgets.io.MethodType.GET;
          params[gadgets.io.RequestParameters.OAUTH_SERVICE_NAME] =
            "shindig";
  
          gadgets.io.makeRequest(url, function (response) {
            if (response.oauthApprovalUrl) {
              var onOpen = function() {};
              var onClose = function() {
                fetchData();
              };
              var popup = new gadgets.oauth.Popup(
                response.oauthApprovalUrl,
                null, onOpen, onClose);
              $('personalize').onclick = popup.createOpenerOnClick();
              $('approvaldone').onclick = popup.createApprovedOnClick();
            } else if (response.data) {
              ...
            } else {
              ...
            }
          }, params);
        }
  
        gadgets.util.registerOnLoadHandler(fetchData);
      &lt;/script&gt;
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
     </pre>
<p id="rfc.section.4.2.8.p.5">Once the <samp>gadgets.oauth.Popup</samp> object is created, the calls to <samp>popup.createOpenerOnClick</samp> and <samp>popup.createApprovedOnClick</samp> generate the appropriate hyperlink targets for acquiring and completing the authorization.</p>
<h1 id="rfc.section.4.2.8.1">
<a href="#rfc.section.4.2.8.1">4.2.8.1.</a> JavaScript API</h1>
<p id="rfc.section.4.2.8.1.p.1">When the OAuth Popup Feature is enabled for an application, the <samp>gadgets.oauth.Popup</samp> object becomes available for use within the application's JavaScript code.</p>
<h1 id="rfc.section.4.2.8.1.1">
<a href="#rfc.section.4.2.8.1.1">4.2.8.1.1.</a> <a href="#gadgets.oauth.Popup.ctor" id="gadgets.oauth.Popup.ctor">The gadgets.oauth.Popup Object</a>
</h1>
<p id="rfc.section.4.2.8.1.1.p.1">The <samp>gadets.oauth.Popup</samp> object is used to manage a window that is displayed and used to acquire OAuth Authorization from a third party. Instances of the object are created using the JavaScript new keyword.</p>
<div id="#rfc.figure.248"></div>
<p>For instance:</p>
<pre>
  var popup = new gadgets.oauth.Popup(
    destination, 
    windowOptions, 
    openCallback, 
    closeCallback);
         </pre>
<p id="rfc.section.4.2.8.1.1.p.2">The constructor accepts the following input parameters:</p>
<div id="#rfc.table.39"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">destination</td>
<td class="left">String</td>
<td class="left">Target URL to display when the window opens.</td>
</tr>
<tr>
<td class="left">windowOptions</td>
<td class="left">String</td>
<td class="left">Options for window.open, used to specify look and feel of the window.</td>
</tr>
<tr>
<td class="left">openCallback</td>
<td class="left">Function</td>
<td class="left">Function to call when the window is opened.</td>
</tr>
<tr>
<td class="left">closeCallback</td>
<td class="left">Function</td>
<td class="left">Function to call when the window is closed.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.8.1.1.p.3">The <samp>gadgets.oauth.Popup</samp> object exposes two methods: <samp>createOpenerOnClick</samp> and createApprovedOnClick.</p>
<h1 id="rfc.section.4.2.8.1.1.1">
<a href="#rfc.section.4.2.8.1.1.1">4.2.8.1.1.1.</a> <a href="#gadgets.oauth.Popup.createOpenerOnClick" id="gadgets.oauth.Popup.createOpenerOnClick">gadgets.oauth.Popup.createOpenerOnClick</a>
</h1>
<p id="rfc.section.4.2.8.1.1.1.p.1">Generates a function that is intended to be assigned to either a hyperlink (e.g. the onclick event of the HTML anchor tag) or similar mechanism (e.g. an HTML button) that when invoked, will display the OAuth Authorization window. The method accepts no input parameters and returns a JavaScript Function object.</p>
<div id="#rfc.figure.249"></div>
<pre>
  &lt;Function&gt; createOpenerOnClick()
           </pre>
<h1 id="rfc.section.4.2.8.1.1.2">
<a href="#rfc.section.4.2.8.1.1.2">4.2.8.1.1.2.</a> <a href="#gadgets.oauth.Popup.createApprovedOnClick" id="gadgets.oauth.Popup.createApprovedOnClick">gadgets.oauth.Popup.createApprovedOnClick</a>
</h1>
<p id="rfc.section.4.2.8.1.1.2.p.1">Generates a function that is intended to be assigned to either a hyperlink (e.g. the onclick event of the HTML anchor tag) or similar mechanism (e.g. an HTML button) that when invoked, will notify the container that OAuth authorization is complete.</p>
<p id="rfc.section.4.2.8.1.1.2.p.2">Typically, when the OAuth Popup window closes, the container will be able to automatically detect that authorization is complete and it will attempt to continue with the original request that triggered the authorization step in the first place. However, some containers are unable to detect when the Popup is closed. For those cases, the <samp>createdApprovedOnClick</samp> method provides a alternative. In most typical scenarios, however, the "Approved" function returned by this method will never be invoked.</p>
<p id="rfc.section.4.2.8.1.1.2.p.3">The method accepts no input parameters and returns a JavaScript Function object.</p>
<div id="#rfc.figure.250"></div>
<pre>
  &lt;Function&gt; createApprovedOnClick()
           </pre>
<h1 id="rfc.section.4.2.9">
<a href="#rfc.section.4.2.9">4.2.9.</a> <a href="#OpenSearch" id="OpenSearch">The OpenSearch Feature</a>
</h1>
<p id="rfc.section.4.2.9.p.1">The "opensearch" feature allows applications to declare that searchable material is provided using an <a href="http://www.opensearch.org/Specifications/OpenSearch/1.1">OpenSearch 1.1</a> description. Containers can use the search descriptions provided by multiple applications to, for example, provide a single, integrated container-wide search capability that aggregates results from multiple sources.</p>
<p id="rfc.section.4.2.9.p.2">The OpenSeach description can either be passed directly as a parameter of the feature or by reference using the URL of a description document.</p>
<div id="#rfc.figure.251"></div>
<p>For example: </p>
<pre>
    &lt;?xml version="1.0" encoding="UTF-8" ?&gt;
    &lt;Module&gt;
      &lt;ModulePrefs title="OpenSearch Example"&gt;
        &lt;Optional feature="opensearch"&gt;
          &lt;Param name="description"&gt;
            &lt;![CDATA[
              &lt;OpenSearchDescription xmlns="http://a9.com/-/spec/opensearch/1.1/"&gt;
                &lt;ShortName&gt;Example Search&lt;/ShortName&gt;
                &lt;Description&gt;Realtime Example Search&lt;/Description&gt;
                &lt;Url type="application/atom+xml" method="get" template="http://search.example.com/search.atom?q={searchTerms}"/&gt;
                &lt;Image width="16" height="16"&gt;http://search.example.com/favicon.png&lt;/Image&gt;
                &lt;InputEncoding&gt;UTF-8&lt;/InputEncoding&gt;
                &lt;SearchForm&gt;http://search.example.com/&lt;/SearchForm&gt;
              &lt;/OpenSearchDescription&gt;
            ]]&gt;
          &lt;/Param&gt;
        &lt;/Optional&gt;
      &lt;/ModulePrefs&gt;
      &lt;Content type="url" href="http://example.com/searchGadget.xml" /&gt;
    &lt;/Module&gt;
                </pre>
<div id="#rfc.figure.252"></div>
<p>Or, alternatively, using a URL to reference the description document:</p>
<pre>
    &lt;?xml version="1.0" encoding="UTF-8" ?&gt;
    &lt;Module&gt;
      &lt;ModulePrefs title="OpenSearch Example"&gt;
        &lt;Optional feature="opensearch"&gt;
          &lt;Param name="url"&gt;http://search.example.com/openSearchDescription.xml&lt;/Param&gt;
        &lt;/Optional&gt;
      &lt;/ModulePrefs&gt;
      &lt;Content type="url" href="http://example.com/searchGadget.xml" /&gt;
    &lt;/Module&gt;
                </pre>
<p id="rfc.section.4.2.9.p.3">As illustrated, support for the "opensearch" feature is specified by including either an "Optional" or "Required" element within the "ModulePrefs" of the Gadget specification. The feature identifier is "opensearch". Developers SHOULD declare the feature as "Optional" to allow for maximum interoperability in all containers.</p>
<p id="rfc.section.4.2.9.p.4">The feature has two possible parameters: description and url: </p>

<ul>
<li>The description parameter contains the full XML of the <a href="http://www.opensearch.org/Specifications/OpenSearch/1.1#OpenSearch_description_document">OpenSearch 1.1 description</a>.  This description contains the template url for fetching results, the type of results returned, the title of the search contribution, and other information.</li>
<li>The url parameter contains a URL to an XML document containing the OpenSearch 1.1 description.</li>
</ul>

<p> </p>
<h1 id="rfc.section.4.2.10">
<a href="#rfc.section.4.2.10">4.2.10.</a> <a href="#osapi" id="osapi">The OpenSocial API (osapi) Feature</a>
</h1>
<p id="rfc.section.4.2.10.p.1">The OpenSocial API (osapi) Feature provides developers with an interface for requesting and manipulating social data made available by the OpenSocial Container.</p>
<p id="rfc.section.4.2.10.p.2">While it is possible to use the <samp>gadgets.io.makeRequest</samp> method and associated methods to interact with information provided by the container, the "osapi" feature provides a higher-level abstraction that is more specific to OpenSocial's specific data and API model.</p>
<p id="rfc.section.4.2.10.p.3">The OpenSocial API Feature is enabled for an application instance by specifying feature="osapi" using either the &lt;Require&gt; or &lt;Optional&gt; element within the &lt;ModulePrefs&gt;.</p>
<div id="#rfc.figure.253"></div>
<p>For example:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt; 
      ...
      &lt;Require feature="osapi" /&gt;
      ...
    &lt;/ModulePrefs&gt;
    ...
  &lt;/Module&gt;
        </pre>
<h1 id="rfc.section.4.2.10.1">
<a href="#rfc.section.4.2.10.1">4.2.10.1.</a> JavaScript API</h1>
<p id="rfc.section.4.2.10.1.p.1">When the "osapi" feature is enabled for an application instance, the container will generate and provide one Service object instance for each Social Data Service provided by the container.  Each Service object instance is accessible via a distinct property on the static <samp>osapi</samp> object. The property name is derived from and specific to each individual Social Data Service.</p>
<p id="rfc.section.4.2.10.1.p.2">For example, a container can implement the OpenSocial Person Service as defined by <a href="#social-app">[social-app]</a> and make that available to developers via the "osapi" Feature by using the property name "people" as specified in the Person Service definition.</p>
<div id="#rfc.figure.254"></div>
<pre>
  &lt;?xml version="1.0" encoding="UTF-8" ?&gt;
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      ...
      &lt;Require feature="osapi" /&gt;
      ...
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;&lt;![CDATA[
      &lt;script&gt;
        osapi.people.getViewer().execute(
          function(result) {
            // ...
          }
        );
      &lt;/script&gt;
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
          </pre>
<p id="rfc.section.4.2.10.1.p.3">Likewise, the container can implement the OpenSocial Activity Stream Service as defined by <a href="#social-app">[social-app]</a> and make that available to developers using the property name "activities" as specified in the Activity Stream Service definition.</p>
<div id="#rfc.figure.255"></div>
<pre>
  &lt;?xml version="1.0" encoding="UTF-8" ?&gt;
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      ...
      &lt;Require feature="osapi" /&gt;
      ...
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;&lt;![CDATA[
      &lt;script&gt;
        osapi.activities.get().execute(
          function(result) {
            // ...
          }
        );
      &lt;/script&gt;
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
          </pre>
<p id="rfc.section.4.2.10.1.p.4">The methods provided by the Service Objects returned by each service property are unique to the corresponding service and are defined by each individual service's specification.  Every method exposed by the Service Object SHOULD take, as input, a single parameter whose value is a JavaScript object providing that methods input parameters. This input parameter MAY be optional.  Each method MUST return an <samp>osapi.Request</samp> Object instance that encapsulates the request and may be used to either execute the request immediately or added to a <samp>osapi.BatchRequest</samp> object for deferred and batched execution.</p>
<div id="#rfc.figure.256"></div>
<p>The example below, for instance, uses the OpenSocial Person Service to access a listing of the current Viewer's friends.  First, the Service Object for the "people" service is accessed. Then the "get()" method is called with input parameters specifying the data we wish to retrieve. The method returns an <samp>osapi.Request</samp> object that is then immediately executed to retrieve the data:</p>
<pre>
  var people = osapi.people;
  var params = { 
    "userId" : "@me", 
    "groupId" : "@friends" };
  var get_req = people.get(params);
  get_req.execute(
    function(result) {
      if (!result.error) {
        // ...
      }
    }
  );
          </pre>
<p id="rfc.section.4.2.10.1.p.5">Containers are free to determine the set of Social Data Services they support and expose to applications. Definitions for a handful of common Social Data Services are provided in <a href="#social-app">[social-app]</a>. Gadget developers cannot assume that all containers will support the same set of services and MUST therefore be prepared to gracefully handle cases where any given service is not available.</p>
<div id="#rfc.figure.257"></div>
<p>One method developers can use to safely prepare for such cases is to test for the existence of the service and method, as in the following example:</p>
<pre>
  if (osapi.people &amp;&amp; osapi.people.getViewer) {
    osapi.people.getViewer().execute(function(result) {
      // ...
    });
  }
          </pre>
<h1 id="rfc.section.4.2.10.1.1">
<a href="#rfc.section.4.2.10.1.1">4.2.10.1.1.</a> <a href="#osapi.Request" id="osapi.Request">The osapi.Request Object</a>
</h1>
<p id="rfc.section.4.2.10.1.1.p.1">All methods on a Service Object are required to return an instance of the <samp>osapi.Request</samp> object. These objects encapsulate the service request being made to the container and wrap it in a consistent generic interface exposing a single "execute" method.</p>
<h1 id="rfc.section.4.2.10.1.1.1">
<a href="#rfc.section.4.2.10.1.1.1">4.2.10.1.1.1.</a> <a href="#osapi.Request.execute" id="osapi.Request.execute">osapi.Request.execute</a>
</h1>
<p id="rfc.section.4.2.10.1.1.1.p.1">The <samp>osapi.Request.execute</samp> method invokes the encapsulated Service Object request and passes the result off to a specified callback function.</p>
<div id="#rfc.figure.258"></div>
<pre>
  &lt;Void&gt; &lt;instance&gt;.execute(callback)
              </pre>
<p id="rfc.section.4.2.10.1.1.1.p.2">The method takes as input a single Function object that will be invoked upon completion of the request with a single input parameter representing the request results as a JavaScript object.  The specific properties exposed by the result object depend entirely on the specific Service Object, the request that was executed and the status of the request.</p>
<p id="rfc.section.4.2.10.1.1.1.p.3">If the execution of the request results in an error, the callback function provided will be invoked with details of the error being passed in as described in <a href="#osapi.error.handling">Section 4.2.10.1.3</a>.</p>
<div id="#rfc.figure.259"></div>
<p>For example, if an error occurs during the processing of the request, the response object passed to the callback function would contain an <samp>error</samp> property whose value is an <a href="#core-api">Error Object</a> <cite title="NONE">[core-api]</cite>:</p>
<pre>
  {
    "error": {
      "message": "Invalid Method Parameters",
      "code": -32602
    }
  }
              </pre>
<p id="rfc.section.4.2.10.1.1.1.p.4">The execute method has no return value.</p>
<h1 id="rfc.section.4.2.10.1.2">
<a href="#rfc.section.4.2.10.1.2">4.2.10.1.2.</a> <a href="#osapi.BatchRequest" id="osapi.BatchRequest">The osapi.BatchRequest Object</a>
</h1>
<p id="rfc.section.4.2.10.1.2.p.1">The <samp>osapi.BatchRequest</samp> object allows multiple <samp>osapi.Request</samp> objects to be grouped together and executed as a single unit.</p>
<p id="rfc.section.4.2.10.1.2.p.2">Instances of the <samp>osapi.BatchRequest</samp> object are created using the <samp>osapi.newBatch</samp> method.</p>
<div id="#rfc.figure.260"></div>
<pre>
  &lt;static&gt; &lt;osapi.BatchRequest&gt; osapi.newBatch()
            </pre>
<p id="rfc.section.4.2.10.1.2.p.3">The method takes no input parameters.</p>
<p id="rfc.section.4.2.10.1.2.p.4">Once created, individual <samp>osapi.Request</samp> objects can be added to the <samp>osapi.BatchObject</samp> instance as executed at once using the "execute" method.</p>
<div id="#rfc.figure.261"></div>
<p>The following illustrates two batched requests:</p>
<pre>
  var batch = osapi.newBatch().
     add("viewer", osapi.people.getViewer()).
     add('activities', osapi.activities.get({ userId : '@viewer', groupId : '@self'})).
  batch.execute(function(result) {
    if (!result.error) {
      alert('Hi, ' + result.viewer.displayName + '!');
      alert('You have ' + result.activities.totalResults + ' activities.');
    }
  });
            </pre>
<h1 id="rfc.section.4.2.10.1.2.1">
<a href="#rfc.section.4.2.10.1.2.1">4.2.10.1.2.1.</a> <a href="#osapi.BatchRequest.add" id="osapi.BatchRequest.add">osapi.BatchRequest.add</a>
</h1>
<p id="rfc.section.4.2.10.1.2.1.p.1">The <samp>osapi.BatchRequest.add</samp> method adds a <samp>osapi.Request</samp> object to the batch and associates it with a given key.</p>
<div id="#rfc.figure.262"></div>
<pre>
  &lt;osapi.BatchRequest&gt; &lt;instance&gt;.add(key, request)
              </pre>
<p id="rfc.section.4.2.10.1.2.1.p.2">The first input parameter is a String serving as an identifier for the request object provided by the second parameter. The key value "error" MUST NOT be used. The method returns an <samp>osapi.BatchRequest</samp> object containing the just added <samp>osapi.Request</samp> object all all previously added requests.</p>
<h1 id="rfc.section.4.2.10.1.2.2">
<a href="#rfc.section.4.2.10.1.2.2">4.2.10.1.2.2.</a> <a href="#osapi.BatchRequest.execute" id="osapi.BatchRequest.execute">osapi.BatchRequest.execute</a>
</h1>
<p id="rfc.section.4.2.10.1.2.2.p.1">The <samp>osapi.BatchRequest.execute</samp> method executes all of the requests contained within the batch.</p>
<div id="#rfc.figure.263"></div>
<pre>
  &lt;Void&gt; &lt;instance&gt;.execute(callback)
              </pre>
<p id="rfc.section.4.2.10.1.2.2.p.2">The method takes as input a single callback Function object that will be invoked when all of the batched requests have been processed. The callback Function will be passed a single JavaScript objects mapping each batched request key to a response object specific to the individual batched request.</p>
<p id="rfc.section.4.2.10.1.2.2.p.3">When an error occurs during the processing of one or more batched requests, the container will attempt to continue processing of the remaining requests in the batch. The details of the specific error(s) that occur will be mapped to the appropriate batched request key within the response object and general error details will be included as top level properties of the batch response.</p>
<div id="#rfc.figure.264"></div>
<p>For example, if a Batch Request containing two individual requests mapped to the keys "foo" and "bar" is processed and an error occurs when the "foo" request is being processed but the "bar" request succeeds, the callback function will be passed an object resembling the following structure:</p>
<pre>
  {
    "error" : {
      "message":"An Error Occurred",
      "code": -32099
    },
    "foo" : {
      "error" : {
        "message":"Invalid Method Parameters",
        "code": -32602
      }
    },
    "bar" : {
      "xyz" : "Some appropriate data"
    }
  }
              </pre>
<p id="rfc.section.4.2.10.1.2.2.p.4">Additional details covering error handling is provided in <a href="#osapi.error.handling">Section 4.2.10.1.3</a>.</p>
<h1 id="rfc.section.4.2.10.1.3">
<a href="#rfc.section.4.2.10.1.3">4.2.10.1.3.</a> <a href="#osapi.error.handling" id="osapi.error.handling">Error Handling</a>
</h1>
<p id="rfc.section.4.2.10.1.3.p.1">When processing a batch of <samp>osapi.Request</samp> objects using the <samp>osapi.BachRequest</samp> object and an error occurs processing any of the individual requests, the provided callback function will be invoked with a response object passed in containing a single top-level "error" property whose value is an Error object generally describing that the batch response did not complete with errors. The object will also contain one property key for each request contained in the batch whose value will either be the results of the operation if successful or an object containing a single "error" property whose value is an Error object describing the specific error that occurred.</p>
<div id="#rfc.figure.265"></div>
<p>For example:</p>
<pre>
  {
    "error" : {
      "message":"An Error Occurred",
      "code": -32099
    },
    "foo" : {
      "error" : {
        "message":"Invalid Method Parameters",
        "code": -32602
      }
    },
    "bar" : {
      "xyz" : "Some appropriate data"
    }
  }
              </pre>
<p id="rfc.section.4.2.10.1.3.p.2">When a general error occurs that causes the container to be unable to process either an individual or complete batch of requests, such as when the container is unable to communicate with the Social Data Services, the callback function provided will be invoked and passed a response object containing a single "error" property whose value is an Error object describing the specific nature of the error.</p>
<div id="#rfc.figure.266"></div>
<p>For example:</p>
<pre>
  {
    "error" : {
      "message": "A network communication error occurred",
      "code": -32603
    }
  }
              </pre>
<h1 id="rfc.section.4.2.10.1.4">
<a href="#rfc.section.4.2.10.1.4">4.2.10.1.4.</a> <a href="#osapi.http" id="osapi.http">The osapi.http Service Object</a>
</h1>
<p id="rfc.section.4.2.10.1.4.p.1">The <samp>osapi.http</samp> Object is a special Service Object that encapsulates HTTP Requests within <samp>osapi.Request</samp> objects. These can, in turn, be directly invoked using the "execute" method or added to <samp>osapi.BatchRequest</samp> objects.</p>
<p id="rfc.section.4.2.10.1.4.p.2">The <samp>osapi.http</samp> object exposes one method for each of the following HTTP methods, each returning an appropriate <samp>osapi.Request</samp>:</p>
<div id="#rfc.table.40"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">HTTP Method</th>
<th class="left">osapi.http Method</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">DELETE</td>
<td class="left"><samp>osapi.http.delete</samp></td>
<td class="left">Returns an <samp>osapi.Request</samp> object encapsulating an HTTP DELETE request.</td>
</tr>
<tr>
<td class="left">GET</td>
<td class="left"><samp>osapi.http.get</samp></td>
<td class="left">Returns an <samp>osapi.Request</samp> object encapsulating an HTTP GET request.</td>
</tr>
<tr>
<td class="left">HEAD</td>
<td class="left"><samp>osapi.http.head</samp></td>
<td class="left">Returns an <samp>osapi.Request</samp> object encapsulating an HTTP HEAD request.</td>
</tr>
<tr>
<td class="left">PATCH</td>
<td class="left"><samp>osapi.http.patch</samp></td>
<td class="left">Returns an <samp>osapi.Request</samp> object encapsulating an HTTP PATCH request.</td>
</tr>
<tr>
<td class="left">POST</td>
<td class="left"><samp>osapi.http.post</samp></td>
<td class="left">Returns an <samp>osapi.Request</samp> object encapsulating an HTTP POST request.</td>
</tr>
<tr>
<td class="left">PUT</td>
<td class="left"><samp>osapi.http.put</samp></td>
<td class="left">Returns an <samp>osapi.Request</samp> object encapsulating an HTTP PUT request.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.10.1.4.p.3">Implementations are free to provide additional methods for other HTTP methods. It is RECOMMENDED that such additional methods follow a consistent naming pattern as the lower-case form of the method name. For instance, the method provided for the "OPTIONS" HTTP method would be "options".</p>
<p id="rfc.section.4.2.10.1.4.p.4">Each of the methods on the <samp>osapi.http</samp> Object take an input parameter in the form of an <a href="#http.request.params.object">HTTP Request Parameters Object</a> <cite title="NONE">[http.request.params.object]</cite> that provides general request options for the request.</p>
<h1 id="rfc.section.4.2.10.1.4.1">
<a href="#rfc.section.4.2.10.1.4.1">4.2.10.1.4.1.</a> <a href="#http.request.params.object" id="http.request.params.object">The HTTP Request Parameters Object</a>
</h1>
<p id="rfc.section.4.2.10.1.4.1.p.1">The HTTP Request Parameters Object is a JavaScript object whose individual properties define parameters used during the execution of an HTTP Request.</p>
<p id="rfc.section.4.2.10.1.4.1.p.2">The properties of the HTTP Request Parameters Objects are:</p>
<div id="#rfc.table.41"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">alias</td>
<td class="left">String</td>
<td class="left">When a specification document uses the &lt;ExternalService&gt; element to define an alias for a Container-managed external service, the optional "alias" parameter can be used in place of the "href" property to identify the external service to which the request is to be directed. If unspecified, the default value for this parameter is assumed to be null.</td>
</tr>
<tr>
<td class="left">authz</td>
<td class="left">String</td>
<td class="left">Specifies the authorization method to use. Valid values are: "none", "signed", "oauth" and "oauth2". For convenience, aliases for each of these values have been provided for use in JavaScript code. These aliases are: gadgets.io.AuthorizationType.NONE, gadgets.io.AuthorizationType.SIGNED, gadgets.io.AuthorizationType.OAUTH and gadgets.ioAuthorizationType.OAUTH2.  If not specified, the default value for this parameter is assumed to be "none".</td>
</tr>
<tr>
<td class="left">format</td>
<td class="left">String</td>
<td class="left">Optionally specifies the data format the requested wishes the response to use. Valid values are either "json" or "text", respectively indicating that the data SHOULD be returned as either "application/json" or "text/plain". If not specified, the default value is assumed to be "json". The value of this parameter is used by the container to process the results of the HTTP operation. If format is equal to JSON, the container will attempt to parse the returned content as JSON, handing the parsed result back to the provided callback function. If the format is "text" or otherwise cannot be successfully parsed as JSON, the "raw" unparsed and unprocessed data provided by the request will be passed to the callback function.</td>
</tr>
<tr>
<td class="left">headers</td>
<td class="left">Object</td>
<td class="left">Specifies the collection of HTTP Request Headers the container SHOULD include in the request. The value is specified as an associative map using the header names as a key and either a literal String value or an Array of Strings. For example, to include "Accept-Language" and two "X-Custom" headers in the request, the value of the "HEADERS" property would be set to <samp>{"Accept-Language":"de-DE", "X-Custom":["abc","xyz"]}</samp>.</td>
</tr>
<tr>
<td class="left">href</td>
<td class="left">String</td>
<td class="left">The IRI to which the request is to be sent. If a relative URI is provided, the request will be resolved relative to a Base URI established by the container.</td>
</tr>
<tr>
<td class="left">oauth_service_name</td>
<td class="left">String</td>
<td class="left">When the "authz" parameter is equal to either "OAUTH" or "OAUTH2", and the specification document uses the &lt;OAuth&gt; or &lt;OAuth2&gt; elements within the &lt;ModulePrefs&gt; to define associated OAuth services, the "oauth_service_name" parameter specifies the name of the &lt;Service&gt; element that provides the OAuth Service details to use for the request.  When not specified, the default value is assumed to be an empty string (e.g. "").</td>
</tr>
<tr>
<td class="left">oauth_request_token</td>
<td class="left">String</td>
<td class="left">When the "authz" parameter is equal to either "OAUTH" or "OAUTH2", the "oauth_request_token" parameter can be used to specified a pre-authorized OAuth Request Token for use in the request. If the container does not already have an OAuth Access Token suitable for use with the request, the container SHOULD use the supplied Request Token to request and acquire a new Access Token. If not specified, the default value is assumed to be null.</td>
</tr>
<tr>
<td class="left">oauth_request_token_secret</td>
<td class="left">String</td>
<td class="left">When the "oauth_request_token" parameter is specified, the "oauth_request_token_secret" parameter can be used to supply an associated Request Token Secret. If not specified, the default value is assumed to be null.</td>
</tr>
<tr>
<td class="left">oauth2_scope</td>
<td class="left">String</td>
<td class="left">When the "authz" parameter is equal to "OAUTH", the "oauth2_scope" parameter specifies the value of the OAuth 2.0 scope parameter the container SHOULD use with the request. The scope parameter is defined in <a href="#I-D.ietf-oauth-v2">[I-D.ietf-oauth-v2]</a>.  If not specified, the default value is assumed to be null, indicating that no scope parameter is to be provided.</td>
</tr>
<tr>
<td class="left">oauth_token_name</td>
<td class="left">String</td>
<td class="left">When the "authz" parameter is equal to either "OAUTH" or "OAUTH2", the application MAY use the "oauth_token_name" to specify an alias for the OAuth Access Token used for the request. If the container does not yet have an appropriate Access Token to use with the request, it will follow the appropriate steps to acquire one and cache it using the specified oauth_token_name value. On subsequent requests, the specified oauth_token_name will be used to locate and use the cached Access Token. If not specified, the default value is assumed to be an empty string (e.g. "").</td>
</tr>
<tr>
<td class="left">oauth_use_token</td>
<td class="left">String</td>
<td class="left">When the "authz" parameter is equal to either "OAUTH" or "OAUTH2", the container is typically required to acquire an appropriate OAuth Access Token prior to sending the request to the URL. The "oauth_use_token" parameter can be used to modify this default behavior. Valid values are: "never", "if_available" and "always". If not specified, the default value is assumed to be "always". When "oauth_use_token" is equal to "never", the container SHOULD NOT attempt to acquire an Access Token for the request but SHOULD send the request to the URL just as it would any other request using with OAuth 1.0a or OAuth 2.0 protocols.  When "oauth_use_token" is equal to "if_available", the container SHOULD include the Access Token in the request only if an appropriate token is available. If an Access Token is not available, the request SHOULD be sent to the URL without the Access Token. When "oauth_use_token" is equal to "always", the container is required to acquire an Access Token prior to sending the request and MUST include that token in the request sent to the URL.</td>
</tr>
<tr>
<td class="left">body</td>
<td class="left">String or JSON Object</td>
<td class="left">When used with <samp>osapi.http</samp> method representing an HTTP Method for which a request payload is expected (e.g. <samp>osapi.http.patch</samp>, <samp>osapi.http.post</samp> or <samp>osapi.http.put</samp>), the "body" parameter specifies the data that is to be included as the payload of the request. The value is specified as either a String or a JSON object. If a JSON Object is provided, the Content-Type of the request payload will be "application/json" unless a specific value for the Content-Type header is provided within the "headers" property. If not specified, the value defaults to null, indicating that no payload is to be sent.</td>
</tr>
<tr>
<td class="left">refresh_interval</td>
<td class="left">Number (non-negative integer)</td>
<td class="left">Explicitly sets the numer of seconds content will be cached by the container as specified by <a href="#caching">Section 3.2</a>.</td>
</tr>
<tr>
<td class="left">sign_owner</td>
<td class="left">Boolean</td>
<td class="left">When the "authz" parameter equals either "SIGNED" or "OAUTH", the "sign_owner" parameter indicates whether the container SHOULD include the identity of the <a href="#Application-Roles">Instance Owner</a> <cite title="NONE">[Application-Roles]</cite> when signing the request. The value is specified as a Boolean. When not specified, the default value is assumed to be False.</td>
</tr>
<tr>
<td class="left">sign_viewer</td>
<td class="left">Boolean</td>
<td class="left">When the "authz" parameter equals either "SIGNED" or "OAUTH", the "sign_viewer" parameter indicates whether the container SHOULD include the identity of the current Viewer when signing the request. The value is specified as a Boolean. When not specified, the default value is assumed to be False.</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.4.2.10.1.4.2">
<a href="#rfc.section.4.2.10.1.4.2">4.2.10.1.4.2.</a> Processing osapi.http Requests</h1>
<p id="rfc.section.4.2.10.1.4.2.p.1">The container is responsible for processing all <samp>osapi.http</samp> request objects in much the same way requests are processed using the <samp>gadgets.io.makeRequest</samp> API.</p>
<p id="rfc.section.4.2.10.1.4.2.p.2">If the "authz" property on the HTTP Request Parameters Object passed in when the request object was created specifies any value other than "NONE", the container is required to apply the appropriate authentication mechanism to the request in exactly the same fashion described for the <samp>gadgets.io.makeRequest</samp> method.</p>
<p id="rfc.section.4.2.10.1.4.2.p.3">Upon completion of the HTTP request, the container shall create an <a href="#http.response.object">HTTP Response Object</a> <cite title="NONE">[http.response.object]</cite> which with either be passed as a parameter to the callback function provided when invoking the request object's "execute" method, or added to the batch response object is the HTTP request object is being executed as part of a <samp>osapi.BatchRequest</samp>.</p>
<p id="rfc.section.4.2.10.1.4.2.p.4">When preparing the HTTP Response Object, the container will check the valid of the "format" property provided in the HTTP Request Parameters Object. If the value is unspecified or equals the literal String "json", the container will attempt to parse any content returned within the HTTP Response as if it were an "application/json" response. If the the parse succeeds, the container will included the parsed JSON structure within the HTTP Response Object. If the parse fails, only the raw content of the HTTP Response message, encoded as character data, will be included in the HTTP Response Object.</p>
<div id="#rfc.figure.267"></div>
<p>For example, suppose that an application wishes to retrieve a JSON document located at http://example.org/latest-photos.  For the sake of the example, the JSON document has the following structure:</p>
<pre>
  {
    photos : [ "http://www.somephotosite.com/photos/1.jpg",
               "http://www.somephotosite.com/photos/2.jpg",
               "http://www.somephotosite.com/photos/3.jpg",
             ],
    lastUpdate : "Mon, 13 Apr 2009 23:17:04 GMT"
  }
              </pre>
<div id="#rfc.figure.268"></div>
<p>This document can be retrieved using the <samp>osapi.http.get</samp> method which, by default, will parse the returned JSON and make it available directly from the HTTP Response Object:</p>
<pre>
  osapi.http.get({"href":"http://example.org/latest-photos"})
    .execute(
      function(response) {
        if (!response.error) {
          alert("There are " + response.content.photos.length + " new photos");
        }
      }
    );
              </pre>
<p id="rfc.section.4.2.10.1.4.2.p.5">The container MAY choose to provide cached responses in response to an <samp>osapi.http</samp> Request as specified by <a href="#caching">Section 3.2</a>.</p>
<p id="rfc.section.4.2.10.1.4.2.p.6">When an error occurs during the processing of an HTTP request, or when the HTTP Response uses a status code that indicates an error condition (4xx or 5xx), the HTTP Response Object passed to the callback function will contain a single "error" property whose value is an <a href="#core-api">Error Object</a> <cite title="NONE">[core-api]</cite> describing the specific error that occurred.</p>
<h1 id="rfc.section.4.2.10.1.4.3">
<a href="#rfc.section.4.2.10.1.4.3">4.2.10.1.4.3.</a> <a href="#http.response.object" id="http.response.object">The HTTP Response Object</a>
</h1>
<p id="rfc.section.4.2.10.1.4.3.p.1">The HTTP Response Object is a JavaScript object whose properties provide details about the HTTP Response received when processing an <samp>osapi.http</samp> request object.</p>
<p id="rfc.section.4.2.10.1.4.3.p.2">TODO: Need to define the properties</p>
<h1 id="rfc.section.4.2.11">
<a href="#rfc.section.4.2.11">4.2.11.</a> <a href="#interGadgetEventing" id="interGadgetEventing">The PubSub Feature</a>
</h1>
<p id="rfc.section.4.2.11.p.1">The inter-application eventing feature, common known as "pub/sub", provides for loosely-coupled and asynchronous inter-application communication based on the <a href="http://www.openajax.org/member/wiki/OpenAjax_Hub_2.0_Specification_Introduction">OpenAjax Hub 2.0</a> specification.</p>
<p id="rfc.section.4.2.11.p.2">The "pub/sub" feature provides: </p>

<ul>
<li>An event hub, provided by the container and fully compliant with OpenAjax Hub 2.0, that manages the subscription and publication of events,</li>
<li>Methods for publishing and subscribing to events, and </li>
<li>Mechanisms for declaratively specifying metadata within a application's XML definition relevant to publishing and subscribing to events.</li>
</ul>

<p> </p>
<p id="rfc.section.4.2.11.p.3">The process is straightforward: </p>

<ul>
<li>First, a container that supports the "pub/sub" feature needs to initialize the Hub and all default settings.</li>
<li>Second, a container can bootstrap and simplify the connection of an application to the hub by registering an onLoad handler using the gadgets.util.registerOnLoadHandler API. </li>
<li>Third, once the Hub is initialized by the container, individual applications that declare support for the "pubsub-2" feature using either the "Optional" or "Required" tag within the Gadget specifications "ModulePrefs" can use the provided JavaScript APIs to publish events to the hub using "topics", or use the JavaScript APIs to subscribe to "topics" published by the Hub. When an application publishes an event to the Hub using a specific topic, all application's connected to that Hub and subscribed to the same topic will receive a copy of the event.</li>
</ul>

<p> </p>
<p id="rfc.section.4.2.11.p.4">A "topic" is a String value that conforms to the OpenAjax Hub 2.0 specification's <a href="#OAHub2.0">Topic Name Rules</a> <cite title="NONE">[OAHub2.0]</cite>.  All topic names prefixed with "org.opensocial." are reserved for use by the OpenSocial specification. Developers MUST NOT use the "org.opensocial." prefix when defining their own topics.</p>
<p id="rfc.section.4.2.11.p.5">Note that topic names are case-sensitive such that "org.example.foo" is not equivalent to "org.example.Foo".</p>
<h1 id="rfc.section.4.2.11.1">
<a href="#rfc.section.4.2.11.1">4.2.11.1.</a> <a href="#ContainerExample" id="ContainerExample">Initializing the Hub within the Container</a>
</h1>
<p id="rfc.section.4.2.11.1.p.1">The following non-normative example illustrates how a container can provide support for this feature.</p>
<p id="rfc.section.4.2.11.1.p.2">First, establish default values:</p>
<div id="#rfc.figure.269"></div>
<pre>
  // Create a pubsub settings object
  gadgets.HubSettings = {};

  // Set default HubClient constructor params object
  gadgets.HubSettings.params = {
   HubClient: {
      onSecurityAlert: function( alertSource, alertType ) {
        alert( "Gadget stopped attempted security breach: " + alertType );
        window.location.href = "about:blank"; // Forces container to see Frame Phish alert and probably close this application
      },
      scope: gadgetInstance
    } }; 
  
  // Set default onComplete function for HubClient.connect
  gadgets.HubSettings.onConnected = function( hub, suc, err ) { };
      </pre>
<p id="rfc.section.4.2.11.1.p.3">Next, register an onLoad handler to create the HubClient and connect it to the ManagedHub. Delaying the HubClient creation and connection allows the application to override default values stored in gadgets.HubSettings. For example, IframeHubClient supports params properties such as seed, tokenLength and log, which are not set by default; and an application might need to override onSecurityAlert and/or scope, for which default values are provided. More importantly, the onComplete function for HubClient.connect usually sets up the application's subscriptions by calling gadgets.Hub.subscribe, or if the connection fails asynchronously, the onComplete function handles the error.</p>
<div id="#rfc.figure.270"></div>
<pre>
  // Register an onLoad handler
  gadgets.util.registerOnLoadHandler( function() {
    try {
      // Create the HubClient.
      gadgets.Hub = new OpenAjax.hub.IframeHubClient(  gadgets.HubSettings.params ) ;
  
      // Connect to the ManagedHub
      gadgets.Hub.connect( gadgets.HubSettings.onConnect );
  
    } catch(e) {
      // ... 
    }
  } );
      </pre>
<h1 id="rfc.section.4.2.11.2">
<a href="#rfc.section.4.2.11.2">4.2.11.2.</a> <a href="#GadgetExample" id="GadgetExample">Examples</a>
</h1>
<p id="rfc.section.4.2.11.2.p.1">The following illustrates a non-normative example of an application that subscribes to a topic published by the Hub.</p>
<p id="rfc.section.4.2.11.2.p.2">Note that, by default, all of the necessary defaults parameters on the underlying HubClient connected for the application were initialized when the application was loaded. If the developer wishes to override the default parameters to the HubClient constructor, it can do so by setting values on gadgets.HubSettings as illustrated in the example.</p>
<div id="#rfc.figure.271"></div>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs title="Sample PubSub Subscriber" height="250"&gt;
      &lt;Require feature="pubsub-2"&gt;
        &lt;Param name="topics"&gt;&lt;![CDATA[ 
          &lt;Topic title="Random Number" 
            name="org.apache.shindig.random-number"
            description="Subscribes to random number generator." 
            type="number"
            subscribe="true"/&gt;
          ]]&gt;&lt;/Param&gt;
      &lt;/Require&gt;
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;&lt;![CDATA[
      &lt;script&gt;
  var subId;
  
  // Example of setting a parameter to the HubClient used by pubsub-2 feature.
  gadgets.HubSettings.params.HubClient.onSecurityAlert = function(alertSource, alertType) {
    alert("SECURITY ERROR!");
    window.location.href = "about:blank";
  };
  
  function callback(topic, data, subscriberData) {
    document.getElementById("output").innerHTML =
      "message : " + gadgets.util.escapeString(data + "") + "&lt;br/&gt;" +
      "received at: " + (new Date()).toString();
  }
  
  function subscribe() {
    subId = gadgets.Hub.subscribe("org.apache.shindig.random-number", callback);
  }
  
  function unsubscribe() {
    gadgets.Hub.unsubscribe(subId);
    document.getElementById("output").innerHTML = "";
  }
      &lt;/script&gt;
      &lt;div&gt;
        &lt;input type="button" value="Subscribe" onclick="subscribe()"/&gt;
        &lt;input type="button" value="Unsubscribe" onclick="unsubscribe()"/&gt;
      &lt;/div&gt;
      &lt;div id="output"&gt;&lt;/div&gt;
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
   </pre>
<p id="rfc.section.4.2.11.2.p.3">Similarly, below is a non-normative example of an application that publishes events to the Hub:</p>
<div id="#rfc.figure.272"></div>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs title="Sample PubSub Publisher" height="250"&gt;
      &lt;Require feature="pubsub-2"&gt;
        &lt;Param name="topics"&gt;
          &lt;![CDATA[ 
            &lt;Topic title="Random Number" 
              name="org.apache.shindig.random-number"
              description="Publishes a random number." 
              type="number"
              publish="true" /&gt;
        ]]&gt;&lt;/Param&gt;
      &lt;/Require&gt;
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;&lt;![CDATA[
      &lt;script&gt;
  function publish() {
    var message = Math.random();
    gadgets.Hub.publish("org.apache.shindig.random-number", message);
    document.getElementById("output").innerHTML = message;
  }
      &lt;/script&gt;
      &lt;div&gt;
        &lt;input type="button" value="Publish a random number" onclick="publish()"/&gt;
      &lt;/div&gt;
      &lt;div id="output"&gt;&lt;/div&gt;
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
     </pre>
<h1 id="rfc.section.4.2.11.3">
<a href="#rfc.section.4.2.11.3">4.2.11.3.</a> <a href="#pubsub.javascript" id="pubsub.javascript">JavaScript API</a>
</h1>
<h1 id="rfc.section.4.2.11.3.1">
<a href="#rfc.section.4.2.11.3.1">4.2.11.3.1.</a> The gadgets.Hub Object</h1>
<p id="rfc.section.4.2.11.3.1.p.1">The <samp>gadgets.Hub</samp> object is a fully compliant Hub as defined by the OpenAjax Hub 2.0 specification.  When the specification document specifies a dependency on the "pubsub-2" feature, an instance of the Hub is created automatically by the container and provided to the application.</p>
<h1 id="rfc.section.4.2.11.3.1.1">
<a href="#rfc.section.4.2.11.3.1.1">4.2.11.3.1.1.</a> <a href="#publish" id="publish">gadgets.Hub.publish</a>
</h1>
<p id="rfc.section.4.2.11.3.1.1.p.1">The <samp>gadgets.Hub.publish</samp> method is used to publish a message to a specific topic managed by the Hub.</p>
<div id="#rfc.figure.273"></div>
<pre>
  &lt;static&gt; &lt;Void&gt; gadgets.Hub.publish(topic, payload)
          </pre>
<p id="rfc.section.4.2.11.3.1.1.p.2">Input Parameters:</p>
<div id="#rfc.table.42"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">topic</td>
<td class="left">String</td>
<td class="left">A string identifying the topic, conforming to the OpenAjax Hub Topic Naming Rules. Topic wildcard values (e.g. "*") are NOT permitted.</td>
</tr>
<tr>
<td class="left">payload</td>
<td class="left">JSON Object or Primitive</td>
<td class="left">The data that is being published. This can be be any object serializable as JSON or a JavaScript primitive such as a String, number, boolean or null. Copies of this data will be delivered, by-value, to all subscribers to the named topic.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.11.3.1.1.p.3">The "publish" method is anonymous. That is, the method does not automatically include any information identifying the source of the message.</p>
<div id="#rfc.figure.274"></div>
<p>For example,</p>
<pre>
  var message = {
    "id":"http://example.org/foo/bar",
    "title": "My Example"
  };
  gadgets.Hub.publish("org.example.my.object", message);
          </pre>
<p id="rfc.section.4.2.11.3.1.1.p.4">See the <a href="http://www.openajax.org/member/wiki/OpenAjax_Hub_2.0_Specification_Managed_Hub_APIs#OpenAjax.hub.Hub.prototype.publish">OpenAjax Hub 2.0 documentation</a> for more information.</p>
<h1 id="rfc.section.4.2.11.3.1.2">
<a href="#rfc.section.4.2.11.3.1.2">4.2.11.3.1.2.</a> <a href="#subscribe" id="subscribe">gadgets.Hub.subscribe</a>
</h1>
<p id="rfc.section.4.2.11.3.1.2.p.1">The <samp>gadgets.Hub.subscribe</samp> method is used to register interest in receiving messages published to a specific topic. When a message is published, the Hub will invoke all of the callback methods registered for the topic.</p>
<p id="rfc.section.4.2.11.3.1.2.p.2">The subscribe method will return a unique subscription identifier that can be used to subsequently unsubscribe from the topic.</p>
<div id="#rfc.figure.275"></div>
<pre>
  &lt;static&gt; &lt;String&gt; gadgets.Hub.subscribe(topic, callback [,scope [,onCompleteCallback [,subscriberData]]])
          </pre>
<p id="rfc.section.4.2.11.3.1.2.p.3">Input Parameters:</p>
<div id="#rfc.table.43"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">topic</td>
<td class="left">String</td>
<td class="left">A string identifying the topic, conforming to the OpenAjax Topic Naming Rules. Wildcards (e.g. "*") MAY be used in order to subscribe to multiple topics in a single subscription request.</td>
</tr>
<tr>
<td class="left">callback</td>
<td class="left">Function</td>
<td class="left">A callback function that is invoked when a message is published to the topic.</td>
</tr>
<tr>
<td class="left">scope</td>
<td class="left">object</td>
<td class="left">When the callback or onCompleteCallback functions are invoked, the JavaScript "this" keyword refers to this scope object. If no scope is provided, default is window.</td>
</tr>
<tr>
<td class="left">onCompleteCallback</td>
<td class="left">Function</td>
<td class="left">A callback function that is invoked to tell the client application whether the subscribe operation succeeded or failed.</td>
</tr>
<tr>
<td class="left">subscriberData</td>
<td class="left">JSON Object</td>
<td class="left">Arbitrary, subscriber provided data that is returned back to the client application in the subscriberData parameter of the callback function.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.11.3.1.2.p.4">The method returns an opaque subscription identifier. This identifier is an arbitrary, unique ID string that is used to unsubscribe from the topic.</p>
<div id="#rfc.figure.276"></div>
<p>For example,</p>
<pre>
  callback = new Function(topic, data, subscriberData) {
    //...
  }
  
  subId = gadgets.Hub.subscribe("org.example.my.object", callback);
          </pre>
<p id="rfc.section.4.2.11.3.1.2.p.5">See&amp;#65533; the <a href="http://www.openajax.org/member/wiki/OpenAjax_Hub_2.0_Specification_Managed_Hub_APIs#OpenAjax.hub.Hub.prototype.subscribe">OpenAjax Hub documentation</a>&amp;#65533; for more information</p>
<h1 id="rfc.section.4.2.11.3.1.3">
<a href="#rfc.section.4.2.11.3.1.3">4.2.11.3.1.3.</a> <a href="#unsubscribe" id="unsubscribe">gadgets.Hub.unsubscribe</a>
</h1>
<p id="rfc.section.4.2.11.3.1.3.p.1">The <samp>gadgets.Hub.unsubscribe</samp> method is used to remove a subscription from the hub. The identifier returned by the subscribe method is used to identify the subscription to be removed. An exception is thrown if the referenced subscription does not exist.</p>
<div id="#rfc.figure.277"></div>
<pre>
  &lt;static&gt; &lt;Void&gt; gadgets.Hub.unsubscribe(subscriptionId)
          </pre>
<p id="rfc.section.4.2.11.3.1.3.p.2">Input Parameters:</p>
<div id="#rfc.table.44"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody><tr>
<td class="left">subscriptionId</td>
<td class="left">String</td>
<td class="left">The subscriptionId is the opaque string that is returned from the subscribe(...) method.</td>
</tr></tbody>
</table>
<div id="#rfc.figure.278"></div>
<p>For example,</p>
<pre>
  gadgets.Hub.unsubscribe(subId);
          </pre>
<p id="rfc.section.4.2.11.3.1.3.p.3">See the <a href="http://www.openajax.org/member/wiki/OpenAjax_Hub_2.0_Specification_Managed_Hub_APIs#OpenAjax.hub.Hub.prototype.unsubscribe">OpenAjax Hub documentation</a> for more information.</p>
<h1 id="rfc.section.4.2.11.3.1.4">
<a href="#rfc.section.4.2.11.3.1.4">4.2.11.3.1.4.</a> <a href="#OtherMethods" id="OtherMethods">Additional Methods</a>
</h1>
<p id="rfc.section.4.2.11.3.1.4.p.1">The 'gadgets.Hub' object is an instance of the IframeHubClient as defined by the OpenAjax Hub specification and supports the additional methods defined for objects of that type. Please refer to the <a href="http://www.openajax.org/member/wiki/OpenAjax_Hub_2.0_Specification_Managed_Hub_APIs#OpenAjax.hub.IframeHubClient">OpenAjax Hub documentation</a> for more information.</p>
<h1 id="rfc.section.4.2.11.4">
<a href="#rfc.section.4.2.11.4">4.2.11.4.</a> The &lt;Topic&gt; Element</h1>
<p id="rfc.section.4.2.11.4.p.1">As illustrated by the previous example, the "pubsub-2" feature provides a means of allowing developers to declaratively describe the which topics an application utilizes directly within the feature declaration within the "ModulePrefs" element.</p>
<div id="#rfc.figure.279"></div>
<p>For example:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs title="Sample PubSub Publisher" height="250"&gt;
      &lt;Require feature="pubsub-2"&gt;
        &lt;Param name="topics"&gt;
          &lt;![CDATA[ 
            &lt;Topic title="Random Number" 
              name="org.apache.shindig.random-number"
              description="Publishes a random number." 
              type="number"
              publish="true" /&gt;
        ]]&gt;&lt;/Param&gt;
      &lt;/Require&gt;
    &lt;/ModulePrefs&gt;
    ...
  &lt;/Module&gt;
      </pre>
<p id="rfc.section.4.2.11.4.p.2">When applications use the &lt;Topic&gt; element, containers are able to "wire" applications together either automatically or via a user interface that allows a user to connect applications that publish events to a given topic to applications that subscribe to those events.</p>
<p id="rfc.section.4.2.11.4.p.3">No XML namespace is defined for the &lt;Topic&gt; element.</p>
<div id="#rfc.figure.280"></div>
<pre>
  Topic = element Topic {
    attribute name { text },
    attribute type { text }?
    attribute title { text }?,
    attribute publish { "true" | "false" }?,
    attribute subscribe { "true" | "false" }?,
    attribute description { text }?,
    attribute aboutUrl { text }?,
    undefinedAttribute*
  }
      </pre>
<p id="rfc.section.4.2.11.4.p.4">The &lt;Topic&gt; element has the following attributes:</p>
<div id="#rfc.table.45"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Attribute</th>
<th class="left">Type</th>
<th class="left">Usage</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">name</td>
<td class="left">String</td>
<td class="left">Required</td>
<td class="left">The dot-delimited topic name, e.g. "org.example.randomNumber". This name follows the rules defined in the <a href="http://www.openajax.org/member/wiki/OpenAjax_Metadata_1.0_Specification_Widget_Metadata#topic_element_name_attribute">OpenAjax Widget Metadata specification</a>. Expression Language statements MAY be used within the value so long as the resulting substitution results in a properly formatted topic name.</td>
</tr>
<tr>
<td class="left">type</td>
<td class="left">String</td>
<td class="left">Optional</td>
<td class="left">Type name for the event's payload data. When not specificed, any type will be allowed. See <a href="#EventDataTypes">Event Data Types</a> <cite title="NONE">[EventDataTypes]</cite>.</td>
</tr>
<tr>
<td class="left">title</td>
<td class="left">String</td>
<td class="left">Optional</td>
<td class="left">A human-readable descriptive title for this topic. When not specified, the value of the "name" attribute will be used.</td>
</tr>
<tr>
<td class="left">publish</td>
<td class="left">boolean</td>
<td class="left">Optional</td>
<td class="left">Indicates if the application publishes data to this topic.  The default value is "false".</td>
</tr>
<tr>
<td class="left">subscribe</td>
<td class="left">boolean</td>
<td class="left">Optional</td>
<td class="left">Indicates if the application subscribes to data published to this topic.  The default value is "false".</td>
</tr>
<tr>
<td class="left">description</td>
<td class="left">String</td>
<td class="left">Optional</td>
<td class="left">The textual description of the application's publish or subscribe endpoint. This can be used as an indication of the application's behavior.  Consider an application that subscribes to a topic "com.example.address".  The description might read, "When this application receives an event on the com.example.address topic, it displays mass transit options within 10km of the address received as the event payload."</td>
</tr>
<tr>
<td class="left">aboutUrl</td>
<td class="left">String</td>
<td class="left">Optional</td>
<td class="left">A URL pointing to a resource that provides more extensive descriptive information than can be provided in the description attribute.</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.4.2.11.4.1">
<a href="#rfc.section.4.2.11.4.1">4.2.11.4.1.</a> <a href="#EventDataTypes" id="EventDataTypes">Event Data Types</a>
</h1>
<p id="rfc.section.4.2.11.4.1.p.1">The OpenAjax Hub specification allows any data serializable as JSON to be published to any given topic. Such data is inherently "untyped" and unstructured.</p>
<div id="#rfc.figure.281"></div>
<p>For instance, it is possible -- albeit unlikely -- that code publishing data to a topic can include two entirely dissimilar values to the same topic:</p>
<pre>
  gadgets.Hub.publish("my.topic", {"foo":"bar"});
  gadgets.Hub.publish("my.topic", "my data");
        </pre>
<p id="rfc.section.4.2.11.4.1.p.2">Subscribers to a topic need to be prepared to deal with such differences in payloads by inspecting received data to see what has been published.</p>
<p id="rfc.section.4.2.11.4.1.p.3">Container implementations MAY allow type information to be associated with the payloads published to a given Topic. How such type information is specified when the data is published to a topic is undefined by this specification.</p>
<p id="rfc.section.4.2.11.4.1.p.4">A developer can use the "type" attribute on the &lt;Topic&gt; element to indicate the specific type of data it publishes to a topic or is interested in receiving. Containers that support typing of payloads can use this information to more intelligently route data to interested subscribers.  For instance, one application might only be interested in receiving payloads of type "org.example.foo" from the topic "my.topic" while another might only want type "org.example.bar" payloads.</p>
<p id="rfc.section.4.2.11.4.1.p.5">If data types are supported, they MUST be identified using the following dot-delimited syntax and SHOULD conform to the "reverse DNS" naming convention (e.g. "org.example.foo"):</p>
<div id="#rfc.figure.282"></div>
<pre>
  prefix = token *["." token] "."
  datatype = [prefix] token
        </pre>
<p id="rfc.section.4.2.11.4.1.p.6">Any type other than those listed in the table below MUST have a prefix consisting of at least one token. The prefix "org.opensocial." is reserved for types defined by the OpenSocial specification (e.g. "org.opensocial.Person").</p>
<div id="#rfc.table.46"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Type Name</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">string</td>
<td class="left">A JavaScript string</td>
</tr>
<tr>
<td class="left">number</td>
<td class="left">A JavaScript number </td>
</tr>
<tr>
<td class="left">boolean</td>
<td class="left">A JavaScript boolean </td>
</tr>
<tr>
<td class="left">array</td>
<td class="left">A JSON-serializable Array, e.g. [ 1, 1, 2, 3, 5, 8 ]. The element type/s are not specified when the generic "array" type is used.</td>
</tr>
<tr>
<td class="left">object</td>
<td class="left">A JSON-serializable Object, e.g. { foo: "bar", baz: "boo" }. The specifics of the object are not specified when the generic "object" type is used.</td>
</tr>
<tr>
<td class="left">null</td>
<td class="left">A JavaScript null</td>
</tr>
<tr>
<td class="left">length</td>
<td class="left">Any CSS length value (e.g. "3px")</td>
</tr>
<tr>
<td class="left">color</td>
<td class="left">Any CSS color value (e.g. "#00ff00")</td>
</tr>
<tr>
<td class="left">id</td>
<td class="left">A string value that is used as a unique identifier</td>
</tr>
<tr>
<td class="left">class</td>
<td class="left">Zero or more CSS class names, separated by spaces</td>
</tr>
<tr>
<td class="left">style</td>
<td class="left">A string that could be used as value for a CSS 'style' attribute</td>
</tr>
<tr>
<td class="left">url</td>
<td class="left">An absolute URL value</td>
</tr>
<tr>
<td class="left">html</td>
<td class="left">A fragment of HTML markup</td>
</tr>
<tr>
<td class="left">countrycode</td>
<td class="left">An ISO 3166 Country Code</td>
</tr>
<tr>
<td class="left">languagecode</td>
<td class="left">An ISO 639-2 Language Code</td>
</tr>
<tr>
<td class="left">email</td>
<td class="left">A string that represents an e-mail address</td>
</tr>
<tr>
<td class="left">person</td>
<td class="left">A string that holds a person's name</td>
</tr>
<tr>
<td class="left">postalcode</td>
<td class="left">A string that represents a postal code</td>
</tr>
<tr>
<td class="left">phone</td>
<td class="left">A string that represents a phone number</td>
</tr>
<tr>
<td class="left">date</td>
<td class="left">A string that represents a date. MUST be expressed using the "Date Time String Format" defined in the [http://www.ecmascript.org/docs/tc39-2009-043.pdf ECMAScript5 specification] using one of the date-only forms. For example: "2009-12-15"</td>
</tr>
<tr>
<td class="left">time</td>
<td class="left">A string that represents a time of day. MUST be expressed using the "Date Time String Format" defined in the [http://www.ecmascript.org/docs/tc39-2009-043.pdf ECMAScript5 specification] using one of the time-only forms. For example: "18:45:00Z" or "10:26:24-05:00"</td>
</tr>
<tr>
<td class="left">timestamp</td>
<td class="left">A string that represents a date and time of day. MUST be expressed using the "Date Time String Format" defined in the [http://www.ecmascript.org/docs/tc39-2009-043.pdf ECMAScript5 specification].  For example: "2009-12-15:18:45.000Z"</td>
</tr>
<tr>
<td class="left">duration</td>
<td class="left">A string that represents a duration. MUST have format "PYYYY-DDDThh:mm:ss.fff". For example, "P0400-152T20:45:33.123" means "400 years, 152 days, 20 hours, 45 minutes, 33.123 seconds, while "P0003-000T01:56:22.000" means "3 years, 1 hour, 56 minutes and 22.000 seconds." (Must use this one variant defined in the ISO 8601 standard). </td>
</tr>
<tr>
<td class="left">*</td>
<td class="left">Asterisk, or missing type attribute, means "any datatype"</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.4.2.12">
<a href="#rfc.section.4.2.12">4.2.12.</a> <a href="#SecurityPolicy" id="SecurityPolicy">The Security Policy Feature</a>
</h1>
<p id="rfc.section.4.2.12.p.1">Gadget's often require the ability to perform potentially dangerous or sensitive operations or work with sensitive information.  Such application's SHOULD only be allowed to perform those operations if explicitly granted permission to do so by the container or the user.</p>
<p id="rfc.section.4.2.12.p.2">The Security Policy feature is used by an application to request permissions under which to run.  Specific permissions are requested with &lt;Param&gt; elements, with the "name" attribute on the Param element identifying the feature and the text content of the element providing any additional required feature-specific information.  The Security Policy feature is specified within the &lt;ModulePrefs&gt; with the feature name "security-policy" using either the &lt;Optional&gt; or &lt;Require&gt; element. A container MAY support the Security Policy feature.</p>
<p id="rfc.section.4.2.12.p.3">Containers MAY override any requested permission with its own more restrictive security policy. The container SHOULD NOT grant permissions to any application that are less restrictive than those explicitly requested by the application.</p>
<div id="#rfc.figure.283"></div>
<p>An application requesting optional permissions from the container:</p>
<pre>
    &lt;ModulePrefs &gt;
      &lt;Optional feature="security-policy" &gt;
        &lt;Param name="foo"&gt;bar&lt;/Param&gt;
      &lt;/Optional &gt;
    &lt;/ModulePrefs &gt;
      </pre>
<p id="rfc.section.4.2.12.p.4">If an application requests a security policy that is not supported, the container MUST log an error to the gadgets.log.  A container MAY render that application using a supported security policy, or display an appropriate error message. TODO: Clarify this</p>
<p id="rfc.section.4.2.12.p.5">Containers are free to define their own permissions for any purpose.  TODO: should we have a registry of common permissions???</p>
<h1 id="rfc.section.4.2.13">
<a href="#rfc.section.4.2.13">4.2.13.</a> <a href="#gadgets.selection" id="gadgets.selection">The Selection Feature</a>
</h1>
<p id="rfc.section.4.2.13.p.1">It is common for an OpenSocial container to display multiple applications within a single display area. Often, when a user performs some action in one view, another other displayed application needs to respond in some appropriate manner. For instance, if the user selects a person in their contact list in one view, another view can be triggered to display the selected person's profile information, while another can display a listing of documents owned by that person. In order to enable such functionality, the container needs to provide applications with a way of determining the currently selected object.</p>
<p id="rfc.section.4.2.13.p.2">The Selection feature provides the ability to participate in the container's selection eventing. It is enabled for an application by specifying feature="selection" within either a &lt;Require&gt; or &lt;Optional&gt; element within the &lt;ModulePrefs&gt;.</p>
<p id="rfc.section.4.2.13.p.3">Once the feature is enabled, the application can either get or set the current selection for the container.</p>
<div id="#rfc.figure.284"></div>
<p>The example below illustrates how an application can set the current selection for the container:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs title="Sample Selection Changer" height="250"&gt;
      &lt;Require feature="selection"/&gt;
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;&lt;![CDATA[
      &lt;script&gt;
        function setSelection(selection) {
          selection = [{type:'com.example.food', dataObject: selection}];
          gadgets.selection.setSelection(selection);
          document.getElementById("output").innerHTML = 'selection: '
           + gadgets.util.escapeString('' + gadgets.json.stringify(selection)) + '&lt;br/&gt;';
        }
      &lt;/script&gt;
      &lt;div&gt;
        &lt;input type="radio" name="group1" value="Milk" onclick="setSelection('Milk')"/&gt; Milk&lt;br&gt;
        &lt;input type="radio" name="group1" value="Butter" onclick="setSelection('Butter')"/&gt; Butter&lt;br&gt;
        &lt;input type="radio" name="group1" value="Cheese" onclick="setSelection('Cheese')"/&gt; Cheese&lt;br&gt;
      &lt;/div&gt;
      &lt;div id="output"&gt;&lt;/div&gt;
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;     
     </pre>
<p id="rfc.section.4.2.13.p.4">At any given time, a container only has one selected object that is visible to all applications for which selection is enabled. Any application can access the currently selected object for the container by using either the <samp>gadgets.selection.getSelection</samp> method or by registering a callback function that the container will invoke whenever a new selection object is set.</p>
<h1 id="rfc.section.4.2.13.1">
<a href="#rfc.section.4.2.13.1">4.2.13.1.</a> JavaScript API</h1>
<p id="rfc.section.4.2.13.1.p.1">The following JavaScript methods are provided to applications when the "selection" feature is enabled.</p>
<h1 id="rfc.section.4.2.13.1.1">
<a href="#rfc.section.4.2.13.1.1">4.2.13.1.1.</a> The Selection Object</h1>
<p id="rfc.section.4.2.13.1.1.p.1">Selection Objects are simple JSON-serializable Objects that consist of two basic properties:</p>
<div id="#rfc.table.47"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">type</td>
<td class="left">String</td>
<td class="left">A required data type identifier as defined in <a href="#EventDataTypes">Section 4.2.11.4.1</a> that specifies the kind of object that has been selected.</td>
</tr>
<tr>
<td class="left">dataObject</td>
<td class="left">Object or Primitive</td>
<td class="left">Any valid JSON-serializable object or JavaScript primitive that represents the selected data.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.13.1.1.p.2">The current selection for a container will consist of an array of zero or more individual Selection Objects, each of which MAY specify a different type value. For example:</p>
<div id="#rfc.figure.285"></div>
<p>For example:</p>
<pre>
  var selection = [
    {"type": "org.example.food", "dataObject": "Cheese"},
    {"type": "org.example.drink", "dataObject": "Wine"}
  ]
  gadgets.selection.setSelection(selection);
        </pre>
<h1 id="rfc.section.4.2.13.1.2">
<a href="#rfc.section.4.2.13.1.2">4.2.13.1.2.</a> <a href="#gadgets.selection.setSelection" id="gadgets.selection.setSelection">gadgets.selection.setSelection</a>
</h1>
<p id="rfc.section.4.2.13.1.2.p.1">The <samp>gadgets.selection.setSelection</samp> method sets the current selection for the container, replacing the current selection.</p>
<div id="#rfc.figure.286"></div>
<pre>
   &lt;Static&gt; &lt;Void&gt; gadgets.selection.setSelection (selection)
        </pre>
<p id="rfc.section.4.2.13.1.2.p.2">Input Parameters:</p>
<div id="#rfc.table.48"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody><tr>
<td class="left">selection</td>
<td class="left">Selection Objects[]</td>
<td class="left">An array of zero or more Selection objects.</td>
</tr></tbody>
</table>
<p id="rfc.section.4.2.13.1.2.p.3">No return value is specified.</p>
<p id="rfc.section.4.2.13.1.2.p.4">Calling the <samp>gadgets.selection.setSelection</samp> method will trigger the container to send notifications to all applications that have registered selection listener callback functions.</p>
<h1 id="rfc.section.4.2.13.1.3">
<a href="#rfc.section.4.2.13.1.3">4.2.13.1.3.</a> <a href="#gadgets.selection.getSelection" id="gadgets.selection.getSelection">gadgets.selection.getSelection</a>
</h1>
<p id="rfc.section.4.2.13.1.3.p.1">The <samp>gadgets.selection.getSelection</samp> method returns the current selection for the container. The method takes no input parameters and returns an array of Selection objects.</p>
<div id="#rfc.figure.287"></div>
<pre>
  &lt;static&gt; &lt;Selection Object[]&gt; gadgets.selection.getSelection()
        </pre>
<h1 id="rfc.section.4.2.13.1.4">
<a href="#rfc.section.4.2.13.1.4">4.2.13.1.4.</a> <a href="#gadgets.selection.addListener" id="gadgets.selection.addListener">gadgets.selection.addListener</a>
</h1>
<p id="rfc.section.4.2.13.1.4.p.1">The <samp>gadgets.selection.addListener</samp> method registers a callback function that the container will use to notify the container of changes in the current selection.</p>
<div id="#rfc.figure.288"></div>
<pre>
  &lt;static&gt; &lt;Void&gt; gadgets.selection.addListener(event, callback)
        </pre>
<p id="rfc.section.4.2.13.1.4.p.2">Input Parameters:</p>
<div id="#rfc.table.49"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">event</td>
<td class="left">String</td>
<td class="left">The type of selection event (currently unused). Valid values are "selection", "preselection", "postselection" or null.</td>
</tr>
<tr>
<td class="left">callback</td>
<td class="left">Function</td>
<td class="left">The callback function that is called for the specified selection event.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.13.1.4.p.3">Note that, currently, the "event" parameter is unused.</p>
<p id="rfc.section.4.2.13.1.4.p.4">No return value is specified.</p>
<h1 id="rfc.section.4.2.13.1.5">
<a href="#rfc.section.4.2.13.1.5">4.2.13.1.5.</a> <a href="#gadgets.selection.removeListener" id="gadgets.selection.removeListener">removeListener</a>
</h1>
<p id="rfc.section.4.2.13.1.5.p.1">The <samp>gadgets.selection.removeListener</samp> method unregisters a selection callback function.</p>
<div id="#rfc.figure.289"></div>
<pre>
  &lt;static&gt; &lt;Void&gt; gadgets.selection.removeListener(event, callback)
        </pre>
<p id="rfc.section.4.2.13.1.5.p.2">Input Parameters:</p>
<div id="#rfc.table.50"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">event</td>
<td class="left">String</td>
<td class="left">The type of selection event (currently unused). Valid values are "selection", "preselection", "postselection" or null.</td>
</tr>
<tr>
<td class="left">callback</td>
<td class="left">Function</td>
<td class="left">The callback function to be unregistered.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.13.1.5.p.3">Note that, currently, the "event" parameter is unused.</p>
<p id="rfc.section.4.2.13.1.5.p.4">No return value is specified.</p>
<h1 id="rfc.section.4.2.14">
<a href="#rfc.section.4.2.14">4.2.14.</a> <a href="#gadgets.views" id="gadgets.views">The View Features</a>
</h1>
<p id="rfc.section.4.2.14.p.1">The View Features provide operations for interacting with the collection of Views provided by a specification document. There are two distinct View-related features, each of which are enabled for an application instance by specifying their respective feature identifiers using either the &lt;Require&gt; or &lt;Optional&gt; elements within the &lt;ModulePrefs&gt;</p>
<h1 id="rfc.section.4.2.14.1">
<a href="#rfc.section.4.2.14.1">4.2.14.1.</a> The "views" Feature</h1>
<p id="rfc.section.4.2.14.1.p.1">The "views" feature provides the basic operations for accessing information about and changing the current View being rendered.</p>
<div id="#rfc.figure.290"></div>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      &lt;Require feature="views"/&gt;
    &lt;/ModulePrefs&gt;
    ...
  &lt;/Module&gt;          
          </pre>
<h1 id="rfc.section.4.2.14.1.1">
<a href="#rfc.section.4.2.14.1.1">4.2.14.1.1.</a> JavaScript API</h1>
<p id="rfc.section.4.2.14.1.1.p.1">Once enabled, the "views" feature provides the following objects a methods:</p>
<h1 id="rfc.section.4.2.14.1.1.1">
<a href="#rfc.section.4.2.14.1.1.1">4.2.14.1.1.1.</a> <a href="#gadgets.views.ViewType" id="gadgets.views.ViewType">The gadgets.views.ViewType Constants</a>
</h1>
<p id="rfc.section.4.2.14.1.1.1.p.1">For the convenience of Gadget developers, JavaScript aliases for the handful of common View names defined in <a href="#content-processing-model">Section 2.2.12.1</a> have been defined.</p>
<div id="#rfc.table.51"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">View Name</th>
<th class="left">Alias</th>
</tr></thead>
<tbody>
<tr>
<td class="left">about</td>
<td class="left">gadgets.views.ViewType.ABOUT</td>
</tr>
<tr>
<td class="left">canvas</td>
<td class="left">gadgets.views.ViewType.CANVAS</td>
</tr>
<tr>
<td class="left">embedded</td>
<td class="left">gadgets.views.ViewType.EMBEDDED</td>
</tr>
<tr>
<td class="left">home</td>
<td class="left">gadgets.views.ViewType.HOME</td>
</tr>
<tr>
<td class="left">preferences</td>
<td class="left">gadgets.views.ViewType.PREFERENCES</td>
</tr>
<tr>
<td class="left">preview</td>
<td class="left">gadgets.views.ViewType.PREVIEW</td>
</tr>
<tr>
<td class="left">profile</td>
<td class="left">gadgets.views.ViewType.PROFILE</td>
</tr>
<tr>
<td class="left">support</td>
<td class="left">gadgets.views.ViewType.SUPPORT</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.4.2.14.1.1.2">
<a href="#rfc.section.4.2.14.1.1.2">4.2.14.1.1.2.</a> <a href="#gadgets.views.ViewType.ViewTarget" id="gadgets.views.ViewType.ViewTarget">View Targets</a>
</h1>
<p id="rfc.section.4.2.14.1.1.2.p.1">View targets are specific areas defined by a container where the views of an application can be rendered. The specific targets supported are specific to each individual implementation. At a minimum, containers SHOULD support the following targets:</p>
<div id="#rfc.table.52"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">View Target</th>
<th class="left">Alias</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">TAB</td>
<td class="left">gadgets.views.ViewType.TAB</td>
<td class="left">When containers support the ability to display content using a tabbed interface (similar to those used by modern Web browser user agents), the <samp>TAG</samp> View Target is used to request that a particular Application View be displayed within it's own separate tab.</td>
</tr>
<tr>
<td class="left">DIALOG</td>
<td class="left">gadgets.views.ViewType.DIALOG</td>
<td class="left">The <samp>DIALOG</samp> View Target is used to request that a particular Application View be displayed within a popup up box in a way that allows the Viewer to continue interacting with the rest of the container.</td>
</tr>
<tr>
<td class="left">MODALDIALOG</td>
<td class="left">gadgets.views.ViewType.MODALDIALOG</td>
<td class="left">The <samp>MODALDIALOG</samp> View Target is used to request that a particular Application View be displayed within a popup box in a way that requires the Viewer to interact with it prior to continuing any further interaction with the rest of the container.</td>
</tr>
<tr>
<td class="left">FLOAT</td>
<td class="left">gadgets.views.ViewType.FLOAT</td>
<td class="left">The <samp>FLOAT</samp> View Target is similar to the <samp>DIALOG</samp> View Target with the exception that, when using <samp>FLOAT</samp>, the container SHOULD render the view without including any additional User Interface elements (also known as "chrome").</td>
</tr>
<tr>
<td class="left">SIDEBAR</td>
<td class="left">gadgets.views.ViewType.SIDEBAR</td>
<td class="left">Some containers can reserve a portion of the visible user interface to the right or left of the primary content for the display of one or more application views. The <samp>SIDEBAR</samp> View Target can be used to request that an application view be rendered within this dedicated space.</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.4.2.14.1.1.3">
<a href="#rfc.section.4.2.14.1.1.3">4.2.14.1.1.3.</a> <a href="#gadgets.views.View" id="gadgets.views.View">The gadgets.views.View Object</a>
</h1>
<p id="rfc.section.4.2.14.1.1.3.p.1">The <samp>gadgets.views.View</samp> object represents a View supported by an application. Instances of the <samp>gadgets.views.View</samp> object are provided by the container </p>
<p id="rfc.section.4.2.14.1.1.3.p.2">The methods exposed by the object are:</p>
<h1 id="rfc.section.4.2.14.1.1.3.1">
<a href="#rfc.section.4.2.14.1.1.3.1">4.2.14.1.1.3.1.</a> <a href="#gadgets.views.View.getName" id="gadgets.views.View.getName">gadgets.views.View.getName</a>
</h1>
<p id="rfc.section.4.2.14.1.1.3.1.p.1">The <samp>gadgets.views.View.getName</samp> method returns the name of the View object. The method requires no input parameters.</p>
<div id="#rfc.figure.291"></div>
<pre>
  &lt;String&gt; &lt;instance&gt;.getName()
                </pre>
<h1 id="rfc.section.4.2.14.1.1.3.2">
<a href="#rfc.section.4.2.14.1.1.3.2">4.2.14.1.1.3.2.</a> <a href="#gadgets.views.View.isOnlyVisibleGadget" id="gadgets.views.View.isOnlyVisibleGadget">gadgets.views.View.isOnlyVisibleGadget</a>
</h1>
<p id="rfc.section.4.2.14.1.1.3.2.p.1">The <samp>gadgets.views.View.isOnlyVisibleGadget</samp> returns True if the application instance is the only application currently visibly displayed by the container. No input parameters are specified.</p>
<div id="#rfc.figure.292"></div>
<pre>
  &lt;Boolean&gt; &lt;instance&gt;.isOnlyVisibleGadget()
                </pre>
<h1 id="rfc.section.4.2.14.1.1.4">
<a href="#rfc.section.4.2.14.1.1.4">4.2.14.1.1.4.</a> <a href="#gadgets.views.getCurrentView" id="gadgets.views.getCurrentView">gadgets.views.getCurrentView</a>
</h1>
<p id="rfc.section.4.2.14.1.1.4.p.1">The <samp>gadgets.views.getCurrentView</samp> returns a <samp>gadgets.views.View</samp> object representing the currently rendered View. The method takes no input parameters.</p>
<div id="#rfc.figure.293"></div>
<pre>
  &lt;static&gt; &lt;gadgets.views.View&gt; gadgets.views.getCurrentView()
              </pre>
<h1 id="rfc.section.4.2.14.1.1.5">
<a href="#rfc.section.4.2.14.1.1.5">4.2.14.1.1.5.</a> <a href="#gadgets.views.getParams" id="gadgets.views.getParams">gadgets.views.getParams</a>
</h1>
<p id="rfc.section.4.2.14.1.1.5.p.1">The <samp>gadgets.views.getParams</samp> method returns the parameters provided when the request to render the current view was received.</p>
<div id="#rfc.figure.294"></div>
<pre>
  &lt;static&gt; &lt;Object&gt; gadgets.views.getParams()
              </pre>
<p id="rfc.section.4.2.14.1.1.5.p.2">The method takes no input parameters and returns a JavaScript object whose properties represent each of the provided view parameters.</p>
<h1 id="rfc.section.4.2.14.1.1.6">
<a href="#rfc.section.4.2.14.1.1.6">4.2.14.1.1.6.</a> <a href="#gadgets.views.getSupportedViews" id="gadgets.views.getSupportedViews">gadgets.views.getSupportedViews</a>
</h1>
<p id="rfc.section.4.2.14.1.1.6.p.1">The <samp>gadgets.views.getSupportedViews</samp> method returns a JavaScript object mapping all of the supported primary <samp>gadgets.views.View</samp> objects for an application to the view name. Note that only primary views will be included, for instance, if the specification document defines views named "Canvas.About", "Profile.About", "Home.About", "Canvas.Help", etc, the returned views will be: "Canvas", "Home" and "Profile".</p>
<div id="#rfc.figure.295"></div>
<pre>
  &lt;static&gt; &lt;Object&gt; gadgets.views.getSupportedViews();
              </pre>
<h1 id="rfc.section.4.2.14.1.1.7">
<a href="#rfc.section.4.2.14.1.1.7">4.2.14.1.1.7.</a> <a href="#gadgets.views.requestNavigateTo" id="gadgets.views.requestNavigateTo">gadgets.views.requestNavigateTo</a>
</h1>
<p id="rfc.section.4.2.14.1.1.7.p.1">The <samp>gadgets.views.requestNavigateTo</samp> method is used to request that the container render a specific view. If the container supports parameter passing, it will pass the optional parameters when rendering the new view. </p>
<div id="#rfc.figure.296"></div>
<pre>
  &lt;static&gt; &lt;Void&gt; gadgets.views.requestNavigateTo(view, opt_params, opt_ownerId)
              </pre>
<p id="rfc.section.4.2.14.1.1.7.p.2">TODO: Finish this</p>
<h1 id="rfc.section.4.2.14.2">
<a href="#rfc.section.4.2.14.2">4.2.14.2.</a> The "open-views" Feature</h1>
<p id="rfc.section.4.2.14.2.p.1">The "open-views" feature provides additional methods for opening and closing views within a container.</p>
<div id="#rfc.figure.297"></div>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      &lt;Require feature="open-views"/&gt;
    &lt;/ModulePrefs&gt;
    ...
  &lt;/Module&gt; 
          </pre>
<h1 id="rfc.section.4.2.14.2.1">
<a href="#rfc.section.4.2.14.2.1">4.2.14.2.1.</a> JavaScript API</h1>
<p id="rfc.section.4.2.14.2.1.p.1">Enabling the "open-views" feature provides the following additional methods on the <samp>gadgets.views</samp> object.</p>
<p id="rfc.section.4.2.14.2.1.p.2">The "open-views" feature depends directly on the more basic functionality provided by the "views" feature; so by including "open-views" in a specification document using either the &lt;Require&gt; or &lt;Optional&gt; elements, the Objects and methods of the "views" feature are also made available.</p>
<h1 id="rfc.section.4.2.14.2.1.1">
<a href="#rfc.section.4.2.14.2.1.1">4.2.14.2.1.1.</a> <a href="#gadgets.views.openGadget" id="gadgets.views.openGadget">gadgets.views.openGadget</a>
</h1>
<p id="rfc.section.4.2.14.2.1.1.p.1">The <samp>gadgets.views.openGadget</samp> method requests that a view be rendered by the container.</p>
<div id="#rfc.figure.298"></div>
<pre>
  &lt;static&gt; &lt;Void&gt; gadgets.views.openGadget(resultCallback, navigateCallback, opt_params)
              </pre>
<p id="rfc.section.4.2.14.2.1.1.p.2">The method accepts three parameters as input.</p>
<div id="#rfc.table.53"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">resultCallback</td>
<td class="left">Function</td>
<td class="left">Specifies a callback Function that will be invoked by the container when the requested application has been closed using the <samp>gadgets.views.close</samp> method. If the <samp>gadgets.views.setReturnValue</samp> was called within the opened view, then the value specified will be passed to the callback function as a parameter.</td>
</tr>
<tr>
<td class="left">navigateCallback</td>
<td class="left">Function</td>
<td class="left">Specifies a callback Function that will be invoked by the container when the requested view has been rendered. The identifier the container assigns to the rendered view, along with any additional appropriate metadata will be passed to the function as parameters. The identifier can be used with the <samp>gadgets.views.close</samp> method to subsequently close the opened view.</td>
</tr>
<tr>
<td class="left">opt_params</td>
<td class="left">Object</td>
<td class="left">Specifies optional parameters that affect how the view is to be rendered.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.14.2.1.1.p.3">No return value is specified for the method.</p>
<p id="rfc.section.4.2.14.2.1.1.p.4">The following optional items MAY be specified as properties on the "opt_params" parameter value:</p>
<div id="#rfc.table.54"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">view</td>
<td class="left">String </td>
<td class="left">Identifies the specific view the container is to render. If not provided, the container will render the default unnamed view.</td>
</tr>
<tr>
<td class="left">viewTarget </td>
<td class="left">String </td>
<td class="left">Identifies where and how the container is to render the view, specified as a <a href="#gadgets.views.ViewType.ViewTarget">View Target</a> <cite title="NONE">[gadgets.views.ViewType.ViewTarget]</cite>.  For example, specifying a viewTarget of <samp>MODALDIALOG</samp> will cause the view to be rendered by the container in a modal popup dialog box; whereas specifying a viewTarget of "tab" will cause the container to render the view within a new container tab.</td>
</tr>
<tr>
<td class="left">viewParams </td>
<td class="left">Object</td>
<td class="left">An arbitrary collection of view parameters to pass along to the view being rendered.</td>
</tr>
<tr>
<td class="left">coordinates</td>
<td class="left">
<a href="#gadgets.views.coordinates">Coordinate Object</a> <cite title="NONE">[gadgets.views.coordinates]</cite>
</td>
<td class="left">When viewTarget equals "FLOAT", the coordinates object MAY be used to provide suggested positioning information the container can use when deciding where, within the container, the view is to be renderered relative to the opening application.</td>
</tr>
</tbody>
</table>
<div id="#rfc.figure.299"></div>
<p>For example, in the following sample, code running with the default view opens the view named "foo" in a modal dialog, passing along an arbitrary set of view parameters:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      &lt;Require feature="open-views"/&gt;
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;&lt;![CDATA[
      &lt;script&gt;
        function bar() {
            gadgets.views.openGadget(
              function(result) {}, 
              function(id) {
                // id is the identifier of the dialog box
              }, 
              {
                viewTarget: "dialog",
                view: "foo",
                viewParams: {
                  "abc": "123",
                  "xyz": "foo"
                }
              }
            );
        }
      &lt;/script&gt;
        &lt;a href="#" onclick="bar()"&gt;Open!&lt;/a&gt;
    ]]&gt;&lt;/Content&gt;
    &lt;Content type="html" view="foo"&gt;&lt;![CDATA[
      ...
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
              </pre>
<h1 id="rfc.section.4.2.14.2.1.2">
<a href="#rfc.section.4.2.14.2.1.2">4.2.14.2.1.2.</a> <a href="#gadgets.views.openEmbeddedExperience" id="gadgets.views.openEmbeddedExperience">gadgets.views.openEmbeddedExperience</a>
</h1>
<p id="rfc.section.4.2.14.2.1.2.p.1">The <samp>gadgets.views.openEmbeddedExperience</samp> method requests that an <a href="#Embedded-Experiences">embedded experience</a> <cite title="NONE">[Embedded-Experiences]</cite> by rendered by the container.</p>
<div id="#rfc.figure.300"></div>
<pre>
  &lt;static&gt; &lt;Void&gt; gadgets.views.openEmbeddedExperience(resultCallback, navigateCallback, dataModel, opt_params)
              </pre>
<p id="rfc.section.4.2.14.2.1.2.p.2">The method accepts four parameters as input.</p>
<div id="#rfc.table.55"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">resultCallback</td>
<td class="left">Function</td>
<td class="left">Specifies a callback Function that will be invoked by the container when the specified view has been closed using the <samp>gadgets.views.close</samp> method. If the <samp>gadgets.views.setReturnValue</samp> was called within the opened view, then the value specified will be passed to the callback function as a parameter.</td>
</tr>
<tr>
<td class="left">navigateCallback</td>
<td class="left">Function</td>
<td class="left">Specifies a callback Function that will be invoked by the container when the requested view has been rendered. The identifier the container assigns to the rendered view, along with any additional appropriate metadata will be passed to the function as parameters. The identifier can be used with the <samp>gadgets.views.close</samp> method to subsequently close the opened view.</td>
</tr>
<tr>
<td class="left">dataModel</td>
<td class="left">TODO:</td>
<td class="left">Specifies the Embedded Experiences Data model to use when rendering. The model is passed in as a JavaScript object conforming to the JSON embedded experiences format as defined in <a href="#Embedded-Experiences">Section 4.2.4</a>.</td>
</tr>
<tr>
<td class="left">opt_params</td>
<td class="left">Object</td>
<td class="left">Specifies optional parameters that affect how the view is to be rendered.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.14.2.1.2.p.3">No return value is specified for the method.</p>
<p id="rfc.section.4.2.14.2.1.2.p.4">The following optional items MAY be specified as properties on the "opt_params" parameter value:</p>
<div id="#rfc.table.56"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">view</td>
<td class="left">String </td>
<td class="left">Identifies the specific view the container is to render. If not provided, the container will render the default unnamed view.</td>
</tr>
<tr>
<td class="left">viewTarget </td>
<td class="left">String </td>
<td class="left">Identifies where and how the container is to render the view, specified as a <a href="#gadgets.views.ViewType.ViewTarget">View Target</a> <cite title="NONE">[gadgets.views.ViewType.ViewTarget]</cite>.  For example, specifying a viewTarget of "modalDialog" will cause the view to be rendered by the container in a modal popup dialog box; whereas specifying a viewTarget of "tab" will cause the container to render the view within a new container tab.</td>
</tr>
<tr>
<td class="left">viewParams</td>
<td class="left">Object</td>
<td class="left">An arbitrary collection of view parameters to pass along to the view being rendered.</td>
</tr>
<tr>
<td class="left">coordinates</td>
<td class="left">
<a href="#gadgets.views.coordinates">Coordinate Object</a> <cite title="NONE">[gadgets.views.coordinates]</cite>
</td>
<td class="left">When viewTarget equals "FLOAT", the coordinates object MAY be used to provide suggested positioning information the container can use when deciding where, within the container, the view is to be renderered relative to the opening view.</td>
</tr>
</tbody>
</table>
<div id="#rfc.figure.301"></div>
<p>For example, in the following sample, code running with the default view opens a URL as an embedded experience:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      &lt;Require feature="open-views"/&gt;
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;&lt;![CDATA[
      &lt;script&gt;
        function bar() {
            gadgets.views.openEmbeddedExperience(
              function(result) {}, 
              function(id) {
                // id is the identifier of the dialog box
              }, 
              {
                "url" : "http://example.org/foo.html"
              }
            );
        }
      &lt;/script&gt;
        &lt;a href="#" onclick="bar()"&gt;Open!&lt;/a&gt;
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
              </pre>
<p id="rfc.section.4.2.14.2.1.2.p.5">TODO: This only works when EE container has been properly initialized...</p>
<h1 id="rfc.section.4.2.14.2.1.3">
<a href="#rfc.section.4.2.14.2.1.3">4.2.14.2.1.3.</a> <a href="#gadgets.views.openUrl" id="gadgets.views.openUrl">gadgets.views.openUrl</a>
</h1>
<p id="rfc.section.4.2.14.2.1.3.p.1">The <samp>gadgets.views.openUrl</samp> method requests that a URL be opened and rendered by the container.</p>
<div id="#rfc.figure.302"></div>
<pre>
  &lt;static&gt; &lt;Void&gt; gadgets.views.openUrl(url, navigateCallback, opt_viewTarget)
              </pre>
<p id="rfc.section.4.2.14.2.1.3.p.2">The method accepts three parameters as input:</p>
<div id="#rfc.table.57"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">url</td>
<td class="left">String</td>
<td class="left">The URL of the web page whose content will be displayed.</td>
</tr>
<tr>
<td class="left">navigateCallback</td>
<td class="left">Function</td>
<td class="left">Specifies a callback Function that will be invoked by the container when the requested view has been rendered. The identifier the container assigns to the rendered view, along with any additional appropriate metadata will be passed to the function as parameters. The identifier can be used with the <samp>gadgets.views.close</samp> method to subsequently close the opened view.</td>
</tr>
<tr>
<td class="left">opt_viewTarget </td>
<td class="left">String </td>
<td class="left">Optionally identifies where and how the container is to render the view, specified as a <a href="#gadgets.views.ViewType.ViewTarget">View Target</a> <cite title="NONE">[gadgets.views.ViewType.ViewTarget]</cite>.  For example, specifying a viewTarget of "modalDialog" will cause the URL to be rendered by the container within a modal popup dialog box; whereas specifying a viewTarget of "tab" will cause the container to render the URL within a new container tab.</td>
</tr>
</tbody>
</table>
<div id="#rfc.figure.303"></div>
<p>For example:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      &lt;Require feature="open-views"/&gt;
      &lt;Require feature="embedded-experiences" /&gt;
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;&lt;![CDATA[
      &lt;script&gt;
        function bar() {
            gadgets.views.openUrl(
              "http://example.org/foo.html", 
              function(id) {
                // id is the identifier of the dialog box
              },
              "modaldialog"
            );
        }
      &lt;/script&gt;
        &lt;a href="#" onclick="bar()"&gt;Open!&lt;/a&gt;
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
              </pre>
<h1 id="rfc.section.4.2.14.2.1.4">
<a href="#rfc.section.4.2.14.2.1.4">4.2.14.2.1.4.</a> <a href="#gadgets.views.close" id="gadgets.views.close">gadgets.views.close</a>
</h1>
<p id="rfc.section.4.2.14.2.1.4.p.1">The <samp>gadgets.views.close</samp> method requests that a given view be closed.</p>
<div id="#rfc.figure.304"></div>
<pre>
  &lt;static&gt; &lt;Void&gt; gadgets.views.close(opt_site_handler)
              </pre>
<p id="rfc.section.4.2.14.2.1.4.p.2">Parameters:</p>
<div id="#rfc.table.58"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody><tr>
<td class="left">opt_site_handler</td>
<td class="left">Object</td>
<td class="left">Optional parameter which specifies handler to what site to close. If null or unspecified, it will close the view within which the call to <samp>gadgets.views.close</samp> was made.</td>
</tr></tbody>
</table>
<h1 id="rfc.section.4.2.14.2.1.5">
<a href="#rfc.section.4.2.14.2.1.5">4.2.14.2.1.5.</a> <a href="#gadgets.views.setReturnValue" id="gadgets.views.setReturnValue">gadgets.views.setReturnValue</a>
</h1>
<p id="rfc.section.4.2.14.2.1.5.p.1">Often, code running within one view will require the ability to programmatically open a second view for the purpose of collecting input from the user. In such cases, the <samp>gadgets.views.setReturnValue</samp> method can be used within the code of the second opened view to specify the data that is to be returned to the first.</p>
<div id="#rfc.figure.305"></div>
<pre>
  &lt;static&gt; &lt;Void&gt; gadgets.views.setReturnValue(returnValue)
              </pre>
<p id="rfc.section.4.2.14.2.1.5.p.2">The method takes either a JavaScript primitive value, a JSON-serializable Object, or an Array of primitives or JSON-serializable Objects as an input parameter. No return value is specified for the method.</p>
<div id="#rfc.figure.306"></div>
<p>For example, in the following instance, code running within the default view opens a view named "foo" within a modal dialog and awaits a response. The value set using the <samp>gadgets.views.setReturnValue</samp> method is passed to the calling view via a callback function provided to the <samp>gadgets.views.openGadget</samp> method:</p>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      &lt;Require feature="open-views"/&gt;
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;&lt;![CDATA[
      &lt;script&gt;
        function bar() {
            gadgets.views.openGadget(
              function(returnValue) {
                alert(returnValue);
              }, 
              function() {}, 
              {
                viewTarget: "dialog",
                view: "foo"
              }
            );
        }
      &lt;/script&gt;
        &lt;a href="#" onclick="bar()"&gt;Open!&lt;/a&gt;
    ]]&gt;&lt;/Content&gt;
    &lt;Content type="html" view="foo"&gt;&lt;![CDATA[
      &lt;script&gt;
        function foo() {
          gadgets.views.setReturnValue({"a":"b"});
          gadgets.views.close();
        }
      &lt;/script&gt;
      &lt;a href="#" onclick="foo()"&gt;Close&lt;/a&gt;
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
              </pre>
<h1 id="rfc.section.4.2.14.2.1.6">
<a href="#rfc.section.4.2.14.2.1.6">4.2.14.2.1.6.</a> <a href="#gadgets.window.getContainerDimensions" id="gadgets.window.getContainerDimensions">gadgets.window.getContainerDimensions</a>
</h1>
<p id="rfc.section.4.2.14.2.1.6.p.1">The <samp>gadgets.window.getContainerDimensions</samp> method detects the height and width of the container displaying the view and passes those to a provided callback function.</p>
<div id="#rfc.figure.307"></div>
<pre>
  &lt;static&gt; &lt;Void&gt; gadgets.window.getContainerDimensions(resultCallback)
              </pre>
<p id="rfc.section.4.2.14.2.1.6.p.2">The method accepts as input a single Function object that will be invoked with a single JavaScript object parameter. The object will contain "height" and "width" properties whose numeric values specify the vertical and horizontal dimensions, in pixels, of the container.</p>
<h1 id="rfc.section.4.2.14.2.1.7">
<a href="#rfc.section.4.2.14.2.1.7">4.2.14.2.1.7.</a> <a href="#gadgets.views.coordinates" id="gadgets.views.coordinates">The Coordinates Object</a>
</h1>
<p id="rfc.section.4.2.14.2.1.7.p.1">When using the <samp>gadgets.views.openGadget</samp>, <samp>gadgets.views.openEmbeddedExperience</samp>, or <samp>gadgets.views.openUrl</samp> methods, developers can use the "opt_params" input parameter to provide the container with information about how and where the gadget, Embedded Experience or URL content is to be rendered.</p>
<p id="rfc.section.4.2.14.2.1.7.p.2">Within the "opt_params" object, when the "viewTarget" property is equal to the literal value "FLOAT", an additional optional "coordinates" property can be specified to provide the specific preferred coordinates at which the floating content is to be positioned. The value of the "coordinates" property is a JavaScript object with the following four properties:</p>
<div id="#rfc.table.59"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Name</th>
<th class="left">Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">top</td>
<td class="left">Number</td>
<td class="left">Specifies the suggested absolute top position, in pixels, of the rendered content relative to the top position of the opening view. If "top" is specified, the "bottom" property MUST NOT be specified.</td>
</tr>
<tr>
<td class="left">bottom</td>
<td class="left">Number</td>
<td class="left">Specifies the suggested absolute bottom position, in pixels, of the rendered content relative to the bottom position of the opening view. If "bottom" is specified, the "top" property MUST NOT be specified.</td>
</tr>
<tr>
<td class="left">left</td>
<td class="left">Number</td>
<td class="left">Specifies the suggested absolute left position, in pixels, of the rendered content relative to the bottom position of the opening view. If "left" is specified, the "right" property MUST NOT be specified.</td>
</tr>
<tr>
<td class="left">right</td>
<td class="left">Number</td>
<td class="left">Specifies the suggested absolute right position, in pixels, of the rendered content relative to the right position of the opening view. If "right" is specified, the "left" property MUST NOT be specified.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.2.14.2.1.7.p.3">Support for the "coordinates" property is only defined when the "viewTarget" property is equal to "FLOAT".</p>
<div id="#rfc.figure.308"></div>
<p>For example:</p>
<pre>
  gadgets.views.openGadget(
    function(response) {},
    function(id) {},
    {
      "view": "foo",
      "viewTarget": "FLOAT",
      "coordinates": {
        "top": 10,
        "left": 20
      }
    }
  );
              </pre>
<h1 id="rfc.section.4.2.15">
<a href="#rfc.section.4.2.15">4.2.15.</a> <a href="#gadgets.window" id="gadgets.window">The Window Features</a>
</h1>
<p id="rfc.section.4.2.15.p.1">Window features are a range of additional capabilities that can be enabled for an application for getting information about and modifying the display area for a view.</p>
<h1 id="rfc.section.4.2.15.1">
<a href="#rfc.section.4.2.15.1">4.2.15.1.</a> The "settitle" Feature</h1>
<p id="rfc.section.4.2.15.1.p.1">The "settitle" feature allows an application to modify the displayed title the container uses for the application instance. Whether or not the title is displayed is up to the container.</p>
<p id="rfc.section.4.2.15.1.p.2">The "settitle" feature is enabled by specifying feature="settitle" within either the &lt;Require&gt; or &lt;Optional&gt; element within the &lt;ModulePrefs&gt;.</p>
<div id="#rfc.figure.309"></div>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      &lt;Require feature="settitle" /&gt;
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;&lt;![CDATA[
      gadgets.util.registerOnLoadHandler(
        function() {
          gadgets.window.setTitle("New Title");
        }
      );
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
       </pre>
<p id="rfc.section.4.2.15.1.p.3">When the "settitle" feature is enabled for an application the <samp>gadgets.window.setTitle</samp> method is provided:</p>
<div id="#rfc.figure.310"></div>
<pre>
  &lt;static&gt; &gt;Void&gt; gadgets.window.setTitle(title)
       </pre>
<p id="rfc.section.4.2.15.1.p.4">The method takes a single String input parameter providing the text to display as the title. No return value is specified.</p>
<h1 id="rfc.section.4.2.15.2">
<a href="#rfc.section.4.2.15.2">4.2.15.2.</a> The "dynamic-height" Feature</h1>
<p id="rfc.section.4.2.15.2.p.1">The "dynamic-height" feature allows an application to request that the container dynamically change the vertical display area allocated to the view based on either the current content of the rendered View or an optionally provided numeric value that specifies the preferred height in pixels.</p>
<p id="rfc.section.4.2.15.2.p.2">The "dynamic-height" feature is enable by specifying feature="dynamic-height" within either the &lt;Require&gt; or &lt;Optional&gt; element within the &lt;ModulePrefs&gt;.</p>
<div id="#rfc.figure.311"></div>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      &lt;Require feature="dynamic-height" /&gt;
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;&lt;![CDATA[
      gadgets.util.registerOnLoadHandler(
        function() {
          for (var n = 0; n &lt; 100; n++) {
            document.write("foo " + n + "&lt;br /&gt;");
          }
          gadgets.window.adjustWidth();
        }
      );
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
       </pre>
<p id="rfc.section.4.2.15.2.p.3">When the "dynamic-height" feature is enabled for an application, both the <samp>gadgets.window.getViewportDimensions</samp> and <samp>gadgets.window.adjustHeight</samp> methods are provided:</p>
<div id="#rfc.figure.312"></div>
<pre>
  &lt;static&gt; &lt;Void&gt; gadgets.window.adjustHeight(opt_height)
       </pre>
<p id="rfc.section.4.2.15.2.p.4">The method takes as input one optional numeric parameter that specifies the preferred height, in pixels, the application would like the container to allocate for the view. The container is free to ignore the provided value. If not specified, the container will calculate an appropriate height for the view based on the content currently displayed within the rendered view.</p>
<h1 id="rfc.section.4.2.15.3">
<a href="#rfc.section.4.2.15.3">4.2.15.3.</a> The "dynamic-width" Feature</h1>
<p id="rfc.section.4.2.15.3.p.1">The "dynamic-width" feature allows an application to request that the container dynamically change the horizontal display area allocated to the view based on either the current content of the rendered View or an optionally provided numeric value that specifies the preferred width in pixels.</p>
<p id="rfc.section.4.2.15.3.p.2">The "dynamic-width" feature is enable by specifying feature="dynamic-width" within either the &lt;Require&gt; or &lt;Optional&gt; element within the &lt;ModulePrefs&gt;</p>
<div id="#rfc.figure.313"></div>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      &lt;Require feature="dynamic-width" /&gt;
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;&lt;![CDATA[
      gadgets.util.registerOnLoadHandler(
        function() {
          for (var n = 0; n &lt; 100; n++) {
            document.write("foo ");
          }
          gadgets.window.adjustWidth();
        }
      );
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
       </pre>
<p id="rfc.section.4.2.15.3.p.3">When the "dynamic-width" feature is enabled for an application, both the <samp>gadgets.window.getViewportDimensions</samp> and <samp>gadgets.window.adjustWidth</samp> methods are provided:</p>
<div id="#rfc.figure.314"></div>
<pre>
  &lt;static&gt; &lt;Void&gt; gadgets.window.adjustWidth(opt_width)
       </pre>
<p id="rfc.section.4.2.15.3.p.4">The method takes as input one optional numeric parameter that specifies the preferred width, in pixels, the application would like the container to allocate for the view. The container is free to ignore the provided value. If not specified, the container will calculate an appropriate width for the view based on the content currently displayed within the rendered view.</p>
<h1 id="rfc.section.4.2.15.4">
<a href="#rfc.section.4.2.15.4">4.2.15.4.</a> The "dynamic-size" Feature</h1>
<p id="rfc.section.4.2.15.4.p.1">The "dynamic-size" feature allows an application to request that the container dynamically change the vertical and horizontal display area allocated to the view based on either the current content of the rendered View or optionally provided numeric values that specify the preferred height and width in pixels.</p>
<p id="rfc.section.4.2.15.4.p.2">The "dynamic-size" feature is enable by specifying feature="dynamic-size" within either the &lt;Require&gt; or &lt;Optional&gt; element within the &lt;ModulePrefs&gt;</p>
<div id="#rfc.figure.315"></div>
<pre>
  &lt;Module&gt;
    &lt;ModulePrefs&gt;
      &lt;Require feature="dynamic-size" /&gt;
    &lt;/ModulePrefs&gt;
    &lt;Content type="html"&gt;&lt;![CDATA[
      gadgets.util.registerOnLoadHandler(
        function() {
          for (var n = 0; n &lt; 100; n++) {
            document.write("foo ");
          }
          gadgets.window.adjustSize();
        }
      );
    ]]&gt;&lt;/Content&gt;
  &lt;/Module&gt;
       </pre>
<p id="rfc.section.4.2.15.4.p.3">When the "dynamic-size" feature is enabled for an application, both the <samp>gadgets.window.getViewportDimensions</samp> and <samp>gadgets.window.adjustSize</samp> methods are provided:</p>
<div id="#rfc.figure.316"></div>
<pre>
  &lt;static&gt; &lt;Void&gt; gadgets.window.adjustSize(opt_height, opt_width)
       </pre>
<p id="rfc.section.4.2.15.4.p.4">The method takes as input two optional numeric parameters that specifies, respectively, the preferred height and width, in pixels, the application would like the container to allocate for the view. The container is free to ignore the provided values. If not specified, the container will calculate appropriate values based on the content currently displayed within the rendered view.</p>
<h1 id="rfc.section.4.2.15.5">
<a href="#rfc.section.4.2.15.5">4.2.15.5.</a> <a href="#gadgets.window.getViewportDimensions" id="gadgets.window.getViewportDimensions">gadgets.window.getViewportDimensions</a>
</h1>
<p id="rfc.section.4.2.15.5.p.1">The <samp>gadgets.window.getViewportDimensions</samp> method detects and returns the height and width of area allocated by the container for the renderable content of the View.</p>
<div id="#rfc.figure.317"></div>
<pre>
  &lt;static&gt; &lt;Object&gt; gadgets.window.getViewportDimensions()
       </pre>
<p id="rfc.section.4.2.15.5.p.2">The method takes no parameters as input and returns a single JavaScript object with "height" and "width" properties whose values specify the number of pixels allocated by the container for the vertical and horizontal display area.</p>
<h1 id="rfc.references">
<a href="#rfc.references">5.</a> References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2606">[RFC2606]</b></td>
<td class="top">
<a href="mailto:dee3@us.ibm.com" title="IBM">Eastlake, D.E.</a> and <a href="mailto:buglady@fuschia.net">A. Panitz</a>, "<a href="http://tools.ietf.org/html/rfc2606">Reserved Top Level DNS Names</a>", BCP 32, RFC 2606, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2616">[RFC2616]</b></td>
<td class="top">
<a href="mailto:fielding@ics.uci.edu" title="Department of Information and Computer Science">Fielding, R.</a>, <a href="mailto:jg@w3.org" title="World Wide Web Consortium">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com" title="Compaq Computer Corporation">Mogul, J.</a>, <a href="mailto:frystyk@w3.org" title="World Wide Web Consortium">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com" title="Xerox Corporation">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com" title="Microsoft Corporation">Leach, P.</a> and <a href="mailto:timbl@w3.org" title="World Wide Web Consortium">T. Berners-Lee</a>, "<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>", RFC 2616, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3986">[RFC3986]</b></td>
<td class="top">
<a href="mailto:timbl@w3.org" title="World Wide Web Consortium">Berners-Lee, T.</a>, <a href="mailto:fielding@gbiv.com" title="Day Software">Fielding, R.</a> and <a href="mailto:LMM@acm.org" title="Adobe Systems Incorporated">L. Masinter</a>, "<a href="http://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>", STD 66, RFC 3986, January 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3987">[RFC3987]</b></td>
<td class="top">
<a>Duerst, M.</a> and <a>M. Suignard</a>, "<a href="http://tools.ietf.org/html/rfc3987">Internationalized Resource Identifiers (IRIs)</a>", RFC 3987, January 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5849">[RFC5849]</b></td>
<td class="top">
<a>Hammer-Lahav, E.</a>, "<a href="http://tools.ietf.org/html/rfc5849">The OAuth 1.0 Protocol</a>", RFC 5849, April 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5988">[RFC5988]</b></td>
<td class="top">
<a>Nottingham, M.</a>, "<a href="http://tools.ietf.org/html/rfc5988">Web Linking</a>", RFC 5988, October 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2617">[RFC2617]</b></td>
<td class="top">
<a href="mailto:john@math.nwu.edu" title="Northwestern University, Department of Mathematics">Franks, J.</a>, <a href="mailto:pbaker@verisign.com" title="Verisign Inc.">Hallam-Baker, P.M.</a>, <a href="mailto:jeff@AbiSource.com" title="AbiSource, Inc.">Hostetler, J.L.</a>, <a href="mailto:lawrence@agranat.com" title="Agranat Systems, Inc.">Lawrence, S.D.</a>, <a href="mailto:paulle@microsoft.com" title="Microsoft Corporation">Leach, P.J.</a>, <a title="Netscape Communications Corporation">Luotonen, A.</a> and <a href="mailto:stewart@OpenMarket.com" title="Open Market, Inc.">L. Stewart</a>, "<a href="http://tools.ietf.org/html/rfc2617">HTTP Authentication: Basic and Digest Access Authentication</a>", RFC 2617, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5234">[RFC5234]</b></td>
<td class="top">
<a>Crocker, D.</a> and <a>P. Overell</a>, "<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>", STD 68, RFC 5234, January 2008.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-oauth-v2">[I-D.ietf-oauth-v2]</b></td>
<td class="top">
<a>Hammer-Lahav, E</a>, <a>Recordon, D</a> and <a>D Hardt</a>, "<a href="http://tools.ietf.org/html/draft-ietf-oauth-v2-26">The OAuth 2.0 Authorization Framework</a>", Internet-Draft draft-ietf-oauth-v2-26, May 2012.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-oauth-v2-bearer">[I-D.ietf-oauth-v2-bearer]</b></td>
<td class="top">
<a>Jones, M</a>, <a>Hardt, D</a> and <a>D Recordon</a>, "<a href="http://tools.ietf.org/html/draft-ietf-oauth-v2-bearer-18">The OAuth 2.0 Authorization Protocol: Bearer Tokens</a>", Internet-Draft draft-ietf-oauth-v2-bearer-18, March 2012.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-oauth-v2-http-mac">[I-D.ietf-oauth-v2-http-mac]</b></td>
<td class="top">
<a>Hammer-Lahav, E</a>, "<a href="http://tools.ietf.org/html/draft-ietf-oauth-v2-http-mac-01">HTTP Authentication: MAC Access Authentication</a>", Internet-Draft draft-ietf-oauth-v2-http-mac-01, February 2012.</td>
</tr>
<tr>
<td class="reference"><b id="W3C.REC-xml-infoset-20040204">[W3C.REC-xml-infoset-20040204]</b></td>
<td class="top">
<a>Tobin, R.</a> and <a>J. Cowan</a>, "<a>XML Information Set (Second Edition)</a>", World Wide Web Consortium Recommendation REC-xml-infoset-20040204, February 2004.</td>
</tr>
<tr>
<td class="reference"><b id="W3C.REC-xmlbase-20090128">[W3C.REC-xmlbase-20090128]</b></td>
<td class="top">
<a>Marsh, J.</a> and <a>R. Tobin</a>, "<a>XML Base (Second Edition)</a>", World Wide Web Consortium Recommendation REC-xmlbase-20090128, January 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RNC">[RNC]</b></td>
<td class="top">
<a href="mailto:jjc@jclark.com">Clark, J.</a>, "<a>RELAX NG Compact Syntax</a>", OASIS , Nov 2002.</td>
</tr>
<tr>
<td class="reference"><b id="JSPEL">[JSPEL]</b></td>
<td class="top">
<a>Chung, K.</a>, <a>DeLisle, P.</a> and <a>M. Roth</a>, "<a>Java Server Pages Expression Language</a>", May 2006.</td>
</tr>
<tr>
<td class="reference"><b id="OAHub2.0">[OAHub2.0]</b></td>
<td class="top">
<a>OpenAjax Hub 2.0</a>", .</td>, "</tr>
<tr>
<td class="reference"><b id="OpenSocial-Specification">[OpenSocial-Specification]</b></td>
<td class="top">
<a>OpenSocial Templating Specification</a>", August 2011.</td>, "</tr>
<tr>
<td class="reference"><b id="OpenSocial-Templating">[OpenSocial-Templating]</b></td>
<td class="top">
<a>OpenSocial Templating Specification</a>", August 2011.</td>, "</tr>
<tr>
<td class="reference"><b id="core-api">[core-api]</b></td>
<td class="top">
<a>OpenSocial Core API Specification v3.0</a>", April 2012.</td>, "</tr>
<tr>
<td class="reference"><b id="social-app">[social-app]</b></td>
<td class="top">
<a>OpenSocial Social Application Specification 3.0</a>", April 2012.</td>, "</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">OpenSocial and Gadgets Specification Group</span> 
	  <span class="n hidden">
		<span class="family-name"></span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:opensocial-and-gadgets-spec@googlegroups.com">opensocial-and-gadgets-spec@googlegroups.com</a></span>

  </address>
</div>

</body>
</html>